import {
  Component,
  LogLevel,
  Logger,
  __awaiter,
  __extends,
  __generator,
  __spreadArray,
  createMockUserToken,
  getModularInstance,
  getUA,
  index_esm_default,
  isBrowserExtension,
  isElectron,
  isIE,
  isMobileCordova,
  isReactNative,
  isUWP
} from "./chunk-MGMOBR5X.js";
import "./chunk-HV27UI33.js";

// node_modules/@firebase/webchannel-wrapper/dist/index.esm.js
var extendStatics = function(d, b) {
  extendStatics = Object.setPrototypeOf || { __proto__: [] } instanceof Array && function(d2, b2) {
    d2.__proto__ = b2;
  } || function(d2, b2) {
    for (var p2 in b2)
      if (Object.prototype.hasOwnProperty.call(b2, p2))
        d2[p2] = b2[p2];
  };
  return extendStatics(d, b);
};
function __extends2(d, b) {
  extendStatics(d, b);
  function __() {
    this.constructor = d;
  }
  d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());
}
function __values(o) {
  var s = typeof Symbol === "function" && Symbol.iterator, m = s && o[s], i = 0;
  if (m)
    return m.call(o);
  if (o && typeof o.length === "number")
    return {
      next: function() {
        if (o && i >= o.length)
          o = void 0;
        return { value: o && o[i++], done: !o };
      }
    };
  throw new TypeError(s ? "Object is not iterable." : "Symbol.iterator is not defined.");
}
var commonjsGlobal = typeof globalThis !== "undefined" ? globalThis : typeof window !== "undefined" ? window : typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : {};
var g;
var goog = goog || {};
var k = commonjsGlobal || self;
function aa() {
}
function ba(a) {
  var b = typeof a;
  b = b != "object" ? b : a ? Array.isArray(a) ? "array" : b : "null";
  return b == "array" || b == "object" && typeof a.length == "number";
}
function n(a) {
  var b = typeof a;
  return b == "object" && a != null || b == "function";
}
function ca(a) {
  return Object.prototype.hasOwnProperty.call(a, da) && a[da] || (a[da] = ++ea);
}
var da = "closure_uid_" + (1e9 * Math.random() >>> 0);
var ea = 0;
function fa(a, b, c) {
  return a.call.apply(a.bind, arguments);
}
function ha(a, b, c) {
  if (!a)
    throw Error();
  if (2 < arguments.length) {
    var d = Array.prototype.slice.call(arguments, 2);
    return function() {
      var e = Array.prototype.slice.call(arguments);
      Array.prototype.unshift.apply(e, d);
      return a.apply(b, e);
    };
  }
  return function() {
    return a.apply(b, arguments);
  };
}
function p(a, b, c) {
  Function.prototype.bind && Function.prototype.bind.toString().indexOf("native code") != -1 ? p = fa : p = ha;
  return p.apply(null, arguments);
}
function ia(a, b) {
  var c = Array.prototype.slice.call(arguments, 1);
  return function() {
    var d = c.slice();
    d.push.apply(d, arguments);
    return a.apply(this, d);
  };
}
function q() {
  return Date.now();
}
function r(a, b) {
  function c() {
  }
  c.prototype = b.prototype;
  a.X = b.prototype;
  a.prototype = new c();
  a.prototype.constructor = a;
  a.Pb = function(d, e, f) {
    for (var h = Array(arguments.length - 2), m = 2; m < arguments.length; m++)
      h[m - 2] = arguments[m];
    return b.prototype[e].apply(d, h);
  };
}
function t() {
  this.j = this.j;
  this.i = this.i;
}
var ka = 0;
t.prototype.j = false;
t.prototype.ka = function() {
  if (!this.j && (this.j = true, this.H(), ka != 0)) {
    var a = ca(this);
  }
};
t.prototype.H = function() {
  if (this.i)
    for (; this.i.length; )
      this.i.shift()();
};
var ma = Array.prototype.indexOf ? function(a, b) {
  return Array.prototype.indexOf.call(a, b, void 0);
} : function(a, b) {
  if (typeof a === "string")
    return typeof b !== "string" || b.length != 1 ? -1 : a.indexOf(b, 0);
  for (var c = 0; c < a.length; c++)
    if (c in a && a[c] === b)
      return c;
  return -1;
};
var na = Array.prototype.forEach ? function(a, b, c) {
  Array.prototype.forEach.call(a, b, c);
} : function(a, b, c) {
  for (var d = a.length, e = typeof a === "string" ? a.split("") : a, f = 0; f < d; f++)
    f in e && b.call(c, e[f], f, a);
};
function oa(a) {
  a: {
    var b = pa;
    for (var c = a.length, d = typeof a === "string" ? a.split("") : a, e = 0; e < c; e++)
      if (e in d && b.call(void 0, d[e], e, a)) {
        b = e;
        break a;
      }
    b = -1;
  }
  return 0 > b ? null : typeof a === "string" ? a.charAt(b) : a[b];
}
function qa(a) {
  return Array.prototype.concat.apply([], arguments);
}
function ra(a) {
  var b = a.length;
  if (0 < b) {
    for (var c = Array(b), d = 0; d < b; d++)
      c[d] = a[d];
    return c;
  }
  return [];
}
function sa(a) {
  return /^[\s\xa0]*$/.test(a);
}
var ta = String.prototype.trim ? function(a) {
  return a.trim();
} : function(a) {
  return /^[\s\xa0]*([\s\S]*?)[\s\xa0]*$/.exec(a)[1];
};
function u(a, b) {
  return a.indexOf(b) != -1;
}
function ua(a, b) {
  return a < b ? -1 : a > b ? 1 : 0;
}
var w;
a: {
  va2 = k.navigator;
  if (va2) {
    wa2 = va2.userAgent;
    if (wa2) {
      w = wa2;
      break a;
    }
  }
  w = "";
}
var va2;
var wa2;
function xa(a, b, c) {
  for (var d in a)
    b.call(c, a[d], d, a);
}
function ya(a) {
  var b = {};
  for (var c in a)
    b[c] = a[c];
  return b;
}
var za = "constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");
function Ca(a, b) {
  var c, d;
  for (var e = 1; e < arguments.length; e++) {
    d = arguments[e];
    for (c in d)
      a[c] = d[c];
    for (var f = 0; f < za.length; f++)
      c = za[f], Object.prototype.hasOwnProperty.call(d, c) && (a[c] = d[c]);
  }
}
function Da(a) {
  Da[" "](a);
  return a;
}
Da[" "] = aa;
function Ea(a, b) {
  var c = Fa;
  return Object.prototype.hasOwnProperty.call(c, a) ? c[a] : c[a] = b(a);
}
var Ga = u(w, "Opera");
var x = u(w, "Trident") || u(w, "MSIE");
var Ha = u(w, "Edge");
var Ia = Ha || x;
var Ja = u(w, "Gecko") && !(u(w.toLowerCase(), "webkit") && !u(w, "Edge")) && !(u(w, "Trident") || u(w, "MSIE")) && !u(w, "Edge");
var Ka = u(w.toLowerCase(), "webkit") && !u(w, "Edge");
function La() {
  var a = k.document;
  return a ? a.documentMode : void 0;
}
var Ma;
a: {
  Na2 = "", Oa2 = function() {
    var a = w;
    if (Ja)
      return /rv:([^\);]+)(\)|;)/.exec(a);
    if (Ha)
      return /Edge\/([\d\.]+)/.exec(a);
    if (x)
      return /\b(?:MSIE|rv)[: ]([^\);]+)(\)|;)/.exec(a);
    if (Ka)
      return /WebKit\/(\S+)/.exec(a);
    if (Ga)
      return /(?:Version)[ \/]?(\S+)/.exec(a);
  }();
  Oa2 && (Na2 = Oa2 ? Oa2[1] : "");
  if (x) {
    Pa2 = La();
    if (Pa2 != null && Pa2 > parseFloat(Na2)) {
      Ma = String(Pa2);
      break a;
    }
  }
  Ma = Na2;
}
var Na2;
var Oa2;
var Pa2;
var Fa = {};
function Qa(a) {
  return Ea(a, function() {
    {
      var b = 0;
      var e = ta(String(Ma)).split("."), f = ta(String(a)).split("."), h = Math.max(e.length, f.length);
      for (var m = 0; b == 0 && m < h; m++) {
        var c = e[m] || "", d = f[m] || "";
        do {
          c = /(\d*)(\D*)(.*)/.exec(c) || ["", "", "", ""];
          d = /(\d*)(\D*)(.*)/.exec(d) || ["", "", "", ""];
          if (c[0].length == 0 && d[0].length == 0)
            break;
          b = ua(c[1].length == 0 ? 0 : parseInt(c[1], 10), d[1].length == 0 ? 0 : parseInt(d[1], 10)) || ua(c[2].length == 0, d[2].length == 0) || ua(c[2], d[2]);
          c = c[3];
          d = d[3];
        } while (b == 0);
      }
    }
    return 0 <= b;
  });
}
var Ra;
if (k.document && x) {
  Sa2 = La();
  Ra = Sa2 ? Sa2 : parseInt(Ma, 10) || void 0;
} else
  Ra = void 0;
var Sa2;
var Ta = Ra;
var Ua = !x || 9 <= Number(Ta);
var Va = x && !Qa("9");
var Wa = function() {
  if (!k.addEventListener || !Object.defineProperty)
    return false;
  var a = false, b = Object.defineProperty({}, "passive", { get: function() {
    a = true;
  } });
  try {
    k.addEventListener("test", aa, b), k.removeEventListener("test", aa, b);
  } catch (c) {
  }
  return a;
}();
function y(a, b) {
  this.type = a;
  this.a = this.target = b;
  this.defaultPrevented = false;
}
y.prototype.b = function() {
  this.defaultPrevented = true;
};
function z(a, b) {
  y.call(this, a ? a.type : "");
  this.relatedTarget = this.a = this.target = null;
  this.button = this.screenY = this.screenX = this.clientY = this.clientX = 0;
  this.key = "";
  this.metaKey = this.shiftKey = this.altKey = this.ctrlKey = false;
  this.pointerId = 0;
  this.pointerType = "";
  this.c = null;
  if (a) {
    var c = this.type = a.type, d = a.changedTouches && a.changedTouches.length ? a.changedTouches[0] : null;
    this.target = a.target || a.srcElement;
    this.a = b;
    if (b = a.relatedTarget) {
      if (Ja) {
        a: {
          try {
            Da(b.nodeName);
            var e = true;
            break a;
          } catch (f) {
          }
          e = false;
        }
        e || (b = null);
      }
    } else
      c == "mouseover" ? b = a.fromElement : c == "mouseout" && (b = a.toElement);
    this.relatedTarget = b;
    d ? (this.clientX = d.clientX !== void 0 ? d.clientX : d.pageX, this.clientY = d.clientY !== void 0 ? d.clientY : d.pageY, this.screenX = d.screenX || 0, this.screenY = d.screenY || 0) : (this.clientX = a.clientX !== void 0 ? a.clientX : a.pageX, this.clientY = a.clientY !== void 0 ? a.clientY : a.pageY, this.screenX = a.screenX || 0, this.screenY = a.screenY || 0);
    this.button = a.button;
    this.key = a.key || "";
    this.ctrlKey = a.ctrlKey;
    this.altKey = a.altKey;
    this.shiftKey = a.shiftKey;
    this.metaKey = a.metaKey;
    this.pointerId = a.pointerId || 0;
    this.pointerType = typeof a.pointerType === "string" ? a.pointerType : Xa[a.pointerType] || "";
    this.c = a;
    a.defaultPrevented && this.b();
  }
}
r(z, y);
var Xa = { 2: "touch", 3: "pen", 4: "mouse" };
z.prototype.b = function() {
  z.X.b.call(this);
  var a = this.c;
  if (a.preventDefault)
    a.preventDefault();
  else if (a.returnValue = false, Va)
    try {
      if (a.ctrlKey || 112 <= a.keyCode && 123 >= a.keyCode)
        a.keyCode = -1;
    } catch (b) {
    }
};
var A = "closure_listenable_" + (1e6 * Math.random() | 0);
var Ya = 0;
function Za(a, b, c, d, e) {
  this.listener = a;
  this.proxy = null;
  this.src = b;
  this.type = c;
  this.capture = !!d;
  this.da = e;
  this.key = ++Ya;
  this.Y = this.Z = false;
}
function $a(a) {
  a.Y = true;
  a.listener = null;
  a.proxy = null;
  a.src = null;
  a.da = null;
}
function ab(a) {
  this.src = a;
  this.a = {};
  this.b = 0;
}
ab.prototype.add = function(a, b, c, d, e) {
  var f = a.toString();
  a = this.a[f];
  a || (a = this.a[f] = [], this.b++);
  var h = bb(a, b, d, e);
  -1 < h ? (b = a[h], c || (b.Z = false)) : (b = new Za(b, this.src, f, !!d, e), b.Z = c, a.push(b));
  return b;
};
function cb(a, b) {
  var c = b.type;
  if (c in a.a) {
    var d = a.a[c], e = ma(d, b), f;
    (f = 0 <= e) && Array.prototype.splice.call(d, e, 1);
    f && ($a(b), a.a[c].length == 0 && (delete a.a[c], a.b--));
  }
}
function bb(a, b, c, d) {
  for (var e = 0; e < a.length; ++e) {
    var f = a[e];
    if (!f.Y && f.listener == b && f.capture == !!c && f.da == d)
      return e;
  }
  return -1;
}
var db = "closure_lm_" + (1e6 * Math.random() | 0);
var eb = {};
function gb(a, b, c, d, e) {
  if (d && d.once)
    return hb(a, b, c, d, e);
  if (Array.isArray(b)) {
    for (var f = 0; f < b.length; f++)
      gb(a, b[f], c, d, e);
    return null;
  }
  c = ib(c);
  return a && a[A] ? a.wa(b, c, n(d) ? !!d.capture : !!d, e) : jb(a, b, c, false, d, e);
}
function jb(a, b, c, d, e, f) {
  if (!b)
    throw Error("Invalid event type");
  var h = n(e) ? !!e.capture : !!e;
  if (h && !Ua)
    return null;
  var m = kb(a);
  m || (a[db] = m = new ab(a));
  c = m.add(b, c, d, h, f);
  if (c.proxy)
    return c;
  d = lb();
  c.proxy = d;
  d.src = a;
  d.listener = c;
  if (a.addEventListener)
    Wa || (e = h), e === void 0 && (e = false), a.addEventListener(b.toString(), d, e);
  else if (a.attachEvent)
    a.attachEvent(mb(b.toString()), d);
  else if (a.addListener && a.removeListener)
    a.addListener(d);
  else
    throw Error("addEventListener and attachEvent are unavailable.");
  return c;
}
function lb() {
  var a = nb, b = Ua ? function(c) {
    return a.call(b.src, b.listener, c);
  } : function(c) {
    c = a.call(b.src, b.listener, c);
    if (!c)
      return c;
  };
  return b;
}
function hb(a, b, c, d, e) {
  if (Array.isArray(b)) {
    for (var f = 0; f < b.length; f++)
      hb(a, b[f], c, d, e);
    return null;
  }
  c = ib(c);
  return a && a[A] ? a.xa(b, c, n(d) ? !!d.capture : !!d, e) : jb(a, b, c, true, d, e);
}
function ob(a, b, c, d, e) {
  if (Array.isArray(b))
    for (var f = 0; f < b.length; f++)
      ob(a, b[f], c, d, e);
  else
    (d = n(d) ? !!d.capture : !!d, c = ib(c), a && a[A]) ? (a = a.c, b = String(b).toString(), b in a.a && (f = a.a[b], c = bb(f, c, d, e), -1 < c && ($a(f[c]), Array.prototype.splice.call(f, c, 1), f.length == 0 && (delete a.a[b], a.b--)))) : a && (a = kb(a)) && (b = a.a[b.toString()], a = -1, b && (a = bb(b, c, d, e)), (c = -1 < a ? b[a] : null) && pb(c));
}
function pb(a) {
  if (typeof a !== "number" && a && !a.Y) {
    var b = a.src;
    if (b && b[A])
      cb(b.c, a);
    else {
      var c = a.type, d = a.proxy;
      b.removeEventListener ? b.removeEventListener(c, d, a.capture) : b.detachEvent ? b.detachEvent(mb(c), d) : b.addListener && b.removeListener && b.removeListener(d);
      (c = kb(b)) ? (cb(c, a), c.b == 0 && (c.src = null, b[db] = null)) : $a(a);
    }
  }
}
function mb(a) {
  return a in eb ? eb[a] : eb[a] = "on" + a;
}
function qb(a, b) {
  var c = a.listener, d = a.da || a.src;
  a.Z && pb(a);
  return c.call(d, b);
}
function nb(a, b) {
  if (a.Y)
    return true;
  if (!Ua) {
    if (!b)
      a: {
        b = ["window", "event"];
        for (var c = k, d = 0; d < b.length; d++)
          if (c = c[b[d]], c == null) {
            b = null;
            break a;
          }
        b = c;
      }
    b = new z(b, this);
    return qb(a, b);
  }
  return qb(a, new z(b, this));
}
function kb(a) {
  a = a[db];
  return a instanceof ab ? a : null;
}
var rb = "__closure_events_fn_" + (1e9 * Math.random() >>> 0);
function ib(a) {
  if (typeof a === "function")
    return a;
  a[rb] || (a[rb] = function(b) {
    return a.handleEvent(b);
  });
  return a[rb];
}
function D() {
  t.call(this);
  this.c = new ab(this);
  this.J = this;
  this.D = null;
}
r(D, t);
D.prototype[A] = true;
g = D.prototype;
g.addEventListener = function(a, b, c, d) {
  gb(this, a, b, c, d);
};
g.removeEventListener = function(a, b, c, d) {
  ob(this, a, b, c, d);
};
function E(a, b) {
  var c, d = a.D;
  if (d)
    for (c = []; d; d = d.D)
      c.push(d);
  a = a.J;
  d = b.type || b;
  if (typeof b === "string")
    b = new y(b, a);
  else if (b instanceof y)
    b.target = b.target || a;
  else {
    var e = b;
    b = new y(d, a);
    Ca(b, e);
  }
  e = true;
  if (c)
    for (var f = c.length - 1; 0 <= f; f--) {
      var h = b.a = c[f];
      e = sb(h, d, true, b) && e;
    }
  h = b.a = a;
  e = sb(h, d, true, b) && e;
  e = sb(h, d, false, b) && e;
  if (c)
    for (f = 0; f < c.length; f++)
      h = b.a = c[f], e = sb(h, d, false, b) && e;
}
g.H = function() {
  D.X.H.call(this);
  if (this.c) {
    var a = this.c, c;
    for (c in a.a) {
      for (var d = a.a[c], e = 0; e < d.length; e++)
        $a(d[e]);
      delete a.a[c];
      a.b--;
    }
  }
  this.D = null;
};
g.wa = function(a, b, c, d) {
  return this.c.add(String(a), b, false, c, d);
};
g.xa = function(a, b, c, d) {
  return this.c.add(String(a), b, true, c, d);
};
function sb(a, b, c, d) {
  b = a.c.a[String(b)];
  if (!b)
    return true;
  b = b.concat();
  for (var e = true, f = 0; f < b.length; ++f) {
    var h = b[f];
    if (h && !h.Y && h.capture == c) {
      var m = h.listener, l = h.da || h.src;
      h.Z && cb(a.c, h);
      e = m.call(l, d) !== false && e;
    }
  }
  return e && !d.defaultPrevented;
}
var tb = k.JSON.stringify;
function ub() {
  this.b = this.a = null;
}
var wb = new (function() {
  function class_1(a, b) {
    this.c = a;
    this.f = b;
    this.b = 0;
    this.a = null;
  }
  class_1.prototype.get = function() {
    var a;
    0 < this.b ? (this.b--, a = this.a, this.a = a.next, a.next = null) : a = this.c();
    return a;
  };
  return class_1;
}())(function() {
  return new vb();
}, function(a) {
  a.reset();
});
ub.prototype.add = function(a, b) {
  var c = wb.get();
  c.set(a, b);
  this.b ? this.b.next = c : this.a = c;
  this.b = c;
};
function xb() {
  var a = zb, b = null;
  a.a && (b = a.a, a.a = a.a.next, a.a || (a.b = null), b.next = null);
  return b;
}
function vb() {
  this.next = this.b = this.a = null;
}
vb.prototype.set = function(a, b) {
  this.a = a;
  this.b = b;
  this.next = null;
};
vb.prototype.reset = function() {
  this.next = this.b = this.a = null;
};
function Ab(a) {
  k.setTimeout(function() {
    throw a;
  }, 0);
}
function Bb(a, b) {
  Cb || Db();
  Eb || (Cb(), Eb = true);
  zb.add(a, b);
}
var Cb;
function Db() {
  var a = k.Promise.resolve(void 0);
  Cb = function() {
    a.then(Fb);
  };
}
var Eb = false;
var zb = new ub();
function Fb() {
  for (var a; a = xb(); ) {
    try {
      a.a.call(a.b);
    } catch (c) {
      Ab(c);
    }
    var b = wb;
    b.f(a);
    100 > b.b && (b.b++, a.next = b.a, b.a = a);
  }
  Eb = false;
}
function Gb(a, b) {
  D.call(this);
  this.b = a || 1;
  this.a = b || k;
  this.f = p(this.eb, this);
  this.g = q();
}
r(Gb, D);
g = Gb.prototype;
g.aa = false;
g.M = null;
g.eb = function() {
  if (this.aa) {
    var a = q() - this.g;
    0 < a && a < 0.8 * this.b ? this.M = this.a.setTimeout(this.f, this.b - a) : (this.M && (this.a.clearTimeout(this.M), this.M = null), E(this, "tick"), this.aa && (Hb(this), this.start()));
  }
};
g.start = function() {
  this.aa = true;
  this.M || (this.M = this.a.setTimeout(this.f, this.b), this.g = q());
};
function Hb(a) {
  a.aa = false;
  a.M && (a.a.clearTimeout(a.M), a.M = null);
}
g.H = function() {
  Gb.X.H.call(this);
  Hb(this);
  delete this.a;
};
function Ib(a, b, c) {
  if (typeof a === "function")
    c && (a = p(a, c));
  else if (a && typeof a.handleEvent == "function")
    a = p(a.handleEvent, a);
  else
    throw Error("Invalid listener argument");
  return 2147483647 < Number(b) ? -1 : k.setTimeout(a, b || 0);
}
function Jb(a) {
  a.a = Ib(function() {
    a.a = null;
    a.c && (a.c = false, Jb(a));
  }, a.h);
  var b = a.b;
  a.b = null;
  a.g.apply(null, b);
}
var Kb = function(_super) {
  __extends2(Kb2, _super);
  function Kb2(a, b) {
    var _this = _super.call(this) || this;
    _this.g = a;
    _this.h = b;
    _this.b = null;
    _this.c = false;
    _this.a = null;
    return _this;
  }
  Kb2.prototype.f = function(a) {
    this.b = arguments;
    this.a ? this.c = true : Jb(this);
  };
  Kb2.prototype.H = function() {
    _super.prototype.H.call(this);
    this.a && (k.clearTimeout(this.a), this.a = null, this.c = false, this.b = null);
  };
  return Kb2;
}(t);
function F(a) {
  t.call(this);
  this.b = a;
  this.a = {};
}
r(F, t);
var Lb = [];
function Mb(a, b, c, d) {
  Array.isArray(c) || (c && (Lb[0] = c.toString()), c = Lb);
  for (var e = 0; e < c.length; e++) {
    var f = gb(b, c[e], d || a.handleEvent, false, a.b || a);
    if (!f)
      break;
    a.a[f.key] = f;
  }
}
function Nb(a) {
  xa(a.a, function(b, c) {
    this.a.hasOwnProperty(c) && pb(b);
  }, a);
  a.a = {};
}
F.prototype.H = function() {
  F.X.H.call(this);
  Nb(this);
};
F.prototype.handleEvent = function() {
  throw Error("EventHandler.handleEvent not implemented");
};
function Ob() {
  this.a = true;
}
function Pb(a, b, c, d, e, f) {
  a.info(function() {
    if (a.a)
      if (f) {
        var h = "";
        for (var m = f.split("&"), l = 0; l < m.length; l++) {
          var v = m[l].split("=");
          if (1 < v.length) {
            var C2 = v[0];
            v = v[1];
            var B2 = C2.split("_");
            h = 2 <= B2.length && B2[1] == "type" ? h + (C2 + "=" + v + "&") : h + (C2 + "=redacted&");
          }
        }
      } else
        h = null;
    else
      h = f;
    return "XMLHTTP REQ (" + d + ") [attempt " + e + "]: " + b + "\n" + c + "\n" + h;
  });
}
function Qb(a, b, c, d, e, f, h) {
  a.info(function() {
    return "XMLHTTP RESP (" + d + ") [ attempt " + e + "]: " + b + "\n" + c + "\n" + f + " " + h;
  });
}
function G(a, b, c, d) {
  a.info(function() {
    return "XMLHTTP TEXT (" + b + "): " + Rb(a, c) + (d ? " " + d : "");
  });
}
function Sb(a, b) {
  a.info(function() {
    return "TIMEOUT: " + b;
  });
}
Ob.prototype.info = function() {
};
function Rb(a, b) {
  if (!a.a)
    return b;
  if (!b)
    return null;
  try {
    var c = JSON.parse(b);
    if (c) {
      for (a = 0; a < c.length; a++)
        if (Array.isArray(c[a])) {
          var d = c[a];
          if (!(2 > d.length)) {
            var e = d[1];
            if (Array.isArray(e) && !(1 > e.length)) {
              var f = e[0];
              if (f != "noop" && f != "stop" && f != "close")
                for (var h = 1; h < e.length; h++)
                  e[h] = "";
            }
          }
        }
    }
    return tb(c);
  } catch (m) {
    return b;
  }
}
var H = {};
var Tb = null;
function Ub() {
  return Tb = Tb || new D();
}
H.Ga = "serverreachability";
function Vb(a) {
  y.call(this, H.Ga, a);
}
r(Vb, y);
function I(a) {
  var b = Ub();
  E(b, new Vb(b, a));
}
H.STAT_EVENT = "statevent";
function Wb(a, b) {
  y.call(this, H.STAT_EVENT, a);
  this.stat = b;
}
r(Wb, y);
function J(a) {
  var b = Ub();
  E(b, new Wb(b, a));
}
H.Ha = "timingevent";
function Xb(a) {
  y.call(this, H.Ha, a);
}
r(Xb, y);
function K(a, b) {
  if (typeof a !== "function")
    throw Error("Fn must not be null and must be a function");
  return k.setTimeout(function() {
    a();
  }, b);
}
var Yb = { NO_ERROR: 0, fb: 1, sb: 2, rb: 3, mb: 4, qb: 5, tb: 6, Ea: 7, TIMEOUT: 8, wb: 9 };
var Zb = { kb: "complete", Gb: "success", Fa: "error", Ea: "abort", yb: "ready", zb: "readystatechange", TIMEOUT: "timeout", ub: "incrementaldata", xb: "progress", nb: "downloadprogress", Ob: "uploadprogress" };
function $b() {
}
$b.prototype.b = null;
function ac(a) {
  return a.b || (a.b = a.c());
}
function bc() {
}
var L = { OPEN: "a", jb: "b", Fa: "c", vb: "d" };
function cc() {
  y.call(this, "d");
}
r(cc, y);
function dc() {
  y.call(this, "c");
}
r(dc, y);
var ec;
function fc() {
}
r(fc, $b);
fc.prototype.a = function() {
  return new XMLHttpRequest();
};
fc.prototype.c = function() {
  return {};
};
ec = new fc();
function M(a, b, c, d) {
  this.g = a;
  this.c = b;
  this.f = c;
  this.S = d || 1;
  this.J = new F(this);
  this.P = gc;
  a = Ia ? 125 : void 0;
  this.R = new Gb(a);
  this.B = null;
  this.b = false;
  this.j = this.l = this.i = this.G = this.u = this.T = this.o = null;
  this.s = [];
  this.a = null;
  this.D = 0;
  this.h = this.m = null;
  this.N = -1;
  this.A = false;
  this.O = 0;
  this.F = null;
  this.V = this.C = this.U = this.I = false;
}
var gc = 45e3;
var hc = {};
var ic = {};
g = M.prototype;
g.setTimeout = function(a) {
  this.P = a;
};
function jc(a, b, c) {
  a.G = 1;
  a.i = kc(N(b));
  a.j = c;
  a.I = true;
  lc(a, null);
}
function lc(a, b) {
  a.u = q();
  mc(a);
  a.l = N(a.i);
  var c = a.l, d = a.S;
  Array.isArray(d) || (d = [String(d)]);
  nc(c.b, "t", d);
  a.D = 0;
  a.a = oc(a.g, a.g.C ? b : null);
  0 < a.O && (a.F = new Kb(p(a.Da, a, a.a), a.O));
  Mb(a.J, a.a, "readystatechange", a.bb);
  b = a.B ? ya(a.B) : {};
  a.j ? (a.m || (a.m = "POST"), b["Content-Type"] = "application/x-www-form-urlencoded", a.a.ba(a.l, a.m, a.j, b)) : (a.m = "GET", a.a.ba(a.l, a.m, null, b));
  I(1);
  Pb(a.c, a.m, a.l, a.f, a.S, a.j);
}
g.bb = function(a) {
  a = a.target;
  var b = this.F;
  b && O(a) == 3 ? b.f() : this.Da(a);
};
g.Da = function(a) {
  try {
    if (a == this.a)
      a: {
        var b = O(this.a), c = this.a.va(), d = this.a.W();
        if (!(3 > b || b == 3 && !Ia && !this.a.$())) {
          this.A || b != 4 || c == 7 || (c == 8 || 0 >= d ? I(3) : I(2));
          pc(this);
          var e = this.a.W();
          this.N = e;
          var f = this.a.$();
          this.b = e == 200;
          Qb(this.c, this.m, this.l, this.f, this.S, b, e);
          if (this.b) {
            if (this.U && !this.C) {
              b: {
                if (this.a) {
                  var h, m = this.a;
                  if ((h = m.a ? m.a.getResponseHeader("X-HTTP-Initial-Response") : null) && !sa(h)) {
                    var l = h;
                    break b;
                  }
                }
                l = null;
              }
              if (l)
                G(this.c, this.f, l, "Initial handshake response via X-HTTP-Initial-Response"), this.C = true, qc(this, l);
              else {
                this.b = false;
                this.h = 3;
                J(12);
                P(this);
                rc(this);
                break a;
              }
            }
            this.I ? (sc(this, b, f), Ia && this.b && b == 3 && (Mb(this.J, this.R, "tick", this.ab), this.R.start())) : (G(this.c, this.f, f, null), qc(this, f));
            b == 4 && P(this);
            this.b && !this.A && (b == 4 ? tc(this.g, this) : (this.b = false, mc(this)));
          } else
            e == 400 && 0 < f.indexOf("Unknown SID") ? (this.h = 3, J(12)) : (this.h = 0, J(13)), P(this), rc(this);
        }
      }
  } catch (v) {
  } finally {
  }
};
function sc(a, b, c) {
  for (var d = true; !a.A && a.D < c.length; ) {
    var e = uc(a, c);
    if (e == ic) {
      b == 4 && (a.h = 4, J(14), d = false);
      G(a.c, a.f, null, "[Incomplete Response]");
      break;
    } else if (e == hc) {
      a.h = 4;
      J(15);
      G(a.c, a.f, c, "[Invalid Chunk]");
      d = false;
      break;
    } else
      G(a.c, a.f, e, null), qc(a, e);
  }
  b == 4 && c.length == 0 && (a.h = 1, J(16), d = false);
  a.b = a.b && d;
  d ? 0 < c.length && !a.V && (a.V = true, b = a.g, b.a == a && b.U && !b.F && (b.c.info("Great, no buffering proxy detected. Bytes received: " + c.length), vc(b), b.F = true, J(11))) : (G(a.c, a.f, c, "[Invalid Chunked Response]"), P(a), rc(a));
}
g.ab = function() {
  if (this.a) {
    var a = O(this.a), b = this.a.$();
    this.D < b.length && (pc(this), sc(this, a, b), this.b && a != 4 && mc(this));
  }
};
function uc(a, b) {
  var c = a.D, d = b.indexOf("\n", c);
  if (d == -1)
    return ic;
  c = Number(b.substring(c, d));
  if (isNaN(c))
    return hc;
  d += 1;
  if (d + c > b.length)
    return ic;
  b = b.substr(d, c);
  a.D = d + c;
  return b;
}
g.cancel = function() {
  this.A = true;
  P(this);
};
function mc(a) {
  a.T = q() + a.P;
  wc(a, a.P);
}
function wc(a, b) {
  if (a.o != null)
    throw Error("WatchDog timer not null");
  a.o = K(p(a.$a, a), b);
}
function pc(a) {
  a.o && (k.clearTimeout(a.o), a.o = null);
}
g.$a = function() {
  this.o = null;
  var a = q();
  0 <= a - this.T ? (Sb(this.c, this.l), this.G != 2 && (I(3), J(17)), P(this), this.h = 2, rc(this)) : wc(this, this.T - a);
};
function rc(a) {
  a.g.v == 0 || a.A || tc(a.g, a);
}
function P(a) {
  pc(a);
  var b = a.F;
  b && typeof b.ka == "function" && b.ka();
  a.F = null;
  Hb(a.R);
  Nb(a.J);
  a.a && (b = a.a, a.a = null, b.abort(), b.ka());
}
function qc(a, b) {
  try {
    var c = a.g;
    if (c.v != 0 && (c.a == a || xc(c.b, a))) {
      if (c.I = a.N, !a.C && xc(c.b, a) && c.v == 3) {
        try {
          var d = c.la.a.parse(b);
        } catch (yc2) {
          d = null;
        }
        if (Array.isArray(d) && d.length == 3) {
          var e = d;
          if (e[0] == 0)
            a: {
              if (!c.j) {
                if (c.a)
                  if (c.a.u + 3e3 < a.u)
                    zc(c), Ac(c);
                  else
                    break a;
                Bc(c);
                J(18);
              }
            }
          else
            c.pa = e[1], 0 < c.pa - c.P && 37500 > e[2] && c.G && c.o == 0 && !c.m && (c.m = K(p(c.Xa, c), 6e3));
          if (1 >= Dc(c.b) && c.fa) {
            try {
              c.fa();
            } catch (yc2) {
            }
            c.fa = void 0;
          }
        } else
          Q(c, 11);
      } else if ((a.C || c.a == a) && zc(c), !sa(b))
        for (b = d = c.la.a.parse(b), d = 0; d < b.length; d++)
          if (e = b[d], c.P = e[0], e = e[1], c.v == 2)
            if (e[0] == "c") {
              c.J = e[1];
              c.ha = e[2];
              var f = e[3];
              f != null && (c.ia = f, c.c.info("VER=" + c.ia));
              var h = e[4];
              h != null && (c.qa = h, c.c.info("SVER=" + c.qa));
              var m = e[5];
              if (m != null && typeof m === "number" && 0 < m) {
                var l = 1.5 * m;
                c.D = l;
                c.c.info("backChannelRequestTimeoutMs_=" + l);
              }
              l = c;
              var v = a.a;
              if (v) {
                var C2 = v.a ? v.a.getResponseHeader("X-Client-Wire-Protocol") : null;
                if (C2) {
                  var B2 = l.b;
                  !B2.a && (u(C2, "spdy") || u(C2, "quic") || u(C2, "h2")) && (B2.f = B2.g, B2.a = new Set(), B2.b && (Ec(B2, B2.b), B2.b = null));
                }
                if (l.A) {
                  var yb = v.a ? v.a.getResponseHeader("X-HTTP-Session-Id") : null;
                  yb && (l.oa = yb, R(l.B, l.A, yb));
                }
              }
              c.v = 3;
              c.f && c.f.ua();
              c.U && (c.N = q() - a.u, c.c.info("Handshake RTT: " + c.N + "ms"));
              l = c;
              var Aa2 = a;
              l.ma = Fc(l, l.C ? l.ha : null, l.ga);
              if (Aa2.C) {
                Gc(l.b, Aa2);
                var Ba2 = Aa2, Cc2 = l.D;
                Cc2 && Ba2.setTimeout(Cc2);
                Ba2.o && (pc(Ba2), mc(Ba2));
                l.a = Aa2;
              } else
                Hc(l);
              0 < c.g.length && Ic(c);
            } else
              e[0] != "stop" && e[0] != "close" || Q(c, 7);
          else
            c.v == 3 && (e[0] == "stop" || e[0] == "close" ? e[0] == "stop" ? Q(c, 7) : Jc(c) : e[0] != "noop" && c.f && c.f.ta(e), c.o = 0);
    }
    I(4);
  } catch (yc2) {
  }
}
function Kc(a) {
  if (a.K && typeof a.K == "function")
    return a.K();
  if (typeof a === "string")
    return a.split("");
  if (ba(a)) {
    for (var b = [], c = a.length, d = 0; d < c; d++)
      b.push(a[d]);
    return b;
  }
  b = [];
  c = 0;
  for (d in a)
    b[c++] = a[d];
  return a = b;
}
function Lc(a, b) {
  if (a.forEach && typeof a.forEach == "function")
    a.forEach(b, void 0);
  else if (ba(a) || typeof a === "string")
    na(a, b, void 0);
  else {
    if (a.L && typeof a.L == "function")
      var c = a.L();
    else if (a.K && typeof a.K == "function")
      c = void 0;
    else if (ba(a) || typeof a === "string") {
      c = [];
      for (var d = a.length, e = 0; e < d; e++)
        c.push(e);
    } else
      for (e in c = [], d = 0, a)
        c[d++] = e;
    d = Kc(a);
    e = d.length;
    for (var f = 0; f < e; f++)
      b.call(void 0, d[f], c && c[f], a);
  }
}
function S(a, b) {
  this.b = {};
  this.a = [];
  this.c = 0;
  var c = arguments.length;
  if (1 < c) {
    if (c % 2)
      throw Error("Uneven number of arguments");
    for (var d = 0; d < c; d += 2)
      this.set(arguments[d], arguments[d + 1]);
  } else if (a)
    if (a instanceof S)
      for (c = a.L(), d = 0; d < c.length; d++)
        this.set(c[d], a.get(c[d]));
    else
      for (d in a)
        this.set(d, a[d]);
}
g = S.prototype;
g.K = function() {
  Mc(this);
  for (var a = [], b = 0; b < this.a.length; b++)
    a.push(this.b[this.a[b]]);
  return a;
};
g.L = function() {
  Mc(this);
  return this.a.concat();
};
function Mc(a) {
  if (a.c != a.a.length) {
    for (var b = 0, c = 0; b < a.a.length; ) {
      var d = a.a[b];
      T(a.b, d) && (a.a[c++] = d);
      b++;
    }
    a.a.length = c;
  }
  if (a.c != a.a.length) {
    var e = {};
    for (c = b = 0; b < a.a.length; )
      d = a.a[b], T(e, d) || (a.a[c++] = d, e[d] = 1), b++;
    a.a.length = c;
  }
}
g.get = function(a, b) {
  return T(this.b, a) ? this.b[a] : b;
};
g.set = function(a, b) {
  T(this.b, a) || (this.c++, this.a.push(a));
  this.b[a] = b;
};
g.forEach = function(a, b) {
  for (var c = this.L(), d = 0; d < c.length; d++) {
    var e = c[d], f = this.get(e);
    a.call(b, f, e, this);
  }
};
function T(a, b) {
  return Object.prototype.hasOwnProperty.call(a, b);
}
var Nc = /^(?:([^:/?#.]+):)?(?:\/\/(?:([^\\/?#]*)@)?([^\\/?#]*?)(?::([0-9]+))?(?=[\\/?#]|$))?([^?#]+)?(?:\?([^#]*))?(?:#([\s\S]*))?$/;
function Oc(a, b) {
  if (a) {
    a = a.split("&");
    for (var c = 0; c < a.length; c++) {
      var d = a[c].indexOf("="), e = null;
      if (0 <= d) {
        var f = a[c].substring(0, d);
        e = a[c].substring(d + 1);
      } else
        f = a[c];
      b(f, e ? decodeURIComponent(e.replace(/\+/g, " ")) : "");
    }
  }
}
function U(a, b) {
  this.c = this.j = this.f = "";
  this.h = null;
  this.i = this.g = "";
  this.a = false;
  if (a instanceof U) {
    this.a = b !== void 0 ? b : a.a;
    Pc(this, a.f);
    this.j = a.j;
    Qc(this, a.c);
    Rc(this, a.h);
    this.g = a.g;
    b = a.b;
    var c = new Sc();
    c.c = b.c;
    b.a && (c.a = new S(b.a), c.b = b.b);
    Tc(this, c);
    this.i = a.i;
  } else
    a && (c = String(a).match(Nc)) ? (this.a = !!b, Pc(this, c[1] || "", true), this.j = Uc(c[2] || ""), Qc(this, c[3] || "", true), Rc(this, c[4]), this.g = Uc(c[5] || "", true), Tc(this, c[6] || "", true), this.i = Uc(c[7] || "")) : (this.a = !!b, this.b = new Sc(null, this.a));
}
U.prototype.toString = function() {
  var a = [], b = this.f;
  b && a.push(Vc(b, Wc, true), ":");
  var c = this.c;
  if (c || b == "file")
    a.push("//"), (b = this.j) && a.push(Vc(b, Wc, true), "@"), a.push(encodeURIComponent(String(c)).replace(/%25([0-9a-fA-F]{2})/g, "%$1")), c = this.h, c != null && a.push(":", String(c));
  if (c = this.g)
    this.c && c.charAt(0) != "/" && a.push("/"), a.push(Vc(c, c.charAt(0) == "/" ? Xc : Yc, true));
  (c = this.b.toString()) && a.push("?", c);
  (c = this.i) && a.push("#", Vc(c, Zc));
  return a.join("");
};
function N(a) {
  return new U(a);
}
function Pc(a, b, c) {
  a.f = c ? Uc(b, true) : b;
  a.f && (a.f = a.f.replace(/:$/, ""));
}
function Qc(a, b, c) {
  a.c = c ? Uc(b, true) : b;
}
function Rc(a, b) {
  if (b) {
    b = Number(b);
    if (isNaN(b) || 0 > b)
      throw Error("Bad port number " + b);
    a.h = b;
  } else
    a.h = null;
}
function Tc(a, b, c) {
  b instanceof Sc ? (a.b = b, $c(a.b, a.a)) : (c || (b = Vc(b, ad)), a.b = new Sc(b, a.a));
}
function R(a, b, c) {
  a.b.set(b, c);
}
function kc(a) {
  R(a, "zx", Math.floor(2147483648 * Math.random()).toString(36) + Math.abs(Math.floor(2147483648 * Math.random()) ^ q()).toString(36));
  return a;
}
function bd(a) {
  return a instanceof U ? N(a) : new U(a, void 0);
}
function cd(a, b, c, d) {
  var e = new U(null, void 0);
  a && Pc(e, a);
  b && Qc(e, b);
  c && Rc(e, c);
  d && (e.g = d);
  return e;
}
function Uc(a, b) {
  return a ? b ? decodeURI(a.replace(/%25/g, "%2525")) : decodeURIComponent(a) : "";
}
function Vc(a, b, c) {
  return typeof a === "string" ? (a = encodeURI(a).replace(b, dd), c && (a = a.replace(/%25([0-9a-fA-F]{2})/g, "%$1")), a) : null;
}
function dd(a) {
  a = a.charCodeAt(0);
  return "%" + (a >> 4 & 15).toString(16) + (a & 15).toString(16);
}
var Wc = /[#\/\?@]/g;
var Yc = /[#\?:]/g;
var Xc = /[#\?]/g;
var ad = /[#\?@]/g;
var Zc = /#/g;
function Sc(a, b) {
  this.b = this.a = null;
  this.c = a || null;
  this.f = !!b;
}
function V(a) {
  a.a || (a.a = new S(), a.b = 0, a.c && Oc(a.c, function(b, c) {
    a.add(decodeURIComponent(b.replace(/\+/g, " ")), c);
  }));
}
g = Sc.prototype;
g.add = function(a, b) {
  V(this);
  this.c = null;
  a = W(this, a);
  var c = this.a.get(a);
  c || this.a.set(a, c = []);
  c.push(b);
  this.b += 1;
  return this;
};
function ed(a, b) {
  V(a);
  b = W(a, b);
  T(a.a.b, b) && (a.c = null, a.b -= a.a.get(b).length, a = a.a, T(a.b, b) && (delete a.b[b], a.c--, a.a.length > 2 * a.c && Mc(a)));
}
function fd(a, b) {
  V(a);
  b = W(a, b);
  return T(a.a.b, b);
}
g.forEach = function(a, b) {
  V(this);
  this.a.forEach(function(c, d) {
    na(c, function(e) {
      a.call(b, e, d, this);
    }, this);
  }, this);
};
g.L = function() {
  V(this);
  for (var a = this.a.K(), b = this.a.L(), c = [], d = 0; d < b.length; d++)
    for (var e = a[d], f = 0; f < e.length; f++)
      c.push(b[d]);
  return c;
};
g.K = function(a) {
  V(this);
  var b = [];
  if (typeof a === "string")
    fd(this, a) && (b = qa(b, this.a.get(W(this, a))));
  else {
    a = this.a.K();
    for (var c = 0; c < a.length; c++)
      b = qa(b, a[c]);
  }
  return b;
};
g.set = function(a, b) {
  V(this);
  this.c = null;
  a = W(this, a);
  fd(this, a) && (this.b -= this.a.get(a).length);
  this.a.set(a, [b]);
  this.b += 1;
  return this;
};
g.get = function(a, b) {
  if (!a)
    return b;
  a = this.K(a);
  return 0 < a.length ? String(a[0]) : b;
};
function nc(a, b, c) {
  ed(a, b);
  0 < c.length && (a.c = null, a.a.set(W(a, b), ra(c)), a.b += c.length);
}
g.toString = function() {
  if (this.c)
    return this.c;
  if (!this.a)
    return "";
  for (var a = [], b = this.a.L(), c = 0; c < b.length; c++) {
    var d = b[c], e = encodeURIComponent(String(d));
    d = this.K(d);
    for (var f = 0; f < d.length; f++) {
      var h = e;
      d[f] !== "" && (h += "=" + encodeURIComponent(String(d[f])));
      a.push(h);
    }
  }
  return this.c = a.join("&");
};
function W(a, b) {
  b = String(b);
  a.f && (b = b.toLowerCase());
  return b;
}
function $c(a, b) {
  b && !a.f && (V(a), a.c = null, a.a.forEach(function(c, d) {
    var e = d.toLowerCase();
    d != e && (ed(this, d), nc(this, e, c));
  }, a));
  a.f = b;
}
var gd = function() {
  function gd2(a, b) {
    this.b = a;
    this.a = b;
  }
  return gd2;
}();
function hd(a) {
  this.g = a || id;
  k.PerformanceNavigationTiming ? (a = k.performance.getEntriesByType("navigation"), a = 0 < a.length && (a[0].nextHopProtocol == "hq" || a[0].nextHopProtocol == "h2")) : a = !!(k.ja && k.ja.za && k.ja.za() && k.ja.za().Qb);
  this.f = a ? this.g : 1;
  this.a = null;
  1 < this.f && (this.a = new Set());
  this.b = null;
  this.c = [];
}
var id = 10;
function jd(a) {
  return a.b ? true : a.a ? a.a.size >= a.f : false;
}
function Dc(a) {
  return a.b ? 1 : a.a ? a.a.size : 0;
}
function xc(a, b) {
  return a.b ? a.b == b : a.a ? a.a.has(b) : false;
}
function Ec(a, b) {
  a.a ? a.a.add(b) : a.b = b;
}
function Gc(a, b) {
  a.b && a.b == b ? a.b = null : a.a && a.a.has(b) && a.a.delete(b);
}
hd.prototype.cancel = function() {
  var e_1, _a2;
  this.c = kd(this);
  if (this.b)
    this.b.cancel(), this.b = null;
  else if (this.a && this.a.size !== 0) {
    try {
      for (var _b = __values(this.a.values()), _c2 = _b.next(); !_c2.done; _c2 = _b.next()) {
        var a = _c2.value;
        a.cancel();
      }
    } catch (e_1_1) {
      e_1 = { error: e_1_1 };
    } finally {
      try {
        if (_c2 && !_c2.done && (_a2 = _b.return))
          _a2.call(_b);
      } finally {
        if (e_1)
          throw e_1.error;
      }
    }
    this.a.clear();
  }
};
function kd(a) {
  var e_2, _a2;
  if (a.b != null)
    return a.c.concat(a.b.s);
  if (a.a != null && a.a.size !== 0) {
    var b = a.c;
    try {
      for (var _b = __values(a.a.values()), _c2 = _b.next(); !_c2.done; _c2 = _b.next()) {
        var c = _c2.value;
        b = b.concat(c.s);
      }
    } catch (e_2_1) {
      e_2 = { error: e_2_1 };
    } finally {
      try {
        if (_c2 && !_c2.done && (_a2 = _b.return))
          _a2.call(_b);
      } finally {
        if (e_2)
          throw e_2.error;
      }
    }
    return b;
  }
  return ra(a.c);
}
function ld() {
}
ld.prototype.stringify = function(a) {
  return k.JSON.stringify(a, void 0);
};
ld.prototype.parse = function(a) {
  return k.JSON.parse(a, void 0);
};
function md() {
  this.a = new ld();
}
function nd(a, b, c) {
  var d = c || "";
  try {
    Lc(a, function(e, f) {
      var h = e;
      n(e) && (h = tb(e));
      b.push(d + f + "=" + encodeURIComponent(h));
    });
  } catch (e) {
    throw b.push(d + "type=" + encodeURIComponent("_badmap")), e;
  }
}
function od(a, b) {
  var c = new Ob();
  if (k.Image) {
    var d = new Image();
    d.onload = ia(pd, c, d, "TestLoadImage: loaded", true, b);
    d.onerror = ia(pd, c, d, "TestLoadImage: error", false, b);
    d.onabort = ia(pd, c, d, "TestLoadImage: abort", false, b);
    d.ontimeout = ia(pd, c, d, "TestLoadImage: timeout", false, b);
    k.setTimeout(function() {
      if (d.ontimeout)
        d.ontimeout();
    }, 1e4);
    d.src = a;
  } else
    b(false);
}
function pd(a, b, c, d, e) {
  try {
    b.onload = null, b.onerror = null, b.onabort = null, b.ontimeout = null, e(d);
  } catch (f) {
  }
}
var qd = k.JSON.parse;
function X(a) {
  D.call(this);
  this.headers = new S();
  this.l = a || null;
  this.b = false;
  this.u = this.a = null;
  this.C = "";
  this.h = 0;
  this.f = "";
  this.g = this.B = this.m = this.A = false;
  this.s = 0;
  this.o = null;
  this.I = rd;
  this.F = this.G = false;
}
r(X, D);
var rd = "";
var sd = /^https?$/i;
var td = ["POST", "PUT"];
g = X.prototype;
g.ba = function(a, b, c, d) {
  if (this.a)
    throw Error("[goog.net.XhrIo] Object is active with another request=" + this.C + "; newUri=" + a);
  b = b ? b.toUpperCase() : "GET";
  this.C = a;
  this.f = "";
  this.h = 0;
  this.A = false;
  this.b = true;
  this.a = this.l ? this.l.a() : ec.a();
  this.u = this.l ? ac(this.l) : ac(ec);
  this.a.onreadystatechange = p(this.Aa, this);
  try {
    this.B = true, this.a.open(b, String(a), true), this.B = false;
  } catch (f) {
    ud(this, f);
    return;
  }
  a = c || "";
  var e = new S(this.headers);
  d && Lc(d, function(f, h) {
    e.set(h, f);
  });
  d = oa(e.L());
  c = k.FormData && a instanceof k.FormData;
  !(0 <= ma(td, b)) || d || c || e.set("Content-Type", "application/x-www-form-urlencoded;charset=utf-8");
  e.forEach(function(f, h) {
    this.a.setRequestHeader(h, f);
  }, this);
  this.I && (this.a.responseType = this.I);
  "withCredentials" in this.a && this.a.withCredentials !== this.G && (this.a.withCredentials = this.G);
  try {
    vd(this), 0 < this.s && ((this.F = wd(this.a)) ? (this.a.timeout = this.s, this.a.ontimeout = p(this.ya, this)) : this.o = Ib(this.ya, this.s, this)), this.m = true, this.a.send(a), this.m = false;
  } catch (f) {
    ud(this, f);
  }
};
function wd(a) {
  return x && Qa(9) && typeof a.timeout === "number" && a.ontimeout !== void 0;
}
function pa(a) {
  return a.toLowerCase() == "content-type";
}
g.ya = function() {
  typeof goog != "undefined" && this.a && (this.f = "Timed out after " + this.s + "ms, aborting", this.h = 8, E(this, "timeout"), this.abort(8));
};
function ud(a, b) {
  a.b = false;
  a.a && (a.g = true, a.a.abort(), a.g = false);
  a.f = b;
  a.h = 5;
  xd(a);
  yd(a);
}
function xd(a) {
  a.A || (a.A = true, E(a, "complete"), E(a, "error"));
}
g.abort = function(a) {
  this.a && this.b && (this.b = false, this.g = true, this.a.abort(), this.g = false, this.h = a || 7, E(this, "complete"), E(this, "abort"), yd(this));
};
g.H = function() {
  this.a && (this.b && (this.b = false, this.g = true, this.a.abort(), this.g = false), yd(this, true));
  X.X.H.call(this);
};
g.Aa = function() {
  this.j || (this.B || this.m || this.g ? zd(this) : this.Za());
};
g.Za = function() {
  zd(this);
};
function zd(a) {
  if (a.b && typeof goog != "undefined" && (!a.u[1] || O(a) != 4 || a.W() != 2)) {
    if (a.m && O(a) == 4)
      Ib(a.Aa, 0, a);
    else if (E(a, "readystatechange"), O(a) == 4) {
      a.b = false;
      try {
        {
          var l = a.W();
          a:
            switch (l) {
              case 200:
              case 201:
              case 202:
              case 204:
              case 206:
              case 304:
              case 1223:
                var b = true;
                break a;
              default:
                b = false;
            }
          var c;
          if (!(c = b)) {
            var d;
            if (d = l === 0) {
              var e = String(a.C).match(Nc)[1] || null;
              if (!e && k.self && k.self.location) {
                var f = k.self.location.protocol;
                e = f.substr(0, f.length - 1);
              }
              d = !sd.test(e ? e.toLowerCase() : "");
            }
            c = d;
          }
          var h = c;
        }
        if (h)
          E(a, "complete"), E(a, "success");
        else {
          a.h = 6;
          try {
            var m = 2 < O(a) ? a.a.statusText : "";
          } catch (l2) {
            m = "";
          }
          a.f = m + " [" + a.W() + "]";
          xd(a);
        }
      } finally {
        yd(a);
      }
    }
  }
}
function yd(a, b) {
  if (a.a) {
    vd(a);
    var c = a.a, d = a.u[0] ? aa : null;
    a.a = null;
    a.u = null;
    b || E(a, "ready");
    try {
      c.onreadystatechange = d;
    } catch (e) {
    }
  }
}
function vd(a) {
  a.a && a.F && (a.a.ontimeout = null);
  a.o && (k.clearTimeout(a.o), a.o = null);
}
function O(a) {
  return a.a ? a.a.readyState : 0;
}
g.W = function() {
  try {
    return 2 < O(this) ? this.a.status : -1;
  } catch (a) {
    return -1;
  }
};
g.$ = function() {
  try {
    return this.a ? this.a.responseText : "";
  } catch (a) {
    return "";
  }
};
g.Qa = function(a) {
  if (this.a) {
    var b = this.a.responseText;
    a && b.indexOf(a) == 0 && (b = b.substring(a.length));
    return qd(b);
  }
};
g.va = function() {
  return this.h;
};
g.Ra = function() {
  return typeof this.f === "string" ? this.f : String(this.f);
};
function Ad(a) {
  var b = "";
  xa(a, function(c, d) {
    b += d;
    b += ":";
    b += c;
    b += "\r\n";
  });
  return b;
}
function Bd(a, b, c) {
  a: {
    for (d in c) {
      var d = false;
      break a;
    }
    d = true;
  }
  d || (c = Ad(c), typeof a === "string" ? c != null && encodeURIComponent(String(c)) : R(a, b, c));
}
function Cd(a, b, c) {
  return c && c.internalChannelParams ? c.internalChannelParams[a] || b : b;
}
function Dd(a) {
  this.qa = 0;
  this.g = [];
  this.c = new Ob();
  this.ha = this.ma = this.B = this.ga = this.a = this.oa = this.A = this.V = this.i = this.O = this.l = null;
  this.Pa = this.R = 0;
  this.Ma = Cd("failFast", false, a);
  this.G = this.m = this.j = this.h = this.f = null;
  this.S = true;
  this.I = this.pa = this.P = -1;
  this.T = this.o = this.u = 0;
  this.Ia = Cd("baseRetryDelayMs", 5e3, a);
  this.Sa = Cd("retryDelaySeedMs", 1e4, a);
  this.Na = Cd("forwardChannelMaxRetries", 2, a);
  this.na = Cd("forwardChannelRequestTimeoutMs", 2e4, a);
  this.Oa = a && a.xmlHttpFactory || void 0;
  this.D = void 0;
  this.C = a && a.supportsCrossDomainXhr || false;
  this.J = "";
  this.b = new hd(a && a.concurrentRequestLimit);
  this.la = new md();
  this.ea = a && a.fastHandshake || false;
  this.Ja = a && a.b || false;
  a && a.f && (this.c.a = false);
  a && a.forceLongPolling && (this.S = false);
  this.U = !this.ea && this.S && a && a.detectBufferingProxy || false;
  this.fa = void 0;
  this.N = 0;
  this.F = false;
  this.s = null;
  (this.La = a && a.c || false) && this.c.info("Opt-in to enable Chrome Origin Trials.");
}
g = Dd.prototype;
g.ia = 8;
g.v = 1;
function Jc(a) {
  Ed(a);
  if (a.v == 3) {
    var b = a.R++, c = N(a.B);
    R(c, "SID", a.J);
    R(c, "RID", b);
    R(c, "TYPE", "terminate");
    Fd(a, c);
    b = new M(a, a.c, b, void 0);
    b.G = 2;
    b.i = kc(N(c));
    c = false;
    k.navigator && k.navigator.sendBeacon && (c = k.navigator.sendBeacon(b.i.toString(), ""));
    !c && k.Image && (new Image().src = b.i, c = true);
    c || (b.a = oc(b.g, null), b.a.ba(b.i));
    b.u = q();
    mc(b);
  }
  Gd(a);
}
function Ac(a) {
  a.a && (vc(a), a.a.cancel(), a.a = null);
}
function Ed(a) {
  Ac(a);
  a.j && (k.clearTimeout(a.j), a.j = null);
  zc(a);
  a.b.cancel();
  a.h && (typeof a.h === "number" && k.clearTimeout(a.h), a.h = null);
}
function Hd(a, b) {
  a.g.push(new gd(a.Pa++, b));
  a.v == 3 && Ic(a);
}
function Ic(a) {
  jd(a.b) || a.h || (a.h = true, Bb(a.Ca, a), a.u = 0);
}
function Id(a, b) {
  if (Dc(a.b) >= a.b.f - (a.h ? 1 : 0))
    return false;
  if (a.h)
    return a.g = b.s.concat(a.g), true;
  if (a.v == 1 || a.v == 2 || a.u >= (a.Ma ? 0 : a.Na))
    return false;
  a.h = K(p(a.Ca, a, b), Jd(a, a.u));
  a.u++;
  return true;
}
g.Ca = function(a) {
  if (this.h)
    if (this.h = null, this.v == 1) {
      if (!a) {
        this.R = Math.floor(1e5 * Math.random());
        a = this.R++;
        var b = new M(this, this.c, a, void 0), c = this.l;
        this.O && (c ? (c = ya(c), Ca(c, this.O)) : c = this.O);
        this.i === null && (b.B = c);
        var d;
        if (this.ea)
          a: {
            for (var e = d = 0; e < this.g.length; e++) {
              b: {
                var f = this.g[e];
                if ("__data__" in f.a && (f = f.a.__data__, typeof f === "string")) {
                  f = f.length;
                  break b;
                }
                f = void 0;
              }
              if (f === void 0)
                break;
              d += f;
              if (4096 < d) {
                d = e;
                break a;
              }
              if (d === 4096 || e === this.g.length - 1) {
                d = e + 1;
                break a;
              }
            }
            d = 1e3;
          }
        else
          d = 1e3;
        d = Kd(this, b, d);
        e = N(this.B);
        R(e, "RID", a);
        R(e, "CVER", 22);
        this.A && R(e, "X-HTTP-Session-Id", this.A);
        Fd(this, e);
        this.i && c && Bd(e, this.i, c);
        Ec(this.b, b);
        this.Ja && R(e, "TYPE", "init");
        this.ea ? (R(e, "$req", d), R(e, "SID", "null"), b.U = true, jc(b, e, null)) : jc(b, e, d);
        this.v = 2;
      }
    } else
      this.v == 3 && (a ? Ld(this, a) : this.g.length == 0 || jd(this.b) || Ld(this));
};
function Ld(a, b) {
  var c;
  b ? c = b.f : c = a.R++;
  var d = N(a.B);
  R(d, "SID", a.J);
  R(d, "RID", c);
  R(d, "AID", a.P);
  Fd(a, d);
  a.i && a.l && Bd(d, a.i, a.l);
  c = new M(a, a.c, c, a.u + 1);
  a.i === null && (c.B = a.l);
  b && (a.g = b.s.concat(a.g));
  b = Kd(a, c, 1e3);
  c.setTimeout(Math.round(0.5 * a.na) + Math.round(0.5 * a.na * Math.random()));
  Ec(a.b, c);
  jc(c, d, b);
}
function Fd(a, b) {
  a.f && Lc({}, function(c, d) {
    R(b, d, c);
  });
}
function Kd(a, b, c) {
  c = Math.min(a.g.length, c);
  var d = a.f ? p(a.f.Ka, a.f, a) : null;
  a:
    for (var e = a.g, f = -1; ; ) {
      var h = ["count=" + c];
      f == -1 ? 0 < c ? (f = e[0].b, h.push("ofs=" + f)) : f = 0 : h.push("ofs=" + f);
      for (var m = true, l = 0; l < c; l++) {
        var v = e[l].b, C2 = e[l].a;
        v -= f;
        if (0 > v)
          f = Math.max(0, e[l].b - 100), m = false;
        else
          try {
            nd(C2, h, "req" + v + "_");
          } catch (B2) {
            d && d(C2);
          }
      }
      if (m) {
        d = h.join("&");
        break a;
      }
    }
  a = a.g.splice(0, c);
  b.s = a;
  return d;
}
function Hc(a) {
  a.a || a.j || (a.T = 1, Bb(a.Ba, a), a.o = 0);
}
function Bc(a) {
  if (a.a || a.j || 3 <= a.o)
    return false;
  a.T++;
  a.j = K(p(a.Ba, a), Jd(a, a.o));
  a.o++;
  return true;
}
g.Ba = function() {
  this.j = null;
  Md(this);
  if (this.U && !(this.F || this.a == null || 0 >= this.N)) {
    var a = 2 * this.N;
    this.c.info("BP detection timer enabled: " + a);
    this.s = K(p(this.Ya, this), a);
  }
};
g.Ya = function() {
  this.s && (this.s = null, this.c.info("BP detection timeout reached."), this.c.info("Buffering proxy detected and switch to long-polling!"), this.G = false, this.F = true, J(10), Ac(this), Md(this));
};
function vc(a) {
  a.s != null && (k.clearTimeout(a.s), a.s = null);
}
function Md(a) {
  a.a = new M(a, a.c, "rpc", a.T);
  a.i === null && (a.a.B = a.l);
  a.a.O = 0;
  var b = N(a.ma);
  R(b, "RID", "rpc");
  R(b, "SID", a.J);
  R(b, "CI", a.G ? "0" : "1");
  R(b, "AID", a.P);
  Fd(a, b);
  R(b, "TYPE", "xmlhttp");
  a.i && a.l && Bd(b, a.i, a.l);
  a.D && a.a.setTimeout(a.D);
  var c = a.a;
  a = a.ha;
  c.G = 1;
  c.i = kc(N(b));
  c.j = null;
  c.I = true;
  lc(c, a);
}
g.Xa = function() {
  this.m != null && (this.m = null, Ac(this), Bc(this), J(19));
};
function zc(a) {
  a.m != null && (k.clearTimeout(a.m), a.m = null);
}
function tc(a, b) {
  var c = null;
  if (a.a == b) {
    zc(a);
    vc(a);
    a.a = null;
    var d = 2;
  } else if (xc(a.b, b))
    c = b.s, Gc(a.b, b), d = 1;
  else
    return;
  a.I = b.N;
  if (a.v != 0) {
    if (b.b)
      if (d == 1) {
        c = b.j ? b.j.length : 0;
        b = q() - b.u;
        var e = a.u;
        d = Ub();
        E(d, new Xb(d, c, b, e));
        Ic(a);
      } else
        Hc(a);
    else if (e = b.h, e == 3 || e == 0 && 0 < a.I || !(d == 1 && Id(a, b) || d == 2 && Bc(a)))
      switch (c && 0 < c.length && (b = a.b, b.c = b.c.concat(c)), e) {
        case 1:
          Q(a, 5);
          break;
        case 4:
          Q(a, 10);
          break;
        case 3:
          Q(a, 6);
          break;
        default:
          Q(a, 2);
      }
  }
}
function Jd(a, b) {
  var c = a.Ia + Math.floor(Math.random() * a.Sa);
  a.f || (c *= 2);
  return c * b;
}
function Q(a, b) {
  a.c.info("Error code " + b);
  if (b == 2) {
    var c = null;
    a.f && (c = null);
    var d = p(a.cb, a);
    c || (c = new U("//www.google.com/images/cleardot.gif"), k.location && k.location.protocol == "http" || Pc(c, "https"), kc(c));
    od(c.toString(), d);
  } else
    J(2);
  a.v = 0;
  a.f && a.f.sa(b);
  Gd(a);
  Ed(a);
}
g.cb = function(a) {
  a ? (this.c.info("Successfully pinged google.com"), J(2)) : (this.c.info("Failed to ping google.com"), J(1));
};
function Gd(a) {
  a.v = 0;
  a.I = -1;
  if (a.f) {
    if (kd(a.b).length != 0 || a.g.length != 0)
      a.b.c.length = 0, ra(a.g), a.g.length = 0;
    a.f.ra();
  }
}
function Fc(a, b, c) {
  var d = bd(c);
  if (d.c != "")
    b && Qc(d, b + "." + d.c), Rc(d, d.h);
  else {
    var e = k.location;
    d = cd(e.protocol, b ? b + "." + e.hostname : e.hostname, +e.port, c);
  }
  a.V && xa(a.V, function(f, h) {
    R(d, h, f);
  });
  b = a.A;
  c = a.oa;
  b && c && R(d, b, c);
  R(d, "VER", a.ia);
  Fd(a, d);
  return d;
}
function oc(a, b) {
  if (b && !a.C)
    throw Error("Can't create secondary domain capable XhrIo object.");
  b = new X(a.Oa);
  b.G = a.C;
  return b;
}
function Nd() {
}
g = Nd.prototype;
g.ua = function() {
};
g.ta = function() {
};
g.sa = function() {
};
g.ra = function() {
};
g.Ka = function() {
};
function Od() {
  if (x && !(10 <= Number(Ta)))
    throw Error("Environmental error: no available transport.");
}
Od.prototype.a = function(a, b) {
  return new Y(a, b);
};
function Y(a, b) {
  D.call(this);
  this.a = new Dd(b);
  this.g = a;
  this.b = b && b.messageUrlParams || null;
  a = b && b.messageHeaders || null;
  b && b.clientProtocolHeaderRequired && (a ? a["X-Client-Protocol"] = "webchannel" : a = { "X-Client-Protocol": "webchannel" });
  this.a.l = a;
  a = b && b.initMessageHeaders || null;
  b && b.messageContentType && (a ? a["X-WebChannel-Content-Type"] = b.messageContentType : a = { "X-WebChannel-Content-Type": b.messageContentType });
  b && b.a && (a ? a["X-WebChannel-Client-Profile"] = b.a : a = { "X-WebChannel-Client-Profile": b.a });
  this.a.O = a;
  (a = b && b.httpHeadersOverwriteParam) && !sa(a) && (this.a.i = a);
  this.o = b && b.supportsCrossDomainXhr || false;
  this.m = b && b.sendRawJson || false;
  (b = b && b.httpSessionIdParam) && !sa(b) && (this.a.A = b, a = this.b, a !== null && b in a && (a = this.b, b in a && delete a[b]));
  this.f = new Z(this);
}
r(Y, D);
Y.prototype.h = function() {
  this.a.f = this.f;
  this.o && (this.a.C = true);
  var a = this.a, b = this.g, c = this.b || void 0;
  J(0);
  a.ga = b;
  a.V = c || {};
  a.G = a.S;
  a.B = Fc(a, null, a.ga);
  Ic(a);
};
Y.prototype.close = function() {
  Jc(this.a);
};
Y.prototype.l = function(a) {
  if (typeof a === "string") {
    var b = {};
    b.__data__ = a;
    Hd(this.a, b);
  } else
    this.m ? (b = {}, b.__data__ = tb(a), Hd(this.a, b)) : Hd(this.a, a);
};
Y.prototype.H = function() {
  this.a.f = null;
  delete this.f;
  Jc(this.a);
  delete this.a;
  Y.X.H.call(this);
};
function Pd(a) {
  cc.call(this);
  var b = a.__sm__;
  if (b) {
    a: {
      for (var c in b) {
        a = c;
        break a;
      }
      a = void 0;
    }
    (this.c = a) ? (a = this.c, this.data = b !== null && a in b ? b[a] : void 0) : this.data = b;
  } else
    this.data = a;
}
r(Pd, cc);
function Qd() {
  dc.call(this);
  this.status = 1;
}
r(Qd, dc);
function Z(a) {
  this.a = a;
}
r(Z, Nd);
Z.prototype.ua = function() {
  E(this.a, "a");
};
Z.prototype.ta = function(a) {
  E(this.a, new Pd(a));
};
Z.prototype.sa = function(a) {
  E(this.a, new Qd(a));
};
Z.prototype.ra = function() {
  E(this.a, "b");
};
function Rd(a) {
  this.f = a;
}
r(Rd, $b);
Rd.prototype.a = function() {
  return new Sd(this.f);
};
Rd.prototype.c = function(a) {
  return function() {
    return a;
  };
}({});
function Sd(a) {
  D.call(this);
  this.u = a;
  this.h = void 0;
  this.readyState = Td;
  this.status = 0;
  this.responseType = this.responseText = this.statusText = "";
  this.onreadystatechange = null;
  this.l = new Headers();
  this.b = null;
  this.s = "GET";
  this.o = "";
  this.a = false;
  this.m = this.f = this.g = null;
}
r(Sd, D);
var Td = 0;
g = Sd.prototype;
g.open = function(a, b) {
  if (this.readyState != Td)
    throw this.abort(), Error("Error reopening a connection");
  this.s = a;
  this.o = b;
  this.readyState = 1;
  Ud(this);
};
g.send = function(a) {
  if (this.readyState != 1)
    throw this.abort(), Error("need to call open() first. ");
  this.a = true;
  var b = { headers: this.l, method: this.s, credentials: this.h, cache: void 0 };
  a && (b.body = a);
  this.u.fetch(new Request(this.o, b)).then(this.Wa.bind(this), this.ca.bind(this));
};
g.abort = function() {
  this.responseText = "";
  this.l = new Headers();
  this.status = 0;
  this.f && this.f.cancel("Request was aborted.");
  1 <= this.readyState && this.a && this.readyState != 4 && (this.a = false, Vd(this));
  this.readyState = Td;
};
g.Wa = function(a) {
  this.a && (this.g = a, this.b || (this.status = this.g.status, this.statusText = this.g.statusText, this.b = a.headers, this.readyState = 2, Ud(this)), this.a && (this.readyState = 3, Ud(this), this.a && (this.responseType === "arraybuffer" ? a.arrayBuffer().then(this.Ua.bind(this), this.ca.bind(this)) : typeof k.ReadableStream !== "undefined" && "body" in a ? (this.responseText = "", this.f = a.body.getReader(), this.m = new TextDecoder(), Wd(this)) : a.text().then(this.Va.bind(this), this.ca.bind(this)))));
};
function Wd(a) {
  a.f.read().then(a.Ta.bind(a)).catch(a.ca.bind(a));
}
g.Ta = function(a) {
  if (this.a) {
    var b = this.m.decode(a.value ? a.value : new Uint8Array(0), { stream: !a.done });
    b && (this.responseText += b);
    a.done ? Vd(this) : Ud(this);
    this.readyState == 3 && Wd(this);
  }
};
g.Va = function(a) {
  this.a && (this.responseText = a, Vd(this));
};
g.Ua = function() {
  this.a && Vd(this);
};
g.ca = function() {
  this.a && Vd(this);
};
function Vd(a) {
  a.readyState = 4;
  a.g = null;
  a.f = null;
  a.m = null;
  Ud(a);
}
g.setRequestHeader = function(a, b) {
  this.l.append(a, b);
};
g.getResponseHeader = function(a) {
  return this.b ? this.b.get(a.toLowerCase()) || "" : "";
};
g.getAllResponseHeaders = function() {
  if (!this.b)
    return "";
  var a = [], b = this.b.entries();
  for (var c = b.next(); !c.done; )
    c = c.value, a.push(c[0] + ": " + c[1]), c = b.next();
  return a.join("\r\n");
};
function Ud(a) {
  a.onreadystatechange && a.onreadystatechange.call(a);
}
Object.defineProperty(Sd.prototype, "withCredentials", { get: function() {
  return this.h === "include";
}, set: function(a) {
  this.h = a ? "include" : "same-origin";
} });
Od.prototype.createWebChannel = Od.prototype.a;
Y.prototype.send = Y.prototype.l;
Y.prototype.open = Y.prototype.h;
Y.prototype.close = Y.prototype.close;
Yb.NO_ERROR = 0;
Yb.TIMEOUT = 8;
Yb.HTTP_ERROR = 6;
Zb.COMPLETE = "complete";
bc.EventType = L;
L.OPEN = "a";
L.CLOSE = "b";
L.ERROR = "c";
L.MESSAGE = "d";
D.prototype.listen = D.prototype.wa;
X.prototype.listenOnce = X.prototype.xa;
X.prototype.getLastError = X.prototype.Ra;
X.prototype.getLastErrorCode = X.prototype.va;
X.prototype.getStatus = X.prototype.W;
X.prototype.getResponseJson = X.prototype.Qa;
X.prototype.getResponseText = X.prototype.$;
X.prototype.send = X.prototype.ba;
var createWebChannelTransport = function() {
  return new Od();
};
var getStatEventTarget = function() {
  return Ub();
};
var ErrorCode = Yb;
var EventType = Zb;
var Event = H;
var Stat = { lb: 0, ob: 1, pb: 2, Ib: 3, Nb: 4, Kb: 5, Lb: 6, Jb: 7, Hb: 8, Mb: 9, PROXY: 10, NOPROXY: 11, Fb: 12, Bb: 13, Cb: 14, Ab: 15, Db: 16, Eb: 17, hb: 18, gb: 19, ib: 20 };
var FetchXmlHttpFactory = Rd;
var WebChannel = bc;
var XhrIo = X;

// node_modules/@firebase/firestore/dist/esm5/prebuilt-d16b955d-cdb9e87f.js
var _ = function() {
  function t2(t3, e) {
    var n2 = this;
    this.previousValue = t3, e && (e.sequenceNumberHandler = function(t4) {
      return n2.t(t4);
    }, this.i = function(t4) {
      return e.writeSequenceNumber(t4);
    });
  }
  return t2.prototype.t = function(t3) {
    return this.previousValue = Math.max(t3, this.previousValue), this.previousValue;
  }, t2.prototype.next = function() {
    var t3 = ++this.previousValue;
    return this.i && this.i(t3), t3;
  }, t2;
}();
_.o = -1;
var S2 = {
  OK: "ok",
  CANCELLED: "cancelled",
  UNKNOWN: "unknown",
  INVALID_ARGUMENT: "invalid-argument",
  DEADLINE_EXCEEDED: "deadline-exceeded",
  NOT_FOUND: "not-found",
  ALREADY_EXISTS: "already-exists",
  PERMISSION_DENIED: "permission-denied",
  UNAUTHENTICATED: "unauthenticated",
  RESOURCE_EXHAUSTED: "resource-exhausted",
  FAILED_PRECONDITION: "failed-precondition",
  ABORTED: "aborted",
  OUT_OF_RANGE: "out-of-range",
  UNIMPLEMENTED: "unimplemented",
  INTERNAL: "internal",
  UNAVAILABLE: "unavailable",
  DATA_LOSS: "data-loss"
};
var N2 = function(t2) {
  function e(e2, n2) {
    var r2 = this;
    return (r2 = t2.call(this, n2) || this).code = e2, r2.message = n2, r2.name = "FirebaseError", r2.toString = function() {
      return r2.name + ": [code=" + r2.code + "]: " + r2.message;
    }, r2;
  }
  return __extends(e, t2), e;
}(Error);
var D2 = new Logger("@firebase/firestore");
function A2() {
  return D2.logLevel;
}
function k2(t2) {
  for (var e = [], n2 = 1; n2 < arguments.length; n2++)
    e[n2 - 1] = arguments[n2];
  if (D2.logLevel <= LogLevel.DEBUG) {
    var r2 = e.map(R2);
    D2.debug.apply(D2, __spreadArray(["Firestore (8.6.7): " + t2], r2));
  }
}
function C(t2) {
  for (var e = [], n2 = 1; n2 < arguments.length; n2++)
    e[n2 - 1] = arguments[n2];
  if (D2.logLevel <= LogLevel.ERROR) {
    var r2 = e.map(R2);
    D2.error.apply(D2, __spreadArray(["Firestore (8.6.7): " + t2], r2));
  }
}
function x2(t2) {
  for (var e = [], n2 = 1; n2 < arguments.length; n2++)
    e[n2 - 1] = arguments[n2];
  if (D2.logLevel <= LogLevel.WARN) {
    var r2 = e.map(R2);
    D2.warn.apply(D2, __spreadArray(["Firestore (8.6.7): " + t2], r2));
  }
}
function R2(t2) {
  if (typeof t2 == "string")
    return t2;
  try {
    return e = t2, JSON.stringify(e);
  } catch (e2) {
    return t2;
  }
  var e;
}
function L2(t2) {
  t2 === void 0 && (t2 = "Unexpected state");
  var e = "FIRESTORE (8.6.7) INTERNAL ASSERTION FAILED: " + t2;
  throw C(e), new Error(e);
}
function O2(t2, e) {
  t2 || L2();
}
function P2(t2, e) {
  return t2;
}
function F2(t2) {
  var e = typeof self != "undefined" && (self.crypto || self.msCrypto), n2 = new Uint8Array(t2);
  if (e && typeof e.getRandomValues == "function")
    e.getRandomValues(n2);
  else
    for (var r2 = 0; r2 < t2; r2++)
      n2[r2] = Math.floor(256 * Math.random());
  return n2;
}
var M2 = function() {
  function t2() {
  }
  return t2.u = function() {
    for (var t3 = "ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789", e = Math.floor(256 / t3.length) * t3.length, n2 = ""; n2.length < 20; )
      for (var r2 = F2(40), i = 0; i < r2.length; ++i)
        n2.length < 20 && r2[i] < e && (n2 += t3.charAt(r2[i] % t3.length));
    return n2;
  }, t2;
}();
function V2(t2, e) {
  return t2 < e ? -1 : t2 > e ? 1 : 0;
}
function q2(t2, e, n2) {
  return t2.length === e.length && t2.every(function(t3, r2) {
    return n2(t3, e[r2]);
  });
}
function U2(t2) {
  return t2 + "\0";
}
var B = function() {
  function t2(t3, e) {
    if (this.seconds = t3, this.nanoseconds = e, e < 0)
      throw new N2(S2.INVALID_ARGUMENT, "Timestamp nanoseconds out of range: " + e);
    if (e >= 1e9)
      throw new N2(S2.INVALID_ARGUMENT, "Timestamp nanoseconds out of range: " + e);
    if (t3 < -62135596800)
      throw new N2(S2.INVALID_ARGUMENT, "Timestamp seconds out of range: " + t3);
    if (t3 >= 253402300800)
      throw new N2(S2.INVALID_ARGUMENT, "Timestamp seconds out of range: " + t3);
  }
  return t2.now = function() {
    return t2.fromMillis(Date.now());
  }, t2.fromDate = function(e) {
    return t2.fromMillis(e.getTime());
  }, t2.fromMillis = function(e) {
    var n2 = Math.floor(e / 1e3);
    return new t2(n2, Math.floor(1e6 * (e - 1e3 * n2)));
  }, t2.prototype.toDate = function() {
    return new Date(this.toMillis());
  }, t2.prototype.toMillis = function() {
    return 1e3 * this.seconds + this.nanoseconds / 1e6;
  }, t2.prototype._compareTo = function(t3) {
    return this.seconds === t3.seconds ? V2(this.nanoseconds, t3.nanoseconds) : V2(this.seconds, t3.seconds);
  }, t2.prototype.isEqual = function(t3) {
    return t3.seconds === this.seconds && t3.nanoseconds === this.nanoseconds;
  }, t2.prototype.toString = function() {
    return "Timestamp(seconds=" + this.seconds + ", nanoseconds=" + this.nanoseconds + ")";
  }, t2.prototype.toJSON = function() {
    return {
      seconds: this.seconds,
      nanoseconds: this.nanoseconds
    };
  }, t2.prototype.valueOf = function() {
    var t3 = this.seconds - -62135596800;
    return String(t3).padStart(12, "0") + "." + String(this.nanoseconds).padStart(9, "0");
  }, t2;
}();
var j = function() {
  function t2(t3) {
    this.timestamp = t3;
  }
  return t2.fromTimestamp = function(e) {
    return new t2(e);
  }, t2.min = function() {
    return new t2(new B(0, 0));
  }, t2.prototype.compareTo = function(t3) {
    return this.timestamp._compareTo(t3.timestamp);
  }, t2.prototype.isEqual = function(t3) {
    return this.timestamp.isEqual(t3.timestamp);
  }, t2.prototype.toMicroseconds = function() {
    return 1e6 * this.timestamp.seconds + this.timestamp.nanoseconds / 1e3;
  }, t2.prototype.toString = function() {
    return "SnapshotVersion(" + this.timestamp.toString() + ")";
  }, t2.prototype.toTimestamp = function() {
    return this.timestamp;
  }, t2;
}();
function K2(t2) {
  var e = 0;
  for (var n2 in t2)
    Object.prototype.hasOwnProperty.call(t2, n2) && e++;
  return e;
}
function G2(t2, e) {
  for (var n2 in t2)
    Object.prototype.hasOwnProperty.call(t2, n2) && e(n2, t2[n2]);
}
function Q2(t2) {
  for (var e in t2)
    if (Object.prototype.hasOwnProperty.call(t2, e))
      return false;
  return true;
}
var z2 = function() {
  function t2(t3, e, n2) {
    e === void 0 ? e = 0 : e > t3.length && L2(), n2 === void 0 ? n2 = t3.length - e : n2 > t3.length - e && L2(), this.segments = t3, this.offset = e, this.len = n2;
  }
  return Object.defineProperty(t2.prototype, "length", {
    get: function() {
      return this.len;
    },
    enumerable: false,
    configurable: true
  }), t2.prototype.isEqual = function(e) {
    return t2.comparator(this, e) === 0;
  }, t2.prototype.child = function(e) {
    var n2 = this.segments.slice(this.offset, this.limit());
    return e instanceof t2 ? e.forEach(function(t3) {
      n2.push(t3);
    }) : n2.push(e), this.construct(n2);
  }, t2.prototype.limit = function() {
    return this.offset + this.length;
  }, t2.prototype.popFirst = function(t3) {
    return t3 = t3 === void 0 ? 1 : t3, this.construct(this.segments, this.offset + t3, this.length - t3);
  }, t2.prototype.popLast = function() {
    return this.construct(this.segments, this.offset, this.length - 1);
  }, t2.prototype.firstSegment = function() {
    return this.segments[this.offset];
  }, t2.prototype.lastSegment = function() {
    return this.get(this.length - 1);
  }, t2.prototype.get = function(t3) {
    return this.segments[this.offset + t3];
  }, t2.prototype.isEmpty = function() {
    return this.length === 0;
  }, t2.prototype.isPrefixOf = function(t3) {
    if (t3.length < this.length)
      return false;
    for (var e = 0; e < this.length; e++)
      if (this.get(e) !== t3.get(e))
        return false;
    return true;
  }, t2.prototype.isImmediateParentOf = function(t3) {
    if (this.length + 1 !== t3.length)
      return false;
    for (var e = 0; e < this.length; e++)
      if (this.get(e) !== t3.get(e))
        return false;
    return true;
  }, t2.prototype.forEach = function(t3) {
    for (var e = this.offset, n2 = this.limit(); e < n2; e++)
      t3(this.segments[e]);
  }, t2.prototype.toArray = function() {
    return this.segments.slice(this.offset, this.limit());
  }, t2.comparator = function(t3, e) {
    for (var n2 = Math.min(t3.length, e.length), r2 = 0; r2 < n2; r2++) {
      var i = t3.get(r2), o = e.get(r2);
      if (i < o)
        return -1;
      if (i > o)
        return 1;
    }
    return t3.length < e.length ? -1 : t3.length > e.length ? 1 : 0;
  }, t2;
}();
var W2 = function(t2) {
  function e() {
    return t2 !== null && t2.apply(this, arguments) || this;
  }
  return __extends(e, t2), e.prototype.construct = function(t3, n2, r2) {
    return new e(t3, n2, r2);
  }, e.prototype.canonicalString = function() {
    return this.toArray().join("/");
  }, e.prototype.toString = function() {
    return this.canonicalString();
  }, e.fromString = function() {
    for (var t3 = [], n2 = 0; n2 < arguments.length; n2++)
      t3[n2] = arguments[n2];
    for (var r2 = [], i = 0, o = t3; i < o.length; i++) {
      var s = o[i];
      if (s.indexOf("//") >= 0)
        throw new N2(S2.INVALID_ARGUMENT, "Invalid segment (" + s + "). Paths must not contain // in them.");
      r2.push.apply(r2, s.split("/").filter(function(t4) {
        return t4.length > 0;
      }));
    }
    return new e(r2);
  }, e.emptyPath = function() {
    return new e([]);
  }, e;
}(z2);
var H2 = /^[_a-zA-Z][_a-zA-Z0-9]*$/;
var Y2 = function(t2) {
  function e() {
    return t2 !== null && t2.apply(this, arguments) || this;
  }
  return __extends(e, t2), e.prototype.construct = function(t3, n2, r2) {
    return new e(t3, n2, r2);
  }, e.isValidIdentifier = function(t3) {
    return H2.test(t3);
  }, e.prototype.canonicalString = function() {
    return this.toArray().map(function(t3) {
      return t3 = t3.replace(/\\/g, "\\\\").replace(/`/g, "\\`"), e.isValidIdentifier(t3) || (t3 = "`" + t3 + "`"), t3;
    }).join(".");
  }, e.prototype.toString = function() {
    return this.canonicalString();
  }, e.prototype.isKeyField = function() {
    return this.length === 1 && this.get(0) === "__name__";
  }, e.keyField = function() {
    return new e(["__name__"]);
  }, e.fromServerFormat = function(t3) {
    for (var n2 = [], r2 = "", i = 0, o = function() {
      if (r2.length === 0)
        throw new N2(S2.INVALID_ARGUMENT, "Invalid field path (" + t3 + "). Paths must not be empty, begin with '.', end with '.', or contain '..'");
      n2.push(r2), r2 = "";
    }, s = false; i < t3.length; ) {
      var u2 = t3[i];
      if (u2 === "\\") {
        if (i + 1 === t3.length)
          throw new N2(S2.INVALID_ARGUMENT, "Path has trailing escape character: " + t3);
        var a = t3[i + 1];
        if (a !== "\\" && a !== "." && a !== "`")
          throw new N2(S2.INVALID_ARGUMENT, "Path has invalid escape sequence: " + t3);
        r2 += a, i += 2;
      } else
        u2 === "`" ? (s = !s, i++) : u2 !== "." || s ? (r2 += u2, i++) : (o(), i++);
    }
    if (o(), s)
      throw new N2(S2.INVALID_ARGUMENT, "Unterminated ` in path: " + t3);
    return new e(n2);
  }, e.emptyPath = function() {
    return new e([]);
  }, e;
}(z2);
var $ = function() {
  function t2(t3) {
    this.fields = t3, t3.sort(Y2.comparator);
  }
  return t2.prototype.covers = function(t3) {
    for (var e = 0, n2 = this.fields; e < n2.length; e++) {
      if (n2[e].isPrefixOf(t3))
        return true;
    }
    return false;
  }, t2.prototype.isEqual = function(t3) {
    return q2(this.fields, t3.fields, function(t4, e) {
      return t4.isEqual(e);
    });
  }, t2;
}();
var X2 = function() {
  function t2(t3) {
    this.binaryString = t3;
  }
  return t2.fromBase64String = function(e) {
    return new t2(atob(e));
  }, t2.fromUint8Array = function(e) {
    return new t2(function(t3) {
      for (var e2 = "", n2 = 0; n2 < t3.length; ++n2)
        e2 += String.fromCharCode(t3[n2]);
      return e2;
    }(e));
  }, t2.prototype.toBase64 = function() {
    return t3 = this.binaryString, btoa(t3);
    var t3;
  }, t2.prototype.toUint8Array = function() {
    return function(t3) {
      for (var e = new Uint8Array(t3.length), n2 = 0; n2 < t3.length; n2++)
        e[n2] = t3.charCodeAt(n2);
      return e;
    }(this.binaryString);
  }, t2.prototype.approximateByteSize = function() {
    return 2 * this.binaryString.length;
  }, t2.prototype.compareTo = function(t3) {
    return V2(this.binaryString, t3.binaryString);
  }, t2.prototype.isEqual = function(t3) {
    return this.binaryString === t3.binaryString;
  }, t2;
}();
X2.EMPTY_BYTE_STRING = new X2("");
var J2 = new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);
function Z2(t2) {
  if (O2(!!t2), typeof t2 == "string") {
    var e = 0, n2 = J2.exec(t2);
    if (O2(!!n2), n2[1]) {
      var r2 = n2[1];
      r2 = (r2 + "000000000").substr(0, 9), e = Number(r2);
    }
    var i = new Date(t2);
    return {
      seconds: Math.floor(i.getTime() / 1e3),
      nanos: e
    };
  }
  return {
    seconds: tt(t2.seconds),
    nanos: tt(t2.nanos)
  };
}
function tt(t2) {
  return typeof t2 == "number" ? t2 : typeof t2 == "string" ? Number(t2) : 0;
}
function et(t2) {
  return typeof t2 == "string" ? X2.fromBase64String(t2) : X2.fromUint8Array(t2);
}
function nt(t2) {
  var e, n2;
  return ((n2 = (((e = t2 == null ? void 0 : t2.mapValue) === null || e === void 0 ? void 0 : e.fields) || {}).__type__) === null || n2 === void 0 ? void 0 : n2.stringValue) === "server_timestamp";
}
function rt(t2) {
  var e = t2.mapValue.fields.__previous_value__;
  return nt(e) ? rt(e) : e;
}
function it(t2) {
  var e = Z2(t2.mapValue.fields.__local_write_time__.timestampValue);
  return new B(e.seconds, e.nanos);
}
function ot(t2) {
  return t2 == null;
}
function st(t2) {
  return t2 === 0 && 1 / t2 == -1 / 0;
}
function ut(t2) {
  return typeof t2 == "number" && Number.isInteger(t2) && !st(t2) && t2 <= Number.MAX_SAFE_INTEGER && t2 >= Number.MIN_SAFE_INTEGER;
}
var at = function() {
  function t2(t3) {
    this.path = t3;
  }
  return t2.fromPath = function(e) {
    return new t2(W2.fromString(e));
  }, t2.fromName = function(e) {
    return new t2(W2.fromString(e).popFirst(5));
  }, t2.prototype.hasCollectionId = function(t3) {
    return this.path.length >= 2 && this.path.get(this.path.length - 2) === t3;
  }, t2.prototype.isEqual = function(t3) {
    return t3 !== null && W2.comparator(this.path, t3.path) === 0;
  }, t2.prototype.toString = function() {
    return this.path.toString();
  }, t2.comparator = function(t3, e) {
    return W2.comparator(t3.path, e.path);
  }, t2.isDocumentKey = function(t3) {
    return t3.length % 2 == 0;
  }, t2.fromSegments = function(e) {
    return new t2(new W2(e.slice()));
  }, t2;
}();
function ct(t2) {
  return "nullValue" in t2 ? 0 : "booleanValue" in t2 ? 1 : "integerValue" in t2 || "doubleValue" in t2 ? 2 : "timestampValue" in t2 ? 3 : "stringValue" in t2 ? 5 : "bytesValue" in t2 ? 6 : "referenceValue" in t2 ? 7 : "geoPointValue" in t2 ? 8 : "arrayValue" in t2 ? 9 : "mapValue" in t2 ? nt(t2) ? 4 : 10 : L2();
}
function ht(t2, e) {
  var n2 = ct(t2);
  if (n2 !== ct(e))
    return false;
  switch (n2) {
    case 0:
      return true;
    case 1:
      return t2.booleanValue === e.booleanValue;
    case 4:
      return it(t2).isEqual(it(e));
    case 3:
      return function(t3, e2) {
        if (typeof t3.timestampValue == "string" && typeof e2.timestampValue == "string" && t3.timestampValue.length === e2.timestampValue.length)
          return t3.timestampValue === e2.timestampValue;
        var n3 = Z2(t3.timestampValue), r2 = Z2(e2.timestampValue);
        return n3.seconds === r2.seconds && n3.nanos === r2.nanos;
      }(t2, e);
    case 5:
      return t2.stringValue === e.stringValue;
    case 6:
      return function(t3, e2) {
        return et(t3.bytesValue).isEqual(et(e2.bytesValue));
      }(t2, e);
    case 7:
      return t2.referenceValue === e.referenceValue;
    case 8:
      return function(t3, e2) {
        return tt(t3.geoPointValue.latitude) === tt(e2.geoPointValue.latitude) && tt(t3.geoPointValue.longitude) === tt(e2.geoPointValue.longitude);
      }(t2, e);
    case 2:
      return function(t3, e2) {
        if ("integerValue" in t3 && "integerValue" in e2)
          return tt(t3.integerValue) === tt(e2.integerValue);
        if ("doubleValue" in t3 && "doubleValue" in e2) {
          var n3 = tt(t3.doubleValue), r2 = tt(e2.doubleValue);
          return n3 === r2 ? st(n3) === st(r2) : isNaN(n3) && isNaN(r2);
        }
        return false;
      }(t2, e);
    case 9:
      return q2(t2.arrayValue.values || [], e.arrayValue.values || [], ht);
    case 10:
      return function(t3, e2) {
        var n3 = t3.mapValue.fields || {}, r2 = e2.mapValue.fields || {};
        if (K2(n3) !== K2(r2))
          return false;
        for (var i in n3)
          if (n3.hasOwnProperty(i) && (r2[i] === void 0 || !ht(n3[i], r2[i])))
            return false;
        return true;
      }(t2, e);
    default:
      return L2();
  }
}
function ft(t2, e) {
  return (t2.values || []).find(function(t3) {
    return ht(t3, e);
  }) !== void 0;
}
function lt(t2, e) {
  var n2 = ct(t2), r2 = ct(e);
  if (n2 !== r2)
    return V2(n2, r2);
  switch (n2) {
    case 0:
      return 0;
    case 1:
      return V2(t2.booleanValue, e.booleanValue);
    case 2:
      return function(t3, e2) {
        var n3 = tt(t3.integerValue || t3.doubleValue), r3 = tt(e2.integerValue || e2.doubleValue);
        return n3 < r3 ? -1 : n3 > r3 ? 1 : n3 === r3 ? 0 : isNaN(n3) ? isNaN(r3) ? 0 : -1 : 1;
      }(t2, e);
    case 3:
      return dt(t2.timestampValue, e.timestampValue);
    case 4:
      return dt(it(t2), it(e));
    case 5:
      return V2(t2.stringValue, e.stringValue);
    case 6:
      return function(t3, e2) {
        var n3 = et(t3), r3 = et(e2);
        return n3.compareTo(r3);
      }(t2.bytesValue, e.bytesValue);
    case 7:
      return function(t3, e2) {
        for (var n3 = t3.split("/"), r3 = e2.split("/"), i = 0; i < n3.length && i < r3.length; i++) {
          var o = V2(n3[i], r3[i]);
          if (o !== 0)
            return o;
        }
        return V2(n3.length, r3.length);
      }(t2.referenceValue, e.referenceValue);
    case 8:
      return function(t3, e2) {
        var n3 = V2(tt(t3.latitude), tt(e2.latitude));
        return n3 !== 0 ? n3 : V2(tt(t3.longitude), tt(e2.longitude));
      }(t2.geoPointValue, e.geoPointValue);
    case 9:
      return function(t3, e2) {
        for (var n3 = t3.values || [], r3 = e2.values || [], i = 0; i < n3.length && i < r3.length; ++i) {
          var o = lt(n3[i], r3[i]);
          if (o)
            return o;
        }
        return V2(n3.length, r3.length);
      }(t2.arrayValue, e.arrayValue);
    case 10:
      return function(t3, e2) {
        var n3 = t3.fields || {}, r3 = Object.keys(n3), i = e2.fields || {}, o = Object.keys(i);
        r3.sort(), o.sort();
        for (var s = 0; s < r3.length && s < o.length; ++s) {
          var u2 = V2(r3[s], o[s]);
          if (u2 !== 0)
            return u2;
          var a = lt(n3[r3[s]], i[o[s]]);
          if (a !== 0)
            return a;
        }
        return V2(r3.length, o.length);
      }(t2.mapValue, e.mapValue);
    default:
      throw L2();
  }
}
function dt(t2, e) {
  if (typeof t2 == "string" && typeof e == "string" && t2.length === e.length)
    return V2(t2, e);
  var n2 = Z2(t2), r2 = Z2(e), i = V2(n2.seconds, r2.seconds);
  return i !== 0 ? i : V2(n2.nanos, r2.nanos);
}
function pt(t2) {
  return yt(t2);
}
function yt(t2) {
  return "nullValue" in t2 ? "null" : "booleanValue" in t2 ? "" + t2.booleanValue : "integerValue" in t2 ? "" + t2.integerValue : "doubleValue" in t2 ? "" + t2.doubleValue : "timestampValue" in t2 ? function(t3) {
    var e2 = Z2(t3);
    return "time(" + e2.seconds + "," + e2.nanos + ")";
  }(t2.timestampValue) : "stringValue" in t2 ? t2.stringValue : "bytesValue" in t2 ? et(t2.bytesValue).toBase64() : "referenceValue" in t2 ? (n2 = t2.referenceValue, at.fromName(n2).toString()) : "geoPointValue" in t2 ? "geo(" + (e = t2.geoPointValue).latitude + "," + e.longitude + ")" : "arrayValue" in t2 ? function(t3) {
    for (var e2 = "[", n3 = true, r2 = 0, i = t3.values || []; r2 < i.length; r2++) {
      n3 ? n3 = false : e2 += ",", e2 += yt(i[r2]);
    }
    return e2 + "]";
  }(t2.arrayValue) : "mapValue" in t2 ? function(t3) {
    for (var e2 = "{", n3 = true, r2 = 0, i = Object.keys(t3.fields || {}).sort(); r2 < i.length; r2++) {
      var o = i[r2];
      n3 ? n3 = false : e2 += ",", e2 += o + ":" + yt(t3.fields[o]);
    }
    return e2 + "}";
  }(t2.mapValue) : L2();
  var e, n2;
}
function vt(t2, e) {
  return {
    referenceValue: "projects/" + t2.projectId + "/databases/" + t2.database + "/documents/" + e.path.canonicalString()
  };
}
function mt(t2) {
  return !!t2 && "integerValue" in t2;
}
function gt(t2) {
  return !!t2 && "arrayValue" in t2;
}
function wt(t2) {
  return !!t2 && "nullValue" in t2;
}
function bt(t2) {
  return !!t2 && "doubleValue" in t2 && isNaN(Number(t2.doubleValue));
}
function It(t2) {
  return !!t2 && "mapValue" in t2;
}
function Et(t2) {
  if (t2.geoPointValue)
    return {
      geoPointValue: Object.assign({}, t2.geoPointValue)
    };
  if (t2.timestampValue)
    return {
      timestampValue: Object.assign({}, Z2(t2.timestampValue))
    };
  if (t2.mapValue) {
    var e = {
      mapValue: {
        fields: {}
      }
    };
    return G2(t2.mapValue.fields, function(t3, n3) {
      return e.mapValue.fields[t3] = Et(n3);
    }), e;
  }
  if (t2.arrayValue) {
    for (var n2 = {
      arrayValue: {
        values: []
      }
    }, r2 = 0; r2 < (t2.arrayValue.values || []).length; ++r2)
      n2.arrayValue.values[r2] = Et(t2.arrayValue.values[r2]);
    return n2;
  }
  return Object.assign({}, t2);
}
var Tt = function() {
  function t2(t3) {
    this.value = t3;
  }
  return t2.empty = function() {
    return new t2({
      mapValue: {}
    });
  }, t2.prototype.field = function(t3) {
    if (t3.isEmpty())
      return this.value;
    for (var e = this.value, n2 = 0; n2 < t3.length - 1; ++n2)
      if (!It(e = (e.mapValue.fields || {})[t3.get(n2)]))
        return null;
    return (e = (e.mapValue.fields || {})[t3.lastSegment()]) || null;
  }, t2.prototype.set = function(t3, e) {
    this.getFieldsMap(t3.popLast())[t3.lastSegment()] = Et(e);
  }, t2.prototype.setAll = function(t3) {
    var e = this, n2 = Y2.emptyPath(), r2 = {}, i = [];
    t3.forEach(function(t4, o2) {
      if (!n2.isImmediateParentOf(o2)) {
        var s = e.getFieldsMap(n2);
        e.applyChanges(s, r2, i), r2 = {}, i = [], n2 = o2.popLast();
      }
      t4 ? r2[o2.lastSegment()] = Et(t4) : i.push(o2.lastSegment());
    });
    var o = this.getFieldsMap(n2);
    this.applyChanges(o, r2, i);
  }, t2.prototype.delete = function(t3) {
    var e = this.field(t3.popLast());
    It(e) && e.mapValue.fields && delete e.mapValue.fields[t3.lastSegment()];
  }, t2.prototype.isEqual = function(t3) {
    return ht(this.value, t3.value);
  }, t2.prototype.getFieldsMap = function(t3) {
    var e = this.value;
    e.mapValue.fields || (e.mapValue = {
      fields: {}
    });
    for (var n2 = 0; n2 < t3.length; ++n2) {
      var r2 = e.mapValue.fields[t3.get(n2)];
      It(r2) && r2.mapValue.fields || (r2 = {
        mapValue: {
          fields: {}
        }
      }, e.mapValue.fields[t3.get(n2)] = r2), e = r2;
    }
    return e.mapValue.fields;
  }, t2.prototype.applyChanges = function(t3, e, n2) {
    G2(e, function(e2, n3) {
      return t3[e2] = n3;
    });
    for (var r2 = 0, i = n2; r2 < i.length; r2++) {
      var o = i[r2];
      delete t3[o];
    }
  }, t2.prototype.clone = function() {
    return new t2(Et(this.value));
  }, t2;
}();
function _t(t2) {
  var e = [];
  return G2(t2.fields, function(t3, n2) {
    var r2 = new Y2([t3]);
    if (It(n2)) {
      var i = _t(n2.mapValue).fields;
      if (i.length === 0)
        e.push(r2);
      else
        for (var o = 0, s = i; o < s.length; o++) {
          var u2 = s[o];
          e.push(r2.child(u2));
        }
    } else
      e.push(r2);
  }), new $(e);
}
var St = function() {
  function t2(t3, e, n2, r2, i) {
    this.key = t3, this.documentType = e, this.version = n2, this.data = r2, this.documentState = i;
  }
  return t2.newInvalidDocument = function(e) {
    return new t2(e, 0, j.min(), Tt.empty(), 0);
  }, t2.newFoundDocument = function(e, n2, r2) {
    return new t2(e, 1, n2, r2, 0);
  }, t2.newNoDocument = function(e, n2) {
    return new t2(e, 2, n2, Tt.empty(), 0);
  }, t2.newUnknownDocument = function(e, n2) {
    return new t2(e, 3, n2, Tt.empty(), 2);
  }, t2.prototype.convertToFoundDocument = function(t3, e) {
    return this.version = t3, this.documentType = 1, this.data = e, this.documentState = 0, this;
  }, t2.prototype.convertToNoDocument = function(t3) {
    return this.version = t3, this.documentType = 2, this.data = Tt.empty(), this.documentState = 0, this;
  }, t2.prototype.convertToUnknownDocument = function(t3) {
    return this.version = t3, this.documentType = 3, this.data = Tt.empty(), this.documentState = 2, this;
  }, t2.prototype.setHasCommittedMutations = function() {
    return this.documentState = 2, this;
  }, t2.prototype.setHasLocalMutations = function() {
    return this.documentState = 1, this;
  }, Object.defineProperty(t2.prototype, "hasLocalMutations", {
    get: function() {
      return this.documentState === 1;
    },
    enumerable: false,
    configurable: true
  }), Object.defineProperty(t2.prototype, "hasCommittedMutations", {
    get: function() {
      return this.documentState === 2;
    },
    enumerable: false,
    configurable: true
  }), Object.defineProperty(t2.prototype, "hasPendingWrites", {
    get: function() {
      return this.hasLocalMutations || this.hasCommittedMutations;
    },
    enumerable: false,
    configurable: true
  }), t2.prototype.isValidDocument = function() {
    return this.documentType !== 0;
  }, t2.prototype.isFoundDocument = function() {
    return this.documentType === 1;
  }, t2.prototype.isNoDocument = function() {
    return this.documentType === 2;
  }, t2.prototype.isUnknownDocument = function() {
    return this.documentType === 3;
  }, t2.prototype.isEqual = function(e) {
    return e instanceof t2 && this.key.isEqual(e.key) && this.version.isEqual(e.version) && this.documentType === e.documentType && this.documentState === e.documentState && this.data.isEqual(e.data);
  }, t2.prototype.clone = function() {
    return new t2(this.key, this.documentType, this.version, this.data.clone(), this.documentState);
  }, t2.prototype.toString = function() {
    return "Document(" + this.key + ", " + this.version + ", " + JSON.stringify(this.data.value) + ", {documentType: " + this.documentType + "}), {documentState: " + this.documentState + "})";
  }, t2;
}();
var Nt = function(t2, e, n2, r2, i, o, s) {
  e === void 0 && (e = null), n2 === void 0 && (n2 = []), r2 === void 0 && (r2 = []), i === void 0 && (i = null), o === void 0 && (o = null), s === void 0 && (s = null), this.path = t2, this.collectionGroup = e, this.orderBy = n2, this.filters = r2, this.limit = i, this.startAt = o, this.endAt = s, this.h = null;
};
function Dt(t2, e, n2, r2, i, o, s) {
  return e === void 0 && (e = null), n2 === void 0 && (n2 = []), r2 === void 0 && (r2 = []), i === void 0 && (i = null), o === void 0 && (o = null), s === void 0 && (s = null), new Nt(t2, e, n2, r2, i, o, s);
}
function At(t2) {
  var e = P2(t2);
  if (e.h === null) {
    var n2 = e.path.canonicalString();
    e.collectionGroup !== null && (n2 += "|cg:" + e.collectionGroup), n2 += "|f:", n2 += e.filters.map(function(t3) {
      return function(t4) {
        return t4.field.canonicalString() + t4.op.toString() + pt(t4.value);
      }(t3);
    }).join(","), n2 += "|ob:", n2 += e.orderBy.map(function(t3) {
      return function(t4) {
        return t4.field.canonicalString() + t4.dir;
      }(t3);
    }).join(","), ot(e.limit) || (n2 += "|l:", n2 += e.limit), e.startAt && (n2 += "|lb:", n2 += Bt(e.startAt)), e.endAt && (n2 += "|ub:", n2 += Bt(e.endAt)), e.h = n2;
  }
  return e.h;
}
function kt(t2, e) {
  if (t2.limit !== e.limit)
    return false;
  if (t2.orderBy.length !== e.orderBy.length)
    return false;
  for (var n2 = 0; n2 < t2.orderBy.length; n2++)
    if (!Kt(t2.orderBy[n2], e.orderBy[n2]))
      return false;
  if (t2.filters.length !== e.filters.length)
    return false;
  for (var r2 = 0; r2 < t2.filters.length; r2++)
    if (i = t2.filters[r2], o = e.filters[r2], i.op !== o.op || !i.field.isEqual(o.field) || !ht(i.value, o.value))
      return false;
  var i, o;
  return t2.collectionGroup === e.collectionGroup && !!t2.path.isEqual(e.path) && !!Qt(t2.startAt, e.startAt) && Qt(t2.endAt, e.endAt);
}
function Ct(t2) {
  return at.isDocumentKey(t2.path) && t2.collectionGroup === null && t2.filters.length === 0;
}
var xt = function(t2) {
  function e(e2, n2, r2) {
    var i = this;
    return (i = t2.call(this) || this).field = e2, i.op = n2, i.value = r2, i;
  }
  return __extends(e, t2), e.create = function(t3, n2, r2) {
    return t3.isKeyField() ? n2 === "in" || n2 === "not-in" ? this.l(t3, n2, r2) : new Rt(t3, n2, r2) : n2 === "array-contains" ? new Ft(t3, r2) : n2 === "in" ? new Mt(t3, r2) : n2 === "not-in" ? new Vt(t3, r2) : n2 === "array-contains-any" ? new qt(t3, r2) : new e(t3, n2, r2);
  }, e.l = function(t3, e2, n2) {
    return e2 === "in" ? new Lt(t3, n2) : new Ot(t3, n2);
  }, e.prototype.matches = function(t3) {
    var e2 = t3.data.field(this.field);
    return this.op === "!=" ? e2 !== null && this.m(lt(e2, this.value)) : e2 !== null && ct(this.value) === ct(e2) && this.m(lt(e2, this.value));
  }, e.prototype.m = function(t3) {
    switch (this.op) {
      case "<":
        return t3 < 0;
      case "<=":
        return t3 <= 0;
      case "==":
        return t3 === 0;
      case "!=":
        return t3 !== 0;
      case ">":
        return t3 > 0;
      case ">=":
        return t3 >= 0;
      default:
        return L2();
    }
  }, e.prototype.g = function() {
    return ["<", "<=", ">", ">=", "!=", "not-in"].indexOf(this.op) >= 0;
  }, e;
}(function() {
});
var Rt = function(t2) {
  function e(e2, n2, r2) {
    var i = this;
    return (i = t2.call(this, e2, n2, r2) || this).key = at.fromName(r2.referenceValue), i;
  }
  return __extends(e, t2), e.prototype.matches = function(t3) {
    var e2 = at.comparator(t3.key, this.key);
    return this.m(e2);
  }, e;
}(xt);
var Lt = function(t2) {
  function e(e2, n2) {
    var r2 = this;
    return (r2 = t2.call(this, e2, "in", n2) || this).keys = Pt("in", n2), r2;
  }
  return __extends(e, t2), e.prototype.matches = function(t3) {
    return this.keys.some(function(e2) {
      return e2.isEqual(t3.key);
    });
  }, e;
}(xt);
var Ot = function(t2) {
  function e(e2, n2) {
    var r2 = this;
    return (r2 = t2.call(this, e2, "not-in", n2) || this).keys = Pt("not-in", n2), r2;
  }
  return __extends(e, t2), e.prototype.matches = function(t3) {
    return !this.keys.some(function(e2) {
      return e2.isEqual(t3.key);
    });
  }, e;
}(xt);
function Pt(t2, e) {
  var n2;
  return (((n2 = e.arrayValue) === null || n2 === void 0 ? void 0 : n2.values) || []).map(function(t3) {
    return at.fromName(t3.referenceValue);
  });
}
var Ft = function(t2) {
  function e(e2, n2) {
    return t2.call(this, e2, "array-contains", n2) || this;
  }
  return __extends(e, t2), e.prototype.matches = function(t3) {
    var e2 = t3.data.field(this.field);
    return gt(e2) && ft(e2.arrayValue, this.value);
  }, e;
}(xt);
var Mt = function(t2) {
  function e(e2, n2) {
    return t2.call(this, e2, "in", n2) || this;
  }
  return __extends(e, t2), e.prototype.matches = function(t3) {
    var e2 = t3.data.field(this.field);
    return e2 !== null && ft(this.value.arrayValue, e2);
  }, e;
}(xt);
var Vt = function(t2) {
  function e(e2, n2) {
    return t2.call(this, e2, "not-in", n2) || this;
  }
  return __extends(e, t2), e.prototype.matches = function(t3) {
    if (ft(this.value.arrayValue, {
      nullValue: "NULL_VALUE"
    }))
      return false;
    var e2 = t3.data.field(this.field);
    return e2 !== null && !ft(this.value.arrayValue, e2);
  }, e;
}(xt);
var qt = function(t2) {
  function e(e2, n2) {
    return t2.call(this, e2, "array-contains-any", n2) || this;
  }
  return __extends(e, t2), e.prototype.matches = function(t3) {
    var e2 = this, n2 = t3.data.field(this.field);
    return !(!gt(n2) || !n2.arrayValue.values) && n2.arrayValue.values.some(function(t4) {
      return ft(e2.value.arrayValue, t4);
    });
  }, e;
}(xt);
var Ut = function(t2, e) {
  this.position = t2, this.before = e;
};
function Bt(t2) {
  return (t2.before ? "b" : "a") + ":" + t2.position.map(function(t3) {
    return pt(t3);
  }).join(",");
}
var jt = function(t2, e) {
  e === void 0 && (e = "asc"), this.field = t2, this.dir = e;
};
function Kt(t2, e) {
  return t2.dir === e.dir && t2.field.isEqual(e.field);
}
function Gt(t2, e, n2) {
  for (var r2 = 0, i = 0; i < t2.position.length; i++) {
    var o = e[i], s = t2.position[i];
    if (r2 = o.field.isKeyField() ? at.comparator(at.fromName(s.referenceValue), n2.key) : lt(s, n2.data.field(o.field)), o.dir === "desc" && (r2 *= -1), r2 !== 0)
      break;
  }
  return t2.before ? r2 <= 0 : r2 < 0;
}
function Qt(t2, e) {
  if (t2 === null)
    return e === null;
  if (e === null)
    return false;
  if (t2.before !== e.before || t2.position.length !== e.position.length)
    return false;
  for (var n2 = 0; n2 < t2.position.length; n2++)
    if (!ht(t2.position[n2], e.position[n2]))
      return false;
  return true;
}
var zt = function(t2, e, n2, r2, i, o, s, u2) {
  e === void 0 && (e = null), n2 === void 0 && (n2 = []), r2 === void 0 && (r2 = []), i === void 0 && (i = null), o === void 0 && (o = "F"), s === void 0 && (s = null), u2 === void 0 && (u2 = null), this.path = t2, this.collectionGroup = e, this.explicitOrderBy = n2, this.filters = r2, this.limit = i, this.limitType = o, this.startAt = s, this.endAt = u2, this.p = null, this.T = null, this.startAt, this.endAt;
};
function Wt(t2, e, n2, r2, i, o, s, u2) {
  return new zt(t2, e, n2, r2, i, o, s, u2);
}
function Ht(t2) {
  return new zt(t2);
}
function Yt(t2) {
  return !ot(t2.limit) && t2.limitType === "F";
}
function $t(t2) {
  return !ot(t2.limit) && t2.limitType === "L";
}
function Xt(t2) {
  return t2.explicitOrderBy.length > 0 ? t2.explicitOrderBy[0].field : null;
}
function Jt(t2) {
  for (var e = 0, n2 = t2.filters; e < n2.length; e++) {
    var r2 = n2[e];
    if (r2.g())
      return r2.field;
  }
  return null;
}
function Zt(t2) {
  return t2.collectionGroup !== null;
}
function te(t2) {
  var e = P2(t2);
  if (e.p === null) {
    e.p = [];
    var n2 = Jt(e), r2 = Xt(e);
    if (n2 !== null && r2 === null)
      n2.isKeyField() || e.p.push(new jt(n2)), e.p.push(new jt(Y2.keyField(), "asc"));
    else {
      for (var i = false, o = 0, s = e.explicitOrderBy; o < s.length; o++) {
        var u2 = s[o];
        e.p.push(u2), u2.field.isKeyField() && (i = true);
      }
      if (!i) {
        var a = e.explicitOrderBy.length > 0 ? e.explicitOrderBy[e.explicitOrderBy.length - 1].dir : "asc";
        e.p.push(new jt(Y2.keyField(), a));
      }
    }
  }
  return e.p;
}
function ee(t2) {
  var e = P2(t2);
  if (!e.T)
    if (e.limitType === "F")
      e.T = Dt(e.path, e.collectionGroup, te(e), e.filters, e.limit, e.startAt, e.endAt);
    else {
      for (var n2 = [], r2 = 0, i = te(e); r2 < i.length; r2++) {
        var o = i[r2], s = o.dir === "desc" ? "asc" : "desc";
        n2.push(new jt(o.field, s));
      }
      var u2 = e.endAt ? new Ut(e.endAt.position, !e.endAt.before) : null, a = e.startAt ? new Ut(e.startAt.position, !e.startAt.before) : null;
      e.T = Dt(e.path, e.collectionGroup, n2, e.filters, e.limit, u2, a);
    }
  return e.T;
}
function ne(t2, e, n2) {
  return new zt(t2.path, t2.collectionGroup, t2.explicitOrderBy.slice(), t2.filters.slice(), e, n2, t2.startAt, t2.endAt);
}
function re(t2, e) {
  return kt(ee(t2), ee(e)) && t2.limitType === e.limitType;
}
function ie(t2) {
  return At(ee(t2)) + "|lt:" + t2.limitType;
}
function oe(t2) {
  return "Query(target=" + function(t3) {
    var e = t3.path.canonicalString();
    return t3.collectionGroup !== null && (e += " collectionGroup=" + t3.collectionGroup), t3.filters.length > 0 && (e += ", filters: [" + t3.filters.map(function(t4) {
      return (e2 = t4).field.canonicalString() + " " + e2.op + " " + pt(e2.value);
      var e2;
    }).join(", ") + "]"), ot(t3.limit) || (e += ", limit: " + t3.limit), t3.orderBy.length > 0 && (e += ", orderBy: [" + t3.orderBy.map(function(t4) {
      return function(t5) {
        return t5.field.canonicalString() + " (" + t5.dir + ")";
      }(t4);
    }).join(", ") + "]"), t3.startAt && (e += ", startAt: " + Bt(t3.startAt)), t3.endAt && (e += ", endAt: " + Bt(t3.endAt)), "Target(" + e + ")";
  }(ee(t2)) + "; limitType=" + t2.limitType + ")";
}
function se(t2, e) {
  return e.isFoundDocument() && function(t3, e2) {
    var n2 = e2.key.path;
    return t3.collectionGroup !== null ? e2.key.hasCollectionId(t3.collectionGroup) && t3.path.isPrefixOf(n2) : at.isDocumentKey(t3.path) ? t3.path.isEqual(n2) : t3.path.isImmediateParentOf(n2);
  }(t2, e) && function(t3, e2) {
    for (var n2 = 0, r2 = t3.explicitOrderBy; n2 < r2.length; n2++) {
      var i = r2[n2];
      if (!i.field.isKeyField() && e2.data.field(i.field) === null)
        return false;
    }
    return true;
  }(t2, e) && function(t3, e2) {
    for (var n2 = 0, r2 = t3.filters; n2 < r2.length; n2++) {
      if (!r2[n2].matches(e2))
        return false;
    }
    return true;
  }(t2, e) && function(t3, e2) {
    return !(t3.startAt && !Gt(t3.startAt, te(t3), e2)) && (!t3.endAt || !Gt(t3.endAt, te(t3), e2));
  }(t2, e);
}
function ue(t2) {
  return function(e, n2) {
    for (var r2 = false, i = 0, o = te(t2); i < o.length; i++) {
      var s = o[i], u2 = ae(s, e, n2);
      if (u2 !== 0)
        return u2;
      r2 = r2 || s.field.isKeyField();
    }
    return 0;
  };
}
function ae(t2, e, n2) {
  var r2 = t2.field.isKeyField() ? at.comparator(e.key, n2.key) : function(t3, e2, n3) {
    var r3 = e2.data.field(t3), i = n3.data.field(t3);
    return r3 !== null && i !== null ? lt(r3, i) : L2();
  }(t2.field, e, n2);
  switch (t2.dir) {
    case "asc":
      return r2;
    case "desc":
      return -1 * r2;
    default:
      return L2();
  }
}
function ce(t2, e) {
  if (t2.I) {
    if (isNaN(e))
      return {
        doubleValue: "NaN"
      };
    if (e === 1 / 0)
      return {
        doubleValue: "Infinity"
      };
    if (e === -1 / 0)
      return {
        doubleValue: "-Infinity"
      };
  }
  return {
    doubleValue: st(e) ? "-0" : e
  };
}
function he(t2) {
  return {
    integerValue: "" + t2
  };
}
function fe(t2, e) {
  return ut(e) ? he(e) : ce(t2, e);
}
var le = function() {
  this._ = void 0;
};
function de(t2, e, n2) {
  return t2 instanceof ve ? function(t3, e2) {
    var n3 = {
      fields: {
        __type__: {
          stringValue: "server_timestamp"
        },
        __local_write_time__: {
          timestampValue: {
            seconds: t3.seconds,
            nanos: t3.nanoseconds
          }
        }
      }
    };
    return e2 && (n3.fields.__previous_value__ = e2), {
      mapValue: n3
    };
  }(n2, e) : t2 instanceof me ? ge(t2, e) : t2 instanceof we ? be(t2, e) : function(t3, e2) {
    var n3 = ye(t3, e2), r2 = Ee(n3) + Ee(t3.A);
    return mt(n3) && mt(t3.A) ? he(r2) : ce(t3.R, r2);
  }(t2, e);
}
function pe(t2, e, n2) {
  return t2 instanceof me ? ge(t2, e) : t2 instanceof we ? be(t2, e) : n2;
}
function ye(t2, e) {
  return t2 instanceof Ie ? mt(n2 = e) || function(t3) {
    return !!t3 && "doubleValue" in t3;
  }(n2) ? e : {
    integerValue: 0
  } : null;
  var n2;
}
var ve = function(t2) {
  function e() {
    return t2 !== null && t2.apply(this, arguments) || this;
  }
  return __extends(e, t2), e;
}(le);
var me = function(t2) {
  function e(e2) {
    var n2 = this;
    return (n2 = t2.call(this) || this).elements = e2, n2;
  }
  return __extends(e, t2), e;
}(le);
function ge(t2, e) {
  for (var n2 = Te(e), r2 = function(t3) {
    n2.some(function(e2) {
      return ht(e2, t3);
    }) || n2.push(t3);
  }, i = 0, o = t2.elements; i < o.length; i++) {
    r2(o[i]);
  }
  return {
    arrayValue: {
      values: n2
    }
  };
}
var we = function(t2) {
  function e(e2) {
    var n2 = this;
    return (n2 = t2.call(this) || this).elements = e2, n2;
  }
  return __extends(e, t2), e;
}(le);
function be(t2, e) {
  for (var n2 = Te(e), r2 = function(t3) {
    n2 = n2.filter(function(e2) {
      return !ht(e2, t3);
    });
  }, i = 0, o = t2.elements; i < o.length; i++) {
    r2(o[i]);
  }
  return {
    arrayValue: {
      values: n2
    }
  };
}
var Ie = function(t2) {
  function e(e2, n2) {
    var r2 = this;
    return (r2 = t2.call(this) || this).R = e2, r2.A = n2, r2;
  }
  return __extends(e, t2), e;
}(le);
function Ee(t2) {
  return tt(t2.integerValue || t2.doubleValue);
}
function Te(t2) {
  return gt(t2) && t2.arrayValue.values ? t2.arrayValue.values.slice() : [];
}
var _e = function(t2, e) {
  this.field = t2, this.transform = e;
};
var Se = function(t2, e) {
  this.version = t2, this.transformResults = e;
};
var Ne = function() {
  function t2(t3, e) {
    this.updateTime = t3, this.exists = e;
  }
  return t2.none = function() {
    return new t2();
  }, t2.exists = function(e) {
    return new t2(void 0, e);
  }, t2.updateTime = function(e) {
    return new t2(e);
  }, Object.defineProperty(t2.prototype, "isNone", {
    get: function() {
      return this.updateTime === void 0 && this.exists === void 0;
    },
    enumerable: false,
    configurable: true
  }), t2.prototype.isEqual = function(t3) {
    return this.exists === t3.exists && (this.updateTime ? !!t3.updateTime && this.updateTime.isEqual(t3.updateTime) : !t3.updateTime);
  }, t2;
}();
function De(t2, e) {
  return t2.updateTime !== void 0 ? e.isFoundDocument() && e.version.isEqual(t2.updateTime) : t2.exists === void 0 || t2.exists === e.isFoundDocument();
}
var Ae = function() {
};
function ke(t2, e, n2) {
  t2 instanceof Oe ? function(t3, e2, n3) {
    var r2 = t3.value.clone(), i = Me(t3.fieldTransforms, e2, n3.transformResults);
    r2.setAll(i), e2.convertToFoundDocument(n3.version, r2).setHasCommittedMutations();
  }(t2, e, n2) : t2 instanceof Pe ? function(t3, e2, n3) {
    if (De(t3.precondition, e2)) {
      var r2 = Me(t3.fieldTransforms, e2, n3.transformResults), i = e2.data;
      i.setAll(Fe(t3)), i.setAll(r2), e2.convertToFoundDocument(n3.version, i).setHasCommittedMutations();
    } else
      e2.convertToUnknownDocument(n3.version);
  }(t2, e, n2) : function(t3, e2, n3) {
    e2.convertToNoDocument(n3.version).setHasCommittedMutations();
  }(0, e, n2);
}
function Ce(t2, e, n2) {
  t2 instanceof Oe ? function(t3, e2, n3) {
    if (De(t3.precondition, e2)) {
      var r2 = t3.value.clone(), i = Ve(t3.fieldTransforms, n3, e2);
      r2.setAll(i), e2.convertToFoundDocument(Le(e2), r2).setHasLocalMutations();
    }
  }(t2, e, n2) : t2 instanceof Pe ? function(t3, e2, n3) {
    if (De(t3.precondition, e2)) {
      var r2 = Ve(t3.fieldTransforms, n3, e2), i = e2.data;
      i.setAll(Fe(t3)), i.setAll(r2), e2.convertToFoundDocument(Le(e2), i).setHasLocalMutations();
    }
  }(t2, e, n2) : function(t3, e2) {
    De(t3.precondition, e2) && e2.convertToNoDocument(j.min());
  }(t2, e);
}
function xe(t2, e) {
  for (var n2 = null, r2 = 0, i = t2.fieldTransforms; r2 < i.length; r2++) {
    var o = i[r2], s = e.data.field(o.field), u2 = ye(o.transform, s || null);
    u2 != null && (n2 == null && (n2 = Tt.empty()), n2.set(o.field, u2));
  }
  return n2 || null;
}
function Re(t2, e) {
  return t2.type === e.type && !!t2.key.isEqual(e.key) && !!t2.precondition.isEqual(e.precondition) && !!function(t3, e2) {
    return t3 === void 0 && e2 === void 0 || !(!t3 || !e2) && q2(t3, e2, function(t4, e3) {
      return function(t5, e4) {
        return t5.field.isEqual(e4.field) && function(t6, e5) {
          return t6 instanceof me && e5 instanceof me || t6 instanceof we && e5 instanceof we ? q2(t6.elements, e5.elements, ht) : t6 instanceof Ie && e5 instanceof Ie ? ht(t6.A, e5.A) : t6 instanceof ve && e5 instanceof ve;
        }(t5.transform, e4.transform);
      }(t4, e3);
    });
  }(t2.fieldTransforms, e.fieldTransforms) && (t2.type === 0 ? t2.value.isEqual(e.value) : t2.type !== 1 || t2.data.isEqual(e.data) && t2.fieldMask.isEqual(e.fieldMask));
}
function Le(t2) {
  return t2.isFoundDocument() ? t2.version : j.min();
}
var Oe = function(t2) {
  function e(e2, n2, r2, i) {
    i === void 0 && (i = []);
    var o = this;
    return (o = t2.call(this) || this).key = e2, o.value = n2, o.precondition = r2, o.fieldTransforms = i, o.type = 0, o;
  }
  return __extends(e, t2), e;
}(Ae);
var Pe = function(t2) {
  function e(e2, n2, r2, i, o) {
    o === void 0 && (o = []);
    var s = this;
    return (s = t2.call(this) || this).key = e2, s.data = n2, s.fieldMask = r2, s.precondition = i, s.fieldTransforms = o, s.type = 1, s;
  }
  return __extends(e, t2), e;
}(Ae);
function Fe(t2) {
  var e = new Map();
  return t2.fieldMask.fields.forEach(function(n2) {
    if (!n2.isEmpty()) {
      var r2 = t2.data.field(n2);
      e.set(n2, r2);
    }
  }), e;
}
function Me(t2, e, n2) {
  var r2 = new Map();
  O2(t2.length === n2.length);
  for (var i = 0; i < n2.length; i++) {
    var o = t2[i], s = o.transform, u2 = e.data.field(o.field);
    r2.set(o.field, pe(s, u2, n2[i]));
  }
  return r2;
}
function Ve(t2, e, n2) {
  for (var r2 = new Map(), i = 0, o = t2; i < o.length; i++) {
    var s = o[i], u2 = s.transform, a = n2.data.field(s.field);
    r2.set(s.field, de(u2, a, e));
  }
  return r2;
}
var qe;
var Ue;
var Be = function(t2) {
  function e(e2, n2) {
    var r2 = this;
    return (r2 = t2.call(this) || this).key = e2, r2.precondition = n2, r2.type = 2, r2.fieldTransforms = [], r2;
  }
  return __extends(e, t2), e;
}(Ae);
var je = function(t2) {
  function e(e2, n2) {
    var r2 = this;
    return (r2 = t2.call(this) || this).key = e2, r2.precondition = n2, r2.type = 3, r2.fieldTransforms = [], r2;
  }
  return __extends(e, t2), e;
}(Ae);
var Ke = function(t2) {
  this.count = t2;
};
function Ge(t2) {
  switch (t2) {
    case S2.OK:
      return L2();
    case S2.CANCELLED:
    case S2.UNKNOWN:
    case S2.DEADLINE_EXCEEDED:
    case S2.RESOURCE_EXHAUSTED:
    case S2.INTERNAL:
    case S2.UNAVAILABLE:
    case S2.UNAUTHENTICATED:
      return false;
    case S2.INVALID_ARGUMENT:
    case S2.NOT_FOUND:
    case S2.ALREADY_EXISTS:
    case S2.PERMISSION_DENIED:
    case S2.FAILED_PRECONDITION:
    case S2.ABORTED:
    case S2.OUT_OF_RANGE:
    case S2.UNIMPLEMENTED:
    case S2.DATA_LOSS:
      return true;
    default:
      return L2();
  }
}
function Qe(t2) {
  if (t2 === void 0)
    return C("GRPC error has no .code"), S2.UNKNOWN;
  switch (t2) {
    case qe.OK:
      return S2.OK;
    case qe.CANCELLED:
      return S2.CANCELLED;
    case qe.UNKNOWN:
      return S2.UNKNOWN;
    case qe.DEADLINE_EXCEEDED:
      return S2.DEADLINE_EXCEEDED;
    case qe.RESOURCE_EXHAUSTED:
      return S2.RESOURCE_EXHAUSTED;
    case qe.INTERNAL:
      return S2.INTERNAL;
    case qe.UNAVAILABLE:
      return S2.UNAVAILABLE;
    case qe.UNAUTHENTICATED:
      return S2.UNAUTHENTICATED;
    case qe.INVALID_ARGUMENT:
      return S2.INVALID_ARGUMENT;
    case qe.NOT_FOUND:
      return S2.NOT_FOUND;
    case qe.ALREADY_EXISTS:
      return S2.ALREADY_EXISTS;
    case qe.PERMISSION_DENIED:
      return S2.PERMISSION_DENIED;
    case qe.FAILED_PRECONDITION:
      return S2.FAILED_PRECONDITION;
    case qe.ABORTED:
      return S2.ABORTED;
    case qe.OUT_OF_RANGE:
      return S2.OUT_OF_RANGE;
    case qe.UNIMPLEMENTED:
      return S2.UNIMPLEMENTED;
    case qe.DATA_LOSS:
      return S2.DATA_LOSS;
    default:
      return L2();
  }
}
(Ue = qe || (qe = {}))[Ue.OK = 0] = "OK", Ue[Ue.CANCELLED = 1] = "CANCELLED", Ue[Ue.UNKNOWN = 2] = "UNKNOWN", Ue[Ue.INVALID_ARGUMENT = 3] = "INVALID_ARGUMENT", Ue[Ue.DEADLINE_EXCEEDED = 4] = "DEADLINE_EXCEEDED", Ue[Ue.NOT_FOUND = 5] = "NOT_FOUND", Ue[Ue.ALREADY_EXISTS = 6] = "ALREADY_EXISTS", Ue[Ue.PERMISSION_DENIED = 7] = "PERMISSION_DENIED", Ue[Ue.UNAUTHENTICATED = 16] = "UNAUTHENTICATED", Ue[Ue.RESOURCE_EXHAUSTED = 8] = "RESOURCE_EXHAUSTED", Ue[Ue.FAILED_PRECONDITION = 9] = "FAILED_PRECONDITION", Ue[Ue.ABORTED = 10] = "ABORTED", Ue[Ue.OUT_OF_RANGE = 11] = "OUT_OF_RANGE", Ue[Ue.UNIMPLEMENTED = 12] = "UNIMPLEMENTED", Ue[Ue.INTERNAL = 13] = "INTERNAL", Ue[Ue.UNAVAILABLE = 14] = "UNAVAILABLE", Ue[Ue.DATA_LOSS = 15] = "DATA_LOSS";
var ze = function() {
  function t2(t3, e) {
    this.comparator = t3, this.root = e || He.EMPTY;
  }
  return t2.prototype.insert = function(e, n2) {
    return new t2(this.comparator, this.root.insert(e, n2, this.comparator).copy(null, null, He.BLACK, null, null));
  }, t2.prototype.remove = function(e) {
    return new t2(this.comparator, this.root.remove(e, this.comparator).copy(null, null, He.BLACK, null, null));
  }, t2.prototype.get = function(t3) {
    for (var e = this.root; !e.isEmpty(); ) {
      var n2 = this.comparator(t3, e.key);
      if (n2 === 0)
        return e.value;
      n2 < 0 ? e = e.left : n2 > 0 && (e = e.right);
    }
    return null;
  }, t2.prototype.indexOf = function(t3) {
    for (var e = 0, n2 = this.root; !n2.isEmpty(); ) {
      var r2 = this.comparator(t3, n2.key);
      if (r2 === 0)
        return e + n2.left.size;
      r2 < 0 ? n2 = n2.left : (e += n2.left.size + 1, n2 = n2.right);
    }
    return -1;
  }, t2.prototype.isEmpty = function() {
    return this.root.isEmpty();
  }, Object.defineProperty(t2.prototype, "size", {
    get: function() {
      return this.root.size;
    },
    enumerable: false,
    configurable: true
  }), t2.prototype.minKey = function() {
    return this.root.minKey();
  }, t2.prototype.maxKey = function() {
    return this.root.maxKey();
  }, t2.prototype.inorderTraversal = function(t3) {
    return this.root.inorderTraversal(t3);
  }, t2.prototype.forEach = function(t3) {
    this.inorderTraversal(function(e, n2) {
      return t3(e, n2), false;
    });
  }, t2.prototype.toString = function() {
    var t3 = [];
    return this.inorderTraversal(function(e, n2) {
      return t3.push(e + ":" + n2), false;
    }), "{" + t3.join(", ") + "}";
  }, t2.prototype.reverseTraversal = function(t3) {
    return this.root.reverseTraversal(t3);
  }, t2.prototype.getIterator = function() {
    return new We(this.root, null, this.comparator, false);
  }, t2.prototype.getIteratorFrom = function(t3) {
    return new We(this.root, t3, this.comparator, false);
  }, t2.prototype.getReverseIterator = function() {
    return new We(this.root, null, this.comparator, true);
  }, t2.prototype.getReverseIteratorFrom = function(t3) {
    return new We(this.root, t3, this.comparator, true);
  }, t2;
}();
var We = function() {
  function t2(t3, e, n2, r2) {
    this.isReverse = r2, this.nodeStack = [];
    for (var i = 1; !t3.isEmpty(); )
      if (i = e ? n2(t3.key, e) : 1, r2 && (i *= -1), i < 0)
        t3 = this.isReverse ? t3.left : t3.right;
      else {
        if (i === 0) {
          this.nodeStack.push(t3);
          break;
        }
        this.nodeStack.push(t3), t3 = this.isReverse ? t3.right : t3.left;
      }
  }
  return t2.prototype.getNext = function() {
    var t3 = this.nodeStack.pop(), e = {
      key: t3.key,
      value: t3.value
    };
    if (this.isReverse)
      for (t3 = t3.left; !t3.isEmpty(); )
        this.nodeStack.push(t3), t3 = t3.right;
    else
      for (t3 = t3.right; !t3.isEmpty(); )
        this.nodeStack.push(t3), t3 = t3.left;
    return e;
  }, t2.prototype.hasNext = function() {
    return this.nodeStack.length > 0;
  }, t2.prototype.peek = function() {
    if (this.nodeStack.length === 0)
      return null;
    var t3 = this.nodeStack[this.nodeStack.length - 1];
    return {
      key: t3.key,
      value: t3.value
    };
  }, t2;
}();
var He = function() {
  function t2(e, n2, r2, i, o) {
    this.key = e, this.value = n2, this.color = r2 != null ? r2 : t2.RED, this.left = i != null ? i : t2.EMPTY, this.right = o != null ? o : t2.EMPTY, this.size = this.left.size + 1 + this.right.size;
  }
  return t2.prototype.copy = function(e, n2, r2, i, o) {
    return new t2(e != null ? e : this.key, n2 != null ? n2 : this.value, r2 != null ? r2 : this.color, i != null ? i : this.left, o != null ? o : this.right);
  }, t2.prototype.isEmpty = function() {
    return false;
  }, t2.prototype.inorderTraversal = function(t3) {
    return this.left.inorderTraversal(t3) || t3(this.key, this.value) || this.right.inorderTraversal(t3);
  }, t2.prototype.reverseTraversal = function(t3) {
    return this.right.reverseTraversal(t3) || t3(this.key, this.value) || this.left.reverseTraversal(t3);
  }, t2.prototype.min = function() {
    return this.left.isEmpty() ? this : this.left.min();
  }, t2.prototype.minKey = function() {
    return this.min().key;
  }, t2.prototype.maxKey = function() {
    return this.right.isEmpty() ? this.key : this.right.maxKey();
  }, t2.prototype.insert = function(t3, e, n2) {
    var r2 = this, i = n2(t3, r2.key);
    return (r2 = i < 0 ? r2.copy(null, null, null, r2.left.insert(t3, e, n2), null) : i === 0 ? r2.copy(null, e, null, null, null) : r2.copy(null, null, null, null, r2.right.insert(t3, e, n2))).fixUp();
  }, t2.prototype.removeMin = function() {
    if (this.left.isEmpty())
      return t2.EMPTY;
    var e = this;
    return e.left.isRed() || e.left.left.isRed() || (e = e.moveRedLeft()), (e = e.copy(null, null, null, e.left.removeMin(), null)).fixUp();
  }, t2.prototype.remove = function(e, n2) {
    var r2, i = this;
    if (n2(e, i.key) < 0)
      i.left.isEmpty() || i.left.isRed() || i.left.left.isRed() || (i = i.moveRedLeft()), i = i.copy(null, null, null, i.left.remove(e, n2), null);
    else {
      if (i.left.isRed() && (i = i.rotateRight()), i.right.isEmpty() || i.right.isRed() || i.right.left.isRed() || (i = i.moveRedRight()), n2(e, i.key) === 0) {
        if (i.right.isEmpty())
          return t2.EMPTY;
        r2 = i.right.min(), i = i.copy(r2.key, r2.value, null, null, i.right.removeMin());
      }
      i = i.copy(null, null, null, null, i.right.remove(e, n2));
    }
    return i.fixUp();
  }, t2.prototype.isRed = function() {
    return this.color;
  }, t2.prototype.fixUp = function() {
    var t3 = this;
    return t3.right.isRed() && !t3.left.isRed() && (t3 = t3.rotateLeft()), t3.left.isRed() && t3.left.left.isRed() && (t3 = t3.rotateRight()), t3.left.isRed() && t3.right.isRed() && (t3 = t3.colorFlip()), t3;
  }, t2.prototype.moveRedLeft = function() {
    var t3 = this.colorFlip();
    return t3.right.left.isRed() && (t3 = (t3 = (t3 = t3.copy(null, null, null, null, t3.right.rotateRight())).rotateLeft()).colorFlip()), t3;
  }, t2.prototype.moveRedRight = function() {
    var t3 = this.colorFlip();
    return t3.left.left.isRed() && (t3 = (t3 = t3.rotateRight()).colorFlip()), t3;
  }, t2.prototype.rotateLeft = function() {
    var e = this.copy(null, null, t2.RED, null, this.right.left);
    return this.right.copy(null, null, this.color, e, null);
  }, t2.prototype.rotateRight = function() {
    var e = this.copy(null, null, t2.RED, this.left.right, null);
    return this.left.copy(null, null, this.color, null, e);
  }, t2.prototype.colorFlip = function() {
    var t3 = this.left.copy(null, null, !this.left.color, null, null), e = this.right.copy(null, null, !this.right.color, null, null);
    return this.copy(null, null, !this.color, t3, e);
  }, t2.prototype.checkMaxDepth = function() {
    var t3 = this.check();
    return Math.pow(2, t3) <= this.size + 1;
  }, t2.prototype.check = function() {
    if (this.isRed() && this.left.isRed())
      throw L2();
    if (this.right.isRed())
      throw L2();
    var t3 = this.left.check();
    if (t3 !== this.right.check())
      throw L2();
    return t3 + (this.isRed() ? 0 : 1);
  }, t2;
}();
He.EMPTY = null, He.RED = true, He.BLACK = false, He.EMPTY = new (function() {
  function t2() {
    this.size = 0;
  }
  return Object.defineProperty(t2.prototype, "key", {
    get: function() {
      throw L2();
    },
    enumerable: false,
    configurable: true
  }), Object.defineProperty(t2.prototype, "value", {
    get: function() {
      throw L2();
    },
    enumerable: false,
    configurable: true
  }), Object.defineProperty(t2.prototype, "color", {
    get: function() {
      throw L2();
    },
    enumerable: false,
    configurable: true
  }), Object.defineProperty(t2.prototype, "left", {
    get: function() {
      throw L2();
    },
    enumerable: false,
    configurable: true
  }), Object.defineProperty(t2.prototype, "right", {
    get: function() {
      throw L2();
    },
    enumerable: false,
    configurable: true
  }), t2.prototype.copy = function(t3, e, n2, r2, i) {
    return this;
  }, t2.prototype.insert = function(t3, e, n2) {
    return new He(t3, e);
  }, t2.prototype.remove = function(t3, e) {
    return this;
  }, t2.prototype.isEmpty = function() {
    return true;
  }, t2.prototype.inorderTraversal = function(t3) {
    return false;
  }, t2.prototype.reverseTraversal = function(t3) {
    return false;
  }, t2.prototype.minKey = function() {
    return null;
  }, t2.prototype.maxKey = function() {
    return null;
  }, t2.prototype.isRed = function() {
    return false;
  }, t2.prototype.checkMaxDepth = function() {
    return true;
  }, t2.prototype.check = function() {
    return 0;
  }, t2;
}())();
var Ye = function() {
  function t2(t3) {
    this.comparator = t3, this.data = new ze(this.comparator);
  }
  return t2.prototype.has = function(t3) {
    return this.data.get(t3) !== null;
  }, t2.prototype.first = function() {
    return this.data.minKey();
  }, t2.prototype.last = function() {
    return this.data.maxKey();
  }, Object.defineProperty(t2.prototype, "size", {
    get: function() {
      return this.data.size;
    },
    enumerable: false,
    configurable: true
  }), t2.prototype.indexOf = function(t3) {
    return this.data.indexOf(t3);
  }, t2.prototype.forEach = function(t3) {
    this.data.inorderTraversal(function(e, n2) {
      return t3(e), false;
    });
  }, t2.prototype.forEachInRange = function(t3, e) {
    for (var n2 = this.data.getIteratorFrom(t3[0]); n2.hasNext(); ) {
      var r2 = n2.getNext();
      if (this.comparator(r2.key, t3[1]) >= 0)
        return;
      e(r2.key);
    }
  }, t2.prototype.forEachWhile = function(t3, e) {
    var n2;
    for (n2 = e !== void 0 ? this.data.getIteratorFrom(e) : this.data.getIterator(); n2.hasNext(); )
      if (!t3(n2.getNext().key))
        return;
  }, t2.prototype.firstAfterOrEqual = function(t3) {
    var e = this.data.getIteratorFrom(t3);
    return e.hasNext() ? e.getNext().key : null;
  }, t2.prototype.getIterator = function() {
    return new $e(this.data.getIterator());
  }, t2.prototype.getIteratorFrom = function(t3) {
    return new $e(this.data.getIteratorFrom(t3));
  }, t2.prototype.add = function(t3) {
    return this.copy(this.data.remove(t3).insert(t3, true));
  }, t2.prototype.delete = function(t3) {
    return this.has(t3) ? this.copy(this.data.remove(t3)) : this;
  }, t2.prototype.isEmpty = function() {
    return this.data.isEmpty();
  }, t2.prototype.unionWith = function(t3) {
    var e = this;
    return e.size < t3.size && (e = t3, t3 = this), t3.forEach(function(t4) {
      e = e.add(t4);
    }), e;
  }, t2.prototype.isEqual = function(e) {
    if (!(e instanceof t2))
      return false;
    if (this.size !== e.size)
      return false;
    for (var n2 = this.data.getIterator(), r2 = e.data.getIterator(); n2.hasNext(); ) {
      var i = n2.getNext().key, o = r2.getNext().key;
      if (this.comparator(i, o) !== 0)
        return false;
    }
    return true;
  }, t2.prototype.toArray = function() {
    var t3 = [];
    return this.forEach(function(e) {
      t3.push(e);
    }), t3;
  }, t2.prototype.toString = function() {
    var t3 = [];
    return this.forEach(function(e) {
      return t3.push(e);
    }), "SortedSet(" + t3.toString() + ")";
  }, t2.prototype.copy = function(e) {
    var n2 = new t2(this.comparator);
    return n2.data = e, n2;
  }, t2;
}();
var $e = function() {
  function t2(t3) {
    this.iter = t3;
  }
  return t2.prototype.getNext = function() {
    return this.iter.getNext().key;
  }, t2.prototype.hasNext = function() {
    return this.iter.hasNext();
  }, t2;
}();
var Xe = new ze(at.comparator);
function Je() {
  return Xe;
}
var Ze = new ze(at.comparator);
function tn() {
  return Ze;
}
var en = new ze(at.comparator);
function nn() {
  return en;
}
var rn = new Ye(at.comparator);
function on() {
  for (var t2 = [], e = 0; e < arguments.length; e++)
    t2[e] = arguments[e];
  for (var n2 = rn, r2 = 0, i = t2; r2 < i.length; r2++) {
    var o = i[r2];
    n2 = n2.add(o);
  }
  return n2;
}
var sn = new Ye(V2);
function un() {
  return sn;
}
var an = function() {
  function t2(t3, e, n2, r2, i) {
    this.snapshotVersion = t3, this.targetChanges = e, this.targetMismatches = n2, this.documentUpdates = r2, this.resolvedLimboDocuments = i;
  }
  return t2.createSynthesizedRemoteEventForCurrentChange = function(e, n2) {
    var r2 = new Map();
    return r2.set(e, cn.createSynthesizedTargetChangeForCurrentChange(e, n2)), new t2(j.min(), r2, un(), Je(), on());
  }, t2;
}();
var cn = function() {
  function t2(t3, e, n2, r2, i) {
    this.resumeToken = t3, this.current = e, this.addedDocuments = n2, this.modifiedDocuments = r2, this.removedDocuments = i;
  }
  return t2.createSynthesizedTargetChangeForCurrentChange = function(e, n2) {
    return new t2(X2.EMPTY_BYTE_STRING, n2, on(), on(), on());
  }, t2;
}();
var hn = function(t2, e, n2, r2) {
  this.v = t2, this.removedTargetIds = e, this.key = n2, this.P = r2;
};
var fn = function(t2, e) {
  this.targetId = t2, this.V = e;
};
var ln = function(t2, e, n2, r2) {
  n2 === void 0 && (n2 = X2.EMPTY_BYTE_STRING), r2 === void 0 && (r2 = null), this.state = t2, this.targetIds = e, this.resumeToken = n2, this.cause = r2;
};
var dn = function() {
  function t2() {
    this.S = 0, this.D = vn(), this.C = X2.EMPTY_BYTE_STRING, this.N = false, this.F = true;
  }
  return Object.defineProperty(t2.prototype, "current", {
    get: function() {
      return this.N;
    },
    enumerable: false,
    configurable: true
  }), Object.defineProperty(t2.prototype, "resumeToken", {
    get: function() {
      return this.C;
    },
    enumerable: false,
    configurable: true
  }), Object.defineProperty(t2.prototype, "k", {
    get: function() {
      return this.S !== 0;
    },
    enumerable: false,
    configurable: true
  }), Object.defineProperty(t2.prototype, "$", {
    get: function() {
      return this.F;
    },
    enumerable: false,
    configurable: true
  }), t2.prototype.O = function(t3) {
    t3.approximateByteSize() > 0 && (this.F = true, this.C = t3);
  }, t2.prototype.M = function() {
    var t3 = on(), e = on(), n2 = on();
    return this.D.forEach(function(r2, i) {
      switch (i) {
        case 0:
          t3 = t3.add(r2);
          break;
        case 2:
          e = e.add(r2);
          break;
        case 1:
          n2 = n2.add(r2);
          break;
        default:
          L2();
      }
    }), new cn(this.C, this.N, t3, e, n2);
  }, t2.prototype.L = function() {
    this.F = false, this.D = vn();
  }, t2.prototype.B = function(t3, e) {
    this.F = true, this.D = this.D.insert(t3, e);
  }, t2.prototype.q = function(t3) {
    this.F = true, this.D = this.D.remove(t3);
  }, t2.prototype.U = function() {
    this.S += 1;
  }, t2.prototype.K = function() {
    this.S -= 1;
  }, t2.prototype.j = function() {
    this.F = true, this.N = true;
  }, t2;
}();
var pn = function() {
  function t2(t3) {
    this.W = t3, this.G = new Map(), this.H = Je(), this.J = yn(), this.Y = new Ye(V2);
  }
  return t2.prototype.X = function(t3) {
    for (var e = 0, n2 = t3.v; e < n2.length; e++) {
      var r2 = n2[e];
      t3.P && t3.P.isFoundDocument() ? this.Z(r2, t3.P) : this.tt(r2, t3.key, t3.P);
    }
    for (var i = 0, o = t3.removedTargetIds; i < o.length; i++) {
      r2 = o[i];
      this.tt(r2, t3.key, t3.P);
    }
  }, t2.prototype.et = function(t3) {
    var e = this;
    this.forEachTarget(t3, function(n2) {
      var r2 = e.nt(n2);
      switch (t3.state) {
        case 0:
          e.st(n2) && r2.O(t3.resumeToken);
          break;
        case 1:
          r2.K(), r2.k || r2.L(), r2.O(t3.resumeToken);
          break;
        case 2:
          r2.K(), r2.k || e.removeTarget(n2);
          break;
        case 3:
          e.st(n2) && (r2.j(), r2.O(t3.resumeToken));
          break;
        case 4:
          e.st(n2) && (e.it(n2), r2.O(t3.resumeToken));
          break;
        default:
          L2();
      }
    });
  }, t2.prototype.forEachTarget = function(t3, e) {
    var n2 = this;
    t3.targetIds.length > 0 ? t3.targetIds.forEach(e) : this.G.forEach(function(t4, r2) {
      n2.st(r2) && e(r2);
    });
  }, t2.prototype.rt = function(t3) {
    var e = t3.targetId, n2 = t3.V.count, r2 = this.ot(e);
    if (r2) {
      var i = r2.target;
      if (Ct(i))
        if (n2 === 0) {
          var o = new at(i.path);
          this.tt(e, o, St.newNoDocument(o, j.min()));
        } else
          O2(n2 === 1);
      else
        this.ct(e) !== n2 && (this.it(e), this.Y = this.Y.add(e));
    }
  }, t2.prototype.ut = function(t3) {
    var e = this, n2 = new Map();
    this.G.forEach(function(r3, i2) {
      var o = e.ot(i2);
      if (o) {
        if (r3.current && Ct(o.target)) {
          var s = new at(o.target.path);
          e.H.get(s) !== null || e.at(i2, s) || e.tt(i2, s, St.newNoDocument(s, t3));
        }
        r3.$ && (n2.set(i2, r3.M()), r3.L());
      }
    });
    var r2 = on();
    this.J.forEach(function(t4, n3) {
      var i2 = true;
      n3.forEachWhile(function(t5) {
        var n4 = e.ot(t5);
        return !n4 || n4.purpose === 2 || (i2 = false, false);
      }), i2 && (r2 = r2.add(t4));
    });
    var i = new an(t3, n2, this.Y, this.H, r2);
    return this.H = Je(), this.J = yn(), this.Y = new Ye(V2), i;
  }, t2.prototype.Z = function(t3, e) {
    if (this.st(t3)) {
      var n2 = this.at(t3, e.key) ? 2 : 0;
      this.nt(t3).B(e.key, n2), this.H = this.H.insert(e.key, e), this.J = this.J.insert(e.key, this.ht(e.key).add(t3));
    }
  }, t2.prototype.tt = function(t3, e, n2) {
    if (this.st(t3)) {
      var r2 = this.nt(t3);
      this.at(t3, e) ? r2.B(e, 1) : r2.q(e), this.J = this.J.insert(e, this.ht(e).delete(t3)), n2 && (this.H = this.H.insert(e, n2));
    }
  }, t2.prototype.removeTarget = function(t3) {
    this.G.delete(t3);
  }, t2.prototype.ct = function(t3) {
    var e = this.nt(t3).M();
    return this.W.getRemoteKeysForTarget(t3).size + e.addedDocuments.size - e.removedDocuments.size;
  }, t2.prototype.U = function(t3) {
    this.nt(t3).U();
  }, t2.prototype.nt = function(t3) {
    var e = this.G.get(t3);
    return e || (e = new dn(), this.G.set(t3, e)), e;
  }, t2.prototype.ht = function(t3) {
    var e = this.J.get(t3);
    return e || (e = new Ye(V2), this.J = this.J.insert(t3, e)), e;
  }, t2.prototype.st = function(t3) {
    var e = this.ot(t3) !== null;
    return e || k2("WatchChangeAggregator", "Detected inactive target", t3), e;
  }, t2.prototype.ot = function(t3) {
    var e = this.G.get(t3);
    return e && e.k ? null : this.W.lt(t3);
  }, t2.prototype.it = function(t3) {
    var e = this;
    this.G.set(t3, new dn()), this.W.getRemoteKeysForTarget(t3).forEach(function(n2) {
      e.tt(t3, n2, null);
    });
  }, t2.prototype.at = function(t3, e) {
    return this.W.getRemoteKeysForTarget(t3).has(e);
  }, t2;
}();
function yn() {
  return new ze(at.comparator);
}
function vn() {
  return new ze(at.comparator);
}
var mn = {
  asc: "ASCENDING",
  desc: "DESCENDING"
};
var gn = {
  "<": "LESS_THAN",
  "<=": "LESS_THAN_OR_EQUAL",
  ">": "GREATER_THAN",
  ">=": "GREATER_THAN_OR_EQUAL",
  "==": "EQUAL",
  "!=": "NOT_EQUAL",
  "array-contains": "ARRAY_CONTAINS",
  in: "IN",
  "not-in": "NOT_IN",
  "array-contains-any": "ARRAY_CONTAINS_ANY"
};
var wn = function(t2, e) {
  this.databaseId = t2, this.I = e;
};
function bn(t2, e) {
  return t2.I ? new Date(1e3 * e.seconds).toISOString().replace(/\.\d*/, "").replace("Z", "") + "." + ("000000000" + e.nanoseconds).slice(-9) + "Z" : {
    seconds: "" + e.seconds,
    nanos: e.nanoseconds
  };
}
function In(t2, e) {
  return t2.I ? e.toBase64() : e.toUint8Array();
}
function En(t2, e) {
  return bn(t2, e.toTimestamp());
}
function Tn(t2) {
  return O2(!!t2), j.fromTimestamp(function(t3) {
    var e = Z2(t3);
    return new B(e.seconds, e.nanos);
  }(t2));
}
function _n(t2, e) {
  return function(t3) {
    return new W2(["projects", t3.projectId, "databases", t3.database]);
  }(t2).child("documents").child(e).canonicalString();
}
function Sn(t2) {
  var e = W2.fromString(t2);
  return O2(Yn(e)), e;
}
function Nn(t2, e) {
  return _n(t2.databaseId, e.path);
}
function Dn(t2, e) {
  var n2 = Sn(e);
  if (n2.get(1) !== t2.databaseId.projectId)
    throw new N2(S2.INVALID_ARGUMENT, "Tried to deserialize key from different project: " + n2.get(1) + " vs " + t2.databaseId.projectId);
  if (n2.get(3) !== t2.databaseId.database)
    throw new N2(S2.INVALID_ARGUMENT, "Tried to deserialize key from different database: " + n2.get(3) + " vs " + t2.databaseId.database);
  return new at(xn(n2));
}
function An(t2, e) {
  return _n(t2.databaseId, e);
}
function kn(t2) {
  var e = Sn(t2);
  return e.length === 4 ? W2.emptyPath() : xn(e);
}
function Cn(t2) {
  return new W2(["projects", t2.databaseId.projectId, "databases", t2.databaseId.database]).canonicalString();
}
function xn(t2) {
  return O2(t2.length > 4 && t2.get(4) === "documents"), t2.popFirst(5);
}
function Rn(t2, e, n2) {
  return {
    name: Nn(t2, e),
    fields: n2.value.mapValue.fields
  };
}
function Ln(t2, e, n2) {
  var r2 = Dn(t2, e.name), i = Tn(e.updateTime), o = new Tt({
    mapValue: {
      fields: e.fields
    }
  }), s = St.newFoundDocument(r2, i, o);
  return n2 && s.setHasCommittedMutations(), n2 ? s.setHasCommittedMutations() : s;
}
function On(t2, e) {
  var n2;
  if (e instanceof Oe)
    n2 = {
      update: Rn(t2, e.key, e.value)
    };
  else if (e instanceof Be)
    n2 = {
      delete: Nn(t2, e.key)
    };
  else if (e instanceof Pe)
    n2 = {
      update: Rn(t2, e.key, e.data),
      updateMask: Hn(e.fieldMask)
    };
  else {
    if (!(e instanceof je))
      return L2();
    n2 = {
      verify: Nn(t2, e.key)
    };
  }
  return e.fieldTransforms.length > 0 && (n2.updateTransforms = e.fieldTransforms.map(function(t3) {
    return function(t4, e2) {
      var n3 = e2.transform;
      if (n3 instanceof ve)
        return {
          fieldPath: e2.field.canonicalString(),
          setToServerValue: "REQUEST_TIME"
        };
      if (n3 instanceof me)
        return {
          fieldPath: e2.field.canonicalString(),
          appendMissingElements: {
            values: n3.elements
          }
        };
      if (n3 instanceof we)
        return {
          fieldPath: e2.field.canonicalString(),
          removeAllFromArray: {
            values: n3.elements
          }
        };
      if (n3 instanceof Ie)
        return {
          fieldPath: e2.field.canonicalString(),
          increment: n3.A
        };
      throw L2();
    }(0, t3);
  })), e.precondition.isNone || (n2.currentDocument = function(t3, e2) {
    return e2.updateTime !== void 0 ? {
      updateTime: En(t3, e2.updateTime)
    } : e2.exists !== void 0 ? {
      exists: e2.exists
    } : L2();
  }(t2, e.precondition)), n2;
}
function Pn(t2, e) {
  var n2 = e.currentDocument ? function(t3) {
    return t3.updateTime !== void 0 ? Ne.updateTime(Tn(t3.updateTime)) : t3.exists !== void 0 ? Ne.exists(t3.exists) : Ne.none();
  }(e.currentDocument) : Ne.none(), r2 = e.updateTransforms ? e.updateTransforms.map(function(e2) {
    return function(t3, e3) {
      var n3 = null;
      if ("setToServerValue" in e3)
        O2(e3.setToServerValue === "REQUEST_TIME"), n3 = new ve();
      else if ("appendMissingElements" in e3) {
        var r3 = e3.appendMissingElements.values || [];
        n3 = new me(r3);
      } else if ("removeAllFromArray" in e3) {
        var i2 = e3.removeAllFromArray.values || [];
        n3 = new we(i2);
      } else
        "increment" in e3 ? n3 = new Ie(t3, e3.increment) : L2();
      var o2 = Y2.fromServerFormat(e3.fieldPath);
      return new _e(o2, n3);
    }(t2, e2);
  }) : [];
  if (e.update) {
    e.update.name;
    var i = Dn(t2, e.update.name), o = new Tt({
      mapValue: {
        fields: e.update.fields
      }
    });
    if (e.updateMask) {
      var s = function(t3) {
        var e2 = t3.fieldPaths || [];
        return new $(e2.map(function(t4) {
          return Y2.fromServerFormat(t4);
        }));
      }(e.updateMask);
      return new Pe(i, o, s, n2, r2);
    }
    return new Oe(i, o, n2, r2);
  }
  if (e.delete) {
    var u2 = Dn(t2, e.delete);
    return new Be(u2, n2);
  }
  if (e.verify) {
    var a = Dn(t2, e.verify);
    return new je(a, n2);
  }
  return L2();
}
function Fn(t2, e) {
  return {
    documents: [An(t2, e.path)]
  };
}
function Mn(t2, e) {
  var n2 = {
    structuredQuery: {}
  }, r2 = e.path;
  e.collectionGroup !== null ? (n2.parent = An(t2, r2), n2.structuredQuery.from = [{
    collectionId: e.collectionGroup,
    allDescendants: true
  }]) : (n2.parent = An(t2, r2.popLast()), n2.structuredQuery.from = [{
    collectionId: r2.lastSegment()
  }]);
  var i = function(t3) {
    if (t3.length !== 0) {
      var e2 = t3.map(function(t4) {
        return function(t5) {
          if (t5.op === "==") {
            if (bt(t5.value))
              return {
                unaryFilter: {
                  field: Gn(t5.field),
                  op: "IS_NAN"
                }
              };
            if (wt(t5.value))
              return {
                unaryFilter: {
                  field: Gn(t5.field),
                  op: "IS_NULL"
                }
              };
          } else if (t5.op === "!=") {
            if (bt(t5.value))
              return {
                unaryFilter: {
                  field: Gn(t5.field),
                  op: "IS_NOT_NAN"
                }
              };
            if (wt(t5.value))
              return {
                unaryFilter: {
                  field: Gn(t5.field),
                  op: "IS_NOT_NULL"
                }
              };
          }
          return {
            fieldFilter: {
              field: Gn(t5.field),
              op: Kn(t5.op),
              value: t5.value
            }
          };
        }(t4);
      });
      return e2.length === 1 ? e2[0] : {
        compositeFilter: {
          op: "AND",
          filters: e2
        }
      };
    }
  }(e.filters);
  i && (n2.structuredQuery.where = i);
  var o = function(t3) {
    if (t3.length !== 0)
      return t3.map(function(t4) {
        return function(t5) {
          return {
            field: Gn(t5.field),
            direction: jn(t5.dir)
          };
        }(t4);
      });
  }(e.orderBy);
  o && (n2.structuredQuery.orderBy = o);
  var s = function(t3, e2) {
    return t3.I || ot(e2) ? e2 : {
      value: e2
    };
  }(t2, e.limit);
  return s !== null && (n2.structuredQuery.limit = s), e.startAt && (n2.structuredQuery.startAt = Un(e.startAt)), e.endAt && (n2.structuredQuery.endAt = Un(e.endAt)), n2;
}
function Vn(t2) {
  var e = kn(t2.parent), n2 = t2.structuredQuery, r2 = n2.from ? n2.from.length : 0, i = null;
  if (r2 > 0) {
    O2(r2 === 1);
    var o = n2.from[0];
    o.allDescendants ? i = o.collectionId : e = e.child(o.collectionId);
  }
  var s = [];
  n2.where && (s = qn(n2.where));
  var u2 = [];
  n2.orderBy && (u2 = n2.orderBy.map(function(t3) {
    return function(t4) {
      return new jt(Qn(t4.field), function(t5) {
        switch (t5) {
          case "ASCENDING":
            return "asc";
          case "DESCENDING":
            return "desc";
          default:
            return;
        }
      }(t4.direction));
    }(t3);
  }));
  var a = null;
  n2.limit && (a = function(t3) {
    var e2;
    return ot(e2 = typeof t3 == "object" ? t3.value : t3) ? null : e2;
  }(n2.limit));
  var c = null;
  n2.startAt && (c = Bn(n2.startAt));
  var h = null;
  return n2.endAt && (h = Bn(n2.endAt)), Wt(e, i, u2, s, a, "F", c, h);
}
function qn(t2) {
  return t2 ? t2.unaryFilter !== void 0 ? [Wn(t2)] : t2.fieldFilter !== void 0 ? [zn(t2)] : t2.compositeFilter !== void 0 ? t2.compositeFilter.filters.map(function(t3) {
    return qn(t3);
  }).reduce(function(t3, e) {
    return t3.concat(e);
  }) : L2() : [];
}
function Un(t2) {
  return {
    before: t2.before,
    values: t2.position
  };
}
function Bn(t2) {
  var e = !!t2.before, n2 = t2.values || [];
  return new Ut(n2, e);
}
function jn(t2) {
  return mn[t2];
}
function Kn(t2) {
  return gn[t2];
}
function Gn(t2) {
  return {
    fieldPath: t2.canonicalString()
  };
}
function Qn(t2) {
  return Y2.fromServerFormat(t2.fieldPath);
}
function zn(t2) {
  return xt.create(Qn(t2.fieldFilter.field), function(t3) {
    switch (t3) {
      case "EQUAL":
        return "==";
      case "NOT_EQUAL":
        return "!=";
      case "GREATER_THAN":
        return ">";
      case "GREATER_THAN_OR_EQUAL":
        return ">=";
      case "LESS_THAN":
        return "<";
      case "LESS_THAN_OR_EQUAL":
        return "<=";
      case "ARRAY_CONTAINS":
        return "array-contains";
      case "IN":
        return "in";
      case "NOT_IN":
        return "not-in";
      case "ARRAY_CONTAINS_ANY":
        return "array-contains-any";
      case "OPERATOR_UNSPECIFIED":
      default:
        return L2();
    }
  }(t2.fieldFilter.op), t2.fieldFilter.value);
}
function Wn(t2) {
  switch (t2.unaryFilter.op) {
    case "IS_NAN":
      var e = Qn(t2.unaryFilter.field);
      return xt.create(e, "==", {
        doubleValue: NaN
      });
    case "IS_NULL":
      var n2 = Qn(t2.unaryFilter.field);
      return xt.create(n2, "==", {
        nullValue: "NULL_VALUE"
      });
    case "IS_NOT_NAN":
      var r2 = Qn(t2.unaryFilter.field);
      return xt.create(r2, "!=", {
        doubleValue: NaN
      });
    case "IS_NOT_NULL":
      var i = Qn(t2.unaryFilter.field);
      return xt.create(i, "!=", {
        nullValue: "NULL_VALUE"
      });
    case "OPERATOR_UNSPECIFIED":
    default:
      return L2();
  }
}
function Hn(t2) {
  var e = [];
  return t2.fields.forEach(function(t3) {
    return e.push(t3.canonicalString());
  }), {
    fieldPaths: e
  };
}
function Yn(t2) {
  return t2.length >= 4 && t2.get(0) === "projects" && t2.get(2) === "databases";
}
function $n(t2) {
  for (var e = "", n2 = 0; n2 < t2.length; n2++)
    e.length > 0 && (e = Jn(e)), e = Xn(t2.get(n2), e);
  return Jn(e);
}
function Xn(t2, e) {
  for (var n2 = e, r2 = t2.length, i = 0; i < r2; i++) {
    var o = t2.charAt(i);
    switch (o) {
      case "\0":
        n2 += "";
        break;
      case "":
        n2 += "";
        break;
      default:
        n2 += o;
    }
  }
  return n2;
}
function Jn(t2) {
  return t2 + "";
}
function Zn(t2) {
  var e = t2.length;
  if (O2(e >= 2), e === 2)
    return O2(t2.charAt(0) === "" && t2.charAt(1) === ""), W2.emptyPath();
  for (var n2 = e - 2, r2 = [], i = "", o = 0; o < e; ) {
    var s = t2.indexOf("", o);
    switch ((s < 0 || s > n2) && L2(), t2.charAt(s + 1)) {
      case "":
        var u2 = t2.substring(o, s), a = void 0;
        i.length === 0 ? a = u2 : (a = i += u2, i = ""), r2.push(a);
        break;
      case "":
        i += t2.substring(o, s), i += "\0";
        break;
      case "":
        i += t2.substring(o, s + 1);
        break;
      default:
        L2();
    }
    o = s + 2;
  }
  return new W2(r2);
}
var tr = function(t2, e) {
  this.seconds = t2, this.nanoseconds = e;
};
var er = function(t2, e, n2) {
  this.ownerId = t2, this.allowTabSynchronization = e, this.leaseTimestampMs = n2;
};
er.store = "owner", er.key = "owner";
var nr = function(t2, e, n2) {
  this.userId = t2, this.lastAcknowledgedBatchId = e, this.lastStreamToken = n2;
};
nr.store = "mutationQueues", nr.keyPath = "userId";
var rr = function(t2, e, n2, r2, i) {
  this.userId = t2, this.batchId = e, this.localWriteTimeMs = n2, this.baseMutations = r2, this.mutations = i;
};
rr.store = "mutations", rr.keyPath = "batchId", rr.userMutationsIndex = "userMutationsIndex", rr.userMutationsKeyPath = ["userId", "batchId"];
var ir = function() {
  function t2() {
  }
  return t2.prefixForUser = function(t3) {
    return [t3];
  }, t2.prefixForPath = function(t3, e) {
    return [t3, $n(e)];
  }, t2.key = function(t3, e, n2) {
    return [t3, $n(e), n2];
  }, t2;
}();
ir.store = "documentMutations", ir.PLACEHOLDER = new ir();
var or = function(t2, e) {
  this.path = t2, this.readTime = e;
};
var sr = function(t2, e) {
  this.path = t2, this.version = e;
};
var ur = function(t2, e, n2, r2, i, o) {
  this.unknownDocument = t2, this.noDocument = e, this.document = n2, this.hasCommittedMutations = r2, this.readTime = i, this.parentPath = o;
};
ur.store = "remoteDocuments", ur.readTimeIndex = "readTimeIndex", ur.readTimeIndexPath = "readTime", ur.collectionReadTimeIndex = "collectionReadTimeIndex", ur.collectionReadTimeIndexPath = ["parentPath", "readTime"];
var ar = function(t2) {
  this.byteSize = t2;
};
ar.store = "remoteDocumentGlobal", ar.key = "remoteDocumentGlobalKey";
var cr = function(t2, e, n2, r2, i, o, s) {
  this.targetId = t2, this.canonicalId = e, this.readTime = n2, this.resumeToken = r2, this.lastListenSequenceNumber = i, this.lastLimboFreeSnapshotVersion = o, this.query = s;
};
cr.store = "targets", cr.keyPath = "targetId", cr.queryTargetsIndexName = "queryTargetsIndex", cr.queryTargetsKeyPath = ["canonicalId", "targetId"];
var hr = function(t2, e, n2) {
  this.targetId = t2, this.path = e, this.sequenceNumber = n2;
};
hr.store = "targetDocuments", hr.keyPath = ["targetId", "path"], hr.documentTargetsIndex = "documentTargetsIndex", hr.documentTargetsKeyPath = ["path", "targetId"];
var fr = function(t2, e, n2, r2) {
  this.highestTargetId = t2, this.highestListenSequenceNumber = e, this.lastRemoteSnapshotVersion = n2, this.targetCount = r2;
};
fr.key = "targetGlobalKey", fr.store = "targetGlobal";
var lr = function(t2, e) {
  this.collectionId = t2, this.parent = e;
};
lr.store = "collectionParents", lr.keyPath = ["collectionId", "parent"];
var dr = function(t2, e, n2, r2) {
  this.clientId = t2, this.updateTimeMs = e, this.networkEnabled = n2, this.inForeground = r2;
};
dr.store = "clientMetadata", dr.keyPath = "clientId";
var pr = function(t2, e, n2) {
  this.bundleId = t2, this.createTime = e, this.version = n2;
};
pr.store = "bundles", pr.keyPath = "bundleId";
var yr = function(t2, e, n2) {
  this.name = t2, this.readTime = e, this.bundledQuery = n2;
};
yr.store = "namedQueries", yr.keyPath = "name";
var vr = __spreadArray(__spreadArray([], __spreadArray(__spreadArray([], __spreadArray(__spreadArray([], __spreadArray(__spreadArray([], [nr.store, rr.store, ir.store, ur.store, cr.store, er.store, fr.store, hr.store]), [dr.store])), [ar.store])), [lr.store])), [pr.store, yr.store]);
var mr = "The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.";
var gr = function() {
  function t2() {
    this.onCommittedListeners = [];
  }
  return t2.prototype.addOnCommittedListener = function(t3) {
    this.onCommittedListeners.push(t3);
  }, t2.prototype.raiseOnCommittedEvent = function() {
    this.onCommittedListeners.forEach(function(t3) {
      return t3();
    });
  }, t2;
}();
var wr = function() {
  var t2 = this;
  this.promise = new Promise(function(e, n2) {
    t2.resolve = e, t2.reject = n2;
  });
};
var br = function() {
  function t2(t3) {
    var e = this;
    this.nextCallback = null, this.catchCallback = null, this.result = void 0, this.error = void 0, this.isDone = false, this.callbackAttached = false, t3(function(t4) {
      e.isDone = true, e.result = t4, e.nextCallback && e.nextCallback(t4);
    }, function(t4) {
      e.isDone = true, e.error = t4, e.catchCallback && e.catchCallback(t4);
    });
  }
  return t2.prototype.catch = function(t3) {
    return this.next(void 0, t3);
  }, t2.prototype.next = function(e, n2) {
    var r2 = this;
    return this.callbackAttached && L2(), this.callbackAttached = true, this.isDone ? this.error ? this.wrapFailure(n2, this.error) : this.wrapSuccess(e, this.result) : new t2(function(t3, i) {
      r2.nextCallback = function(n3) {
        r2.wrapSuccess(e, n3).next(t3, i);
      }, r2.catchCallback = function(e2) {
        r2.wrapFailure(n2, e2).next(t3, i);
      };
    });
  }, t2.prototype.toPromise = function() {
    var t3 = this;
    return new Promise(function(e, n2) {
      t3.next(e, n2);
    });
  }, t2.prototype.wrapUserFunction = function(e) {
    try {
      var n2 = e();
      return n2 instanceof t2 ? n2 : t2.resolve(n2);
    } catch (e2) {
      return t2.reject(e2);
    }
  }, t2.prototype.wrapSuccess = function(e, n2) {
    return e ? this.wrapUserFunction(function() {
      return e(n2);
    }) : t2.resolve(n2);
  }, t2.prototype.wrapFailure = function(e, n2) {
    return e ? this.wrapUserFunction(function() {
      return e(n2);
    }) : t2.reject(n2);
  }, t2.resolve = function(e) {
    return new t2(function(t3, n2) {
      t3(e);
    });
  }, t2.reject = function(e) {
    return new t2(function(t3, n2) {
      n2(e);
    });
  }, t2.waitFor = function(e) {
    return new t2(function(t3, n2) {
      var r2 = 0, i = 0, o = false;
      e.forEach(function(e2) {
        ++r2, e2.next(function() {
          ++i, o && i === r2 && t3();
        }, function(t4) {
          return n2(t4);
        });
      }), o = true, i === r2 && t3();
    });
  }, t2.or = function(e) {
    for (var n2 = t2.resolve(false), r2 = function(e2) {
      n2 = n2.next(function(n3) {
        return n3 ? t2.resolve(n3) : e2();
      });
    }, i = 0, o = e; i < o.length; i++) {
      r2(o[i]);
    }
    return n2;
  }, t2.forEach = function(t3, e) {
    var n2 = this, r2 = [];
    return t3.forEach(function(t4, i) {
      r2.push(e.call(n2, t4, i));
    }), this.waitFor(r2);
  }, t2;
}();
var Ir = function() {
  function t2(t3, e) {
    var n2 = this;
    this.action = t3, this.transaction = e, this.aborted = false, this.ft = new wr(), this.transaction.oncomplete = function() {
      n2.ft.resolve();
    }, this.transaction.onabort = function() {
      e.error ? n2.ft.reject(new _r(t3, e.error)) : n2.ft.resolve();
    }, this.transaction.onerror = function(e2) {
      var r2 = kr(e2.target.error);
      n2.ft.reject(new _r(t3, r2));
    };
  }
  return t2.open = function(e, n2, r2, i) {
    try {
      return new t2(n2, e.transaction(i, r2));
    } catch (e2) {
      throw new _r(n2, e2);
    }
  }, Object.defineProperty(t2.prototype, "dt", {
    get: function() {
      return this.ft.promise;
    },
    enumerable: false,
    configurable: true
  }), t2.prototype.abort = function(t3) {
    t3 && this.ft.reject(t3), this.aborted || (k2("SimpleDb", "Aborting transaction:", t3 ? t3.message : "Client-initiated abort"), this.aborted = true, this.transaction.abort());
  }, t2.prototype.store = function(t3) {
    var e = this.transaction.objectStore(t3);
    return new Nr(e);
  }, t2;
}();
var Er = function() {
  function e(n2, r2, i) {
    this.name = n2, this.version = r2, this.wt = i, e._t(getUA()) === 12.2 && C("Firestore persistence suffers from a bug in iOS 12.2 Safari that may cause your app to stop working. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.");
  }
  return e.delete = function(t2) {
    return k2("SimpleDb", "Removing database:", t2), Dr(window.indexedDB.deleteDatabase(t2)).toPromise();
  }, e.yt = function() {
    if (typeof indexedDB == "undefined")
      return false;
    if (e.gt())
      return true;
    var n2 = getUA(), r2 = e._t(n2), i = 0 < r2 && r2 < 10, o = e.Et(n2), s = 0 < o && o < 4.5;
    return !(n2.indexOf("MSIE ") > 0 || n2.indexOf("Trident/") > 0 || n2.indexOf("Edge/") > 0 || i || s);
  }, e.gt = function() {
    var t2;
    return typeof process != "undefined" && ((t2 = process.env) === null || t2 === void 0 ? void 0 : t2.Tt) === "YES";
  }, e.It = function(t2, e2) {
    return t2.store(e2);
  }, e._t = function(t2) {
    var e2 = t2.match(/i(?:phone|pad|pod) os ([\d_]+)/i), n2 = e2 ? e2[1].split("_").slice(0, 2).join(".") : "-1";
    return Number(n2);
  }, e.Et = function(t2) {
    var e2 = t2.match(/Android ([\d.]+)/i), n2 = e2 ? e2[1].split(".").slice(0, 2).join(".") : "-1";
    return Number(n2);
  }, e.prototype.At = function(t2) {
    return __awaiter(this, void 0, void 0, function() {
      var e2, n2 = this;
      return __generator(this, function(r2) {
        switch (r2.label) {
          case 0:
            return this.db ? [3, 2] : (k2("SimpleDb", "Opening database:", this.name), e2 = this, [4, new Promise(function(e3, r3) {
              var i = indexedDB.open(n2.name, n2.version);
              i.onsuccess = function(t3) {
                var n3 = t3.target.result;
                e3(n3);
              }, i.onblocked = function() {
                r3(new _r(t2, "Cannot upgrade IndexedDB schema while another tab is open. Close all tabs that access Firestore and reload this page to proceed."));
              }, i.onerror = function(e4) {
                var n3 = e4.target.error;
                n3.name === "VersionError" ? r3(new N2(S2.FAILED_PRECONDITION, "A newer version of the Firestore SDK was previously used and so the persisted data is not compatible with the version of the SDK you are now using. The SDK will operate with persistence disabled. If you need persistence, please re-upgrade to a newer version of the SDK or else clear the persisted IndexedDB data for your app to start fresh.")) : r3(new _r(t2, n3));
              }, i.onupgradeneeded = function(t3) {
                k2("SimpleDb", 'Database "' + n2.name + '" requires upgrade from version:', t3.oldVersion);
                var e4 = t3.target.result;
                n2.wt.Rt(e4, i.transaction, t3.oldVersion, n2.version).next(function() {
                  k2("SimpleDb", "Database upgrade to version " + n2.version + " complete");
                });
              };
            })]);
          case 1:
            e2.db = r2.sent(), r2.label = 2;
          case 2:
            return [2, (this.bt && (this.db.onversionchange = function(t3) {
              return n2.bt(t3);
            }), this.db)];
        }
      });
    });
  }, e.prototype.vt = function(t2) {
    this.bt = t2, this.db && (this.db.onversionchange = function(e2) {
      return t2(e2);
    });
  }, e.prototype.runTransaction = function(t2, e2, n2, r2) {
    return __awaiter(this, void 0, void 0, function() {
      var i, o, s, u2, a;
      return __generator(this, function(c) {
        switch (c.label) {
          case 0:
            i = e2 === "readonly", o = 0, s = function() {
              var e3, s2, a2, c2, h;
              return __generator(this, function(f) {
                switch (f.label) {
                  case 0:
                    ++o, f.label = 1;
                  case 1:
                    return f.trys.push([1, 4, , 5]), [4, u2.At(t2)];
                  case 2:
                    return u2.db = f.sent(), e3 = Ir.open(u2.db, t2, i ? "readonly" : "readwrite", n2), s2 = r2(e3).catch(function(t3) {
                      return e3.abort(t3), br.reject(t3);
                    }).toPromise(), a2 = {}, s2.catch(function() {
                    }), [4, e3.dt];
                  case 3:
                    return [2, (a2.value = (f.sent(), s2), a2)];
                  case 4:
                    return c2 = f.sent(), h = c2.name !== "FirebaseError" && o < 3, k2("SimpleDb", "Transaction failed with error:", c2.message, "Retrying:", h), u2.close(), h ? [3, 5] : [2, {
                      value: Promise.reject(c2)
                    }];
                  case 5:
                    return [2];
                }
              });
            }, u2 = this, c.label = 1;
          case 1:
            return [5, s()];
          case 2:
            if (typeof (a = c.sent()) == "object")
              return [2, a.value];
            c.label = 3;
          case 3:
            return [3, 1];
          case 4:
            return [2];
        }
      });
    });
  }, e.prototype.close = function() {
    this.db && this.db.close(), this.db = void 0;
  }, e;
}();
var Tr = function() {
  function t2(t3) {
    this.Pt = t3, this.Vt = false, this.St = null;
  }
  return Object.defineProperty(t2.prototype, "isDone", {
    get: function() {
      return this.Vt;
    },
    enumerable: false,
    configurable: true
  }), Object.defineProperty(t2.prototype, "Dt", {
    get: function() {
      return this.St;
    },
    enumerable: false,
    configurable: true
  }), Object.defineProperty(t2.prototype, "cursor", {
    set: function(t3) {
      this.Pt = t3;
    },
    enumerable: false,
    configurable: true
  }), t2.prototype.done = function() {
    this.Vt = true;
  }, t2.prototype.Ct = function(t3) {
    this.St = t3;
  }, t2.prototype.delete = function() {
    return Dr(this.Pt.delete());
  }, t2;
}();
var _r = function(t2) {
  function e(e2, n2) {
    var r2 = this;
    return (r2 = t2.call(this, S2.UNAVAILABLE, "IndexedDB transaction '" + e2 + "' failed: " + n2) || this).name = "IndexedDbTransactionError", r2;
  }
  return __extends(e, t2), e;
}(N2);
function Sr(t2) {
  return t2.name === "IndexedDbTransactionError";
}
var Nr = function() {
  function t2(t3) {
    this.store = t3;
  }
  return t2.prototype.put = function(t3, e) {
    var n2;
    return e !== void 0 ? (k2("SimpleDb", "PUT", this.store.name, t3, e), n2 = this.store.put(e, t3)) : (k2("SimpleDb", "PUT", this.store.name, "<auto-key>", t3), n2 = this.store.put(t3)), Dr(n2);
  }, t2.prototype.add = function(t3) {
    return k2("SimpleDb", "ADD", this.store.name, t3, t3), Dr(this.store.add(t3));
  }, t2.prototype.get = function(t3) {
    var e = this;
    return Dr(this.store.get(t3)).next(function(n2) {
      return n2 === void 0 && (n2 = null), k2("SimpleDb", "GET", e.store.name, t3, n2), n2;
    });
  }, t2.prototype.delete = function(t3) {
    return k2("SimpleDb", "DELETE", this.store.name, t3), Dr(this.store.delete(t3));
  }, t2.prototype.count = function() {
    return k2("SimpleDb", "COUNT", this.store.name), Dr(this.store.count());
  }, t2.prototype.Nt = function(t3, e) {
    var n2 = this.cursor(this.options(t3, e)), r2 = [];
    return this.xt(n2, function(t4, e2) {
      r2.push(e2);
    }).next(function() {
      return r2;
    });
  }, t2.prototype.Ft = function(t3, e) {
    k2("SimpleDb", "DELETE ALL", this.store.name);
    var n2 = this.options(t3, e);
    n2.kt = false;
    var r2 = this.cursor(n2);
    return this.xt(r2, function(t4, e2, n3) {
      return n3.delete();
    });
  }, t2.prototype.$t = function(t3, e) {
    var n2;
    e ? n2 = t3 : (n2 = {}, e = t3);
    var r2 = this.cursor(n2);
    return this.xt(r2, e);
  }, t2.prototype.Ot = function(t3) {
    var e = this.cursor({});
    return new br(function(n2, r2) {
      e.onerror = function(t4) {
        var e2 = kr(t4.target.error);
        r2(e2);
      }, e.onsuccess = function(e2) {
        var r3 = e2.target.result;
        r3 ? t3(r3.primaryKey, r3.value).next(function(t4) {
          t4 ? r3.continue() : n2();
        }) : n2();
      };
    });
  }, t2.prototype.xt = function(t3, e) {
    var n2 = [];
    return new br(function(r2, i) {
      t3.onerror = function(t4) {
        i(t4.target.error);
      }, t3.onsuccess = function(t4) {
        var i2 = t4.target.result;
        if (i2) {
          var o = new Tr(i2), s = e(i2.primaryKey, i2.value, o);
          if (s instanceof br) {
            var u2 = s.catch(function(t5) {
              return o.done(), br.reject(t5);
            });
            n2.push(u2);
          }
          o.isDone ? r2() : o.Dt === null ? i2.continue() : i2.continue(o.Dt);
        } else
          r2();
      };
    }).next(function() {
      return br.waitFor(n2);
    });
  }, t2.prototype.options = function(t3, e) {
    var n2;
    return t3 !== void 0 && (typeof t3 == "string" ? n2 = t3 : e = t3), {
      index: n2,
      range: e
    };
  }, t2.prototype.cursor = function(t3) {
    var e = "next";
    if (t3.reverse && (e = "prev"), t3.index) {
      var n2 = this.store.index(t3.index);
      return t3.kt ? n2.openKeyCursor(t3.range, e) : n2.openCursor(t3.range, e);
    }
    return this.store.openCursor(t3.range, e);
  }, t2;
}();
function Dr(t2) {
  return new br(function(e, n2) {
    t2.onsuccess = function(t3) {
      var n3 = t3.target.result;
      e(n3);
    }, t2.onerror = function(t3) {
      var e2 = kr(t3.target.error);
      n2(e2);
    };
  });
}
var Ar = false;
function kr(e) {
  var n2 = Er._t(getUA());
  if (n2 >= 12.2 && n2 < 13) {
    var r2 = "An internal error was encountered in the Indexed Database server";
    if (e.message.indexOf(r2) >= 0) {
      var i = new N2("internal", "IOS_INDEXEDDB_BUG1: IndexedDb has thrown '" + r2 + "'. This is likely due to an unavoidable bug in iOS. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.");
      return Ar || (Ar = true, setTimeout(function() {
        throw i;
      }, 0)), i;
    }
  }
  return e;
}
var Cr = function(t2) {
  function e(e2, n2) {
    var r2 = this;
    return (r2 = t2.call(this) || this).Mt = e2, r2.currentSequenceNumber = n2, r2;
  }
  return __extends(e, t2), e;
}(gr);
function xr(t2, e) {
  var n2 = P2(t2);
  return Er.It(n2.Mt, e);
}
var Rr = function() {
  function t2(t3, e, n2, r2) {
    this.batchId = t3, this.localWriteTime = e, this.baseMutations = n2, this.mutations = r2;
  }
  return t2.prototype.applyToRemoteDocument = function(t3, e) {
    for (var n2 = e.mutationResults, r2 = 0; r2 < this.mutations.length; r2++) {
      var i = this.mutations[r2];
      i.key.isEqual(t3.key) && ke(i, t3, n2[r2]);
    }
  }, t2.prototype.applyToLocalView = function(t3) {
    for (var e = 0, n2 = this.baseMutations; e < n2.length; e++) {
      (o = n2[e]).key.isEqual(t3.key) && Ce(o, t3, this.localWriteTime);
    }
    for (var r2 = 0, i = this.mutations; r2 < i.length; r2++) {
      var o;
      (o = i[r2]).key.isEqual(t3.key) && Ce(o, t3, this.localWriteTime);
    }
  }, t2.prototype.applyToLocalDocumentSet = function(t3) {
    var e = this;
    this.mutations.forEach(function(n2) {
      var r2 = t3.get(n2.key), i = r2;
      e.applyToLocalView(i), r2.isValidDocument() || i.convertToNoDocument(j.min());
    });
  }, t2.prototype.keys = function() {
    return this.mutations.reduce(function(t3, e) {
      return t3.add(e.key);
    }, on());
  }, t2.prototype.isEqual = function(t3) {
    return this.batchId === t3.batchId && q2(this.mutations, t3.mutations, function(t4, e) {
      return Re(t4, e);
    }) && q2(this.baseMutations, t3.baseMutations, function(t4, e) {
      return Re(t4, e);
    });
  }, t2;
}();
var Lr = function() {
  function t2(t3, e, n2, r2) {
    this.batch = t3, this.commitVersion = e, this.mutationResults = n2, this.docVersions = r2;
  }
  return t2.from = function(e, n2, r2) {
    O2(e.mutations.length === r2.length);
    for (var i = nn(), o = e.mutations, s = 0; s < o.length; s++)
      i = i.insert(o[s].key, r2[s].version);
    return new t2(e, n2, r2, i);
  }, t2;
}();
var Or = function() {
  function t2(t3, e, n2, r2, i, o, s) {
    i === void 0 && (i = j.min()), o === void 0 && (o = j.min()), s === void 0 && (s = X2.EMPTY_BYTE_STRING), this.target = t3, this.targetId = e, this.purpose = n2, this.sequenceNumber = r2, this.snapshotVersion = i, this.lastLimboFreeSnapshotVersion = o, this.resumeToken = s;
  }
  return t2.prototype.withSequenceNumber = function(e) {
    return new t2(this.target, this.targetId, this.purpose, e, this.snapshotVersion, this.lastLimboFreeSnapshotVersion, this.resumeToken);
  }, t2.prototype.withResumeToken = function(e, n2) {
    return new t2(this.target, this.targetId, this.purpose, this.sequenceNumber, n2, this.lastLimboFreeSnapshotVersion, e);
  }, t2.prototype.withLastLimboFreeSnapshotVersion = function(e) {
    return new t2(this.target, this.targetId, this.purpose, this.sequenceNumber, this.snapshotVersion, e, this.resumeToken);
  }, t2;
}();
var Pr = function(t2) {
  this.Lt = t2;
};
function Fr(t2, e) {
  if (e.document)
    return Ln(t2.Lt, e.document, !!e.hasCommittedMutations);
  if (e.noDocument) {
    var n2 = at.fromSegments(e.noDocument.path), r2 = Br(e.noDocument.readTime), i = St.newNoDocument(n2, r2);
    return e.hasCommittedMutations ? i.setHasCommittedMutations() : i;
  }
  if (e.unknownDocument) {
    var o = at.fromSegments(e.unknownDocument.path);
    r2 = Br(e.unknownDocument.version);
    return St.newUnknownDocument(o, r2);
  }
  return L2();
}
function Mr(t2, e, n2) {
  var r2 = Vr(n2), i = e.key.path.popLast().toArray();
  if (e.isFoundDocument()) {
    var o = function(t3, e2) {
      return {
        name: Nn(t3, e2.key),
        fields: e2.data.value.mapValue.fields,
        updateTime: bn(t3, e2.version.toTimestamp())
      };
    }(t2.Lt, e), s = e.hasCommittedMutations;
    return new ur(null, null, o, s, r2, i);
  }
  if (e.isNoDocument()) {
    var u2 = e.key.path.toArray(), a = Ur(e.version);
    s = e.hasCommittedMutations;
    return new ur(null, new or(u2, a), null, s, r2, i);
  }
  if (e.isUnknownDocument()) {
    var c = e.key.path.toArray(), h = Ur(e.version);
    return new ur(new sr(c, h), null, null, true, r2, i);
  }
  return L2();
}
function Vr(t2) {
  var e = t2.toTimestamp();
  return [e.seconds, e.nanoseconds];
}
function qr(t2) {
  var e = new B(t2[0], t2[1]);
  return j.fromTimestamp(e);
}
function Ur(t2) {
  var e = t2.toTimestamp();
  return new tr(e.seconds, e.nanoseconds);
}
function Br(t2) {
  var e = new B(t2.seconds, t2.nanoseconds);
  return j.fromTimestamp(e);
}
function jr(t2, e) {
  for (var n2 = (e.baseMutations || []).map(function(e2) {
    return Pn(t2.Lt, e2);
  }), r2 = 0; r2 < e.mutations.length - 1; ++r2) {
    var i = e.mutations[r2];
    if (r2 + 1 < e.mutations.length && e.mutations[r2 + 1].transform !== void 0) {
      var o = e.mutations[r2 + 1];
      i.updateTransforms = o.transform.fieldTransforms, e.mutations.splice(r2 + 1, 1), ++r2;
    }
  }
  var s = e.mutations.map(function(e2) {
    return Pn(t2.Lt, e2);
  }), u2 = B.fromMillis(e.localWriteTimeMs);
  return new Rr(e.batchId, u2, n2, s);
}
function Kr(t2) {
  var e, n2, r2 = Br(t2.readTime), i = t2.lastLimboFreeSnapshotVersion !== void 0 ? Br(t2.lastLimboFreeSnapshotVersion) : j.min();
  return t2.query.documents !== void 0 ? (O2((n2 = t2.query).documents.length === 1), e = ee(Ht(kn(n2.documents[0])))) : e = function(t3) {
    return ee(Vn(t3));
  }(t2.query), new Or(e, t2.targetId, 0, t2.lastListenSequenceNumber, r2, i, X2.fromBase64String(t2.resumeToken));
}
function Gr(t2, e) {
  var n2, r2 = Ur(e.snapshotVersion), i = Ur(e.lastLimboFreeSnapshotVersion);
  n2 = Ct(e.target) ? Fn(t2.Lt, e.target) : Mn(t2.Lt, e.target);
  var o = e.resumeToken.toBase64();
  return new cr(e.targetId, At(e.target), r2, o, e.sequenceNumber, i, n2);
}
function Qr(t2) {
  var e = Vn({
    parent: t2.parent,
    structuredQuery: t2.structuredQuery
  });
  return t2.limitType === "LAST" ? ne(e, e.limit, "L") : e;
}
var zr = function() {
  function t2() {
  }
  return t2.prototype.getBundleMetadata = function(t3, e) {
    return Wr(t3).get(e).next(function(t4) {
      if (t4)
        return {
          id: (e2 = t4).bundleId,
          createTime: Br(e2.createTime),
          version: e2.version
        };
      var e2;
    });
  }, t2.prototype.saveBundleMetadata = function(t3, e) {
    return Wr(t3).put({
      bundleId: (n2 = e).id,
      createTime: Ur(Tn(n2.createTime)),
      version: n2.version
    });
    var n2;
  }, t2.prototype.getNamedQuery = function(t3, e) {
    return Hr(t3).get(e).next(function(t4) {
      if (t4)
        return {
          name: (e2 = t4).name,
          query: Qr(e2.bundledQuery),
          readTime: Br(e2.readTime)
        };
      var e2;
    });
  }, t2.prototype.saveNamedQuery = function(t3, e) {
    return Hr(t3).put(function(t4) {
      return {
        name: t4.name,
        readTime: Ur(Tn(t4.readTime)),
        bundledQuery: t4.bundledQuery
      };
    }(e));
  }, t2;
}();
function Wr(t2) {
  return xr(t2, pr.store);
}
function Hr(t2) {
  return xr(t2, yr.store);
}
var Yr = function() {
  function t2() {
    this.Bt = new $r();
  }
  return t2.prototype.addToCollectionParentIndex = function(t3, e) {
    return this.Bt.add(e), br.resolve();
  }, t2.prototype.getCollectionParents = function(t3, e) {
    return br.resolve(this.Bt.getEntries(e));
  }, t2;
}();
var $r = function() {
  function t2() {
    this.index = {};
  }
  return t2.prototype.add = function(t3) {
    var e = t3.lastSegment(), n2 = t3.popLast(), r2 = this.index[e] || new Ye(W2.comparator), i = !r2.has(n2);
    return this.index[e] = r2.add(n2), i;
  }, t2.prototype.has = function(t3) {
    var e = t3.lastSegment(), n2 = t3.popLast(), r2 = this.index[e];
    return r2 && r2.has(n2);
  }, t2.prototype.getEntries = function(t3) {
    return (this.index[t3] || new Ye(W2.comparator)).toArray();
  }, t2;
}();
var Xr = function() {
  function t2() {
    this.qt = new $r();
  }
  return t2.prototype.addToCollectionParentIndex = function(t3, e) {
    var n2 = this;
    if (!this.qt.has(e)) {
      var r2 = e.lastSegment(), i = e.popLast();
      t3.addOnCommittedListener(function() {
        n2.qt.add(e);
      });
      var o = {
        collectionId: r2,
        parent: $n(i)
      };
      return Jr(t3).put(o);
    }
    return br.resolve();
  }, t2.prototype.getCollectionParents = function(t3, e) {
    var n2 = [], r2 = IDBKeyRange.bound([e, ""], [U2(e), ""], false, true);
    return Jr(t3).Nt(r2).next(function(t4) {
      for (var r3 = 0, i = t4; r3 < i.length; r3++) {
        var o = i[r3];
        if (o.collectionId !== e)
          break;
        n2.push(Zn(o.parent));
      }
      return n2;
    });
  }, t2;
}();
function Jr(t2) {
  return xr(t2, lr.store);
}
var Zr = {
  didRun: false,
  sequenceNumbersCollected: 0,
  targetsRemoved: 0,
  documentsRemoved: 0
};
var ti = function() {
  function t2(t3, e, n2) {
    this.cacheSizeCollectionThreshold = t3, this.percentileToCollect = e, this.maximumSequenceNumbersToCollect = n2;
  }
  return t2.withCacheSize = function(e) {
    return new t2(e, t2.DEFAULT_COLLECTION_PERCENTILE, t2.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT);
  }, t2;
}();
function ei(t2, e, n2) {
  var r2 = t2.store(rr.store), i = t2.store(ir.store), o = [], s = IDBKeyRange.only(n2.batchId), u2 = 0, a = r2.$t({
    range: s
  }, function(t3, e2, n3) {
    return u2++, n3.delete();
  });
  o.push(a.next(function() {
    O2(u2 === 1);
  }));
  for (var c = [], h = 0, f = n2.mutations; h < f.length; h++) {
    var l = f[h], d = ir.key(e, l.key.path, n2.batchId);
    o.push(i.delete(d)), c.push(l.key);
  }
  return br.waitFor(o).next(function() {
    return c;
  });
}
function ni(t2) {
  if (!t2)
    return 0;
  var e;
  if (t2.document)
    e = t2.document;
  else if (t2.unknownDocument)
    e = t2.unknownDocument;
  else {
    if (!t2.noDocument)
      throw L2();
    e = t2.noDocument;
  }
  return JSON.stringify(e).length;
}
ti.DEFAULT_COLLECTION_PERCENTILE = 10, ti.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT = 1e3, ti.DEFAULT = new ti(41943040, ti.DEFAULT_COLLECTION_PERCENTILE, ti.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT), ti.DISABLED = new ti(-1, 0, 0);
var ri = function() {
  function t2(t3, e, n2, r2) {
    this.userId = t3, this.R = e, this.Ut = n2, this.referenceDelegate = r2, this.Qt = {};
  }
  return t2.Kt = function(e, n2, r2, i) {
    return O2(e.uid !== ""), new t2(e.isAuthenticated() ? e.uid : "", n2, r2, i);
  }, t2.prototype.checkEmpty = function(t3) {
    var e = true, n2 = IDBKeyRange.bound([this.userId, Number.NEGATIVE_INFINITY], [this.userId, Number.POSITIVE_INFINITY]);
    return oi(t3).$t({
      index: rr.userMutationsIndex,
      range: n2
    }, function(t4, n3, r2) {
      e = false, r2.done();
    }).next(function() {
      return e;
    });
  }, t2.prototype.addMutationBatch = function(t3, e, n2, r2) {
    var i = this, o = si(t3), s = oi(t3);
    return s.add({}).next(function(u2) {
      O2(typeof u2 == "number");
      for (var a = new Rr(u2, e, n2, r2), c = function(t4, e2, n3) {
        var r3 = n3.baseMutations.map(function(e3) {
          return On(t4.Lt, e3);
        }), i2 = n3.mutations.map(function(e3) {
          return On(t4.Lt, e3);
        });
        return new rr(e2, n3.batchId, n3.localWriteTime.toMillis(), r3, i2);
      }(i.R, i.userId, a), h = [], f = new Ye(function(t4, e2) {
        return V2(t4.canonicalString(), e2.canonicalString());
      }), l = 0, d = r2; l < d.length; l++) {
        var p2 = d[l], y2 = ir.key(i.userId, p2.key.path, u2);
        f = f.add(p2.key.path.popLast()), h.push(s.put(c)), h.push(o.put(y2, ir.PLACEHOLDER));
      }
      return f.forEach(function(e2) {
        h.push(i.Ut.addToCollectionParentIndex(t3, e2));
      }), t3.addOnCommittedListener(function() {
        i.Qt[u2] = a.keys();
      }), br.waitFor(h).next(function() {
        return a;
      });
    });
  }, t2.prototype.lookupMutationBatch = function(t3, e) {
    var n2 = this;
    return oi(t3).get(e).next(function(t4) {
      return t4 ? (O2(t4.userId === n2.userId), jr(n2.R, t4)) : null;
    });
  }, t2.prototype.jt = function(t3, e) {
    var n2 = this;
    return this.Qt[e] ? br.resolve(this.Qt[e]) : this.lookupMutationBatch(t3, e).next(function(t4) {
      if (t4) {
        var r2 = t4.keys();
        return n2.Qt[e] = r2, r2;
      }
      return null;
    });
  }, t2.prototype.getNextMutationBatchAfterBatchId = function(t3, e) {
    var n2 = this, r2 = e + 1, i = IDBKeyRange.lowerBound([this.userId, r2]), o = null;
    return oi(t3).$t({
      index: rr.userMutationsIndex,
      range: i
    }, function(t4, e2, i2) {
      e2.userId === n2.userId && (O2(e2.batchId >= r2), o = jr(n2.R, e2)), i2.done();
    }).next(function() {
      return o;
    });
  }, t2.prototype.getHighestUnacknowledgedBatchId = function(t3) {
    var e = IDBKeyRange.upperBound([this.userId, Number.POSITIVE_INFINITY]), n2 = -1;
    return oi(t3).$t({
      index: rr.userMutationsIndex,
      range: e,
      reverse: true
    }, function(t4, e2, r2) {
      n2 = e2.batchId, r2.done();
    }).next(function() {
      return n2;
    });
  }, t2.prototype.getAllMutationBatches = function(t3) {
    var e = this, n2 = IDBKeyRange.bound([this.userId, -1], [this.userId, Number.POSITIVE_INFINITY]);
    return oi(t3).Nt(rr.userMutationsIndex, n2).next(function(t4) {
      return t4.map(function(t5) {
        return jr(e.R, t5);
      });
    });
  }, t2.prototype.getAllMutationBatchesAffectingDocumentKey = function(t3, e) {
    var n2 = this, r2 = ir.prefixForPath(this.userId, e.path), i = IDBKeyRange.lowerBound(r2), o = [];
    return si(t3).$t({
      range: i
    }, function(r3, i2, s) {
      var u2 = r3[0], a = r3[1], c = r3[2], h = Zn(a);
      if (u2 === n2.userId && e.path.isEqual(h))
        return oi(t3).get(c).next(function(t4) {
          if (!t4)
            throw L2();
          O2(t4.userId === n2.userId), o.push(jr(n2.R, t4));
        });
      s.done();
    }).next(function() {
      return o;
    });
  }, t2.prototype.getAllMutationBatchesAffectingDocumentKeys = function(t3, e) {
    var n2 = this, r2 = new Ye(V2), i = [];
    return e.forEach(function(e2) {
      var o = ir.prefixForPath(n2.userId, e2.path), s = IDBKeyRange.lowerBound(o), u2 = si(t3).$t({
        range: s
      }, function(t4, i2, o2) {
        var s2 = t4[0], u3 = t4[1], a = t4[2], c = Zn(u3);
        s2 === n2.userId && e2.path.isEqual(c) ? r2 = r2.add(a) : o2.done();
      });
      i.push(u2);
    }), br.waitFor(i).next(function() {
      return n2.Wt(t3, r2);
    });
  }, t2.prototype.getAllMutationBatchesAffectingQuery = function(t3, e) {
    var n2 = this, r2 = e.path, i = r2.length + 1, o = ir.prefixForPath(this.userId, r2), s = IDBKeyRange.lowerBound(o), u2 = new Ye(V2);
    return si(t3).$t({
      range: s
    }, function(t4, e2, o2) {
      var s2 = t4[0], a = t4[1], c = t4[2], h = Zn(a);
      s2 === n2.userId && r2.isPrefixOf(h) ? h.length === i && (u2 = u2.add(c)) : o2.done();
    }).next(function() {
      return n2.Wt(t3, u2);
    });
  }, t2.prototype.Wt = function(t3, e) {
    var n2 = this, r2 = [], i = [];
    return e.forEach(function(e2) {
      i.push(oi(t3).get(e2).next(function(t4) {
        if (t4 === null)
          throw L2();
        O2(t4.userId === n2.userId), r2.push(jr(n2.R, t4));
      }));
    }), br.waitFor(i).next(function() {
      return r2;
    });
  }, t2.prototype.removeMutationBatch = function(t3, e) {
    var n2 = this;
    return ei(t3.Mt, this.userId, e).next(function(r2) {
      return t3.addOnCommittedListener(function() {
        n2.Gt(e.batchId);
      }), br.forEach(r2, function(e2) {
        return n2.referenceDelegate.markPotentiallyOrphaned(t3, e2);
      });
    });
  }, t2.prototype.Gt = function(t3) {
    delete this.Qt[t3];
  }, t2.prototype.performConsistencyCheck = function(t3) {
    var e = this;
    return this.checkEmpty(t3).next(function(n2) {
      if (!n2)
        return br.resolve();
      var r2 = IDBKeyRange.lowerBound(ir.prefixForUser(e.userId)), i = [];
      return si(t3).$t({
        range: r2
      }, function(t4, n3, r3) {
        if (t4[0] === e.userId) {
          var o = Zn(t4[1]);
          i.push(o);
        } else
          r3.done();
      }).next(function() {
        O2(i.length === 0);
      });
    });
  }, t2.prototype.containsKey = function(t3, e) {
    return ii(t3, this.userId, e);
  }, t2.prototype.zt = function(t3) {
    var e = this;
    return ui(t3).get(this.userId).next(function(t4) {
      return t4 || new nr(e.userId, -1, "");
    });
  }, t2;
}();
function ii(t2, e, n2) {
  var r2 = ir.prefixForPath(e, n2.path), i = r2[1], o = IDBKeyRange.lowerBound(r2), s = false;
  return si(t2).$t({
    range: o,
    kt: true
  }, function(t3, n3, r3) {
    var o2 = t3[0], u2 = t3[1];
    t3[2];
    o2 === e && u2 === i && (s = true), r3.done();
  }).next(function() {
    return s;
  });
}
function oi(t2) {
  return xr(t2, rr.store);
}
function si(t2) {
  return xr(t2, ir.store);
}
function ui(t2) {
  return xr(t2, nr.store);
}
var ai = function() {
  function t2(t3) {
    this.Ht = t3;
  }
  return t2.prototype.next = function() {
    return this.Ht += 2, this.Ht;
  }, t2.Jt = function() {
    return new t2(0);
  }, t2.Yt = function() {
    return new t2(-1);
  }, t2;
}();
var ci = function() {
  function t2(t3, e) {
    this.referenceDelegate = t3, this.R = e;
  }
  return t2.prototype.allocateTargetId = function(t3) {
    var e = this;
    return this.Xt(t3).next(function(n2) {
      var r2 = new ai(n2.highestTargetId);
      return n2.highestTargetId = r2.next(), e.Zt(t3, n2).next(function() {
        return n2.highestTargetId;
      });
    });
  }, t2.prototype.getLastRemoteSnapshotVersion = function(t3) {
    return this.Xt(t3).next(function(t4) {
      return j.fromTimestamp(new B(t4.lastRemoteSnapshotVersion.seconds, t4.lastRemoteSnapshotVersion.nanoseconds));
    });
  }, t2.prototype.getHighestSequenceNumber = function(t3) {
    return this.Xt(t3).next(function(t4) {
      return t4.highestListenSequenceNumber;
    });
  }, t2.prototype.setTargetsMetadata = function(t3, e, n2) {
    var r2 = this;
    return this.Xt(t3).next(function(i) {
      return i.highestListenSequenceNumber = e, n2 && (i.lastRemoteSnapshotVersion = n2.toTimestamp()), e > i.highestListenSequenceNumber && (i.highestListenSequenceNumber = e), r2.Zt(t3, i);
    });
  }, t2.prototype.addTargetData = function(t3, e) {
    var n2 = this;
    return this.te(t3, e).next(function() {
      return n2.Xt(t3).next(function(r2) {
        return r2.targetCount += 1, n2.ee(e, r2), n2.Zt(t3, r2);
      });
    });
  }, t2.prototype.updateTargetData = function(t3, e) {
    return this.te(t3, e);
  }, t2.prototype.removeTargetData = function(t3, e) {
    var n2 = this;
    return this.removeMatchingKeysForTargetId(t3, e.targetId).next(function() {
      return hi(t3).delete(e.targetId);
    }).next(function() {
      return n2.Xt(t3);
    }).next(function(e2) {
      return O2(e2.targetCount > 0), e2.targetCount -= 1, n2.Zt(t3, e2);
    });
  }, t2.prototype.removeTargets = function(t3, e, n2) {
    var r2 = this, i = 0, o = [];
    return hi(t3).$t(function(s, u2) {
      var a = Kr(u2);
      a.sequenceNumber <= e && n2.get(a.targetId) === null && (i++, o.push(r2.removeTargetData(t3, a)));
    }).next(function() {
      return br.waitFor(o);
    }).next(function() {
      return i;
    });
  }, t2.prototype.forEachTarget = function(t3, e) {
    return hi(t3).$t(function(t4, n2) {
      var r2 = Kr(n2);
      e(r2);
    });
  }, t2.prototype.Xt = function(t3) {
    return fi(t3).get(fr.key).next(function(t4) {
      return O2(t4 !== null), t4;
    });
  }, t2.prototype.Zt = function(t3, e) {
    return fi(t3).put(fr.key, e);
  }, t2.prototype.te = function(t3, e) {
    return hi(t3).put(Gr(this.R, e));
  }, t2.prototype.ee = function(t3, e) {
    var n2 = false;
    return t3.targetId > e.highestTargetId && (e.highestTargetId = t3.targetId, n2 = true), t3.sequenceNumber > e.highestListenSequenceNumber && (e.highestListenSequenceNumber = t3.sequenceNumber, n2 = true), n2;
  }, t2.prototype.getTargetCount = function(t3) {
    return this.Xt(t3).next(function(t4) {
      return t4.targetCount;
    });
  }, t2.prototype.getTargetData = function(t3, e) {
    var n2 = At(e), r2 = IDBKeyRange.bound([n2, Number.NEGATIVE_INFINITY], [n2, Number.POSITIVE_INFINITY]), i = null;
    return hi(t3).$t({
      range: r2,
      index: cr.queryTargetsIndexName
    }, function(t4, n3, r3) {
      var o = Kr(n3);
      kt(e, o.target) && (i = o, r3.done());
    }).next(function() {
      return i;
    });
  }, t2.prototype.addMatchingKeys = function(t3, e, n2) {
    var r2 = this, i = [], o = li(t3);
    return e.forEach(function(e2) {
      var s = $n(e2.path);
      i.push(o.put(new hr(n2, s))), i.push(r2.referenceDelegate.addReference(t3, n2, e2));
    }), br.waitFor(i);
  }, t2.prototype.removeMatchingKeys = function(t3, e, n2) {
    var r2 = this, i = li(t3);
    return br.forEach(e, function(e2) {
      var o = $n(e2.path);
      return br.waitFor([i.delete([n2, o]), r2.referenceDelegate.removeReference(t3, n2, e2)]);
    });
  }, t2.prototype.removeMatchingKeysForTargetId = function(t3, e) {
    var n2 = li(t3), r2 = IDBKeyRange.bound([e], [e + 1], false, true);
    return n2.delete(r2);
  }, t2.prototype.getMatchingKeysForTargetId = function(t3, e) {
    var n2 = IDBKeyRange.bound([e], [e + 1], false, true), r2 = li(t3), i = on();
    return r2.$t({
      range: n2,
      kt: true
    }, function(t4, e2, n3) {
      var r3 = Zn(t4[1]), o = new at(r3);
      i = i.add(o);
    }).next(function() {
      return i;
    });
  }, t2.prototype.containsKey = function(t3, e) {
    var n2 = $n(e.path), r2 = IDBKeyRange.bound([n2], [U2(n2)], false, true), i = 0;
    return li(t3).$t({
      index: hr.documentTargetsIndex,
      kt: true,
      range: r2
    }, function(t4, e2, n3) {
      var r3 = t4[0];
      t4[1];
      r3 !== 0 && (i++, n3.done());
    }).next(function() {
      return i > 0;
    });
  }, t2.prototype.lt = function(t3, e) {
    return hi(t3).get(e).next(function(t4) {
      return t4 ? Kr(t4) : null;
    });
  }, t2;
}();
function hi(t2) {
  return xr(t2, cr.store);
}
function fi(t2) {
  return xr(t2, fr.store);
}
function li(t2) {
  return xr(t2, hr.store);
}
function di(t2) {
  return __awaiter(this, void 0, void 0, function() {
    return __generator(this, function(e) {
      if (t2.code !== S2.FAILED_PRECONDITION || t2.message !== mr)
        throw t2;
      return k2("LocalStore", "Unexpectedly lost primary lease"), [2];
    });
  });
}
function pi(t2, e) {
  var n2 = t2[0], r2 = t2[1], i = e[0], o = e[1], s = V2(n2, i);
  return s === 0 ? V2(r2, o) : s;
}
var yi = function() {
  function t2(t3) {
    this.ne = t3, this.buffer = new Ye(pi), this.se = 0;
  }
  return t2.prototype.ie = function() {
    return ++this.se;
  }, t2.prototype.re = function(t3) {
    var e = [t3, this.ie()];
    if (this.buffer.size < this.ne)
      this.buffer = this.buffer.add(e);
    else {
      var n2 = this.buffer.last();
      pi(e, n2) < 0 && (this.buffer = this.buffer.delete(n2).add(e));
    }
  }, Object.defineProperty(t2.prototype, "maxValue", {
    get: function() {
      return this.buffer.last()[0];
    },
    enumerable: false,
    configurable: true
  }), t2;
}();
var vi = function() {
  function t2(t3, e) {
    this.garbageCollector = t3, this.asyncQueue = e, this.oe = false, this.ce = null;
  }
  return t2.prototype.start = function(t3) {
    this.garbageCollector.params.cacheSizeCollectionThreshold !== -1 && this.ue(t3);
  }, t2.prototype.stop = function() {
    this.ce && (this.ce.cancel(), this.ce = null);
  }, Object.defineProperty(t2.prototype, "started", {
    get: function() {
      return this.ce !== null;
    },
    enumerable: false,
    configurable: true
  }), t2.prototype.ue = function(t3) {
    var e = this, n2 = this.oe ? 3e5 : 6e4;
    k2("LruGarbageCollector", "Garbage collection scheduled in " + n2 + "ms"), this.ce = this.asyncQueue.enqueueAfterDelay("lru_garbage_collection", n2, function() {
      return __awaiter(e, void 0, void 0, function() {
        var e2;
        return __generator(this, function(n3) {
          switch (n3.label) {
            case 0:
              this.ce = null, this.oe = true, n3.label = 1;
            case 1:
              return n3.trys.push([1, 3, , 7]), [4, t3.collectGarbage(this.garbageCollector)];
            case 2:
              return n3.sent(), [3, 7];
            case 3:
              return Sr(e2 = n3.sent()) ? (k2("LruGarbageCollector", "Ignoring IndexedDB error during garbage collection: ", e2), [3, 6]) : [3, 4];
            case 4:
              return [4, di(e2)];
            case 5:
              n3.sent(), n3.label = 6;
            case 6:
              return [3, 7];
            case 7:
              return [4, this.ue(t3)];
            case 8:
              return n3.sent(), [2];
          }
        });
      });
    });
  }, t2;
}();
var mi = function() {
  function t2(t3, e) {
    this.ae = t3, this.params = e;
  }
  return t2.prototype.calculateTargetCount = function(t3, e) {
    return this.ae.he(t3).next(function(t4) {
      return Math.floor(e / 100 * t4);
    });
  }, t2.prototype.nthSequenceNumber = function(t3, e) {
    var n2 = this;
    if (e === 0)
      return br.resolve(_.o);
    var r2 = new yi(e);
    return this.ae.forEachTarget(t3, function(t4) {
      return r2.re(t4.sequenceNumber);
    }).next(function() {
      return n2.ae.le(t3, function(t4) {
        return r2.re(t4);
      });
    }).next(function() {
      return r2.maxValue;
    });
  }, t2.prototype.removeTargets = function(t3, e, n2) {
    return this.ae.removeTargets(t3, e, n2);
  }, t2.prototype.removeOrphanedDocuments = function(t3, e) {
    return this.ae.removeOrphanedDocuments(t3, e);
  }, t2.prototype.collect = function(t3, e) {
    var n2 = this;
    return this.params.cacheSizeCollectionThreshold === -1 ? (k2("LruGarbageCollector", "Garbage collection skipped; disabled"), br.resolve(Zr)) : this.getCacheSize(t3).next(function(r2) {
      return r2 < n2.params.cacheSizeCollectionThreshold ? (k2("LruGarbageCollector", "Garbage collection skipped; Cache size " + r2 + " is lower than threshold " + n2.params.cacheSizeCollectionThreshold), Zr) : n2.fe(t3, e);
    });
  }, t2.prototype.getCacheSize = function(t3) {
    return this.ae.getCacheSize(t3);
  }, t2.prototype.fe = function(t3, e) {
    var n2, r2, i, o, s, u2, a, c = this, f = Date.now();
    return this.calculateTargetCount(t3, this.params.percentileToCollect).next(function(e2) {
      return e2 > c.params.maximumSequenceNumbersToCollect ? (k2("LruGarbageCollector", "Capping sequence numbers to collect down to the maximum of " + c.params.maximumSequenceNumbersToCollect + " from " + e2), r2 = c.params.maximumSequenceNumbersToCollect) : r2 = e2, o = Date.now(), c.nthSequenceNumber(t3, r2);
    }).next(function(r3) {
      return n2 = r3, s = Date.now(), c.removeTargets(t3, n2, e);
    }).next(function(e2) {
      return i = e2, u2 = Date.now(), c.removeOrphanedDocuments(t3, n2);
    }).next(function(t4) {
      return a = Date.now(), A2() <= LogLevel.DEBUG && k2("LruGarbageCollector", "LRU Garbage Collection\n	Counted targets in " + (o - f) + "ms\n	Determined least recently used " + r2 + " in " + (s - o) + "ms\n	Removed " + i + " targets in " + (u2 - s) + "ms\n	Removed " + t4 + " documents in " + (a - u2) + "ms\nTotal Duration: " + (a - f) + "ms"), br.resolve({
        didRun: true,
        sequenceNumbersCollected: r2,
        targetsRemoved: i,
        documentsRemoved: t4
      });
    });
  }, t2;
}();
var gi = function() {
  function t2(t3, e) {
    this.db = t3, this.garbageCollector = function(t4, e2) {
      return new mi(t4, e2);
    }(this, e);
  }
  return t2.prototype.he = function(t3) {
    var e = this.de(t3);
    return this.db.getTargetCache().getTargetCount(t3).next(function(t4) {
      return e.next(function(e2) {
        return t4 + e2;
      });
    });
  }, t2.prototype.de = function(t3) {
    var e = 0;
    return this.le(t3, function(t4) {
      e++;
    }).next(function() {
      return e;
    });
  }, t2.prototype.forEachTarget = function(t3, e) {
    return this.db.getTargetCache().forEachTarget(t3, e);
  }, t2.prototype.le = function(t3, e) {
    return this.we(t3, function(t4, n2) {
      return e(n2);
    });
  }, t2.prototype.addReference = function(t3, e, n2) {
    return wi(t3, n2);
  }, t2.prototype.removeReference = function(t3, e, n2) {
    return wi(t3, n2);
  }, t2.prototype.removeTargets = function(t3, e, n2) {
    return this.db.getTargetCache().removeTargets(t3, e, n2);
  }, t2.prototype.markPotentiallyOrphaned = function(t3, e) {
    return wi(t3, e);
  }, t2.prototype._e = function(t3, e) {
    return function(t4, e2) {
      var n2 = false;
      return ui(t4).Ot(function(r2) {
        return ii(t4, r2, e2).next(function(t5) {
          return t5 && (n2 = true), br.resolve(!t5);
        });
      }).next(function() {
        return n2;
      });
    }(t3, e);
  }, t2.prototype.removeOrphanedDocuments = function(t3, e) {
    var n2 = this, r2 = this.db.getRemoteDocumentCache().newChangeBuffer(), i = [], o = 0;
    return this.we(t3, function(s, u2) {
      if (u2 <= e) {
        var a = n2._e(t3, s).next(function(e2) {
          if (!e2)
            return o++, r2.getEntry(t3, s).next(function() {
              return r2.removeEntry(s), li(t3).delete([0, $n(s.path)]);
            });
        });
        i.push(a);
      }
    }).next(function() {
      return br.waitFor(i);
    }).next(function() {
      return r2.apply(t3);
    }).next(function() {
      return o;
    });
  }, t2.prototype.removeTarget = function(t3, e) {
    var n2 = e.withSequenceNumber(t3.currentSequenceNumber);
    return this.db.getTargetCache().updateTargetData(t3, n2);
  }, t2.prototype.updateLimboDocument = function(t3, e) {
    return wi(t3, e);
  }, t2.prototype.we = function(t3, e) {
    var n2, r2 = li(t3), i = _.o;
    return r2.$t({
      index: hr.documentTargetsIndex
    }, function(t4, r3) {
      var o = t4[0], s = (t4[1], r3.path), u2 = r3.sequenceNumber;
      o === 0 ? (i !== _.o && e(new at(Zn(n2)), i), i = u2, n2 = s) : i = _.o;
    }).next(function() {
      i !== _.o && e(new at(Zn(n2)), i);
    });
  }, t2.prototype.getCacheSize = function(t3) {
    return this.db.getRemoteDocumentCache().getSize(t3);
  }, t2;
}();
function wi(t2, e) {
  return li(t2).put(function(t3, e2) {
    return new hr(0, $n(t3.path), e2);
  }(e, t2.currentSequenceNumber));
}
var bi = function() {
  function t2(t3, e) {
    this.mapKeyFn = t3, this.equalsFn = e, this.inner = {};
  }
  return t2.prototype.get = function(t3) {
    var e = this.mapKeyFn(t3), n2 = this.inner[e];
    if (n2 !== void 0)
      for (var r2 = 0, i = n2; r2 < i.length; r2++) {
        var o = i[r2], s = o[0], u2 = o[1];
        if (this.equalsFn(s, t3))
          return u2;
      }
  }, t2.prototype.has = function(t3) {
    return this.get(t3) !== void 0;
  }, t2.prototype.set = function(t3, e) {
    var n2 = this.mapKeyFn(t3), r2 = this.inner[n2];
    if (r2 !== void 0) {
      for (var i = 0; i < r2.length; i++)
        if (this.equalsFn(r2[i][0], t3))
          return void (r2[i] = [t3, e]);
      r2.push([t3, e]);
    } else
      this.inner[n2] = [[t3, e]];
  }, t2.prototype.delete = function(t3) {
    var e = this.mapKeyFn(t3), n2 = this.inner[e];
    if (n2 === void 0)
      return false;
    for (var r2 = 0; r2 < n2.length; r2++)
      if (this.equalsFn(n2[r2][0], t3))
        return n2.length === 1 ? delete this.inner[e] : n2.splice(r2, 1), true;
    return false;
  }, t2.prototype.forEach = function(t3) {
    G2(this.inner, function(e, n2) {
      for (var r2 = 0, i = n2; r2 < i.length; r2++) {
        var o = i[r2], s = o[0], u2 = o[1];
        t3(s, u2);
      }
    });
  }, t2.prototype.isEmpty = function() {
    return Q2(this.inner);
  }, t2;
}();
var Ii = function() {
  function t2() {
    this.changes = new bi(function(t3) {
      return t3.toString();
    }, function(t3, e) {
      return t3.isEqual(e);
    }), this.changesApplied = false;
  }
  return t2.prototype.getReadTime = function(t3) {
    var e = this.changes.get(t3);
    return e ? e.readTime : j.min();
  }, t2.prototype.addEntry = function(t3, e) {
    this.assertNotApplied(), this.changes.set(t3.key, {
      document: t3,
      readTime: e
    });
  }, t2.prototype.removeEntry = function(t3, e) {
    e === void 0 && (e = null), this.assertNotApplied(), this.changes.set(t3, {
      document: St.newInvalidDocument(t3),
      readTime: e
    });
  }, t2.prototype.getEntry = function(t3, e) {
    this.assertNotApplied();
    var n2 = this.changes.get(e);
    return n2 !== void 0 ? br.resolve(n2.document) : this.getFromCache(t3, e);
  }, t2.prototype.getEntries = function(t3, e) {
    return this.getAllFromCache(t3, e);
  }, t2.prototype.apply = function(t3) {
    return this.assertNotApplied(), this.changesApplied = true, this.applyChanges(t3);
  }, t2.prototype.assertNotApplied = function() {
  }, t2;
}();
var Ei = function() {
  function t2(t3, e) {
    this.R = t3, this.Ut = e;
  }
  return t2.prototype.addEntry = function(t3, e, n2) {
    return Si(t3).put(Ni(e), n2);
  }, t2.prototype.removeEntry = function(t3, e) {
    var n2 = Si(t3), r2 = Ni(e);
    return n2.delete(r2);
  }, t2.prototype.updateMetadata = function(t3, e) {
    var n2 = this;
    return this.getMetadata(t3).next(function(r2) {
      return r2.byteSize += e, n2.me(t3, r2);
    });
  }, t2.prototype.getEntry = function(t3, e) {
    var n2 = this;
    return Si(t3).get(Ni(e)).next(function(t4) {
      return n2.ye(e, t4);
    });
  }, t2.prototype.ge = function(t3, e) {
    var n2 = this;
    return Si(t3).get(Ni(e)).next(function(t4) {
      return {
        document: n2.ye(e, t4),
        size: ni(t4)
      };
    });
  }, t2.prototype.getEntries = function(t3, e) {
    var n2 = this, r2 = Je();
    return this.pe(t3, e, function(t4, e2) {
      var i = n2.ye(t4, e2);
      r2 = r2.insert(t4, i);
    }).next(function() {
      return r2;
    });
  }, t2.prototype.Ee = function(t3, e) {
    var n2 = this, r2 = Je(), i = new ze(at.comparator);
    return this.pe(t3, e, function(t4, e2) {
      var o = n2.ye(t4, e2);
      r2 = r2.insert(t4, o), i = i.insert(t4, ni(e2));
    }).next(function() {
      return {
        documents: r2,
        Te: i
      };
    });
  }, t2.prototype.pe = function(t3, e, n2) {
    if (e.isEmpty())
      return br.resolve();
    var r2 = IDBKeyRange.bound(e.first().path.toArray(), e.last().path.toArray()), i = e.getIterator(), o = i.getNext();
    return Si(t3).$t({
      range: r2
    }, function(t4, e2, r3) {
      for (var s = at.fromSegments(t4); o && at.comparator(o, s) < 0; )
        n2(o, null), o = i.getNext();
      o && o.isEqual(s) && (n2(o, e2), o = i.hasNext() ? i.getNext() : null), o ? r3.Ct(o.path.toArray()) : r3.done();
    }).next(function() {
      for (; o; )
        n2(o, null), o = i.hasNext() ? i.getNext() : null;
    });
  }, t2.prototype.getDocumentsMatchingQuery = function(t3, e, n2) {
    var r2 = this, i = Je(), o = e.path.length + 1, s = {};
    if (n2.isEqual(j.min())) {
      var u2 = e.path.toArray();
      s.range = IDBKeyRange.lowerBound(u2);
    } else {
      var a = e.path.toArray(), c = Vr(n2);
      s.range = IDBKeyRange.lowerBound([a, c], true), s.index = ur.collectionReadTimeIndex;
    }
    return Si(t3).$t(s, function(t4, n3, s2) {
      if (t4.length === o) {
        var u3 = Fr(r2.R, n3);
        e.path.isPrefixOf(u3.key.path) ? se(e, u3) && (i = i.insert(u3.key, u3)) : s2.done();
      }
    }).next(function() {
      return i;
    });
  }, t2.prototype.newChangeBuffer = function(t3) {
    return new Ti(this, !!t3 && t3.trackRemovals);
  }, t2.prototype.getSize = function(t3) {
    return this.getMetadata(t3).next(function(t4) {
      return t4.byteSize;
    });
  }, t2.prototype.getMetadata = function(t3) {
    return _i(t3).get(ar.key).next(function(t4) {
      return O2(!!t4), t4;
    });
  }, t2.prototype.me = function(t3, e) {
    return _i(t3).put(ar.key, e);
  }, t2.prototype.ye = function(t3, e) {
    if (e) {
      var n2 = Fr(this.R, e);
      if (!n2.isNoDocument() || !n2.version.isEqual(j.min()))
        return n2;
    }
    return St.newInvalidDocument(t3);
  }, t2;
}();
var Ti = function(t2) {
  function e(e2, n2) {
    var r2 = this;
    return (r2 = t2.call(this) || this).Ie = e2, r2.trackRemovals = n2, r2.Ae = new bi(function(t3) {
      return t3.toString();
    }, function(t3, e3) {
      return t3.isEqual(e3);
    }), r2;
  }
  return __extends(e, t2), e.prototype.applyChanges = function(t3) {
    var e2 = this, n2 = [], r2 = 0, i = new Ye(function(t4, e3) {
      return V2(t4.canonicalString(), e3.canonicalString());
    });
    return this.changes.forEach(function(o, s) {
      var u2 = e2.Ae.get(o);
      if (s.document.isValidDocument()) {
        var a = Mr(e2.Ie.R, s.document, e2.getReadTime(o));
        i = i.add(o.path.popLast());
        var c = ni(a);
        r2 += c - u2, n2.push(e2.Ie.addEntry(t3, o, a));
      } else if (r2 -= u2, e2.trackRemovals) {
        var h = Mr(e2.Ie.R, St.newNoDocument(o, j.min()), e2.getReadTime(o));
        n2.push(e2.Ie.addEntry(t3, o, h));
      } else
        n2.push(e2.Ie.removeEntry(t3, o));
    }), i.forEach(function(r3) {
      n2.push(e2.Ie.Ut.addToCollectionParentIndex(t3, r3));
    }), n2.push(this.Ie.updateMetadata(t3, r2)), br.waitFor(n2);
  }, e.prototype.getFromCache = function(t3, e2) {
    var n2 = this;
    return this.Ie.ge(t3, e2).next(function(t4) {
      return n2.Ae.set(e2, t4.size), t4.document;
    });
  }, e.prototype.getAllFromCache = function(t3, e2) {
    var n2 = this;
    return this.Ie.Ee(t3, e2).next(function(t4) {
      var e3 = t4.documents;
      return t4.Te.forEach(function(t5, e4) {
        n2.Ae.set(t5, e4);
      }), e3;
    });
  }, e;
}(Ii);
function _i(t2) {
  return xr(t2, ar.store);
}
function Si(t2) {
  return xr(t2, ur.store);
}
function Ni(t2) {
  return t2.path.toArray();
}
var Di = function() {
  function t2(t3) {
    this.R = t3;
  }
  return t2.prototype.Rt = function(t3, e, n2, r2) {
    var i = this;
    O2(n2 < r2 && n2 >= 0 && r2 <= 11);
    var o = new Ir("createOrUpgrade", e);
    n2 < 1 && r2 >= 1 && (function(t4) {
      t4.createObjectStore(er.store);
    }(t3), function(t4) {
      t4.createObjectStore(nr.store, {
        keyPath: nr.keyPath
      }), t4.createObjectStore(rr.store, {
        keyPath: rr.keyPath,
        autoIncrement: true
      }).createIndex(rr.userMutationsIndex, rr.userMutationsKeyPath, {
        unique: true
      }), t4.createObjectStore(ir.store);
    }(t3), Ai(t3), function(t4) {
      t4.createObjectStore(ur.store);
    }(t3));
    var s = br.resolve();
    return n2 < 3 && r2 >= 3 && (n2 !== 0 && (function(t4) {
      t4.deleteObjectStore(hr.store), t4.deleteObjectStore(cr.store), t4.deleteObjectStore(fr.store);
    }(t3), Ai(t3)), s = s.next(function() {
      return function(t4) {
        var e2 = t4.store(fr.store), n3 = new fr(0, 0, j.min().toTimestamp(), 0);
        return e2.put(fr.key, n3);
      }(o);
    })), n2 < 4 && r2 >= 4 && (n2 !== 0 && (s = s.next(function() {
      return function(t4, e2) {
        return e2.store(rr.store).Nt().next(function(n3) {
          t4.deleteObjectStore(rr.store), t4.createObjectStore(rr.store, {
            keyPath: rr.keyPath,
            autoIncrement: true
          }).createIndex(rr.userMutationsIndex, rr.userMutationsKeyPath, {
            unique: true
          });
          var r3 = e2.store(rr.store), i2 = n3.map(function(t5) {
            return r3.put(t5);
          });
          return br.waitFor(i2);
        });
      }(t3, o);
    })), s = s.next(function() {
      !function(t4) {
        t4.createObjectStore(dr.store, {
          keyPath: dr.keyPath
        });
      }(t3);
    })), n2 < 5 && r2 >= 5 && (s = s.next(function() {
      return i.Re(o);
    })), n2 < 6 && r2 >= 6 && (s = s.next(function() {
      return function(t4) {
        t4.createObjectStore(ar.store);
      }(t3), i.be(o);
    })), n2 < 7 && r2 >= 7 && (s = s.next(function() {
      return i.ve(o);
    })), n2 < 8 && r2 >= 8 && (s = s.next(function() {
      return i.Pe(t3, o);
    })), n2 < 9 && r2 >= 9 && (s = s.next(function() {
      !function(t4) {
        t4.objectStoreNames.contains("remoteDocumentChanges") && t4.deleteObjectStore("remoteDocumentChanges");
      }(t3), function(t4) {
        var e2 = t4.objectStore(ur.store);
        e2.createIndex(ur.readTimeIndex, ur.readTimeIndexPath, {
          unique: false
        }), e2.createIndex(ur.collectionReadTimeIndex, ur.collectionReadTimeIndexPath, {
          unique: false
        });
      }(e);
    })), n2 < 10 && r2 >= 10 && (s = s.next(function() {
      return i.Ve(o);
    })), n2 < 11 && r2 >= 11 && (s = s.next(function() {
      !function(t4) {
        t4.createObjectStore(pr.store, {
          keyPath: pr.keyPath
        });
      }(t3), function(t4) {
        t4.createObjectStore(yr.store, {
          keyPath: yr.keyPath
        });
      }(t3);
    })), s;
  }, t2.prototype.be = function(t3) {
    var e = 0;
    return t3.store(ur.store).$t(function(t4, n2) {
      e += ni(n2);
    }).next(function() {
      var n2 = new ar(e);
      return t3.store(ar.store).put(ar.key, n2);
    });
  }, t2.prototype.Re = function(t3) {
    var e = this, n2 = t3.store(nr.store), r2 = t3.store(rr.store);
    return n2.Nt().next(function(n3) {
      return br.forEach(n3, function(n4) {
        var i = IDBKeyRange.bound([n4.userId, -1], [n4.userId, n4.lastAcknowledgedBatchId]);
        return r2.Nt(rr.userMutationsIndex, i).next(function(r3) {
          return br.forEach(r3, function(r4) {
            O2(r4.userId === n4.userId);
            var i2 = jr(e.R, r4);
            return ei(t3, n4.userId, i2).next(function() {
            });
          });
        });
      });
    });
  }, t2.prototype.ve = function(t3) {
    var e = t3.store(hr.store), n2 = t3.store(ur.store);
    return t3.store(fr.store).get(fr.key).next(function(t4) {
      var r2 = [];
      return n2.$t(function(n3, i) {
        var o = new W2(n3), s = function(t5) {
          return [0, $n(t5)];
        }(o);
        r2.push(e.get(s).next(function(n4) {
          return n4 ? br.resolve() : function(n5) {
            return e.put(new hr(0, $n(n5), t4.highestListenSequenceNumber));
          }(o);
        }));
      }).next(function() {
        return br.waitFor(r2);
      });
    });
  }, t2.prototype.Pe = function(t3, e) {
    t3.createObjectStore(lr.store, {
      keyPath: lr.keyPath
    });
    var n2 = e.store(lr.store), r2 = new $r(), i = function(t4) {
      if (r2.add(t4)) {
        var e2 = t4.lastSegment(), i2 = t4.popLast();
        return n2.put({
          collectionId: e2,
          parent: $n(i2)
        });
      }
    };
    return e.store(ur.store).$t({
      kt: true
    }, function(t4, e2) {
      var n3 = new W2(t4);
      return i(n3.popLast());
    }).next(function() {
      return e.store(ir.store).$t({
        kt: true
      }, function(t4, e2) {
        t4[0];
        var n3 = t4[1], r3 = (t4[2], Zn(n3));
        return i(r3.popLast());
      });
    });
  }, t2.prototype.Ve = function(t3) {
    var e = this, n2 = t3.store(cr.store);
    return n2.$t(function(t4, r2) {
      var i = Kr(r2), o = Gr(e.R, i);
      return n2.put(o);
    });
  }, t2;
}();
function Ai(t2) {
  t2.createObjectStore(hr.store, {
    keyPath: hr.keyPath
  }).createIndex(hr.documentTargetsIndex, hr.documentTargetsKeyPath, {
    unique: true
  }), t2.createObjectStore(cr.store, {
    keyPath: cr.keyPath
  }).createIndex(cr.queryTargetsIndexName, cr.queryTargetsKeyPath, {
    unique: true
  }), t2.createObjectStore(fr.store);
}
var ki = "Failed to obtain exclusive access to the persistence layer. To allow shared access, multi-tab synchronization has to be enabled in all tabs. If you are using `experimentalForceOwningTab:true`, make sure that only one tab has persistence enabled at any given time.";
var Ci = function() {
  function t2(e, n2, r2, i, o, s, u2, a, c, h) {
    if (this.allowTabSynchronization = e, this.persistenceKey = n2, this.clientId = r2, this.Se = o, this.window = s, this.document = u2, this.De = c, this.Ce = h, this.Ne = null, this.xe = false, this.isPrimary = false, this.networkEnabled = true, this.Fe = null, this.inForeground = false, this.ke = null, this.$e = null, this.Oe = Number.NEGATIVE_INFINITY, this.Me = function(t3) {
      return Promise.resolve();
    }, !t2.yt())
      throw new N2(S2.UNIMPLEMENTED, "This platform is either missing IndexedDB or is known to have an incomplete implementation. Offline persistence has been disabled.");
    this.referenceDelegate = new gi(this, i), this.Le = n2 + "main", this.R = new Pr(a), this.Be = new Er(this.Le, 11, new Di(this.R)), this.qe = new ci(this.referenceDelegate, this.R), this.Ut = new Xr(), this.Ue = function(t3, e2) {
      return new Ei(t3, e2);
    }(this.R, this.Ut), this.Qe = new zr(), this.window && this.window.localStorage ? this.Ke = this.window.localStorage : (this.Ke = null, h === false && C("IndexedDbPersistence", "LocalStorage is unavailable. As a result, persistence may not work reliably. In particular enablePersistence() could fail immediately after refreshing the page."));
  }
  return t2.prototype.start = function() {
    var t3 = this;
    return this.je().then(function() {
      if (!t3.isPrimary && !t3.allowTabSynchronization)
        throw new N2(S2.FAILED_PRECONDITION, ki);
      return t3.We(), t3.Ge(), t3.ze(), t3.runTransaction("getHighestListenSequenceNumber", "readonly", function(e) {
        return t3.qe.getHighestSequenceNumber(e);
      });
    }).then(function(e) {
      t3.Ne = new _(e, t3.De);
    }).then(function() {
      t3.xe = true;
    }).catch(function(e) {
      return t3.Be && t3.Be.close(), Promise.reject(e);
    });
  }, t2.prototype.He = function(t3) {
    var e = this;
    return this.Me = function(n2) {
      return __awaiter(e, void 0, void 0, function() {
        return __generator(this, function(e2) {
          return this.started ? [2, t3(n2)] : [2];
        });
      });
    }, t3(this.isPrimary);
  }, t2.prototype.setDatabaseDeletedListener = function(t3) {
    var e = this;
    this.Be.vt(function(n2) {
      return __awaiter(e, void 0, void 0, function() {
        return __generator(this, function(e2) {
          switch (e2.label) {
            case 0:
              return n2.newVersion === null ? [4, t3()] : [3, 2];
            case 1:
              e2.sent(), e2.label = 2;
            case 2:
              return [2];
          }
        });
      });
    });
  }, t2.prototype.setNetworkEnabled = function(t3) {
    var e = this;
    this.networkEnabled !== t3 && (this.networkEnabled = t3, this.Se.enqueueAndForget(function() {
      return __awaiter(e, void 0, void 0, function() {
        return __generator(this, function(t4) {
          switch (t4.label) {
            case 0:
              return this.started ? [4, this.je()] : [3, 2];
            case 1:
              t4.sent(), t4.label = 2;
            case 2:
              return [2];
          }
        });
      });
    }));
  }, t2.prototype.je = function() {
    var t3 = this;
    return this.runTransaction("updateClientMetadataAndTryBecomePrimary", "readwrite", function(e) {
      return Ri(e).put(new dr(t3.clientId, Date.now(), t3.networkEnabled, t3.inForeground)).next(function() {
        if (t3.isPrimary)
          return t3.Je(e).next(function(e2) {
            e2 || (t3.isPrimary = false, t3.Se.enqueueRetryable(function() {
              return t3.Me(false);
            }));
          });
      }).next(function() {
        return t3.Ye(e);
      }).next(function(n2) {
        return t3.isPrimary && !n2 ? t3.Xe(e).next(function() {
          return false;
        }) : !!n2 && t3.Ze(e).next(function() {
          return true;
        });
      });
    }).catch(function(e) {
      if (Sr(e))
        return k2("IndexedDbPersistence", "Failed to extend owner lease: ", e), t3.isPrimary;
      if (!t3.allowTabSynchronization)
        throw e;
      return k2("IndexedDbPersistence", "Releasing owner lease after error during lease refresh", e), false;
    }).then(function(e) {
      t3.isPrimary !== e && t3.Se.enqueueRetryable(function() {
        return t3.Me(e);
      }), t3.isPrimary = e;
    });
  }, t2.prototype.Je = function(t3) {
    var e = this;
    return xi(t3).get(er.key).next(function(t4) {
      return br.resolve(e.tn(t4));
    });
  }, t2.prototype.en = function(t3) {
    return Ri(t3).delete(this.clientId);
  }, t2.prototype.nn = function() {
    return __awaiter(this, void 0, void 0, function() {
      var t3, e, n2, r2, i = this;
      return __generator(this, function(o) {
        switch (o.label) {
          case 0:
            return !this.isPrimary || this.sn(this.Oe, 18e5) ? [3, 2] : (this.Oe = Date.now(), [4, this.runTransaction("maybeGarbageCollectMultiClientState", "readwrite-primary", function(t4) {
              var e2 = xr(t4, dr.store);
              return e2.Nt().next(function(t5) {
                var n3 = i.rn(t5, 18e5), r3 = t5.filter(function(t6) {
                  return n3.indexOf(t6) === -1;
                });
                return br.forEach(r3, function(t6) {
                  return e2.delete(t6.clientId);
                }).next(function() {
                  return r3;
                });
              });
            }).catch(function() {
              return [];
            })]);
          case 1:
            if (t3 = o.sent(), this.Ke)
              for (e = 0, n2 = t3; e < n2.length; e++)
                r2 = n2[e], this.Ke.removeItem(this.on(r2.clientId));
            o.label = 2;
          case 2:
            return [2];
        }
      });
    });
  }, t2.prototype.ze = function() {
    var t3 = this;
    this.$e = this.Se.enqueueAfterDelay("client_metadata_refresh", 4e3, function() {
      return t3.je().then(function() {
        return t3.nn();
      }).then(function() {
        return t3.ze();
      });
    });
  }, t2.prototype.tn = function(t3) {
    return !!t3 && t3.ownerId === this.clientId;
  }, t2.prototype.Ye = function(t3) {
    var e = this;
    return this.Ce ? br.resolve(true) : xi(t3).get(er.key).next(function(n2) {
      if (n2 !== null && e.sn(n2.leaseTimestampMs, 5e3) && !e.cn(n2.ownerId)) {
        if (e.tn(n2) && e.networkEnabled)
          return true;
        if (!e.tn(n2)) {
          if (!n2.allowTabSynchronization)
            throw new N2(S2.FAILED_PRECONDITION, ki);
          return false;
        }
      }
      return !(!e.networkEnabled || !e.inForeground) || Ri(t3).Nt().next(function(t4) {
        return e.rn(t4, 5e3).find(function(t5) {
          if (e.clientId !== t5.clientId) {
            var n3 = !e.networkEnabled && t5.networkEnabled, r2 = !e.inForeground && t5.inForeground, i = e.networkEnabled === t5.networkEnabled;
            if (n3 || r2 && i)
              return true;
          }
          return false;
        }) === void 0;
      });
    }).next(function(t4) {
      return e.isPrimary !== t4 && k2("IndexedDbPersistence", "Client " + (t4 ? "is" : "is not") + " eligible for a primary lease."), t4;
    });
  }, t2.prototype.shutdown = function() {
    return __awaiter(this, void 0, void 0, function() {
      var t3 = this;
      return __generator(this, function(e) {
        switch (e.label) {
          case 0:
            return this.xe = false, this.un(), this.$e && (this.$e.cancel(), this.$e = null), this.an(), this.hn(), [4, this.Be.runTransaction("shutdown", "readwrite", [er.store, dr.store], function(e2) {
              var n2 = new Cr(e2, _.o);
              return t3.Xe(n2).next(function() {
                return t3.en(n2);
              });
            })];
          case 1:
            return e.sent(), this.Be.close(), this.ln(), [2];
        }
      });
    });
  }, t2.prototype.rn = function(t3, e) {
    var n2 = this;
    return t3.filter(function(t4) {
      return n2.sn(t4.updateTimeMs, e) && !n2.cn(t4.clientId);
    });
  }, t2.prototype.fn = function() {
    var t3 = this;
    return this.runTransaction("getActiveClients", "readonly", function(e) {
      return Ri(e).Nt().next(function(e2) {
        return t3.rn(e2, 18e5).map(function(t4) {
          return t4.clientId;
        });
      });
    });
  }, Object.defineProperty(t2.prototype, "started", {
    get: function() {
      return this.xe;
    },
    enumerable: false,
    configurable: true
  }), t2.prototype.getMutationQueue = function(t3) {
    return ri.Kt(t3, this.R, this.Ut, this.referenceDelegate);
  }, t2.prototype.getTargetCache = function() {
    return this.qe;
  }, t2.prototype.getRemoteDocumentCache = function() {
    return this.Ue;
  }, t2.prototype.getIndexManager = function() {
    return this.Ut;
  }, t2.prototype.getBundleCache = function() {
    return this.Qe;
  }, t2.prototype.runTransaction = function(t3, e, n2) {
    var r2 = this;
    k2("IndexedDbPersistence", "Starting transaction:", t3);
    var i, o = e === "readonly" ? "readonly" : "readwrite";
    return this.Be.runTransaction(t3, o, vr, function(o2) {
      return i = new Cr(o2, r2.Ne ? r2.Ne.next() : _.o), e === "readwrite-primary" ? r2.Je(i).next(function(t4) {
        return !!t4 || r2.Ye(i);
      }).next(function(e2) {
        if (!e2)
          throw C("Failed to obtain primary lease for action '" + t3 + "'."), r2.isPrimary = false, r2.Se.enqueueRetryable(function() {
            return r2.Me(false);
          }), new N2(S2.FAILED_PRECONDITION, mr);
        return n2(i);
      }).next(function(t4) {
        return r2.Ze(i).next(function() {
          return t4;
        });
      }) : r2.dn(i).next(function() {
        return n2(i);
      });
    }).then(function(t4) {
      return i.raiseOnCommittedEvent(), t4;
    });
  }, t2.prototype.dn = function(t3) {
    var e = this;
    return xi(t3).get(er.key).next(function(t4) {
      if (t4 !== null && e.sn(t4.leaseTimestampMs, 5e3) && !e.cn(t4.ownerId) && !e.tn(t4) && !(e.Ce || e.allowTabSynchronization && t4.allowTabSynchronization))
        throw new N2(S2.FAILED_PRECONDITION, ki);
    });
  }, t2.prototype.Ze = function(t3) {
    var e = new er(this.clientId, this.allowTabSynchronization, Date.now());
    return xi(t3).put(er.key, e);
  }, t2.yt = function() {
    return Er.yt();
  }, t2.prototype.Xe = function(t3) {
    var e = this, n2 = xi(t3);
    return n2.get(er.key).next(function(t4) {
      return e.tn(t4) ? (k2("IndexedDbPersistence", "Releasing primary lease."), n2.delete(er.key)) : br.resolve();
    });
  }, t2.prototype.sn = function(t3, e) {
    var n2 = Date.now();
    return !(t3 < n2 - e || t3 > n2 && (C("Detected an update time that is in the future: " + t3 + " > " + n2), 1));
  }, t2.prototype.We = function() {
    var t3 = this;
    this.document !== null && typeof this.document.addEventListener == "function" && (this.ke = function() {
      t3.Se.enqueueAndForget(function() {
        return t3.inForeground = t3.document.visibilityState === "visible", t3.je();
      });
    }, this.document.addEventListener("visibilitychange", this.ke), this.inForeground = this.document.visibilityState === "visible");
  }, t2.prototype.an = function() {
    this.ke && (this.document.removeEventListener("visibilitychange", this.ke), this.ke = null);
  }, t2.prototype.Ge = function() {
    var t3, e = this;
    typeof ((t3 = this.window) === null || t3 === void 0 ? void 0 : t3.addEventListener) == "function" && (this.Fe = function() {
      e.un(), e.Se.enqueueAndForget(function() {
        return e.shutdown();
      });
    }, this.window.addEventListener("pagehide", this.Fe));
  }, t2.prototype.hn = function() {
    this.Fe && (this.window.removeEventListener("pagehide", this.Fe), this.Fe = null);
  }, t2.prototype.cn = function(t3) {
    var e;
    try {
      var n2 = ((e = this.Ke) === null || e === void 0 ? void 0 : e.getItem(this.on(t3))) !== null;
      return k2("IndexedDbPersistence", "Client '" + t3 + "' " + (n2 ? "is" : "is not") + " zombied in LocalStorage"), n2;
    } catch (t4) {
      return C("IndexedDbPersistence", "Failed to get zombied client id.", t4), false;
    }
  }, t2.prototype.un = function() {
    if (this.Ke)
      try {
        this.Ke.setItem(this.on(this.clientId), String(Date.now()));
      } catch (t3) {
        C("Failed to set zombie client id.", t3);
      }
  }, t2.prototype.ln = function() {
    if (this.Ke)
      try {
        this.Ke.removeItem(this.on(this.clientId));
      } catch (t3) {
      }
  }, t2.prototype.on = function(t3) {
    return "firestore_zombie_" + this.persistenceKey + "_" + t3;
  }, t2;
}();
function xi(t2) {
  return xr(t2, er.store);
}
function Ri(t2) {
  return xr(t2, dr.store);
}
function Li(t2, e) {
  var n2 = t2.projectId;
  return t2.isDefaultDatabase || (n2 += "." + t2.database), "firestore/" + e + "/" + n2 + "/";
}
var Oi = function(t2, e) {
  this.progress = t2, this.wn = e;
};
var Pi = function() {
  function t2(t3, e, n2) {
    this.Ue = t3, this._n = e, this.Ut = n2;
  }
  return t2.prototype.mn = function(t3, e) {
    var n2 = this;
    return this._n.getAllMutationBatchesAffectingDocumentKey(t3, e).next(function(r2) {
      return n2.yn(t3, e, r2);
    });
  }, t2.prototype.yn = function(t3, e, n2) {
    return this.Ue.getEntry(t3, e).next(function(t4) {
      for (var e2 = 0, r2 = n2; e2 < r2.length; e2++) {
        r2[e2].applyToLocalView(t4);
      }
      return t4;
    });
  }, t2.prototype.gn = function(t3, e) {
    t3.forEach(function(t4, n2) {
      for (var r2 = 0, i = e; r2 < i.length; r2++) {
        i[r2].applyToLocalView(n2);
      }
    });
  }, t2.prototype.pn = function(t3, e) {
    var n2 = this;
    return this.Ue.getEntries(t3, e).next(function(e2) {
      return n2.En(t3, e2).next(function() {
        return e2;
      });
    });
  }, t2.prototype.En = function(t3, e) {
    var n2 = this;
    return this._n.getAllMutationBatchesAffectingDocumentKeys(t3, e).next(function(t4) {
      return n2.gn(e, t4);
    });
  }, t2.prototype.getDocumentsMatchingQuery = function(t3, e, n2) {
    return function(t4) {
      return at.isDocumentKey(t4.path) && t4.collectionGroup === null && t4.filters.length === 0;
    }(e) ? this.Tn(t3, e.path) : Zt(e) ? this.In(t3, e, n2) : this.An(t3, e, n2);
  }, t2.prototype.Tn = function(t3, e) {
    return this.mn(t3, new at(e)).next(function(t4) {
      var e2 = tn();
      return t4.isFoundDocument() && (e2 = e2.insert(t4.key, t4)), e2;
    });
  }, t2.prototype.In = function(t3, e, n2) {
    var r2 = this, i = e.collectionGroup, o = tn();
    return this.Ut.getCollectionParents(t3, i).next(function(s) {
      return br.forEach(s, function(s2) {
        var u2 = function(t4, e2) {
          return new zt(e2, null, t4.explicitOrderBy.slice(), t4.filters.slice(), t4.limit, t4.limitType, t4.startAt, t4.endAt);
        }(e, s2.child(i));
        return r2.An(t3, u2, n2).next(function(t4) {
          t4.forEach(function(t5, e2) {
            o = o.insert(t5, e2);
          });
        });
      }).next(function() {
        return o;
      });
    });
  }, t2.prototype.An = function(t3, e, n2) {
    var r2, i, o = this;
    return this.Ue.getDocumentsMatchingQuery(t3, e, n2).next(function(n3) {
      return r2 = n3, o._n.getAllMutationBatchesAffectingQuery(t3, e);
    }).next(function(e2) {
      return i = e2, o.Rn(t3, i, r2).next(function(t4) {
        r2 = t4;
        for (var e3 = 0, n3 = i; e3 < n3.length; e3++)
          for (var o2 = n3[e3], s = 0, u2 = o2.mutations; s < u2.length; s++) {
            var a = u2[s], c = a.key, h = r2.get(c);
            h == null && (h = St.newInvalidDocument(c), r2 = r2.insert(c, h)), Ce(a, h, o2.localWriteTime), h.isFoundDocument() || (r2 = r2.remove(c));
          }
      });
    }).next(function() {
      return r2.forEach(function(t4, n3) {
        se(e, n3) || (r2 = r2.remove(t4));
      }), r2;
    });
  }, t2.prototype.Rn = function(t3, e, n2) {
    for (var r2 = on(), i = 0, o = e; i < o.length; i++)
      for (var s = 0, u2 = o[i].mutations; s < u2.length; s++) {
        var a = u2[s];
        a instanceof Pe && n2.get(a.key) === null && (r2 = r2.add(a.key));
      }
    var c = n2;
    return this.Ue.getEntries(t3, r2).next(function(t4) {
      return t4.forEach(function(t5, e2) {
        e2.isFoundDocument() && (c = c.insert(t5, e2));
      }), c;
    });
  }, t2;
}();
var Fi = function() {
  function t2(t3, e, n2, r2) {
    this.targetId = t3, this.fromCache = e, this.bn = n2, this.vn = r2;
  }
  return t2.Pn = function(e, n2) {
    for (var r2 = on(), i = on(), o = 0, s = n2.docChanges; o < s.length; o++) {
      var u2 = s[o];
      switch (u2.type) {
        case 0:
          r2 = r2.add(u2.doc.key);
          break;
        case 1:
          i = i.add(u2.doc.key);
      }
    }
    return new t2(e, n2.fromCache, r2, i);
  }, t2;
}();
var Mi = function() {
  function t2() {
  }
  return t2.prototype.Vn = function(t3) {
    this.Sn = t3;
  }, t2.prototype.getDocumentsMatchingQuery = function(t3, e, n2, r2) {
    var i = this;
    return function(t4) {
      return t4.filters.length === 0 && t4.limit === null && t4.startAt == null && t4.endAt == null && (t4.explicitOrderBy.length === 0 || t4.explicitOrderBy.length === 1 && t4.explicitOrderBy[0].field.isKeyField());
    }(e) || n2.isEqual(j.min()) ? this.Dn(t3, e) : this.Sn.pn(t3, r2).next(function(o) {
      var s = i.Cn(e, o);
      return (Yt(e) || $t(e)) && i.Nn(e.limitType, s, r2, n2) ? i.Dn(t3, e) : (A2() <= LogLevel.DEBUG && k2("QueryEngine", "Re-using previous result from %s to execute query: %s", n2.toString(), oe(e)), i.Sn.getDocumentsMatchingQuery(t3, e, n2).next(function(t4) {
        return s.forEach(function(e2) {
          t4 = t4.insert(e2.key, e2);
        }), t4;
      }));
    });
  }, t2.prototype.Cn = function(t3, e) {
    var n2 = new Ye(ue(t3));
    return e.forEach(function(e2, r2) {
      se(t3, r2) && (n2 = n2.add(r2));
    }), n2;
  }, t2.prototype.Nn = function(t3, e, n2, r2) {
    if (n2.size !== e.size)
      return true;
    var i = t3 === "F" ? e.last() : e.first();
    return !!i && (i.hasPendingWrites || i.version.compareTo(r2) > 0);
  }, t2.prototype.Dn = function(t3, e) {
    return A2() <= LogLevel.DEBUG && k2("QueryEngine", "Using full collection scan to execute query:", oe(e)), this.Sn.getDocumentsMatchingQuery(t3, e, j.min());
  }, t2;
}();
var Vi = function() {
  function t2(t3, e, n2, r2) {
    this.persistence = t3, this.xn = e, this.R = r2, this.Fn = new ze(V2), this.kn = new bi(function(t4) {
      return At(t4);
    }, kt), this.$n = j.min(), this._n = t3.getMutationQueue(n2), this.On = t3.getRemoteDocumentCache(), this.qe = t3.getTargetCache(), this.Mn = new Pi(this.On, this._n, this.persistence.getIndexManager()), this.Qe = t3.getBundleCache(), this.xn.Vn(this.Mn);
  }
  return t2.prototype.collectGarbage = function(t3) {
    var e = this;
    return this.persistence.runTransaction("Collect garbage", "readwrite-primary", function(n2) {
      return t3.collect(n2, e.Fn);
    });
  }, t2;
}();
function qi(t2, e, n2, r2) {
  return new Vi(t2, e, n2, r2);
}
function Ui(t2, e) {
  return __awaiter(this, void 0, void 0, function() {
    var n2, r2, i, o;
    return __generator(this, function(s) {
      switch (s.label) {
        case 0:
          return n2 = P2(t2), r2 = n2._n, i = n2.Mn, [4, n2.persistence.runTransaction("Handle user change", "readonly", function(t3) {
            var o2;
            return n2._n.getAllMutationBatches(t3).next(function(s2) {
              return o2 = s2, r2 = n2.persistence.getMutationQueue(e), i = new Pi(n2.On, r2, n2.persistence.getIndexManager()), r2.getAllMutationBatches(t3);
            }).next(function(e2) {
              for (var n3 = [], r3 = [], s2 = on(), u2 = 0, a = o2; u2 < a.length; u2++) {
                var c = a[u2];
                n3.push(c.batchId);
                for (var h = 0, f = c.mutations; h < f.length; h++) {
                  var l = f[h];
                  s2 = s2.add(l.key);
                }
              }
              for (var d = 0, p2 = e2; d < p2.length; d++) {
                var y2 = p2[d];
                r3.push(y2.batchId);
                for (var v = 0, m = y2.mutations; v < m.length; v++) {
                  var g2 = m[v];
                  s2 = s2.add(g2.key);
                }
              }
              return i.pn(t3, s2).next(function(t4) {
                return {
                  Ln: t4,
                  removedBatchIds: n3,
                  addedBatchIds: r3
                };
              });
            });
          })];
        case 1:
          return o = s.sent(), [2, (n2._n = r2, n2.Mn = i, n2.xn.Vn(n2.Mn), o)];
      }
    });
  });
}
function Bi(t2, e) {
  var n2 = P2(t2);
  return n2.persistence.runTransaction("Acknowledge batch", "readwrite-primary", function(t3) {
    var r2 = e.batch.keys(), i = n2.On.newChangeBuffer({
      trackRemovals: true
    });
    return function(t4, e2, n3, r3) {
      var i2 = n3.batch, o = i2.keys(), s = br.resolve();
      return o.forEach(function(t5) {
        s = s.next(function() {
          return r3.getEntry(e2, t5);
        }).next(function(e3) {
          var o2 = n3.docVersions.get(t5);
          O2(o2 !== null), e3.version.compareTo(o2) < 0 && (i2.applyToRemoteDocument(e3, n3), e3.isValidDocument() && r3.addEntry(e3, n3.commitVersion));
        });
      }), s.next(function() {
        return t4._n.removeMutationBatch(e2, i2);
      });
    }(n2, t3, e, i).next(function() {
      return i.apply(t3);
    }).next(function() {
      return n2._n.performConsistencyCheck(t3);
    }).next(function() {
      return n2.Mn.pn(t3, r2);
    });
  });
}
function ji(t2) {
  var e = P2(t2);
  return e.persistence.runTransaction("Get last remote snapshot version", "readonly", function(t3) {
    return e.qe.getLastRemoteSnapshotVersion(t3);
  });
}
function Ki(t2, e) {
  var n2 = P2(t2), r2 = e.snapshotVersion, i = n2.Fn;
  return n2.persistence.runTransaction("Apply remote event", "readwrite-primary", function(t3) {
    var o = n2.On.newChangeBuffer({
      trackRemovals: true
    });
    i = n2.Fn;
    var s = [];
    e.targetChanges.forEach(function(e2, o2) {
      var u3 = i.get(o2);
      if (u3) {
        s.push(n2.qe.removeMatchingKeys(t3, e2.removedDocuments, o2).next(function() {
          return n2.qe.addMatchingKeys(t3, e2.addedDocuments, o2);
        }));
        var a2 = e2.resumeToken;
        if (a2.approximateByteSize() > 0) {
          var c = u3.withResumeToken(a2, r2).withSequenceNumber(t3.currentSequenceNumber);
          i = i.insert(o2, c), function(t4, e3, n3) {
            return O2(e3.resumeToken.approximateByteSize() > 0), t4.resumeToken.approximateByteSize() === 0 || (e3.snapshotVersion.toMicroseconds() - t4.snapshotVersion.toMicroseconds() >= 3e8 || n3.addedDocuments.size + n3.modifiedDocuments.size + n3.removedDocuments.size > 0);
          }(u3, c, e2) && s.push(n2.qe.updateTargetData(t3, c));
        }
      }
    });
    var u2 = Je();
    if (e.documentUpdates.forEach(function(r3, i2) {
      e.resolvedLimboDocuments.has(r3) && s.push(n2.persistence.referenceDelegate.updateLimboDocument(t3, r3));
    }), s.push(Gi(t3, o, e.documentUpdates, r2, void 0).next(function(t4) {
      u2 = t4;
    })), !r2.isEqual(j.min())) {
      var a = n2.qe.getLastRemoteSnapshotVersion(t3).next(function(e2) {
        return n2.qe.setTargetsMetadata(t3, t3.currentSequenceNumber, r2);
      });
      s.push(a);
    }
    return br.waitFor(s).next(function() {
      return o.apply(t3);
    }).next(function() {
      return n2.Mn.En(t3, u2);
    }).next(function() {
      return u2;
    });
  }).then(function(t3) {
    return n2.Fn = i, t3;
  });
}
function Gi(t2, e, n2, r2, i) {
  var o = on();
  return n2.forEach(function(t3) {
    return o = o.add(t3);
  }), e.getEntries(t2, o).next(function(t3) {
    var o2 = Je();
    return n2.forEach(function(n3, s) {
      var u2 = t3.get(n3), a = (i == null ? void 0 : i.get(n3)) || r2;
      s.isNoDocument() && s.version.isEqual(j.min()) ? (e.removeEntry(n3, a), o2 = o2.insert(n3, s)) : !u2.isValidDocument() || s.version.compareTo(u2.version) > 0 || s.version.compareTo(u2.version) === 0 && u2.hasPendingWrites ? (e.addEntry(s, a), o2 = o2.insert(n3, s)) : k2("LocalStore", "Ignoring outdated watch update for ", n3, ". Current version:", u2.version, " Watch version:", s.version);
    }), o2;
  });
}
function Qi(t2, e) {
  var n2 = P2(t2);
  return n2.persistence.runTransaction("Get next mutation batch", "readonly", function(t3) {
    return e === void 0 && (e = -1), n2._n.getNextMutationBatchAfterBatchId(t3, e);
  });
}
function zi(t2, e) {
  var n2 = P2(t2);
  return n2.persistence.runTransaction("Allocate target", "readwrite", function(t3) {
    var r2;
    return n2.qe.getTargetData(t3, e).next(function(i) {
      return i ? (r2 = i, br.resolve(r2)) : n2.qe.allocateTargetId(t3).next(function(i2) {
        return r2 = new Or(e, i2, 0, t3.currentSequenceNumber), n2.qe.addTargetData(t3, r2).next(function() {
          return r2;
        });
      });
    });
  }).then(function(t3) {
    var r2 = n2.Fn.get(t3.targetId);
    return (r2 === null || t3.snapshotVersion.compareTo(r2.snapshotVersion) > 0) && (n2.Fn = n2.Fn.insert(t3.targetId, t3), n2.kn.set(e, t3.targetId)), t3;
  });
}
function Wi(t2, e, n2) {
  return __awaiter(this, void 0, void 0, function() {
    var r2, i, o, s;
    return __generator(this, function(u2) {
      switch (u2.label) {
        case 0:
          r2 = P2(t2), i = r2.Fn.get(e), o = n2 ? "readwrite" : "readwrite-primary", u2.label = 1;
        case 1:
          return u2.trys.push([1, 4, , 5]), n2 ? [3, 3] : [4, r2.persistence.runTransaction("Release target", o, function(t3) {
            return r2.persistence.referenceDelegate.removeTarget(t3, i);
          })];
        case 2:
          u2.sent(), u2.label = 3;
        case 3:
          return [3, 5];
        case 4:
          if (!Sr(s = u2.sent()))
            throw s;
          return k2("LocalStore", "Failed to update sequence numbers for target " + e + ": " + s), [3, 5];
        case 5:
          return r2.Fn = r2.Fn.remove(e), r2.kn.delete(i.target), [2];
      }
    });
  });
}
function Hi(t2, e, n2) {
  var r2 = P2(t2), i = j.min(), o = on();
  return r2.persistence.runTransaction("Execute query", "readonly", function(t3) {
    return function(t4, e2, n3) {
      var r3 = P2(t4), i2 = r3.kn.get(n3);
      return i2 !== void 0 ? br.resolve(r3.Fn.get(i2)) : r3.qe.getTargetData(e2, n3);
    }(r2, t3, ee(e)).next(function(e2) {
      if (e2)
        return i = e2.lastLimboFreeSnapshotVersion, r2.qe.getMatchingKeysForTargetId(t3, e2.targetId).next(function(t4) {
          o = t4;
        });
    }).next(function() {
      return r2.xn.getDocumentsMatchingQuery(t3, e, n2 ? i : j.min(), n2 ? o : on());
    }).next(function(t4) {
      return {
        documents: t4,
        Bn: o
      };
    });
  });
}
function Yi(t2, e) {
  var n2 = P2(t2), r2 = P2(n2.qe), i = n2.Fn.get(e);
  return i ? Promise.resolve(i.target) : n2.persistence.runTransaction("Get target data", "readonly", function(t3) {
    return r2.lt(t3, e).next(function(t4) {
      return t4 ? t4.target : null;
    });
  });
}
function $i(t2) {
  var e = P2(t2);
  return e.persistence.runTransaction("Get new document changes", "readonly", function(t3) {
    return function(t4, e2, n2) {
      var r2 = P2(t4), i = Je(), o = Vr(n2), s = Si(e2), u2 = IDBKeyRange.lowerBound(o, true);
      return s.$t({
        index: ur.readTimeIndex,
        range: u2
      }, function(t5, e3) {
        var n3 = Fr(r2.R, e3);
        i = i.insert(n3.key, n3), o = e3.readTime;
      }).next(function() {
        return {
          wn: i,
          readTime: qr(o)
        };
      });
    }(e.On, t3, e.$n);
  }).then(function(t3) {
    var n2 = t3.wn, r2 = t3.readTime;
    return e.$n = r2, n2;
  });
}
function Xi(t2) {
  return __awaiter(this, void 0, void 0, function() {
    var e;
    return __generator(this, function(n2) {
      return [2, (e = P2(t2)).persistence.runTransaction("Synchronize last document change read time", "readonly", function(t3) {
        return function(t4) {
          var e2 = Si(t4), n3 = j.min();
          return e2.$t({
            index: ur.readTimeIndex,
            reverse: true
          }, function(t5, e3, r2) {
            e3.readTime && (n3 = qr(e3.readTime)), r2.done();
          }).next(function() {
            return n3;
          });
        }(t3);
      }).then(function(t3) {
        e.$n = t3;
      })];
    });
  });
}
function Ji(t2, e, n2, r2) {
  return __awaiter(this, void 0, void 0, function() {
    var i, o, s, u2, a, c, h, f, l, d;
    return __generator(this, function(p2) {
      switch (p2.label) {
        case 0:
          for (i = P2(t2), o = on(), s = Je(), u2 = nn(), a = 0, c = n2; a < c.length; a++)
            h = c[a], f = e.qn(h.metadata.name), h.document && (o = o.add(f)), s = s.insert(f, e.Un(h)), u2 = u2.insert(f, e.Qn(h.metadata.readTime));
          return l = i.On.newChangeBuffer({
            trackRemovals: true
          }), [4, zi(i, function(t3) {
            return ee(Ht(W2.fromString("__bundle__/docs/" + t3)));
          }(r2))];
        case 1:
          return d = p2.sent(), [2, i.persistence.runTransaction("Apply bundle documents", "readwrite", function(t3) {
            return Gi(t3, l, s, j.min(), u2).next(function(e2) {
              return l.apply(t3), e2;
            }).next(function(e2) {
              return i.qe.removeMatchingKeysForTargetId(t3, d.targetId).next(function() {
                return i.qe.addMatchingKeys(t3, o, d.targetId);
              }).next(function() {
                return i.Mn.En(t3, e2);
              }).next(function() {
                return e2;
              });
            });
          })];
      }
    });
  });
}
function Zi(t2, e, n2) {
  return n2 === void 0 && (n2 = on()), __awaiter(this, void 0, void 0, function() {
    var r2, i;
    return __generator(this, function(o) {
      switch (o.label) {
        case 0:
          return [4, zi(t2, ee(Qr(e.bundledQuery)))];
        case 1:
          return r2 = o.sent(), [2, (i = P2(t2)).persistence.runTransaction("Save named query", "readwrite", function(t3) {
            var o2 = Tn(e.readTime);
            if (r2.snapshotVersion.compareTo(o2) >= 0)
              return i.Qe.saveNamedQuery(t3, e);
            var s = r2.withResumeToken(X2.EMPTY_BYTE_STRING, o2);
            return i.Fn = i.Fn.insert(s.targetId, s), i.qe.updateTargetData(t3, s).next(function() {
              return i.qe.removeMatchingKeysForTargetId(t3, r2.targetId);
            }).next(function() {
              return i.qe.addMatchingKeys(t3, n2, r2.targetId);
            }).next(function() {
              return i.Qe.saveNamedQuery(t3, e);
            });
          })];
      }
    });
  });
}
var to = function() {
  function t2(t3) {
    this.R = t3, this.Kn = new Map(), this.jn = new Map();
  }
  return t2.prototype.getBundleMetadata = function(t3, e) {
    return br.resolve(this.Kn.get(e));
  }, t2.prototype.saveBundleMetadata = function(t3, e) {
    var n2;
    return this.Kn.set(e.id, {
      id: (n2 = e).id,
      version: n2.version,
      createTime: Tn(n2.createTime)
    }), br.resolve();
  }, t2.prototype.getNamedQuery = function(t3, e) {
    return br.resolve(this.jn.get(e));
  }, t2.prototype.saveNamedQuery = function(t3, e) {
    return this.jn.set(e.name, function(t4) {
      return {
        name: t4.name,
        query: Qr(t4.bundledQuery),
        readTime: Tn(t4.readTime)
      };
    }(e)), br.resolve();
  }, t2;
}();
var eo = function() {
  function t2() {
    this.Wn = new Ye(no.Gn), this.zn = new Ye(no.Hn);
  }
  return t2.prototype.isEmpty = function() {
    return this.Wn.isEmpty();
  }, t2.prototype.addReference = function(t3, e) {
    var n2 = new no(t3, e);
    this.Wn = this.Wn.add(n2), this.zn = this.zn.add(n2);
  }, t2.prototype.Jn = function(t3, e) {
    var n2 = this;
    t3.forEach(function(t4) {
      return n2.addReference(t4, e);
    });
  }, t2.prototype.removeReference = function(t3, e) {
    this.Yn(new no(t3, e));
  }, t2.prototype.Xn = function(t3, e) {
    var n2 = this;
    t3.forEach(function(t4) {
      return n2.removeReference(t4, e);
    });
  }, t2.prototype.Zn = function(t3) {
    var e = this, n2 = new at(new W2([])), r2 = new no(n2, t3), i = new no(n2, t3 + 1), o = [];
    return this.zn.forEachInRange([r2, i], function(t4) {
      e.Yn(t4), o.push(t4.key);
    }), o;
  }, t2.prototype.ts = function() {
    var t3 = this;
    this.Wn.forEach(function(e) {
      return t3.Yn(e);
    });
  }, t2.prototype.Yn = function(t3) {
    this.Wn = this.Wn.delete(t3), this.zn = this.zn.delete(t3);
  }, t2.prototype.es = function(t3) {
    var e = new at(new W2([])), n2 = new no(e, t3), r2 = new no(e, t3 + 1), i = on();
    return this.zn.forEachInRange([n2, r2], function(t4) {
      i = i.add(t4.key);
    }), i;
  }, t2.prototype.containsKey = function(t3) {
    var e = new no(t3, 0), n2 = this.Wn.firstAfterOrEqual(e);
    return n2 !== null && t3.isEqual(n2.key);
  }, t2;
}();
var no = function() {
  function t2(t3, e) {
    this.key = t3, this.ns = e;
  }
  return t2.Gn = function(t3, e) {
    return at.comparator(t3.key, e.key) || V2(t3.ns, e.ns);
  }, t2.Hn = function(t3, e) {
    return V2(t3.ns, e.ns) || at.comparator(t3.key, e.key);
  }, t2;
}();
var ro = function() {
  function t2(t3, e) {
    this.Ut = t3, this.referenceDelegate = e, this._n = [], this.ss = 1, this.rs = new Ye(no.Gn);
  }
  return t2.prototype.checkEmpty = function(t3) {
    return br.resolve(this._n.length === 0);
  }, t2.prototype.addMutationBatch = function(t3, e, n2, r2) {
    var i = this.ss;
    this.ss++, this._n.length > 0 && this._n[this._n.length - 1];
    var o = new Rr(i, e, n2, r2);
    this._n.push(o);
    for (var s = 0, u2 = r2; s < u2.length; s++) {
      var a = u2[s];
      this.rs = this.rs.add(new no(a.key, i)), this.Ut.addToCollectionParentIndex(t3, a.key.path.popLast());
    }
    return br.resolve(o);
  }, t2.prototype.lookupMutationBatch = function(t3, e) {
    return br.resolve(this.os(e));
  }, t2.prototype.getNextMutationBatchAfterBatchId = function(t3, e) {
    var n2 = e + 1, r2 = this.cs(n2), i = r2 < 0 ? 0 : r2;
    return br.resolve(this._n.length > i ? this._n[i] : null);
  }, t2.prototype.getHighestUnacknowledgedBatchId = function() {
    return br.resolve(this._n.length === 0 ? -1 : this.ss - 1);
  }, t2.prototype.getAllMutationBatches = function(t3) {
    return br.resolve(this._n.slice());
  }, t2.prototype.getAllMutationBatchesAffectingDocumentKey = function(t3, e) {
    var n2 = this, r2 = new no(e, 0), i = new no(e, Number.POSITIVE_INFINITY), o = [];
    return this.rs.forEachInRange([r2, i], function(t4) {
      var e2 = n2.os(t4.ns);
      o.push(e2);
    }), br.resolve(o);
  }, t2.prototype.getAllMutationBatchesAffectingDocumentKeys = function(t3, e) {
    var n2 = this, r2 = new Ye(V2);
    return e.forEach(function(t4) {
      var e2 = new no(t4, 0), i = new no(t4, Number.POSITIVE_INFINITY);
      n2.rs.forEachInRange([e2, i], function(t5) {
        r2 = r2.add(t5.ns);
      });
    }), br.resolve(this.us(r2));
  }, t2.prototype.getAllMutationBatchesAffectingQuery = function(t3, e) {
    var n2 = e.path, r2 = n2.length + 1, i = n2;
    at.isDocumentKey(i) || (i = i.child(""));
    var o = new no(new at(i), 0), s = new Ye(V2);
    return this.rs.forEachWhile(function(t4) {
      var e2 = t4.key.path;
      return !!n2.isPrefixOf(e2) && (e2.length === r2 && (s = s.add(t4.ns)), true);
    }, o), br.resolve(this.us(s));
  }, t2.prototype.us = function(t3) {
    var e = this, n2 = [];
    return t3.forEach(function(t4) {
      var r2 = e.os(t4);
      r2 !== null && n2.push(r2);
    }), n2;
  }, t2.prototype.removeMutationBatch = function(t3, e) {
    var n2 = this;
    O2(this.hs(e.batchId, "removed") === 0), this._n.shift();
    var r2 = this.rs;
    return br.forEach(e.mutations, function(i) {
      var o = new no(i.key, e.batchId);
      return r2 = r2.delete(o), n2.referenceDelegate.markPotentiallyOrphaned(t3, i.key);
    }).next(function() {
      n2.rs = r2;
    });
  }, t2.prototype.Gt = function(t3) {
  }, t2.prototype.containsKey = function(t3, e) {
    var n2 = new no(e, 0), r2 = this.rs.firstAfterOrEqual(n2);
    return br.resolve(e.isEqual(r2 && r2.key));
  }, t2.prototype.performConsistencyCheck = function(t3) {
    return this._n.length, br.resolve();
  }, t2.prototype.hs = function(t3, e) {
    return this.cs(t3);
  }, t2.prototype.cs = function(t3) {
    return this._n.length === 0 ? 0 : t3 - this._n[0].batchId;
  }, t2.prototype.os = function(t3) {
    var e = this.cs(t3);
    return e < 0 || e >= this._n.length ? null : this._n[e];
  }, t2;
}();
var io = function() {
  function t2(t3, e) {
    this.Ut = t3, this.ls = e, this.docs = new ze(at.comparator), this.size = 0;
  }
  return t2.prototype.addEntry = function(t3, e, n2) {
    var r2 = e.key, i = this.docs.get(r2), o = i ? i.size : 0, s = this.ls(e);
    return this.docs = this.docs.insert(r2, {
      document: e.clone(),
      size: s,
      readTime: n2
    }), this.size += s - o, this.Ut.addToCollectionParentIndex(t3, r2.path.popLast());
  }, t2.prototype.removeEntry = function(t3) {
    var e = this.docs.get(t3);
    e && (this.docs = this.docs.remove(t3), this.size -= e.size);
  }, t2.prototype.getEntry = function(t3, e) {
    var n2 = this.docs.get(e);
    return br.resolve(n2 ? n2.document.clone() : St.newInvalidDocument(e));
  }, t2.prototype.getEntries = function(t3, e) {
    var n2 = this, r2 = Je();
    return e.forEach(function(t4) {
      var e2 = n2.docs.get(t4);
      r2 = r2.insert(t4, e2 ? e2.document.clone() : St.newInvalidDocument(t4));
    }), br.resolve(r2);
  }, t2.prototype.getDocumentsMatchingQuery = function(t3, e, n2) {
    for (var r2 = Je(), i = new at(e.path.child("")), o = this.docs.getIteratorFrom(i); o.hasNext(); ) {
      var s = o.getNext(), u2 = s.key, a = s.value, c = a.document, h = a.readTime;
      if (!e.path.isPrefixOf(u2.path))
        break;
      h.compareTo(n2) <= 0 || se(e, c) && (r2 = r2.insert(c.key, c.clone()));
    }
    return br.resolve(r2);
  }, t2.prototype.fs = function(t3, e) {
    return br.forEach(this.docs, function(t4) {
      return e(t4);
    });
  }, t2.prototype.newChangeBuffer = function(t3) {
    return new oo(this);
  }, t2.prototype.getSize = function(t3) {
    return br.resolve(this.size);
  }, t2;
}();
var oo = function(t2) {
  function e(e2) {
    var n2 = this;
    return (n2 = t2.call(this) || this).Ie = e2, n2;
  }
  return __extends(e, t2), e.prototype.applyChanges = function(t3) {
    var e2 = this, n2 = [];
    return this.changes.forEach(function(r2, i) {
      i.document.isValidDocument() ? n2.push(e2.Ie.addEntry(t3, i.document, e2.getReadTime(r2))) : e2.Ie.removeEntry(r2);
    }), br.waitFor(n2);
  }, e.prototype.getFromCache = function(t3, e2) {
    return this.Ie.getEntry(t3, e2);
  }, e.prototype.getAllFromCache = function(t3, e2) {
    return this.Ie.getEntries(t3, e2);
  }, e;
}(Ii);
var so = function() {
  function t2(t3) {
    this.persistence = t3, this.ds = new bi(function(t4) {
      return At(t4);
    }, kt), this.lastRemoteSnapshotVersion = j.min(), this.highestTargetId = 0, this.ws = 0, this._s = new eo(), this.targetCount = 0, this.ys = ai.Jt();
  }
  return t2.prototype.forEachTarget = function(t3, e) {
    return this.ds.forEach(function(t4, n2) {
      return e(n2);
    }), br.resolve();
  }, t2.prototype.getLastRemoteSnapshotVersion = function(t3) {
    return br.resolve(this.lastRemoteSnapshotVersion);
  }, t2.prototype.getHighestSequenceNumber = function(t3) {
    return br.resolve(this.ws);
  }, t2.prototype.allocateTargetId = function(t3) {
    return this.highestTargetId = this.ys.next(), br.resolve(this.highestTargetId);
  }, t2.prototype.setTargetsMetadata = function(t3, e, n2) {
    return n2 && (this.lastRemoteSnapshotVersion = n2), e > this.ws && (this.ws = e), br.resolve();
  }, t2.prototype.te = function(t3) {
    this.ds.set(t3.target, t3);
    var e = t3.targetId;
    e > this.highestTargetId && (this.ys = new ai(e), this.highestTargetId = e), t3.sequenceNumber > this.ws && (this.ws = t3.sequenceNumber);
  }, t2.prototype.addTargetData = function(t3, e) {
    return this.te(e), this.targetCount += 1, br.resolve();
  }, t2.prototype.updateTargetData = function(t3, e) {
    return this.te(e), br.resolve();
  }, t2.prototype.removeTargetData = function(t3, e) {
    return this.ds.delete(e.target), this._s.Zn(e.targetId), this.targetCount -= 1, br.resolve();
  }, t2.prototype.removeTargets = function(t3, e, n2) {
    var r2 = this, i = 0, o = [];
    return this.ds.forEach(function(s, u2) {
      u2.sequenceNumber <= e && n2.get(u2.targetId) === null && (r2.ds.delete(s), o.push(r2.removeMatchingKeysForTargetId(t3, u2.targetId)), i++);
    }), br.waitFor(o).next(function() {
      return i;
    });
  }, t2.prototype.getTargetCount = function(t3) {
    return br.resolve(this.targetCount);
  }, t2.prototype.getTargetData = function(t3, e) {
    var n2 = this.ds.get(e) || null;
    return br.resolve(n2);
  }, t2.prototype.addMatchingKeys = function(t3, e, n2) {
    return this._s.Jn(e, n2), br.resolve();
  }, t2.prototype.removeMatchingKeys = function(t3, e, n2) {
    this._s.Xn(e, n2);
    var r2 = this.persistence.referenceDelegate, i = [];
    return r2 && e.forEach(function(e2) {
      i.push(r2.markPotentiallyOrphaned(t3, e2));
    }), br.waitFor(i);
  }, t2.prototype.removeMatchingKeysForTargetId = function(t3, e) {
    return this._s.Zn(e), br.resolve();
  }, t2.prototype.getMatchingKeysForTargetId = function(t3, e) {
    var n2 = this._s.es(e);
    return br.resolve(n2);
  }, t2.prototype.containsKey = function(t3, e) {
    return br.resolve(this._s.containsKey(e));
  }, t2;
}();
var uo = function() {
  function t2(t3, e) {
    var n2 = this;
    this.gs = {}, this.Ne = new _(0), this.xe = false, this.xe = true, this.referenceDelegate = t3(this), this.qe = new so(this), this.Ut = new Yr(), this.Ue = function(t4, e2) {
      return new io(t4, function(t5) {
        return n2.referenceDelegate.ps(t5);
      });
    }(this.Ut), this.R = new Pr(e), this.Qe = new to(this.R);
  }
  return t2.prototype.start = function() {
    return Promise.resolve();
  }, t2.prototype.shutdown = function() {
    return this.xe = false, Promise.resolve();
  }, Object.defineProperty(t2.prototype, "started", {
    get: function() {
      return this.xe;
    },
    enumerable: false,
    configurable: true
  }), t2.prototype.setDatabaseDeletedListener = function() {
  }, t2.prototype.setNetworkEnabled = function() {
  }, t2.prototype.getIndexManager = function() {
    return this.Ut;
  }, t2.prototype.getMutationQueue = function(t3) {
    var e = this.gs[t3.toKey()];
    return e || (e = new ro(this.Ut, this.referenceDelegate), this.gs[t3.toKey()] = e), e;
  }, t2.prototype.getTargetCache = function() {
    return this.qe;
  }, t2.prototype.getRemoteDocumentCache = function() {
    return this.Ue;
  }, t2.prototype.getBundleCache = function() {
    return this.Qe;
  }, t2.prototype.runTransaction = function(t3, e, n2) {
    var r2 = this;
    k2("MemoryPersistence", "Starting transaction:", t3);
    var i = new ao(this.Ne.next());
    return this.referenceDelegate.Es(), n2(i).next(function(t4) {
      return r2.referenceDelegate.Ts(i).next(function() {
        return t4;
      });
    }).toPromise().then(function(t4) {
      return i.raiseOnCommittedEvent(), t4;
    });
  }, t2.prototype.Is = function(t3, e) {
    return br.or(Object.values(this.gs).map(function(n2) {
      return function() {
        return n2.containsKey(t3, e);
      };
    }));
  }, t2;
}();
var ao = function(t2) {
  function e(e2) {
    var n2 = this;
    return (n2 = t2.call(this) || this).currentSequenceNumber = e2, n2;
  }
  return __extends(e, t2), e;
}(gr);
var co = function() {
  function t2(t3) {
    this.persistence = t3, this.As = new eo(), this.Rs = null;
  }
  return t2.bs = function(e) {
    return new t2(e);
  }, Object.defineProperty(t2.prototype, "vs", {
    get: function() {
      if (this.Rs)
        return this.Rs;
      throw L2();
    },
    enumerable: false,
    configurable: true
  }), t2.prototype.addReference = function(t3, e, n2) {
    return this.As.addReference(n2, e), this.vs.delete(n2.toString()), br.resolve();
  }, t2.prototype.removeReference = function(t3, e, n2) {
    return this.As.removeReference(n2, e), this.vs.add(n2.toString()), br.resolve();
  }, t2.prototype.markPotentiallyOrphaned = function(t3, e) {
    return this.vs.add(e.toString()), br.resolve();
  }, t2.prototype.removeTarget = function(t3, e) {
    var n2 = this;
    this.As.Zn(e.targetId).forEach(function(t4) {
      return n2.vs.add(t4.toString());
    });
    var r2 = this.persistence.getTargetCache();
    return r2.getMatchingKeysForTargetId(t3, e.targetId).next(function(t4) {
      t4.forEach(function(t5) {
        return n2.vs.add(t5.toString());
      });
    }).next(function() {
      return r2.removeTargetData(t3, e);
    });
  }, t2.prototype.Es = function() {
    this.Rs = new Set();
  }, t2.prototype.Ts = function(t3) {
    var e = this, n2 = this.persistence.getRemoteDocumentCache().newChangeBuffer();
    return br.forEach(this.vs, function(r2) {
      var i = at.fromPath(r2);
      return e.Ps(t3, i).next(function(t4) {
        t4 || n2.removeEntry(i);
      });
    }).next(function() {
      return e.Rs = null, n2.apply(t3);
    });
  }, t2.prototype.updateLimboDocument = function(t3, e) {
    var n2 = this;
    return this.Ps(t3, e).next(function(t4) {
      t4 ? n2.vs.delete(e.toString()) : n2.vs.add(e.toString());
    });
  }, t2.prototype.ps = function(t3) {
    return 0;
  }, t2.prototype.Ps = function(t3, e) {
    var n2 = this;
    return br.or([function() {
      return br.resolve(n2.As.containsKey(e));
    }, function() {
      return n2.persistence.getTargetCache().containsKey(t3, e);
    }, function() {
      return n2.persistence.Is(t3, e);
    }]);
  }, t2;
}();
var ho = function() {
  function t2(t3) {
    this.uid = t3;
  }
  return t2.prototype.isAuthenticated = function() {
    return this.uid != null;
  }, t2.prototype.toKey = function() {
    return this.isAuthenticated() ? "uid:" + this.uid : "anonymous-user";
  }, t2.prototype.isEqual = function(t3) {
    return t3.uid === this.uid;
  }, t2;
}();
function fo(t2, e) {
  return "firestore_clients_" + t2 + "_" + e;
}
function lo(t2, e, n2) {
  var r2 = "firestore_mutations_" + t2 + "_" + n2;
  return e.isAuthenticated() && (r2 += "_" + e.uid), r2;
}
function po(t2, e) {
  return "firestore_targets_" + t2 + "_" + e;
}
ho.UNAUTHENTICATED = new ho(null), ho.GOOGLE_CREDENTIALS = new ho("google-credentials-uid"), ho.FIRST_PARTY = new ho("first-party-uid");
var yo = function() {
  function t2(t3, e, n2, r2) {
    this.user = t3, this.batchId = e, this.state = n2, this.error = r2;
  }
  return t2.Vs = function(e, n2, r2) {
    var i, o = JSON.parse(r2), s = typeof o == "object" && ["pending", "acknowledged", "rejected"].indexOf(o.state) !== -1 && (o.error === void 0 || typeof o.error == "object");
    return s && o.error && ((s = typeof o.error.message == "string" && typeof o.error.code == "string") && (i = new N2(o.error.code, o.error.message))), s ? new t2(e, n2, o.state, i) : (C("SharedClientState", "Failed to parse mutation state for ID '" + n2 + "': " + r2), null);
  }, t2.prototype.Ss = function() {
    var t3 = {
      state: this.state,
      updateTimeMs: Date.now()
    };
    return this.error && (t3.error = {
      code: this.error.code,
      message: this.error.message
    }), JSON.stringify(t3);
  }, t2;
}();
var vo = function() {
  function t2(t3, e, n2) {
    this.targetId = t3, this.state = e, this.error = n2;
  }
  return t2.Vs = function(e, n2) {
    var r2, i = JSON.parse(n2), o = typeof i == "object" && ["not-current", "current", "rejected"].indexOf(i.state) !== -1 && (i.error === void 0 || typeof i.error == "object");
    return o && i.error && ((o = typeof i.error.message == "string" && typeof i.error.code == "string") && (r2 = new N2(i.error.code, i.error.message))), o ? new t2(e, i.state, r2) : (C("SharedClientState", "Failed to parse target state for ID '" + e + "': " + n2), null);
  }, t2.prototype.Ss = function() {
    var t3 = {
      state: this.state,
      updateTimeMs: Date.now()
    };
    return this.error && (t3.error = {
      code: this.error.code,
      message: this.error.message
    }), JSON.stringify(t3);
  }, t2;
}();
var mo = function() {
  function t2(t3, e) {
    this.clientId = t3, this.activeTargetIds = e;
  }
  return t2.Vs = function(e, n2) {
    for (var r2 = JSON.parse(n2), i = typeof r2 == "object" && r2.activeTargetIds instanceof Array, o = un(), s = 0; i && s < r2.activeTargetIds.length; ++s)
      i = ut(r2.activeTargetIds[s]), o = o.add(r2.activeTargetIds[s]);
    return i ? new t2(e, o) : (C("SharedClientState", "Failed to parse client data for instance '" + e + "': " + n2), null);
  }, t2;
}();
var go = function() {
  function t2(t3, e) {
    this.clientId = t3, this.onlineState = e;
  }
  return t2.Vs = function(e) {
    var n2 = JSON.parse(e);
    return typeof n2 == "object" && ["Unknown", "Online", "Offline"].indexOf(n2.onlineState) !== -1 && typeof n2.clientId == "string" ? new t2(n2.clientId, n2.onlineState) : (C("SharedClientState", "Failed to parse online state: " + e), null);
  }, t2;
}();
var wo = function() {
  function t2() {
    this.activeTargetIds = un();
  }
  return t2.prototype.Ds = function(t3) {
    this.activeTargetIds = this.activeTargetIds.add(t3);
  }, t2.prototype.Cs = function(t3) {
    this.activeTargetIds = this.activeTargetIds.delete(t3);
  }, t2.prototype.Ss = function() {
    var t3 = {
      activeTargetIds: this.activeTargetIds.toArray(),
      updateTimeMs: Date.now()
    };
    return JSON.stringify(t3);
  }, t2;
}();
var bo = function() {
  function t2(t3, e, n2, r2, i) {
    this.window = t3, this.Se = e, this.persistenceKey = n2, this.Ns = r2, this.syncEngine = null, this.onlineStateHandler = null, this.sequenceNumberHandler = null, this.xs = this.Fs.bind(this), this.ks = new ze(V2), this.started = false, this.$s = [];
    var o = n2.replace(/[.*+?^${}()|[\]\\]/g, "\\$&");
    this.storage = this.window.localStorage, this.currentUser = i, this.Os = fo(this.persistenceKey, this.Ns), this.Ms = function(t4) {
      return "firestore_sequence_number_" + t4;
    }(this.persistenceKey), this.ks = this.ks.insert(this.Ns, new wo()), this.Ls = new RegExp("^firestore_clients_" + o + "_([^_]*)$"), this.Bs = new RegExp("^firestore_mutations_" + o + "_(\\d+)(?:_(.*))?$"), this.qs = new RegExp("^firestore_targets_" + o + "_(\\d+)$"), this.Us = function(t4) {
      return "firestore_online_state_" + t4;
    }(this.persistenceKey), this.Qs = function(t4) {
      return "firestore_bundle_loaded_" + t4;
    }(this.persistenceKey), this.window.addEventListener("storage", this.xs);
  }
  return t2.yt = function(t3) {
    return !(!t3 || !t3.localStorage);
  }, t2.prototype.start = function() {
    return __awaiter(this, void 0, void 0, function() {
      var t3, e, n2, r2, i, o, s, u2, a, c, h, f = this;
      return __generator(this, function(l) {
        switch (l.label) {
          case 0:
            return [4, this.syncEngine.fn()];
          case 1:
            for (t3 = l.sent(), e = 0, n2 = t3; e < n2.length; e++)
              (r2 = n2[e]) !== this.Ns && (i = this.getItem(fo(this.persistenceKey, r2))) && (o = mo.Vs(r2, i)) && (this.ks = this.ks.insert(o.clientId, o));
            for (this.Ks(), (s = this.storage.getItem(this.Us)) && (u2 = this.js(s)) && this.Ws(u2), a = 0, c = this.$s; a < c.length; a++)
              h = c[a], this.Fs(h);
            return this.$s = [], this.window.addEventListener("pagehide", function() {
              return f.shutdown();
            }), this.started = true, [2];
        }
      });
    });
  }, t2.prototype.writeSequenceNumber = function(t3) {
    this.setItem(this.Ms, JSON.stringify(t3));
  }, t2.prototype.getAllActiveQueryTargets = function() {
    return this.Gs(this.ks);
  }, t2.prototype.isActiveQueryTarget = function(t3) {
    var e = false;
    return this.ks.forEach(function(n2, r2) {
      r2.activeTargetIds.has(t3) && (e = true);
    }), e;
  }, t2.prototype.addPendingMutation = function(t3) {
    this.zs(t3, "pending");
  }, t2.prototype.updateMutationState = function(t3, e, n2) {
    this.zs(t3, e, n2), this.Hs(t3);
  }, t2.prototype.addLocalQueryTarget = function(t3) {
    var e = "not-current";
    if (this.isActiveQueryTarget(t3)) {
      var n2 = this.storage.getItem(po(this.persistenceKey, t3));
      if (n2) {
        var r2 = vo.Vs(t3, n2);
        r2 && (e = r2.state);
      }
    }
    return this.Js.Ds(t3), this.Ks(), e;
  }, t2.prototype.removeLocalQueryTarget = function(t3) {
    this.Js.Cs(t3), this.Ks();
  }, t2.prototype.isLocalQueryTarget = function(t3) {
    return this.Js.activeTargetIds.has(t3);
  }, t2.prototype.clearQueryState = function(t3) {
    this.removeItem(po(this.persistenceKey, t3));
  }, t2.prototype.updateQueryState = function(t3, e, n2) {
    this.Ys(t3, e, n2);
  }, t2.prototype.handleUserChange = function(t3, e, n2) {
    var r2 = this;
    e.forEach(function(t4) {
      r2.Hs(t4);
    }), this.currentUser = t3, n2.forEach(function(t4) {
      r2.addPendingMutation(t4);
    });
  }, t2.prototype.setOnlineState = function(t3) {
    this.Xs(t3);
  }, t2.prototype.notifyBundleLoaded = function() {
    this.Zs();
  }, t2.prototype.shutdown = function() {
    this.started && (this.window.removeEventListener("storage", this.xs), this.removeItem(this.Os), this.started = false);
  }, t2.prototype.getItem = function(t3) {
    var e = this.storage.getItem(t3);
    return k2("SharedClientState", "READ", t3, e), e;
  }, t2.prototype.setItem = function(t3, e) {
    k2("SharedClientState", "SET", t3, e), this.storage.setItem(t3, e);
  }, t2.prototype.removeItem = function(t3) {
    k2("SharedClientState", "REMOVE", t3), this.storage.removeItem(t3);
  }, t2.prototype.Fs = function(t3) {
    var e = this, n2 = t3;
    if (n2.storageArea === this.storage) {
      if (k2("SharedClientState", "EVENT", n2.key, n2.newValue), n2.key === this.Os)
        return void C("Received WebStorage notification for local change. Another client might have garbage-collected our state");
      this.Se.enqueueRetryable(function() {
        return __awaiter(e, void 0, void 0, function() {
          var t4, e2, r2, i, o, s;
          return __generator(this, function(u2) {
            if (this.started) {
              if (n2.key !== null) {
                if (this.Ls.test(n2.key)) {
                  if (n2.newValue == null)
                    return t4 = this.ti(n2.key), [2, this.ei(t4, null)];
                  if (e2 = this.ni(n2.key, n2.newValue))
                    return [2, this.ei(e2.clientId, e2)];
                } else if (this.Bs.test(n2.key)) {
                  if (n2.newValue !== null && (r2 = this.si(n2.key, n2.newValue)))
                    return [2, this.ii(r2)];
                } else if (this.qs.test(n2.key)) {
                  if (n2.newValue !== null && (i = this.ri(n2.key, n2.newValue)))
                    return [2, this.oi(i)];
                } else if (n2.key === this.Us) {
                  if (n2.newValue !== null && (o = this.js(n2.newValue)))
                    return [2, this.Ws(o)];
                } else if (n2.key === this.Ms)
                  (s = function(t5) {
                    var e3 = _.o;
                    if (t5 != null)
                      try {
                        var n3 = JSON.parse(t5);
                        O2(typeof n3 == "number"), e3 = n3;
                      } catch (t6) {
                        C("SharedClientState", "Failed to read sequence number from WebStorage", t6);
                      }
                    return e3;
                  }(n2.newValue)) !== _.o && this.sequenceNumberHandler(s);
                else if (n2.key === this.Qs)
                  return [2, this.syncEngine.ci()];
              }
            } else
              this.$s.push(n2);
            return [2];
          });
        });
      });
    }
  }, Object.defineProperty(t2.prototype, "Js", {
    get: function() {
      return this.ks.get(this.Ns);
    },
    enumerable: false,
    configurable: true
  }), t2.prototype.Ks = function() {
    this.setItem(this.Os, this.Js.Ss());
  }, t2.prototype.zs = function(t3, e, n2) {
    var r2 = new yo(this.currentUser, t3, e, n2), i = lo(this.persistenceKey, this.currentUser, t3);
    this.setItem(i, r2.Ss());
  }, t2.prototype.Hs = function(t3) {
    var e = lo(this.persistenceKey, this.currentUser, t3);
    this.removeItem(e);
  }, t2.prototype.Xs = function(t3) {
    var e = {
      clientId: this.Ns,
      onlineState: t3
    };
    this.storage.setItem(this.Us, JSON.stringify(e));
  }, t2.prototype.Ys = function(t3, e, n2) {
    var r2 = po(this.persistenceKey, t3), i = new vo(t3, e, n2);
    this.setItem(r2, i.Ss());
  }, t2.prototype.Zs = function() {
    this.setItem(this.Qs, "value-not-used");
  }, t2.prototype.ti = function(t3) {
    var e = this.Ls.exec(t3);
    return e ? e[1] : null;
  }, t2.prototype.ni = function(t3, e) {
    var n2 = this.ti(t3);
    return mo.Vs(n2, e);
  }, t2.prototype.si = function(t3, e) {
    var n2 = this.Bs.exec(t3), r2 = Number(n2[1]), i = n2[2] !== void 0 ? n2[2] : null;
    return yo.Vs(new ho(i), r2, e);
  }, t2.prototype.ri = function(t3, e) {
    var n2 = this.qs.exec(t3), r2 = Number(n2[1]);
    return vo.Vs(r2, e);
  }, t2.prototype.js = function(t3) {
    return go.Vs(t3);
  }, t2.prototype.ii = function(t3) {
    return __awaiter(this, void 0, void 0, function() {
      return __generator(this, function(e) {
        return t3.user.uid === this.currentUser.uid ? [2, this.syncEngine.ui(t3.batchId, t3.state, t3.error)] : (k2("SharedClientState", "Ignoring mutation for non-active user " + t3.user.uid), [2]);
      });
    });
  }, t2.prototype.oi = function(t3) {
    return this.syncEngine.ai(t3.targetId, t3.state, t3.error);
  }, t2.prototype.ei = function(t3, e) {
    var n2 = this, r2 = e ? this.ks.insert(t3, e) : this.ks.remove(t3), i = this.Gs(this.ks), o = this.Gs(r2), s = [], u2 = [];
    return o.forEach(function(t4) {
      i.has(t4) || s.push(t4);
    }), i.forEach(function(t4) {
      o.has(t4) || u2.push(t4);
    }), this.syncEngine.hi(s, u2).then(function() {
      n2.ks = r2;
    });
  }, t2.prototype.Ws = function(t3) {
    this.ks.get(t3.clientId) && this.onlineStateHandler(t3.onlineState);
  }, t2.prototype.Gs = function(t3) {
    var e = un();
    return t3.forEach(function(t4, n2) {
      e = e.unionWith(n2.activeTargetIds);
    }), e;
  }, t2;
}();
var Io = function() {
  function t2() {
    this.li = new wo(), this.fi = {}, this.onlineStateHandler = null, this.sequenceNumberHandler = null;
  }
  return t2.prototype.addPendingMutation = function(t3) {
  }, t2.prototype.updateMutationState = function(t3, e, n2) {
  }, t2.prototype.addLocalQueryTarget = function(t3) {
    return this.li.Ds(t3), this.fi[t3] || "not-current";
  }, t2.prototype.updateQueryState = function(t3, e, n2) {
    this.fi[t3] = e;
  }, t2.prototype.removeLocalQueryTarget = function(t3) {
    this.li.Cs(t3);
  }, t2.prototype.isLocalQueryTarget = function(t3) {
    return this.li.activeTargetIds.has(t3);
  }, t2.prototype.clearQueryState = function(t3) {
    delete this.fi[t3];
  }, t2.prototype.getAllActiveQueryTargets = function() {
    return this.li.activeTargetIds;
  }, t2.prototype.isActiveQueryTarget = function(t3) {
    return this.li.activeTargetIds.has(t3);
  }, t2.prototype.start = function() {
    return this.li = new wo(), Promise.resolve();
  }, t2.prototype.handleUserChange = function(t3, e, n2) {
  }, t2.prototype.setOnlineState = function(t3) {
  }, t2.prototype.shutdown = function() {
  }, t2.prototype.writeSequenceNumber = function(t3) {
  }, t2.prototype.notifyBundleLoaded = function() {
  }, t2;
}();
var Eo = function() {
  function t2() {
  }
  return t2.prototype.di = function(t3) {
  }, t2.prototype.shutdown = function() {
  }, t2;
}();
var To = function() {
  function t2() {
    var t3 = this;
    this.wi = function() {
      return t3._i();
    }, this.mi = function() {
      return t3.yi();
    }, this.gi = [], this.pi();
  }
  return t2.prototype.di = function(t3) {
    this.gi.push(t3);
  }, t2.prototype.shutdown = function() {
    window.removeEventListener("online", this.wi), window.removeEventListener("offline", this.mi);
  }, t2.prototype.pi = function() {
    window.addEventListener("online", this.wi), window.addEventListener("offline", this.mi);
  }, t2.prototype._i = function() {
    k2("ConnectivityMonitor", "Network connectivity changed: AVAILABLE");
    for (var t3 = 0, e = this.gi; t3 < e.length; t3++) {
      (0, e[t3])(0);
    }
  }, t2.prototype.yi = function() {
    k2("ConnectivityMonitor", "Network connectivity changed: UNAVAILABLE");
    for (var t3 = 0, e = this.gi; t3 < e.length; t3++) {
      (0, e[t3])(1);
    }
  }, t2.yt = function() {
    return typeof window != "undefined" && window.addEventListener !== void 0 && window.removeEventListener !== void 0;
  }, t2;
}();
var _o = {
  BatchGetDocuments: "batchGet",
  Commit: "commit",
  RunQuery: "runQuery"
};
var So = function() {
  function t2(t3) {
    this.Ei = t3.Ei, this.Ti = t3.Ti;
  }
  return t2.prototype.Ii = function(t3) {
    this.Ai = t3;
  }, t2.prototype.Ri = function(t3) {
    this.bi = t3;
  }, t2.prototype.onMessage = function(t3) {
    this.vi = t3;
  }, t2.prototype.close = function() {
    this.Ti();
  }, t2.prototype.send = function(t3) {
    this.Ei(t3);
  }, t2.prototype.Pi = function() {
    this.Ai();
  }, t2.prototype.Vi = function(t3) {
    this.bi(t3);
  }, t2.prototype.Si = function(t3) {
    this.vi(t3);
  }, t2;
}();
var No = function(t2) {
  function u2(e) {
    var n2 = this;
    return (n2 = t2.call(this, e) || this).forceLongPolling = e.forceLongPolling, n2.autoDetectLongPolling = e.autoDetectLongPolling, n2.useFetchStreams = e.useFetchStreams, n2;
  }
  return __extends(u2, t2), u2.prototype.ki = function(t3, e, n2, r2) {
    return new Promise(function(i, o) {
      var s = new XhrIo();
      s.listenOnce(EventType.COMPLETE, function() {
        try {
          switch (s.getLastErrorCode()) {
            case ErrorCode.NO_ERROR:
              var e2 = s.getResponseJson();
              k2("Connection", "XHR received:", JSON.stringify(e2)), i(e2);
              break;
            case ErrorCode.TIMEOUT:
              k2("Connection", 'RPC "' + t3 + '" timed out'), o(new N2(S2.DEADLINE_EXCEEDED, "Request time out"));
              break;
            case ErrorCode.HTTP_ERROR:
              var n3 = s.getStatus();
              if (k2("Connection", 'RPC "' + t3 + '" failed with status:', n3, "response text:", s.getResponseText()), n3 > 0) {
                var r3 = s.getResponseJson().error;
                if (r3 && r3.status && r3.message) {
                  var u4 = function(t4) {
                    var e3 = t4.toLowerCase().replace(/_/g, "-");
                    return Object.values(S2).indexOf(e3) >= 0 ? e3 : S2.UNKNOWN;
                  }(r3.status);
                  o(new N2(u4, r3.message));
                } else
                  o(new N2(S2.UNKNOWN, "Server responded with status " + s.getStatus()));
              } else
                o(new N2(S2.UNAVAILABLE, "Connection failed."));
              break;
            default:
              L2();
          }
        } finally {
          k2("Connection", 'RPC "' + t3 + '" completed.');
        }
      });
      var u3 = JSON.stringify(r2);
      s.send(e, "POST", u3, n2, 15);
    });
  }, u2.prototype.Oi = function(t3, u3) {
    var a = [this.Di, "/", "google.firestore.v1.Firestore", "/", t3, "/channel"], c = createWebChannelTransport(), h = getStatEventTarget(), f = {
      httpSessionIdParam: "gsessionid",
      initMessageHeaders: {},
      messageUrlParams: {
        database: "projects/" + this.databaseId.projectId + "/databases/" + this.databaseId.database
      },
      sendRawJson: true,
      supportsCrossDomainXhr: true,
      internalChannelParams: {
        forwardChannelRequestTimeoutMs: 6e5
      },
      forceLongPolling: this.forceLongPolling,
      detectBufferingProxy: this.autoDetectLongPolling
    };
    this.useFetchStreams && (f.xmlHttpFactory = new FetchXmlHttpFactory({})), this.Fi(f.initMessageHeaders, u3), isMobileCordova() || isReactNative() || isElectron() || isIE() || isUWP() || isBrowserExtension() || (f.httpHeadersOverwriteParam = "$httpHeaders");
    var l = a.join("");
    k2("Connection", "Creating WebChannel: " + l, f);
    var d = c.createWebChannel(l, f), b = false, I3 = false, E2 = new So({
      Ei: function(t4) {
        I3 ? k2("Connection", "Not sending because WebChannel is closed:", t4) : (b || (k2("Connection", "Opening WebChannel transport."), d.open(), b = true), k2("Connection", "WebChannel sending:", t4), d.send(t4));
      },
      Ti: function() {
        return d.close();
      }
    }), T2 = function(t4, e, n2) {
      t4.listen(e, function(t5) {
        try {
          n2(t5);
        } catch (t6) {
          setTimeout(function() {
            throw t6;
          }, 0);
        }
      });
    };
    return T2(d, WebChannel.EventType.OPEN, function() {
      I3 || k2("Connection", "WebChannel transport opened.");
    }), T2(d, WebChannel.EventType.CLOSE, function() {
      I3 || (I3 = true, k2("Connection", "WebChannel transport closed"), E2.Vi());
    }), T2(d, WebChannel.EventType.ERROR, function(t4) {
      I3 || (I3 = true, x2("Connection", "WebChannel transport errored:", t4), E2.Vi(new N2(S2.UNAVAILABLE, "The operation could not be completed")));
    }), T2(d, WebChannel.EventType.MESSAGE, function(t4) {
      var e;
      if (!I3) {
        var n2 = t4.data[0];
        O2(!!n2);
        var r2 = n2, i = r2.error || ((e = r2[0]) === null || e === void 0 ? void 0 : e.error);
        if (i) {
          k2("Connection", "WebChannel received error:", i);
          var o = i.status, s = function(t5) {
            var e2 = qe[t5];
            if (e2 !== void 0)
              return Qe(e2);
          }(o), u4 = i.message;
          s === void 0 && (s = S2.INTERNAL, u4 = "Unknown error status: " + o + " with message " + i.message), I3 = true, E2.Vi(new N2(s, u4)), d.close();
        } else
          k2("Connection", "WebChannel received:", n2), E2.Si(n2);
      }
    }), T2(h, Event.STAT_EVENT, function(t4) {
      t4.stat === Stat.PROXY ? k2("Connection", "Detected buffering proxy") : t4.stat === Stat.NOPROXY && k2("Connection", "Detected no buffering proxy");
    }), setTimeout(function() {
      E2.Pi();
    }, 0), E2;
  }, u2;
}(function() {
  function t2(t3) {
    this.databaseInfo = t3, this.databaseId = t3.databaseId;
    var e = t3.ssl ? "https" : "http";
    this.Di = e + "://" + t3.host, this.Ci = "projects/" + this.databaseId.projectId + "/databases/" + this.databaseId.database + "/documents";
  }
  return t2.prototype.Ni = function(t3, e, n2, r2) {
    var i = this.xi(t3, e);
    k2("RestConnection", "Sending: ", i, n2);
    var o = {};
    return this.Fi(o, r2), this.ki(t3, i, o, n2).then(function(t4) {
      return k2("RestConnection", "Received: ", t4), t4;
    }, function(e2) {
      throw x2("RestConnection", t3 + " failed with error: ", e2, "url: ", i, "request:", n2), e2;
    });
  }, t2.prototype.$i = function(t3, e, n2, r2) {
    return this.Ni(t3, e, n2, r2);
  }, t2.prototype.Fi = function(t3, e) {
    if (t3["X-Goog-Api-Client"] = "gl-js/ fire/8.6.7", t3["Content-Type"] = "text/plain", this.databaseInfo.appId && (t3["X-Firebase-GMPID"] = this.databaseInfo.appId), e)
      for (var n2 in e.authHeaders)
        e.authHeaders.hasOwnProperty(n2) && (t3[n2] = e.authHeaders[n2]);
  }, t2.prototype.xi = function(t3, e) {
    var n2 = _o[t3];
    return this.Di + "/v1/" + e + ":" + n2;
  }, t2;
}());
function Do() {
  return typeof window != "undefined" ? window : null;
}
function Ao() {
  return typeof document != "undefined" ? document : null;
}
function ko(t2) {
  return new wn(t2, true);
}
var Co = function() {
  function t2(t3, e, n2, r2, i) {
    n2 === void 0 && (n2 = 1e3), r2 === void 0 && (r2 = 1.5), i === void 0 && (i = 6e4), this.Se = t3, this.timerId = e, this.Mi = n2, this.Li = r2, this.Bi = i, this.qi = 0, this.Ui = null, this.Qi = Date.now(), this.reset();
  }
  return t2.prototype.reset = function() {
    this.qi = 0;
  }, t2.prototype.Ki = function() {
    this.qi = this.Bi;
  }, t2.prototype.ji = function(t3) {
    var e = this;
    this.cancel();
    var n2 = Math.floor(this.qi + this.Wi()), r2 = Math.max(0, Date.now() - this.Qi), i = Math.max(0, n2 - r2);
    i > 0 && k2("ExponentialBackoff", "Backing off for " + i + " ms (base delay: " + this.qi + " ms, delay with jitter: " + n2 + " ms, last attempt: " + r2 + " ms ago)"), this.Ui = this.Se.enqueueAfterDelay(this.timerId, i, function() {
      return e.Qi = Date.now(), t3();
    }), this.qi *= this.Li, this.qi < this.Mi && (this.qi = this.Mi), this.qi > this.Bi && (this.qi = this.Bi);
  }, t2.prototype.Gi = function() {
    this.Ui !== null && (this.Ui.skipDelay(), this.Ui = null);
  }, t2.prototype.cancel = function() {
    this.Ui !== null && (this.Ui.cancel(), this.Ui = null);
  }, t2.prototype.Wi = function() {
    return (Math.random() - 0.5) * this.qi;
  }, t2;
}();
var xo = function() {
  function t2(t3, e, n2, r2, i, o) {
    this.Se = t3, this.zi = n2, this.Hi = r2, this.Ji = i, this.listener = o, this.state = 0, this.Yi = 0, this.Xi = null, this.stream = null, this.Zi = new Co(t3, e);
  }
  return t2.prototype.tr = function() {
    return this.state === 1 || this.state === 2 || this.state === 4;
  }, t2.prototype.er = function() {
    return this.state === 2;
  }, t2.prototype.start = function() {
    this.state !== 3 ? this.auth() : this.nr();
  }, t2.prototype.stop = function() {
    return __awaiter(this, void 0, void 0, function() {
      return __generator(this, function(t3) {
        switch (t3.label) {
          case 0:
            return this.tr() ? [4, this.close(0)] : [3, 2];
          case 1:
            t3.sent(), t3.label = 2;
          case 2:
            return [2];
        }
      });
    });
  }, t2.prototype.sr = function() {
    this.state = 0, this.Zi.reset();
  }, t2.prototype.ir = function() {
    var t3 = this;
    this.er() && this.Xi === null && (this.Xi = this.Se.enqueueAfterDelay(this.zi, 6e4, function() {
      return t3.rr();
    }));
  }, t2.prototype.cr = function(t3) {
    this.ur(), this.stream.send(t3);
  }, t2.prototype.rr = function() {
    return __awaiter(this, void 0, void 0, function() {
      return __generator(this, function(t3) {
        return this.er() ? [2, this.close(0)] : [2];
      });
    });
  }, t2.prototype.ur = function() {
    this.Xi && (this.Xi.cancel(), this.Xi = null);
  }, t2.prototype.close = function(t3, e) {
    return __awaiter(this, void 0, void 0, function() {
      return __generator(this, function(n2) {
        switch (n2.label) {
          case 0:
            return this.ur(), this.Zi.cancel(), this.Yi++, t3 !== 3 ? this.Zi.reset() : e && e.code === S2.RESOURCE_EXHAUSTED ? (C(e.toString()), C("Using maximum backoff delay to prevent overloading the backend."), this.Zi.Ki()) : e && e.code === S2.UNAUTHENTICATED && this.Ji.invalidateToken(), this.stream !== null && (this.ar(), this.stream.close(), this.stream = null), this.state = t3, [4, this.listener.Ri(e)];
          case 1:
            return n2.sent(), [2];
        }
      });
    });
  }, t2.prototype.ar = function() {
  }, t2.prototype.auth = function() {
    var t3 = this;
    this.state = 1;
    var e = this.hr(this.Yi), n2 = this.Yi;
    this.Ji.getToken().then(function(e2) {
      t3.Yi === n2 && t3.lr(e2);
    }, function(n3) {
      e(function() {
        var e2 = new N2(S2.UNKNOWN, "Fetching auth token failed: " + n3.message);
        return t3.dr(e2);
      });
    });
  }, t2.prototype.lr = function(t3) {
    var e = this, n2 = this.hr(this.Yi);
    this.stream = this.wr(t3), this.stream.Ii(function() {
      n2(function() {
        return e.state = 2, e.listener.Ii();
      });
    }), this.stream.Ri(function(t4) {
      n2(function() {
        return e.dr(t4);
      });
    }), this.stream.onMessage(function(t4) {
      n2(function() {
        return e.onMessage(t4);
      });
    });
  }, t2.prototype.nr = function() {
    var t3 = this;
    this.state = 4, this.Zi.ji(function() {
      return __awaiter(t3, void 0, void 0, function() {
        return __generator(this, function(t4) {
          return this.state = 0, this.start(), [2];
        });
      });
    });
  }, t2.prototype.dr = function(t3) {
    return k2("PersistentStream", "close with error: " + t3), this.stream = null, this.close(3, t3);
  }, t2.prototype.hr = function(t3) {
    var e = this;
    return function(n2) {
      e.Se.enqueueAndForget(function() {
        return e.Yi === t3 ? n2() : (k2("PersistentStream", "stream callback skipped by getCloseGuardedDispatcher."), Promise.resolve());
      });
    };
  }, t2;
}();
var Ro = function(t2) {
  function e(e2, n2, r2, i, o) {
    var s = this;
    return (s = t2.call(this, e2, "listen_stream_connection_backoff", "listen_stream_idle", n2, r2, o) || this).R = i, s;
  }
  return __extends(e, t2), e.prototype.wr = function(t3) {
    return this.Hi.Oi("Listen", t3);
  }, e.prototype.onMessage = function(t3) {
    this.Zi.reset();
    var e2 = function(t4, e3) {
      var n3;
      if ("targetChange" in e3) {
        e3.targetChange;
        var r2 = function(t5) {
          return t5 === "NO_CHANGE" ? 0 : t5 === "ADD" ? 1 : t5 === "REMOVE" ? 2 : t5 === "CURRENT" ? 3 : t5 === "RESET" ? 4 : L2();
        }(e3.targetChange.targetChangeType || "NO_CHANGE"), i = e3.targetChange.targetIds || [], o = function(t5, e4) {
          return t5.I ? (O2(e4 === void 0 || typeof e4 == "string"), X2.fromBase64String(e4 || "")) : (O2(e4 === void 0 || e4 instanceof Uint8Array), X2.fromUint8Array(e4 || new Uint8Array()));
        }(t4, e3.targetChange.resumeToken), s = (u2 = e3.targetChange.cause) && function(t5) {
          var e4 = t5.code === void 0 ? S2.UNKNOWN : Qe(t5.code);
          return new N2(e4, t5.message || "");
        }(u2);
        n3 = new ln(r2, i, o, s || null);
      } else if ("documentChange" in e3) {
        e3.documentChange, (r2 = e3.documentChange).document, r2.document.name, r2.document.updateTime, i = Dn(t4, r2.document.name), o = Tn(r2.document.updateTime);
        var u2 = new Tt({
          mapValue: {
            fields: r2.document.fields
          }
        }), a = (s = St.newFoundDocument(i, o, u2), r2.targetIds || []), c = r2.removedTargetIds || [];
        n3 = new hn(a, c, s.key, s);
      } else if ("documentDelete" in e3)
        e3.documentDelete, (r2 = e3.documentDelete).document, i = Dn(t4, r2.document), o = r2.readTime ? Tn(r2.readTime) : j.min(), u2 = St.newNoDocument(i, o), s = r2.removedTargetIds || [], n3 = new hn([], s, u2.key, u2);
      else if ("documentRemove" in e3)
        e3.documentRemove, (r2 = e3.documentRemove).document, i = Dn(t4, r2.document), o = r2.removedTargetIds || [], n3 = new hn([], o, i, null);
      else {
        if (!("filter" in e3))
          return L2();
        e3.filter;
        var h = e3.filter;
        h.targetId, r2 = h.count || 0, i = new Ke(r2), o = h.targetId, n3 = new fn(o, i);
      }
      return n3;
    }(this.R, t3), n2 = function(t4) {
      if (!("targetChange" in t4))
        return j.min();
      var e3 = t4.targetChange;
      return e3.targetIds && e3.targetIds.length ? j.min() : e3.readTime ? Tn(e3.readTime) : j.min();
    }(t3);
    return this.listener._r(e2, n2);
  }, e.prototype.mr = function(t3) {
    var e2 = {};
    e2.database = Cn(this.R), e2.addTarget = function(t4, e3) {
      var n3, r2 = e3.target;
      return (n3 = Ct(r2) ? {
        documents: Fn(t4, r2)
      } : {
        query: Mn(t4, r2)
      }).targetId = e3.targetId, e3.resumeToken.approximateByteSize() > 0 ? n3.resumeToken = In(t4, e3.resumeToken) : e3.snapshotVersion.compareTo(j.min()) > 0 && (n3.readTime = bn(t4, e3.snapshotVersion.toTimestamp())), n3;
    }(this.R, t3);
    var n2 = function(t4, e3) {
      var n3 = function(t5, e4) {
        switch (e4) {
          case 0:
            return null;
          case 1:
            return "existence-filter-mismatch";
          case 2:
            return "limbo-document";
          default:
            return L2();
        }
      }(0, e3.purpose);
      return n3 == null ? null : {
        "goog-listen-tags": n3
      };
    }(this.R, t3);
    n2 && (e2.labels = n2), this.cr(e2);
  }, e.prototype.yr = function(t3) {
    var e2 = {};
    e2.database = Cn(this.R), e2.removeTarget = t3, this.cr(e2);
  }, e;
}(xo);
var Lo = function(t2) {
  function e(e2, n2, r2, i, o) {
    var s = this;
    return (s = t2.call(this, e2, "write_stream_connection_backoff", "write_stream_idle", n2, r2, o) || this).R = i, s.gr = false, s;
  }
  return __extends(e, t2), Object.defineProperty(e.prototype, "pr", {
    get: function() {
      return this.gr;
    },
    enumerable: false,
    configurable: true
  }), e.prototype.start = function() {
    this.gr = false, this.lastStreamToken = void 0, t2.prototype.start.call(this);
  }, e.prototype.ar = function() {
    this.gr && this.Er([]);
  }, e.prototype.wr = function(t3) {
    return this.Hi.Oi("Write", t3);
  }, e.prototype.onMessage = function(t3) {
    if (O2(!!t3.streamToken), this.lastStreamToken = t3.streamToken, this.gr) {
      this.Zi.reset();
      var e2 = function(t4, e3) {
        return t4 && t4.length > 0 ? (O2(e3 !== void 0), t4.map(function(t5) {
          return function(t6, e4) {
            var n3 = t6.updateTime ? Tn(t6.updateTime) : Tn(e4);
            return n3.isEqual(j.min()) && (n3 = Tn(e4)), new Se(n3, t6.transformResults || []);
          }(t5, e3);
        })) : [];
      }(t3.writeResults, t3.commitTime), n2 = Tn(t3.commitTime);
      return this.listener.Tr(n2, e2);
    }
    return O2(!t3.writeResults || t3.writeResults.length === 0), this.gr = true, this.listener.Ir();
  }, e.prototype.Ar = function() {
    var t3 = {};
    t3.database = Cn(this.R), this.cr(t3);
  }, e.prototype.Er = function(t3) {
    var e2 = this, n2 = {
      streamToken: this.lastStreamToken,
      writes: t3.map(function(t4) {
        return On(e2.R, t4);
      })
    };
    this.cr(n2);
  }, e;
}(xo);
var Oo = function(t2) {
  function e(e2, n2, r2) {
    var i = this;
    return (i = t2.call(this) || this).credentials = e2, i.Hi = n2, i.R = r2, i.Rr = false, i;
  }
  return __extends(e, t2), e.prototype.br = function() {
    if (this.Rr)
      throw new N2(S2.FAILED_PRECONDITION, "The client has already been terminated.");
  }, e.prototype.Ni = function(t3, e2, n2) {
    var r2 = this;
    return this.br(), this.credentials.getToken().then(function(i) {
      return r2.Hi.Ni(t3, e2, n2, i);
    }).catch(function(t4) {
      throw t4.name === "FirebaseError" ? (t4.code === S2.UNAUTHENTICATED && r2.credentials.invalidateToken(), t4) : new N2(S2.UNKNOWN, t4.toString());
    });
  }, e.prototype.$i = function(t3, e2, n2) {
    var r2 = this;
    return this.br(), this.credentials.getToken().then(function(i) {
      return r2.Hi.$i(t3, e2, n2, i);
    }).catch(function(t4) {
      throw t4.name === "FirebaseError" ? (t4.code === S2.UNAUTHENTICATED && r2.credentials.invalidateToken(), t4) : new N2(S2.UNKNOWN, t4.toString());
    });
  }, e.prototype.terminate = function() {
    this.Rr = true;
  }, e;
}(function() {
});
var Po = function() {
  function t2(t3, e) {
    this.asyncQueue = t3, this.onlineStateHandler = e, this.state = "Unknown", this.vr = 0, this.Pr = null, this.Vr = true;
  }
  return t2.prototype.Sr = function() {
    var t3 = this;
    this.vr === 0 && (this.Dr("Unknown"), this.Pr = this.asyncQueue.enqueueAfterDelay("online_state_timeout", 1e4, function() {
      return t3.Pr = null, t3.Cr("Backend didn't respond within 10 seconds."), t3.Dr("Offline"), Promise.resolve();
    }));
  }, t2.prototype.Nr = function(t3) {
    this.state === "Online" ? this.Dr("Unknown") : (this.vr++, this.vr >= 1 && (this.Fr(), this.Cr("Connection failed 1 times. Most recent error: " + t3.toString()), this.Dr("Offline")));
  }, t2.prototype.set = function(t3) {
    this.Fr(), this.vr = 0, t3 === "Online" && (this.Vr = false), this.Dr(t3);
  }, t2.prototype.Dr = function(t3) {
    t3 !== this.state && (this.state = t3, this.onlineStateHandler(t3));
  }, t2.prototype.Cr = function(t3) {
    var e = "Could not reach Cloud Firestore backend. " + t3 + "\nThis typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.";
    this.Vr ? (C(e), this.Vr = false) : k2("OnlineStateTracker", e);
  }, t2.prototype.Fr = function() {
    this.Pr !== null && (this.Pr.cancel(), this.Pr = null);
  }, t2;
}();
var Fo = function(t2, e, n2, r2, i) {
  var o = this;
  this.localStore = t2, this.datastore = e, this.asyncQueue = n2, this.remoteSyncer = {}, this.kr = [], this.$r = new Map(), this.Or = new Set(), this.Mr = [], this.Lr = i, this.Lr.di(function(t3) {
    n2.enqueueAndForget(function() {
      return __awaiter(o, void 0, void 0, function() {
        return __generator(this, function(t4) {
          switch (t4.label) {
            case 0:
              return Qo(this) ? (k2("RemoteStore", "Restarting streams for network reachability change."), [4, function(t5) {
                return __awaiter(this, void 0, void 0, function() {
                  var e2;
                  return __generator(this, function(n3) {
                    switch (n3.label) {
                      case 0:
                        return (e2 = P2(t5)).Or.add(4), [4, Vo(e2)];
                      case 1:
                        return n3.sent(), e2.Br.set("Unknown"), e2.Or.delete(4), [4, Mo(e2)];
                      case 2:
                        return n3.sent(), [2];
                    }
                  });
                });
              }(this)]) : [3, 2];
            case 1:
              t4.sent(), t4.label = 2;
            case 2:
              return [2];
          }
        });
      });
    });
  }), this.Br = new Po(n2, r2);
};
function Mo(t2) {
  return __awaiter(this, void 0, void 0, function() {
    var e, n2;
    return __generator(this, function(r2) {
      switch (r2.label) {
        case 0:
          if (!Qo(t2))
            return [3, 4];
          e = 0, n2 = t2.Mr, r2.label = 1;
        case 1:
          return e < n2.length ? [4, (0, n2[e])(true)] : [3, 4];
        case 2:
          r2.sent(), r2.label = 3;
        case 3:
          return e++, [3, 1];
        case 4:
          return [2];
      }
    });
  });
}
function Vo(t2) {
  return __awaiter(this, void 0, void 0, function() {
    var e, n2;
    return __generator(this, function(r2) {
      switch (r2.label) {
        case 0:
          e = 0, n2 = t2.Mr, r2.label = 1;
        case 1:
          return e < n2.length ? [4, (0, n2[e])(false)] : [3, 4];
        case 2:
          r2.sent(), r2.label = 3;
        case 3:
          return e++, [3, 1];
        case 4:
          return [2];
      }
    });
  });
}
function qo(t2, e) {
  var n2 = P2(t2);
  n2.$r.has(e.targetId) || (n2.$r.set(e.targetId, e), Go(n2) ? Ko(n2) : ss(n2).er() && Bo(n2, e));
}
function Uo(t2, e) {
  var n2 = P2(t2), r2 = ss(n2);
  n2.$r.delete(e), r2.er() && jo(n2, e), n2.$r.size === 0 && (r2.er() ? r2.ir() : Qo(n2) && n2.Br.set("Unknown"));
}
function Bo(t2, e) {
  t2.qr.U(e.targetId), ss(t2).mr(e);
}
function jo(t2, e) {
  t2.qr.U(e), ss(t2).yr(e);
}
function Ko(t2) {
  t2.qr = new pn({
    getRemoteKeysForTarget: function(e) {
      return t2.remoteSyncer.getRemoteKeysForTarget(e);
    },
    lt: function(e) {
      return t2.$r.get(e) || null;
    }
  }), ss(t2).start(), t2.Br.Sr();
}
function Go(t2) {
  return Qo(t2) && !ss(t2).tr() && t2.$r.size > 0;
}
function Qo(t2) {
  return P2(t2).Or.size === 0;
}
function zo(t2) {
  t2.qr = void 0;
}
function Wo(t2) {
  return __awaiter(this, void 0, void 0, function() {
    return __generator(this, function(e) {
      return t2.$r.forEach(function(e2, n2) {
        Bo(t2, e2);
      }), [2];
    });
  });
}
function Ho(t2, e) {
  return __awaiter(this, void 0, void 0, function() {
    return __generator(this, function(n2) {
      return zo(t2), Go(t2) ? (t2.Br.Nr(e), Ko(t2)) : t2.Br.set("Unknown"), [2];
    });
  });
}
function Yo(t2, e, n2) {
  return __awaiter(this, void 0, void 0, function() {
    var r2, i, o;
    return __generator(this, function(s) {
      switch (s.label) {
        case 0:
          if (t2.Br.set("Online"), !(e instanceof ln && e.state === 2 && e.cause))
            return [3, 6];
          s.label = 1;
        case 1:
          return s.trys.push([1, 3, , 5]), [
            4,
            function(t3, e2) {
              return __awaiter(this, void 0, void 0, function() {
                var n3, r3, i2, o2;
                return __generator(this, function(s2) {
                  switch (s2.label) {
                    case 0:
                      n3 = e2.cause, r3 = 0, i2 = e2.targetIds, s2.label = 1;
                    case 1:
                      return r3 < i2.length ? (o2 = i2[r3], t3.$r.has(o2) ? [4, t3.remoteSyncer.rejectListen(o2, n3)] : [3, 3]) : [3, 5];
                    case 2:
                      s2.sent(), t3.$r.delete(o2), t3.qr.removeTarget(o2), s2.label = 3;
                    case 3:
                      s2.label = 4;
                    case 4:
                      return r3++, [3, 1];
                    case 5:
                      return [2];
                  }
                });
              });
            }(t2, e)
          ];
        case 2:
          return s.sent(), [3, 5];
        case 3:
          return r2 = s.sent(), k2("RemoteStore", "Failed to remove targets %s: %s ", e.targetIds.join(","), r2), [4, $o(t2, r2)];
        case 4:
          return s.sent(), [3, 5];
        case 5:
          return [3, 13];
        case 6:
          if (e instanceof hn ? t2.qr.X(e) : e instanceof fn ? t2.qr.rt(e) : t2.qr.et(e), n2.isEqual(j.min()))
            return [3, 13];
          s.label = 7;
        case 7:
          return s.trys.push([7, 11, , 13]), [4, ji(t2.localStore)];
        case 8:
          return i = s.sent(), n2.compareTo(i) >= 0 ? [
            4,
            function(t3, e2) {
              var n3 = t3.qr.ut(e2);
              return n3.targetChanges.forEach(function(n4, r3) {
                if (n4.resumeToken.approximateByteSize() > 0) {
                  var i2 = t3.$r.get(r3);
                  i2 && t3.$r.set(r3, i2.withResumeToken(n4.resumeToken, e2));
                }
              }), n3.targetMismatches.forEach(function(e3) {
                var n4 = t3.$r.get(e3);
                if (n4) {
                  t3.$r.set(e3, n4.withResumeToken(X2.EMPTY_BYTE_STRING, n4.snapshotVersion)), jo(t3, e3);
                  var r3 = new Or(n4.target, e3, 1, n4.sequenceNumber);
                  Bo(t3, r3);
                }
              }), t3.remoteSyncer.applyRemoteEvent(n3);
            }(t2, n2)
          ] : [3, 10];
        case 9:
          s.sent(), s.label = 10;
        case 10:
          return [3, 13];
        case 11:
          return k2("RemoteStore", "Failed to raise snapshot:", o = s.sent()), [4, $o(t2, o)];
        case 12:
          return s.sent(), [3, 13];
        case 13:
          return [2];
      }
    });
  });
}
function $o(t2, e, n2) {
  return __awaiter(this, void 0, void 0, function() {
    var r2 = this;
    return __generator(this, function(i) {
      switch (i.label) {
        case 0:
          if (!Sr(e))
            throw e;
          return t2.Or.add(1), [4, Vo(t2)];
        case 1:
          return i.sent(), t2.Br.set("Offline"), n2 || (n2 = function() {
            return ji(t2.localStore);
          }), t2.asyncQueue.enqueueRetryable(function() {
            return __awaiter(r2, void 0, void 0, function() {
              return __generator(this, function(e2) {
                switch (e2.label) {
                  case 0:
                    return k2("RemoteStore", "Retrying IndexedDB access"), [4, n2()];
                  case 1:
                    return e2.sent(), t2.Or.delete(1), [4, Mo(t2)];
                  case 2:
                    return e2.sent(), [2];
                }
              });
            });
          }), [2];
      }
    });
  });
}
function Xo(t2, e) {
  return e().catch(function(n2) {
    return $o(t2, n2, e);
  });
}
function Jo(t2) {
  return __awaiter(this, void 0, void 0, function() {
    var e, n2, r2, i, o;
    return __generator(this, function(s) {
      switch (s.label) {
        case 0:
          e = P2(t2), n2 = us(e), r2 = e.kr.length > 0 ? e.kr[e.kr.length - 1].batchId : -1, s.label = 1;
        case 1:
          if (!function(t3) {
            return Qo(t3) && t3.kr.length < 10;
          }(e))
            return [3, 7];
          s.label = 2;
        case 2:
          return s.trys.push([2, 4, , 6]), [4, Qi(e.localStore, r2)];
        case 3:
          return (i = s.sent()) === null ? (e.kr.length === 0 && n2.ir(), [3, 7]) : (r2 = i.batchId, function(t3, e2) {
            t3.kr.push(e2);
            var n3 = us(t3);
            n3.er() && n3.pr && n3.Er(e2.mutations);
          }(e, i), [3, 6]);
        case 4:
          return o = s.sent(), [4, $o(e, o)];
        case 5:
          return s.sent(), [3, 6];
        case 6:
          return [3, 1];
        case 7:
          return Zo(e) && ts(e), [2];
      }
    });
  });
}
function Zo(t2) {
  return Qo(t2) && !us(t2).tr() && t2.kr.length > 0;
}
function ts(t2) {
  us(t2).start();
}
function es(t2) {
  return __awaiter(this, void 0, void 0, function() {
    return __generator(this, function(e) {
      return us(t2).Ar(), [2];
    });
  });
}
function ns(t2) {
  return __awaiter(this, void 0, void 0, function() {
    var e, n2, r2, i;
    return __generator(this, function(o) {
      for (e = us(t2), n2 = 0, r2 = t2.kr; n2 < r2.length; n2++)
        i = r2[n2], e.Er(i.mutations);
      return [2];
    });
  });
}
function rs(t2, e, n2) {
  return __awaiter(this, void 0, void 0, function() {
    var r2, i;
    return __generator(this, function(o) {
      switch (o.label) {
        case 0:
          return r2 = t2.kr.shift(), i = Lr.from(r2, e, n2), [4, Xo(t2, function() {
            return t2.remoteSyncer.applySuccessfulWrite(i);
          })];
        case 1:
          return o.sent(), [4, Jo(t2)];
        case 2:
          return o.sent(), [2];
      }
    });
  });
}
function is(t2, e) {
  return __awaiter(this, void 0, void 0, function() {
    return __generator(this, function(n2) {
      switch (n2.label) {
        case 0:
          return e && us(t2).pr ? [4, function(t3, e2) {
            return __awaiter(this, void 0, void 0, function() {
              var n3, r2;
              return __generator(this, function(i) {
                switch (i.label) {
                  case 0:
                    return Ge(r2 = e2.code) && r2 !== S2.ABORTED ? (n3 = t3.kr.shift(), us(t3).sr(), [4, Xo(t3, function() {
                      return t3.remoteSyncer.rejectFailedWrite(n3.batchId, e2);
                    })]) : [3, 3];
                  case 1:
                    return i.sent(), [4, Jo(t3)];
                  case 2:
                    i.sent(), i.label = 3;
                  case 3:
                    return [2];
                }
              });
            });
          }(t2, e)] : [3, 2];
        case 1:
          n2.sent(), n2.label = 2;
        case 2:
          return Zo(t2) && ts(t2), [2];
      }
    });
  });
}
function os(t2, e) {
  return __awaiter(this, void 0, void 0, function() {
    var n2, r2;
    return __generator(this, function(i) {
      switch (i.label) {
        case 0:
          return n2 = P2(t2), e ? (n2.Or.delete(2), [4, Mo(n2)]) : [3, 2];
        case 1:
          return i.sent(), [3, 5];
        case 2:
          return (r2 = e) ? [3, 4] : (n2.Or.add(2), [4, Vo(n2)]);
        case 3:
          i.sent(), r2 = n2.Br.set("Unknown"), i.label = 4;
        case 4:
          r2, i.label = 5;
        case 5:
          return [2];
      }
    });
  });
}
function ss(t2) {
  var e = this;
  return t2.Ur || (t2.Ur = function(t3, e2, n2) {
    var r2 = P2(t3);
    return r2.br(), new Ro(e2, r2.Hi, r2.credentials, r2.R, n2);
  }(t2.datastore, t2.asyncQueue, {
    Ii: Wo.bind(null, t2),
    Ri: Ho.bind(null, t2),
    _r: Yo.bind(null, t2)
  }), t2.Mr.push(function(n2) {
    return __awaiter(e, void 0, void 0, function() {
      return __generator(this, function(e2) {
        switch (e2.label) {
          case 0:
            return n2 ? (t2.Ur.sr(), Go(t2) ? Ko(t2) : t2.Br.set("Unknown"), [3, 3]) : [3, 1];
          case 1:
            return [4, t2.Ur.stop()];
          case 2:
            e2.sent(), zo(t2), e2.label = 3;
          case 3:
            return [2];
        }
      });
    });
  })), t2.Ur;
}
function us(t2) {
  var e = this;
  return t2.Qr || (t2.Qr = function(t3, e2, n2) {
    var r2 = P2(t3);
    return r2.br(), new Lo(e2, r2.Hi, r2.credentials, r2.R, n2);
  }(t2.datastore, t2.asyncQueue, {
    Ii: es.bind(null, t2),
    Ri: is.bind(null, t2),
    Ir: ns.bind(null, t2),
    Tr: rs.bind(null, t2)
  }), t2.Mr.push(function(n2) {
    return __awaiter(e, void 0, void 0, function() {
      return __generator(this, function(e2) {
        switch (e2.label) {
          case 0:
            return n2 ? (t2.Qr.sr(), [4, Jo(t2)]) : [3, 2];
          case 1:
            return e2.sent(), [3, 4];
          case 2:
            return [4, t2.Qr.stop()];
          case 3:
            e2.sent(), t2.kr.length > 0 && (k2("RemoteStore", "Stopping write stream with " + t2.kr.length + " pending writes"), t2.kr = []), e2.label = 4;
          case 4:
            return [2];
        }
      });
    });
  })), t2.Qr;
}
var as = function() {
  function t2(t3, e, n2, r2, i) {
    this.asyncQueue = t3, this.timerId = e, this.targetTimeMs = n2, this.op = r2, this.removalCallback = i, this.deferred = new wr(), this.then = this.deferred.promise.then.bind(this.deferred.promise), this.deferred.promise.catch(function(t4) {
    });
  }
  return t2.createAndSchedule = function(e, n2, r2, i, o) {
    var s = new t2(e, n2, Date.now() + r2, i, o);
    return s.start(r2), s;
  }, t2.prototype.start = function(t3) {
    var e = this;
    this.timerHandle = setTimeout(function() {
      return e.handleDelayElapsed();
    }, t3);
  }, t2.prototype.skipDelay = function() {
    return this.handleDelayElapsed();
  }, t2.prototype.cancel = function(t3) {
    this.timerHandle !== null && (this.clearTimeout(), this.deferred.reject(new N2(S2.CANCELLED, "Operation cancelled" + (t3 ? ": " + t3 : ""))));
  }, t2.prototype.handleDelayElapsed = function() {
    var t3 = this;
    this.asyncQueue.enqueueAndForget(function() {
      return t3.timerHandle !== null ? (t3.clearTimeout(), t3.op().then(function(e) {
        return t3.deferred.resolve(e);
      })) : Promise.resolve();
    });
  }, t2.prototype.clearTimeout = function() {
    this.timerHandle !== null && (this.removalCallback(this), clearTimeout(this.timerHandle), this.timerHandle = null);
  }, t2;
}();
function cs(t2, e) {
  if (C("AsyncQueue", e + ": " + t2), Sr(t2))
    return new N2(S2.UNAVAILABLE, e + ": " + t2);
  throw t2;
}
var hs = function() {
  function t2(t3) {
    this.comparator = t3 ? function(e, n2) {
      return t3(e, n2) || at.comparator(e.key, n2.key);
    } : function(t4, e) {
      return at.comparator(t4.key, e.key);
    }, this.keyedMap = tn(), this.sortedSet = new ze(this.comparator);
  }
  return t2.emptySet = function(e) {
    return new t2(e.comparator);
  }, t2.prototype.has = function(t3) {
    return this.keyedMap.get(t3) != null;
  }, t2.prototype.get = function(t3) {
    return this.keyedMap.get(t3);
  }, t2.prototype.first = function() {
    return this.sortedSet.minKey();
  }, t2.prototype.last = function() {
    return this.sortedSet.maxKey();
  }, t2.prototype.isEmpty = function() {
    return this.sortedSet.isEmpty();
  }, t2.prototype.indexOf = function(t3) {
    var e = this.keyedMap.get(t3);
    return e ? this.sortedSet.indexOf(e) : -1;
  }, Object.defineProperty(t2.prototype, "size", {
    get: function() {
      return this.sortedSet.size;
    },
    enumerable: false,
    configurable: true
  }), t2.prototype.forEach = function(t3) {
    this.sortedSet.inorderTraversal(function(e, n2) {
      return t3(e), false;
    });
  }, t2.prototype.add = function(t3) {
    var e = this.delete(t3.key);
    return e.copy(e.keyedMap.insert(t3.key, t3), e.sortedSet.insert(t3, null));
  }, t2.prototype.delete = function(t3) {
    var e = this.get(t3);
    return e ? this.copy(this.keyedMap.remove(t3), this.sortedSet.remove(e)) : this;
  }, t2.prototype.isEqual = function(e) {
    if (!(e instanceof t2))
      return false;
    if (this.size !== e.size)
      return false;
    for (var n2 = this.sortedSet.getIterator(), r2 = e.sortedSet.getIterator(); n2.hasNext(); ) {
      var i = n2.getNext().key, o = r2.getNext().key;
      if (!i.isEqual(o))
        return false;
    }
    return true;
  }, t2.prototype.toString = function() {
    var t3 = [];
    return this.forEach(function(e) {
      t3.push(e.toString());
    }), t3.length === 0 ? "DocumentSet ()" : "DocumentSet (\n  " + t3.join("  \n") + "\n)";
  }, t2.prototype.copy = function(e, n2) {
    var r2 = new t2();
    return r2.comparator = this.comparator, r2.keyedMap = e, r2.sortedSet = n2, r2;
  }, t2;
}();
var fs = function() {
  function t2() {
    this.Kr = new ze(at.comparator);
  }
  return t2.prototype.track = function(t3) {
    var e = t3.doc.key, n2 = this.Kr.get(e);
    n2 ? t3.type !== 0 && n2.type === 3 ? this.Kr = this.Kr.insert(e, t3) : t3.type === 3 && n2.type !== 1 ? this.Kr = this.Kr.insert(e, {
      type: n2.type,
      doc: t3.doc
    }) : t3.type === 2 && n2.type === 2 ? this.Kr = this.Kr.insert(e, {
      type: 2,
      doc: t3.doc
    }) : t3.type === 2 && n2.type === 0 ? this.Kr = this.Kr.insert(e, {
      type: 0,
      doc: t3.doc
    }) : t3.type === 1 && n2.type === 0 ? this.Kr = this.Kr.remove(e) : t3.type === 1 && n2.type === 2 ? this.Kr = this.Kr.insert(e, {
      type: 1,
      doc: n2.doc
    }) : t3.type === 0 && n2.type === 1 ? this.Kr = this.Kr.insert(e, {
      type: 2,
      doc: t3.doc
    }) : L2() : this.Kr = this.Kr.insert(e, t3);
  }, t2.prototype.jr = function() {
    var t3 = [];
    return this.Kr.inorderTraversal(function(e, n2) {
      t3.push(n2);
    }), t3;
  }, t2;
}();
var ls = function() {
  function t2(t3, e, n2, r2, i, o, s, u2) {
    this.query = t3, this.docs = e, this.oldDocs = n2, this.docChanges = r2, this.mutatedKeys = i, this.fromCache = o, this.syncStateChanged = s, this.excludesMetadataChanges = u2;
  }
  return t2.fromInitialDocuments = function(e, n2, r2, i) {
    var o = [];
    return n2.forEach(function(t3) {
      o.push({
        type: 0,
        doc: t3
      });
    }), new t2(e, n2, hs.emptySet(n2), o, r2, i, true, false);
  }, Object.defineProperty(t2.prototype, "hasPendingWrites", {
    get: function() {
      return !this.mutatedKeys.isEmpty();
    },
    enumerable: false,
    configurable: true
  }), t2.prototype.isEqual = function(t3) {
    if (!(this.fromCache === t3.fromCache && this.syncStateChanged === t3.syncStateChanged && this.mutatedKeys.isEqual(t3.mutatedKeys) && re(this.query, t3.query) && this.docs.isEqual(t3.docs) && this.oldDocs.isEqual(t3.oldDocs)))
      return false;
    var e = this.docChanges, n2 = t3.docChanges;
    if (e.length !== n2.length)
      return false;
    for (var r2 = 0; r2 < e.length; r2++)
      if (e[r2].type !== n2[r2].type || !e[r2].doc.isEqual(n2[r2].doc))
        return false;
    return true;
  }, t2;
}();
var ds = function() {
  this.Wr = void 0, this.listeners = [];
};
var ps = function() {
  this.queries = new bi(function(t2) {
    return ie(t2);
  }, re), this.onlineState = "Unknown", this.Gr = new Set();
};
function ys(t2, e) {
  return __awaiter(this, void 0, void 0, function() {
    var n2, r2, i, o, s, u2, a;
    return __generator(this, function(c) {
      switch (c.label) {
        case 0:
          if (n2 = P2(t2), r2 = e.query, i = false, (o = n2.queries.get(r2)) || (i = true, o = new ds()), !i)
            return [3, 4];
          c.label = 1;
        case 1:
          return c.trys.push([1, 3, , 4]), s = o, [4, n2.onListen(r2)];
        case 2:
          return s.Wr = c.sent(), [3, 4];
        case 3:
          return u2 = c.sent(), a = cs(u2, "Initialization of query '" + oe(e.query) + "' failed"), [2, void e.onError(a)];
        case 4:
          return n2.queries.set(r2, o), o.listeners.push(e), e.zr(n2.onlineState), o.Wr && e.Hr(o.Wr) && ws(n2), [2];
      }
    });
  });
}
function vs(t2, e) {
  return __awaiter(this, void 0, void 0, function() {
    var n2, r2, i, o, s;
    return __generator(this, function(u2) {
      return n2 = P2(t2), r2 = e.query, i = false, (o = n2.queries.get(r2)) && (s = o.listeners.indexOf(e)) >= 0 && (o.listeners.splice(s, 1), i = o.listeners.length === 0), i ? [2, (n2.queries.delete(r2), n2.onUnlisten(r2))] : [2];
    });
  });
}
function ms(t2, e) {
  for (var n2 = P2(t2), r2 = false, i = 0, o = e; i < o.length; i++) {
    var s = o[i], u2 = s.query, a = n2.queries.get(u2);
    if (a) {
      for (var c = 0, h = a.listeners; c < h.length; c++) {
        h[c].Hr(s) && (r2 = true);
      }
      a.Wr = s;
    }
  }
  r2 && ws(n2);
}
function gs(t2, e, n2) {
  var r2 = P2(t2), i = r2.queries.get(e);
  if (i)
    for (var o = 0, s = i.listeners; o < s.length; o++) {
      s[o].onError(n2);
    }
  r2.queries.delete(e);
}
function ws(t2) {
  t2.Gr.forEach(function(t3) {
    t3.next();
  });
}
var bs = function() {
  function t2(t3, e, n2) {
    this.query = t3, this.Jr = e, this.Yr = false, this.Xr = null, this.onlineState = "Unknown", this.options = n2 || {};
  }
  return t2.prototype.Hr = function(t3) {
    if (!this.options.includeMetadataChanges) {
      for (var e = [], n2 = 0, r2 = t3.docChanges; n2 < r2.length; n2++) {
        var i = r2[n2];
        i.type !== 3 && e.push(i);
      }
      t3 = new ls(t3.query, t3.docs, t3.oldDocs, e, t3.mutatedKeys, t3.fromCache, t3.syncStateChanged, true);
    }
    var o = false;
    return this.Yr ? this.Zr(t3) && (this.Jr.next(t3), o = true) : this.eo(t3, this.onlineState) && (this.no(t3), o = true), this.Xr = t3, o;
  }, t2.prototype.onError = function(t3) {
    this.Jr.error(t3);
  }, t2.prototype.zr = function(t3) {
    this.onlineState = t3;
    var e = false;
    return this.Xr && !this.Yr && this.eo(this.Xr, t3) && (this.no(this.Xr), e = true), e;
  }, t2.prototype.eo = function(t3, e) {
    if (!t3.fromCache)
      return true;
    var n2 = e !== "Offline";
    return !(this.options.so && n2 || t3.docs.isEmpty() && e !== "Offline");
  }, t2.prototype.Zr = function(t3) {
    if (t3.docChanges.length > 0)
      return true;
    var e = this.Xr && this.Xr.hasPendingWrites !== t3.hasPendingWrites;
    return !(!t3.syncStateChanged && !e) && this.options.includeMetadataChanges === true;
  }, t2.prototype.no = function(t3) {
    t3 = ls.fromInitialDocuments(t3.query, t3.docs, t3.mutatedKeys, t3.fromCache), this.Yr = true, this.Jr.next(t3);
  }, t2;
}();
var Is = function() {
  function t2(t3, e) {
    this.payload = t3, this.byteLength = e;
  }
  return t2.prototype.io = function() {
    return "metadata" in this.payload;
  }, t2;
}();
var Es = function() {
  function t2(t3) {
    this.R = t3;
  }
  return t2.prototype.qn = function(t3) {
    return Dn(this.R, t3);
  }, t2.prototype.Un = function(t3) {
    return t3.metadata.exists ? Ln(this.R, t3.document, false) : St.newNoDocument(this.qn(t3.metadata.name), this.Qn(t3.metadata.readTime));
  }, t2.prototype.Qn = function(t3) {
    return Tn(t3);
  }, t2;
}();
var Ts = function() {
  function t2(t3, e, n2) {
    this.ro = t3, this.localStore = e, this.R = n2, this.queries = [], this.documents = [], this.progress = _s(t3);
  }
  return t2.prototype.oo = function(t3) {
    this.progress.bytesLoaded += t3.byteLength;
    var e = this.progress.documentsLoaded;
    return t3.payload.namedQuery ? this.queries.push(t3.payload.namedQuery) : t3.payload.documentMetadata ? (this.documents.push({
      metadata: t3.payload.documentMetadata
    }), t3.payload.documentMetadata.exists || ++e) : t3.payload.document && (this.documents[this.documents.length - 1].document = t3.payload.document, ++e), e !== this.progress.documentsLoaded ? (this.progress.documentsLoaded = e, Object.assign({}, this.progress)) : null;
  }, t2.prototype.co = function(t3) {
    for (var e = new Map(), n2 = new Es(this.R), r2 = 0, i = t3; r2 < i.length; r2++) {
      var o = i[r2];
      if (o.metadata.queries)
        for (var s = n2.qn(o.metadata.name), u2 = 0, a = o.metadata.queries; u2 < a.length; u2++) {
          var c = a[u2], h = (e.get(c) || on()).add(s);
          e.set(c, h);
        }
    }
    return e;
  }, t2.prototype.complete = function() {
    return __awaiter(this, void 0, void 0, function() {
      var t3, e, n2, r2, i;
      return __generator(this, function(o) {
        switch (o.label) {
          case 0:
            return [4, Ji(this.localStore, new Es(this.R), this.documents, this.ro.id)];
          case 1:
            t3 = o.sent(), e = this.co(this.documents), n2 = 0, r2 = this.queries, o.label = 2;
          case 2:
            return n2 < r2.length ? (i = r2[n2], [4, Zi(this.localStore, i, e.get(i.name))]) : [3, 5];
          case 3:
            o.sent(), o.label = 4;
          case 4:
            return n2++, [3, 2];
          case 5:
            return [2, (this.progress.taskState = "Success", new Oi(Object.assign({}, this.progress), t3))];
        }
      });
    });
  }, t2;
}();
function _s(t2) {
  return {
    taskState: "Running",
    documentsLoaded: 0,
    bytesLoaded: 0,
    totalDocuments: t2.totalDocuments,
    totalBytes: t2.totalBytes
  };
}
var Ss = function(t2) {
  this.key = t2;
};
var Ns = function(t2) {
  this.key = t2;
};
var Ds = function() {
  function t2(t3, e) {
    this.query = t3, this.uo = e, this.ao = null, this.current = false, this.ho = on(), this.mutatedKeys = on(), this.lo = ue(t3), this.fo = new hs(this.lo);
  }
  return Object.defineProperty(t2.prototype, "wo", {
    get: function() {
      return this.uo;
    },
    enumerable: false,
    configurable: true
  }), t2.prototype._o = function(t3, e) {
    var n2 = this, r2 = e ? e.mo : new fs(), i = e ? e.fo : this.fo, o = e ? e.mutatedKeys : this.mutatedKeys, s = i, u2 = false, a = Yt(this.query) && i.size === this.query.limit ? i.last() : null, c = $t(this.query) && i.size === this.query.limit ? i.first() : null;
    if (t3.inorderTraversal(function(t4, e2) {
      var h2 = i.get(t4), f = se(n2.query, e2) ? e2 : null, l = !!h2 && n2.mutatedKeys.has(h2.key), d = !!f && (f.hasLocalMutations || n2.mutatedKeys.has(f.key) && f.hasCommittedMutations), p2 = false;
      h2 && f ? h2.data.isEqual(f.data) ? l !== d && (r2.track({
        type: 3,
        doc: f
      }), p2 = true) : n2.yo(h2, f) || (r2.track({
        type: 2,
        doc: f
      }), p2 = true, (a && n2.lo(f, a) > 0 || c && n2.lo(f, c) < 0) && (u2 = true)) : !h2 && f ? (r2.track({
        type: 0,
        doc: f
      }), p2 = true) : h2 && !f && (r2.track({
        type: 1,
        doc: h2
      }), p2 = true, (a || c) && (u2 = true)), p2 && (f ? (s = s.add(f), o = d ? o.add(t4) : o.delete(t4)) : (s = s.delete(t4), o = o.delete(t4)));
    }), Yt(this.query) || $t(this.query))
      for (; s.size > this.query.limit; ) {
        var h = Yt(this.query) ? s.last() : s.first();
        s = s.delete(h.key), o = o.delete(h.key), r2.track({
          type: 1,
          doc: h
        });
      }
    return {
      fo: s,
      mo: r2,
      Nn: u2,
      mutatedKeys: o
    };
  }, t2.prototype.yo = function(t3, e) {
    return t3.hasLocalMutations && e.hasCommittedMutations && !e.hasLocalMutations;
  }, t2.prototype.applyChanges = function(t3, e, n2) {
    var r2 = this, i = this.fo;
    this.fo = t3.fo, this.mutatedKeys = t3.mutatedKeys;
    var o = t3.mo.jr();
    o.sort(function(t4, e2) {
      return function(t5, e3) {
        var n3 = function(t6) {
          switch (t6) {
            case 0:
              return 1;
            case 2:
            case 3:
              return 2;
            case 1:
              return 0;
            default:
              return L2();
          }
        };
        return n3(t5) - n3(e3);
      }(t4.type, e2.type) || r2.lo(t4.doc, e2.doc);
    }), this.po(n2);
    var s = e ? this.Eo() : [], u2 = this.ho.size === 0 && this.current ? 1 : 0, a = u2 !== this.ao;
    return this.ao = u2, o.length !== 0 || a ? {
      snapshot: new ls(this.query, t3.fo, i, o, t3.mutatedKeys, u2 === 0, a, false),
      To: s
    } : {
      To: s
    };
  }, t2.prototype.zr = function(t3) {
    return this.current && t3 === "Offline" ? (this.current = false, this.applyChanges({
      fo: this.fo,
      mo: new fs(),
      mutatedKeys: this.mutatedKeys,
      Nn: false
    }, false)) : {
      To: []
    };
  }, t2.prototype.Io = function(t3) {
    return !this.uo.has(t3) && !!this.fo.has(t3) && !this.fo.get(t3).hasLocalMutations;
  }, t2.prototype.po = function(t3) {
    var e = this;
    t3 && (t3.addedDocuments.forEach(function(t4) {
      return e.uo = e.uo.add(t4);
    }), t3.modifiedDocuments.forEach(function(t4) {
    }), t3.removedDocuments.forEach(function(t4) {
      return e.uo = e.uo.delete(t4);
    }), this.current = t3.current);
  }, t2.prototype.Eo = function() {
    var t3 = this;
    if (!this.current)
      return [];
    var e = this.ho;
    this.ho = on(), this.fo.forEach(function(e2) {
      t3.Io(e2.key) && (t3.ho = t3.ho.add(e2.key));
    });
    var n2 = [];
    return e.forEach(function(e2) {
      t3.ho.has(e2) || n2.push(new Ns(e2));
    }), this.ho.forEach(function(t4) {
      e.has(t4) || n2.push(new Ss(t4));
    }), n2;
  }, t2.prototype.Ao = function(t3) {
    this.uo = t3.Bn, this.ho = on();
    var e = this._o(t3.documents);
    return this.applyChanges(e, true);
  }, t2.prototype.Ro = function() {
    return ls.fromInitialDocuments(this.query, this.fo, this.mutatedKeys, this.ao === 0);
  }, t2;
}();
var As = function(t2, e, n2) {
  this.query = t2, this.targetId = e, this.view = n2;
};
var ks = function(t2) {
  this.key = t2, this.bo = false;
};
var Cs = function() {
  function t2(t3, e, n2, r2, i, o) {
    this.localStore = t3, this.remoteStore = e, this.eventManager = n2, this.sharedClientState = r2, this.currentUser = i, this.maxConcurrentLimboResolutions = o, this.vo = {}, this.Po = new bi(function(t4) {
      return ie(t4);
    }, re), this.Vo = new Map(), this.So = new Set(), this.Do = new ze(at.comparator), this.Co = new Map(), this.No = new eo(), this.xo = {}, this.Fo = new Map(), this.ko = ai.Yt(), this.onlineState = "Unknown", this.$o = void 0;
  }
  return Object.defineProperty(t2.prototype, "isPrimaryClient", {
    get: function() {
      return this.$o === true;
    },
    enumerable: false,
    configurable: true
  }), t2;
}();
function xs(t2, e) {
  return __awaiter(this, void 0, void 0, function() {
    var n2, r2, i, o, s, u2;
    return __generator(this, function(a) {
      switch (a.label) {
        case 0:
          return n2 = su(t2), (o = n2.Po.get(e)) ? (r2 = o.targetId, n2.sharedClientState.addLocalQueryTarget(r2), i = o.view.Ro(), [3, 4]) : [3, 1];
        case 1:
          return [4, zi(n2.localStore, ee(e))];
        case 2:
          return s = a.sent(), u2 = n2.sharedClientState.addLocalQueryTarget(s.targetId), r2 = s.targetId, [4, Rs(n2, e, r2, u2 === "current")];
        case 3:
          i = a.sent(), n2.isPrimaryClient && qo(n2.remoteStore, s), a.label = 4;
        case 4:
          return [2, i];
      }
    });
  });
}
function Rs(t2, e, n2, r2) {
  return __awaiter(this, void 0, void 0, function() {
    var i, o, s, u2, a, c;
    return __generator(this, function(h) {
      switch (h.label) {
        case 0:
          return t2.Oo = function(e2, n3, r3) {
            return function(t3, e3, n4, r4) {
              return __awaiter(this, void 0, void 0, function() {
                var i2, o2, s2;
                return __generator(this, function(u3) {
                  switch (u3.label) {
                    case 0:
                      return i2 = e3.view._o(n4), i2.Nn ? [4, Hi(t3.localStore, e3.query, false).then(function(t4) {
                        var n5 = t4.documents;
                        return e3.view._o(n5, i2);
                      })] : [3, 2];
                    case 1:
                      i2 = u3.sent(), u3.label = 2;
                    case 2:
                      return o2 = r4 && r4.targetChanges.get(e3.targetId), s2 = e3.view.applyChanges(i2, t3.isPrimaryClient, o2), [2, (Qs(t3, e3.targetId, s2.To), s2.snapshot)];
                  }
                });
              });
            }(t2, e2, n3, r3);
          }, [4, Hi(t2.localStore, e, true)];
        case 1:
          return i = h.sent(), o = new Ds(e, i.Bn), s = o._o(i.documents), u2 = cn.createSynthesizedTargetChangeForCurrentChange(n2, r2 && t2.onlineState !== "Offline"), a = o.applyChanges(s, t2.isPrimaryClient, u2), Qs(t2, n2, a.To), c = new As(e, n2, o), [2, (t2.Po.set(e, c), t2.Vo.has(n2) ? t2.Vo.get(n2).push(e) : t2.Vo.set(n2, [e]), a.snapshot)];
      }
    });
  });
}
function Ls(t2, e) {
  return __awaiter(this, void 0, void 0, function() {
    var n2, r2, i;
    return __generator(this, function(o) {
      switch (o.label) {
        case 0:
          return n2 = P2(t2), r2 = n2.Po.get(e), (i = n2.Vo.get(r2.targetId)).length > 1 ? [2, (n2.Vo.set(r2.targetId, i.filter(function(t3) {
            return !re(t3, e);
          })), void n2.Po.delete(e))] : n2.isPrimaryClient ? (n2.sharedClientState.removeLocalQueryTarget(r2.targetId), n2.sharedClientState.isActiveQueryTarget(r2.targetId) ? [3, 2] : [4, Wi(n2.localStore, r2.targetId, false).then(function() {
            n2.sharedClientState.clearQueryState(r2.targetId), Uo(n2.remoteStore, r2.targetId), Ks(n2, r2.targetId);
          }).catch(di)]) : [3, 3];
        case 1:
          o.sent(), o.label = 2;
        case 2:
          return [3, 5];
        case 3:
          return Ks(n2, r2.targetId), [4, Wi(n2.localStore, r2.targetId, true)];
        case 4:
          o.sent(), o.label = 5;
        case 5:
          return [2];
      }
    });
  });
}
function Os(t2, e, n2) {
  return __awaiter(this, void 0, void 0, function() {
    var r2, i, o, s;
    return __generator(this, function(u2) {
      switch (u2.label) {
        case 0:
          r2 = uu(t2), u2.label = 1;
        case 1:
          return u2.trys.push([1, 5, , 6]), [4, function(t3, e2) {
            var n3, r3 = P2(t3), i2 = B.now(), o2 = e2.reduce(function(t4, e3) {
              return t4.add(e3.key);
            }, on());
            return r3.persistence.runTransaction("Locally write mutations", "readwrite", function(t4) {
              return r3.Mn.pn(t4, o2).next(function(o3) {
                n3 = o3;
                for (var s2 = [], u3 = 0, a = e2; u3 < a.length; u3++) {
                  var c = a[u3], h = xe(c, n3.get(c.key));
                  h != null && s2.push(new Pe(c.key, h, _t(h.value.mapValue), Ne.exists(true)));
                }
                return r3._n.addMutationBatch(t4, i2, s2, e2);
              });
            }).then(function(t4) {
              return t4.applyToLocalDocumentSet(n3), {
                batchId: t4.batchId,
                changes: n3
              };
            });
          }(r2.localStore, e)];
        case 2:
          return i = u2.sent(), r2.sharedClientState.addPendingMutation(i.batchId), function(t3, e2, n3) {
            var r3 = t3.xo[t3.currentUser.toKey()];
            r3 || (r3 = new ze(V2)), r3 = r3.insert(e2, n3), t3.xo[t3.currentUser.toKey()] = r3;
          }(r2, i.batchId, n2), [4, Hs(r2, i.changes)];
        case 3:
          return u2.sent(), [4, Jo(r2.remoteStore)];
        case 4:
          return u2.sent(), [3, 6];
        case 5:
          return o = u2.sent(), s = cs(o, "Failed to persist write"), n2.reject(s), [3, 6];
        case 6:
          return [2];
      }
    });
  });
}
function Ps(t2, e) {
  return __awaiter(this, void 0, void 0, function() {
    var n2, r2;
    return __generator(this, function(i) {
      switch (i.label) {
        case 0:
          n2 = P2(t2), i.label = 1;
        case 1:
          return i.trys.push([1, 4, , 6]), [4, Ki(n2.localStore, e)];
        case 2:
          return r2 = i.sent(), e.targetChanges.forEach(function(t3, e2) {
            var r3 = n2.Co.get(e2);
            r3 && (O2(t3.addedDocuments.size + t3.modifiedDocuments.size + t3.removedDocuments.size <= 1), t3.addedDocuments.size > 0 ? r3.bo = true : t3.modifiedDocuments.size > 0 ? O2(r3.bo) : t3.removedDocuments.size > 0 && (O2(r3.bo), r3.bo = false));
          }), [4, Hs(n2, r2, e)];
        case 3:
          return i.sent(), [3, 6];
        case 4:
          return [4, di(i.sent())];
        case 5:
          return i.sent(), [3, 6];
        case 6:
          return [2];
      }
    });
  });
}
function Fs(t2, e, n2) {
  var r2 = P2(t2);
  if (r2.isPrimaryClient && n2 === 0 || !r2.isPrimaryClient && n2 === 1) {
    var i = [];
    r2.Po.forEach(function(t3, n3) {
      var r3 = n3.view.zr(e);
      r3.snapshot && i.push(r3.snapshot);
    }), function(t3, e2) {
      var n3 = P2(t3);
      n3.onlineState = e2;
      var r3 = false;
      n3.queries.forEach(function(t4, n4) {
        for (var i2 = 0, o = n4.listeners; i2 < o.length; i2++) {
          o[i2].zr(e2) && (r3 = true);
        }
      }), r3 && ws(n3);
    }(r2.eventManager, e), i.length && r2.vo._r(i), r2.onlineState = e, r2.isPrimaryClient && r2.sharedClientState.setOnlineState(e);
  }
}
function Ms(t2, e, n2) {
  return __awaiter(this, void 0, void 0, function() {
    var r2, i, o, s, u2, a;
    return __generator(this, function(c) {
      switch (c.label) {
        case 0:
          return (r2 = P2(t2)).sharedClientState.updateQueryState(e, "rejected", n2), i = r2.Co.get(e), (o = i && i.key) ? (s = (s = new ze(at.comparator)).insert(o, St.newNoDocument(o, j.min())), u2 = on().add(o), a = new an(j.min(), new Map(), new Ye(V2), s, u2), [4, Ps(r2, a)]) : [3, 2];
        case 1:
          return c.sent(), r2.Do = r2.Do.remove(o), r2.Co.delete(e), Ws(r2), [3, 4];
        case 2:
          return [4, Wi(r2.localStore, e, false).then(function() {
            return Ks(r2, e, n2);
          }).catch(di)];
        case 3:
          c.sent(), c.label = 4;
        case 4:
          return [2];
      }
    });
  });
}
function Vs(t2, e) {
  return __awaiter(this, void 0, void 0, function() {
    var n2, r2, i;
    return __generator(this, function(o) {
      switch (o.label) {
        case 0:
          n2 = P2(t2), r2 = e.batch.batchId, o.label = 1;
        case 1:
          return o.trys.push([1, 4, , 6]), [4, Bi(n2.localStore, e)];
        case 2:
          return i = o.sent(), js(n2, r2, null), Bs(n2, r2), n2.sharedClientState.updateMutationState(r2, "acknowledged"), [4, Hs(n2, i)];
        case 3:
          return o.sent(), [3, 6];
        case 4:
          return [4, di(o.sent())];
        case 5:
          return o.sent(), [3, 6];
        case 6:
          return [2];
      }
    });
  });
}
function qs(t2, e, n2) {
  return __awaiter(this, void 0, void 0, function() {
    var r2, i;
    return __generator(this, function(o) {
      switch (o.label) {
        case 0:
          r2 = P2(t2), o.label = 1;
        case 1:
          return o.trys.push([1, 4, , 6]), [4, function(t3, e2) {
            var n3 = P2(t3);
            return n3.persistence.runTransaction("Reject batch", "readwrite-primary", function(t4) {
              var r3;
              return n3._n.lookupMutationBatch(t4, e2).next(function(e3) {
                return O2(e3 !== null), r3 = e3.keys(), n3._n.removeMutationBatch(t4, e3);
              }).next(function() {
                return n3._n.performConsistencyCheck(t4);
              }).next(function() {
                return n3.Mn.pn(t4, r3);
              });
            });
          }(r2.localStore, e)];
        case 2:
          return i = o.sent(), js(r2, e, n2), Bs(r2, e), r2.sharedClientState.updateMutationState(e, "rejected", n2), [4, Hs(r2, i)];
        case 3:
          return o.sent(), [3, 6];
        case 4:
          return [4, di(o.sent())];
        case 5:
          return o.sent(), [3, 6];
        case 6:
          return [2];
      }
    });
  });
}
function Us(t2, e) {
  return __awaiter(this, void 0, void 0, function() {
    var n2, r2, i, o, s;
    return __generator(this, function(u2) {
      switch (u2.label) {
        case 0:
          Qo((n2 = P2(t2)).remoteStore) || k2("SyncEngine", "The network is disabled. The task returned by 'awaitPendingWrites()' will not complete until the network is enabled."), u2.label = 1;
        case 1:
          return u2.trys.push([1, 3, , 4]), [4, function(t3) {
            var e2 = P2(t3);
            return e2.persistence.runTransaction("Get highest unacknowledged batch id", "readonly", function(t4) {
              return e2._n.getHighestUnacknowledgedBatchId(t4);
            });
          }(n2.localStore)];
        case 2:
          return (r2 = u2.sent()) === -1 ? [2, void e.resolve()] : ((i = n2.Fo.get(r2) || []).push(e), n2.Fo.set(r2, i), [3, 4]);
        case 3:
          return o = u2.sent(), s = cs(o, "Initialization of waitForPendingWrites() operation failed"), e.reject(s), [3, 4];
        case 4:
          return [2];
      }
    });
  });
}
function Bs(t2, e) {
  (t2.Fo.get(e) || []).forEach(function(t3) {
    t3.resolve();
  }), t2.Fo.delete(e);
}
function js(t2, e, n2) {
  var r2 = P2(t2), i = r2.xo[r2.currentUser.toKey()];
  if (i) {
    var o = i.get(e);
    o && (n2 ? o.reject(n2) : o.resolve(), i = i.remove(e)), r2.xo[r2.currentUser.toKey()] = i;
  }
}
function Ks(t2, e, n2) {
  n2 === void 0 && (n2 = null), t2.sharedClientState.removeLocalQueryTarget(e);
  for (var r2 = 0, i = t2.Vo.get(e); r2 < i.length; r2++) {
    var o = i[r2];
    t2.Po.delete(o), n2 && t2.vo.Mo(o, n2);
  }
  t2.Vo.delete(e), t2.isPrimaryClient && t2.No.Zn(e).forEach(function(e2) {
    t2.No.containsKey(e2) || Gs(t2, e2);
  });
}
function Gs(t2, e) {
  t2.So.delete(e.path.canonicalString());
  var n2 = t2.Do.get(e);
  n2 !== null && (Uo(t2.remoteStore, n2), t2.Do = t2.Do.remove(e), t2.Co.delete(n2), Ws(t2));
}
function Qs(t2, e, n2) {
  for (var r2 = 0, i = n2; r2 < i.length; r2++) {
    var o = i[r2];
    o instanceof Ss ? (t2.No.addReference(o.key, e), zs(t2, o)) : o instanceof Ns ? (k2("SyncEngine", "Document no longer in limbo: " + o.key), t2.No.removeReference(o.key, e), t2.No.containsKey(o.key) || Gs(t2, o.key)) : L2();
  }
}
function zs(t2, e) {
  var n2 = e.key, r2 = n2.path.canonicalString();
  t2.Do.get(n2) || t2.So.has(r2) || (k2("SyncEngine", "New document in limbo: " + n2), t2.So.add(r2), Ws(t2));
}
function Ws(t2) {
  for (; t2.So.size > 0 && t2.Do.size < t2.maxConcurrentLimboResolutions; ) {
    var e = t2.So.values().next().value;
    t2.So.delete(e);
    var n2 = new at(W2.fromString(e)), r2 = t2.ko.next();
    t2.Co.set(r2, new ks(n2)), t2.Do = t2.Do.insert(n2, r2), qo(t2.remoteStore, new Or(ee(Ht(n2.path)), r2, 2, _.o));
  }
}
function Hs(t2, e, n2) {
  return __awaiter(this, void 0, void 0, function() {
    var r2, i, o, s;
    return __generator(this, function(u2) {
      switch (u2.label) {
        case 0:
          return r2 = P2(t2), i = [], o = [], s = [], r2.Po.isEmpty() ? [3, 3] : (r2.Po.forEach(function(t3, u3) {
            s.push(r2.Oo(u3, e, n2).then(function(t4) {
              if (t4) {
                r2.isPrimaryClient && r2.sharedClientState.updateQueryState(u3.targetId, t4.fromCache ? "not-current" : "current"), i.push(t4);
                var e2 = Fi.Pn(u3.targetId, t4);
                o.push(e2);
              }
            }));
          }), [4, Promise.all(s)]);
        case 1:
          return u2.sent(), r2.vo._r(i), [4, function(t3, e2) {
            return __awaiter(this, void 0, void 0, function() {
              var n3, r3, i2, o2, s2, u3, a, c, h;
              return __generator(this, function(f) {
                switch (f.label) {
                  case 0:
                    n3 = P2(t3), f.label = 1;
                  case 1:
                    return f.trys.push([1, 3, , 4]), [4, n3.persistence.runTransaction("notifyLocalViewChanges", "readwrite", function(t4) {
                      return br.forEach(e2, function(e3) {
                        return br.forEach(e3.bn, function(r4) {
                          return n3.persistence.referenceDelegate.addReference(t4, e3.targetId, r4);
                        }).next(function() {
                          return br.forEach(e3.vn, function(r4) {
                            return n3.persistence.referenceDelegate.removeReference(t4, e3.targetId, r4);
                          });
                        });
                      });
                    })];
                  case 2:
                    return f.sent(), [3, 4];
                  case 3:
                    if (!Sr(r3 = f.sent()))
                      throw r3;
                    return k2("LocalStore", "Failed to update sequence numbers: " + r3), [3, 4];
                  case 4:
                    for (i2 = 0, o2 = e2; i2 < o2.length; i2++)
                      s2 = o2[i2], u3 = s2.targetId, s2.fromCache || (a = n3.Fn.get(u3), c = a.snapshotVersion, h = a.withLastLimboFreeSnapshotVersion(c), n3.Fn = n3.Fn.insert(u3, h));
                    return [2];
                }
              });
            });
          }(r2.localStore, o)];
        case 2:
          u2.sent(), u2.label = 3;
        case 3:
          return [2];
      }
    });
  });
}
function Ys(t2, e) {
  return __awaiter(this, void 0, void 0, function() {
    var n2, r2;
    return __generator(this, function(i) {
      switch (i.label) {
        case 0:
          return (n2 = P2(t2)).currentUser.isEqual(e) ? [3, 3] : (k2("SyncEngine", "User change. New user:", e.toKey()), [4, Ui(n2.localStore, e)]);
        case 1:
          return r2 = i.sent(), n2.currentUser = e, function(t3, e2) {
            t3.Fo.forEach(function(t4) {
              t4.forEach(function(t5) {
                t5.reject(new N2(S2.CANCELLED, "'waitForPendingWrites' promise is rejected due to a user change."));
              });
            }), t3.Fo.clear();
          }(n2), n2.sharedClientState.handleUserChange(e, r2.removedBatchIds, r2.addedBatchIds), [4, Hs(n2, r2.Ln)];
        case 2:
          i.sent(), i.label = 3;
        case 3:
          return [2];
      }
    });
  });
}
function $s(t2, e) {
  var n2 = P2(t2), r2 = n2.Co.get(e);
  if (r2 && r2.bo)
    return on().add(r2.key);
  var i = on(), o = n2.Vo.get(e);
  if (!o)
    return i;
  for (var s = 0, u2 = o; s < u2.length; s++) {
    var a = u2[s], c = n2.Po.get(a);
    i = i.unionWith(c.view.wo);
  }
  return i;
}
function Xs(t2, e) {
  return __awaiter(this, void 0, void 0, function() {
    var n2, r2, i;
    return __generator(this, function(o) {
      switch (o.label) {
        case 0:
          return [4, Hi((n2 = P2(t2)).localStore, e.query, true)];
        case 1:
          return r2 = o.sent(), i = e.view.Ao(r2), [2, (n2.isPrimaryClient && Qs(n2, e.targetId, i.To), i)];
      }
    });
  });
}
function Js(t2) {
  return __awaiter(this, void 0, void 0, function() {
    var e;
    return __generator(this, function(n2) {
      return [2, $i((e = P2(t2)).localStore).then(function(t3) {
        return Hs(e, t3);
      })];
    });
  });
}
function Zs(t2, e, n2, r2) {
  return __awaiter(this, void 0, void 0, function() {
    var i, o;
    return __generator(this, function(s) {
      switch (s.label) {
        case 0:
          return [4, function(t3, e2) {
            var n3 = P2(t3), r3 = P2(n3._n);
            return n3.persistence.runTransaction("Lookup mutation documents", "readonly", function(t4) {
              return r3.jt(t4, e2).next(function(e3) {
                return e3 ? n3.Mn.pn(t4, e3) : br.resolve(null);
              });
            });
          }((i = P2(t2)).localStore, e)];
        case 1:
          return (o = s.sent()) === null ? [3, 6] : n2 !== "pending" ? [3, 3] : [4, Jo(i.remoteStore)];
        case 2:
          return s.sent(), [3, 4];
        case 3:
          n2 === "acknowledged" || n2 === "rejected" ? (js(i, e, r2 || null), Bs(i, e), function(t3, e2) {
            P2(P2(t3)._n).Gt(e2);
          }(i.localStore, e)) : L2(), s.label = 4;
        case 4:
          return [4, Hs(i, o)];
        case 5:
          return s.sent(), [3, 7];
        case 6:
          k2("SyncEngine", "Cannot apply mutation batch with id: " + e), s.label = 7;
        case 7:
          return [2];
      }
    });
  });
}
function tu(t2, e) {
  return __awaiter(this, void 0, void 0, function() {
    var n2, r2, i, o, s, u2, a, c;
    return __generator(this, function(h) {
      switch (h.label) {
        case 0:
          return su(n2 = P2(t2)), uu(n2), e !== true || n2.$o === true ? [3, 3] : (r2 = n2.sharedClientState.getAllActiveQueryTargets(), [4, eu(n2, r2.toArray())]);
        case 1:
          return i = h.sent(), n2.$o = true, [4, os(n2.remoteStore, true)];
        case 2:
          for (h.sent(), o = 0, s = i; o < s.length; o++)
            u2 = s[o], qo(n2.remoteStore, u2);
          return [3, 7];
        case 3:
          return e !== false || n2.$o === false ? [3, 7] : (a = [], c = Promise.resolve(), n2.Vo.forEach(function(t3, e2) {
            n2.sharedClientState.isLocalQueryTarget(e2) ? a.push(e2) : c = c.then(function() {
              return Ks(n2, e2), Wi(n2.localStore, e2, true);
            }), Uo(n2.remoteStore, e2);
          }), [4, c]);
        case 4:
          return h.sent(), [4, eu(n2, a)];
        case 5:
          return h.sent(), function(t3) {
            var e2 = P2(t3);
            e2.Co.forEach(function(t4, n3) {
              Uo(e2.remoteStore, n3);
            }), e2.No.ts(), e2.Co = new Map(), e2.Do = new ze(at.comparator);
          }(n2), n2.$o = false, [4, os(n2.remoteStore, false)];
        case 6:
          h.sent(), h.label = 7;
        case 7:
          return [2];
      }
    });
  });
}
function eu(t2, e, n2) {
  return __awaiter(this, void 0, void 0, function() {
    var n3, r2, i, o, s, u2, a, c, h, f, l, d, p2, y2;
    return __generator(this, function(v) {
      switch (v.label) {
        case 0:
          n3 = P2(t2), r2 = [], i = [], o = 0, s = e, v.label = 1;
        case 1:
          return o < s.length ? (u2 = s[o], a = void 0, (c = n3.Vo.get(u2)) && c.length !== 0 ? [4, zi(n3.localStore, ee(c[0]))] : [3, 7]) : [3, 13];
        case 2:
          a = v.sent(), h = 0, f = c, v.label = 3;
        case 3:
          return h < f.length ? (l = f[h], d = n3.Po.get(l), [4, Xs(n3, d)]) : [3, 6];
        case 4:
          (p2 = v.sent()).snapshot && i.push(p2.snapshot), v.label = 5;
        case 5:
          return h++, [3, 3];
        case 6:
          return [3, 11];
        case 7:
          return [4, Yi(n3.localStore, u2)];
        case 8:
          return y2 = v.sent(), [4, zi(n3.localStore, y2)];
        case 9:
          return a = v.sent(), [4, Rs(n3, nu(y2), u2, false)];
        case 10:
          v.sent(), v.label = 11;
        case 11:
          r2.push(a), v.label = 12;
        case 12:
          return o++, [3, 1];
        case 13:
          return [2, (n3.vo._r(i), r2)];
      }
    });
  });
}
function nu(t2) {
  return Wt(t2.path, t2.collectionGroup, t2.orderBy, t2.filters, t2.limit, "F", t2.startAt, t2.endAt);
}
function ru(t2) {
  var e = P2(t2);
  return P2(P2(e.localStore).persistence).fn();
}
function iu(t2, e, n2, r2) {
  return __awaiter(this, void 0, void 0, function() {
    var i, o, s;
    return __generator(this, function(u2) {
      switch (u2.label) {
        case 0:
          return (i = P2(t2)).$o ? (k2("SyncEngine", "Ignoring unexpected query state notification."), [3, 8]) : [3, 1];
        case 1:
          if (!i.Vo.has(e))
            return [3, 8];
          switch (n2) {
            case "current":
            case "not-current":
              return [3, 2];
            case "rejected":
              return [3, 5];
          }
          return [3, 7];
        case 2:
          return [4, $i(i.localStore)];
        case 3:
          return o = u2.sent(), s = an.createSynthesizedRemoteEventForCurrentChange(e, n2 === "current"), [4, Hs(i, o, s)];
        case 4:
          return u2.sent(), [3, 8];
        case 5:
          return [4, Wi(i.localStore, e, true)];
        case 6:
          return u2.sent(), Ks(i, e, r2), [3, 8];
        case 7:
          L2(), u2.label = 8;
        case 8:
          return [2];
      }
    });
  });
}
function ou(t2, e, n2) {
  return __awaiter(this, void 0, void 0, function() {
    var r2, i, o, s, u2, a, c, h, f, l;
    return __generator(this, function(d) {
      switch (d.label) {
        case 0:
          if (!(r2 = su(t2)).$o)
            return [3, 10];
          i = 0, o = e, d.label = 1;
        case 1:
          return i < o.length ? (s = o[i], r2.Vo.has(s) ? (k2("SyncEngine", "Adding an already active target " + s), [3, 5]) : [4, Yi(r2.localStore, s)]) : [3, 6];
        case 2:
          return u2 = d.sent(), [4, zi(r2.localStore, u2)];
        case 3:
          return a = d.sent(), [4, Rs(r2, nu(u2), a.targetId, false)];
        case 4:
          d.sent(), qo(r2.remoteStore, a), d.label = 5;
        case 5:
          return i++, [3, 1];
        case 6:
          c = function(t3) {
            return __generator(this, function(e2) {
              switch (e2.label) {
                case 0:
                  return r2.Vo.has(t3) ? [4, Wi(r2.localStore, t3, false).then(function() {
                    Uo(r2.remoteStore, t3), Ks(r2, t3);
                  }).catch(di)] : [3, 2];
                case 1:
                  e2.sent(), e2.label = 2;
                case 2:
                  return [2];
              }
            });
          }, h = 0, f = n2, d.label = 7;
        case 7:
          return h < f.length ? (l = f[h], [5, c(l)]) : [3, 10];
        case 8:
          d.sent(), d.label = 9;
        case 9:
          return h++, [3, 7];
        case 10:
          return [2];
      }
    });
  });
}
function su(t2) {
  var e = P2(t2);
  return e.remoteStore.remoteSyncer.applyRemoteEvent = Ps.bind(null, e), e.remoteStore.remoteSyncer.getRemoteKeysForTarget = $s.bind(null, e), e.remoteStore.remoteSyncer.rejectListen = Ms.bind(null, e), e.vo._r = ms.bind(null, e.eventManager), e.vo.Mo = gs.bind(null, e.eventManager), e;
}
function uu(t2) {
  var e = P2(t2);
  return e.remoteStore.remoteSyncer.applySuccessfulWrite = Vs.bind(null, e), e.remoteStore.remoteSyncer.rejectFailedWrite = qs.bind(null, e), e;
}
var cu = function() {
  function t2() {
    this.synchronizeTabs = false;
  }
  return t2.prototype.initialize = function(t3) {
    return __awaiter(this, void 0, void 0, function() {
      return __generator(this, function(e) {
        switch (e.label) {
          case 0:
            return this.R = ko(t3.databaseInfo.databaseId), this.sharedClientState = this.Bo(t3), this.persistence = this.qo(t3), [4, this.persistence.start()];
          case 1:
            return e.sent(), this.gcScheduler = this.Uo(t3), this.localStore = this.Qo(t3), [2];
        }
      });
    });
  }, t2.prototype.Uo = function(t3) {
    return null;
  }, t2.prototype.Qo = function(t3) {
    return qi(this.persistence, new Mi(), t3.initialUser, this.R);
  }, t2.prototype.qo = function(t3) {
    return new uo(co.bs, this.R);
  }, t2.prototype.Bo = function(t3) {
    return new Io();
  }, t2.prototype.terminate = function() {
    return __awaiter(this, void 0, void 0, function() {
      return __generator(this, function(t3) {
        switch (t3.label) {
          case 0:
            return this.gcScheduler && this.gcScheduler.stop(), [4, this.sharedClientState.shutdown()];
          case 1:
            return t3.sent(), [4, this.persistence.shutdown()];
          case 2:
            return t3.sent(), [2];
        }
      });
    });
  }, t2;
}();
var hu = function(t2) {
  function e(e2, n2, r2) {
    var i = this;
    return (i = t2.call(this) || this).Ko = e2, i.cacheSizeBytes = n2, i.forceOwnership = r2, i.synchronizeTabs = false, i;
  }
  return __extends(e, t2), e.prototype.initialize = function(e2) {
    return __awaiter(this, void 0, void 0, function() {
      return __generator(this, function(n2) {
        switch (n2.label) {
          case 0:
            return [4, t2.prototype.initialize.call(this, e2)];
          case 1:
            return n2.sent(), [4, Xi(this.localStore)];
          case 2:
            return n2.sent(), [4, this.Ko.initialize(this, e2)];
          case 3:
            return n2.sent(), [4, uu(this.Ko.syncEngine)];
          case 4:
            return n2.sent(), [4, Jo(this.Ko.remoteStore)];
          case 5:
            return n2.sent(), [2];
        }
      });
    });
  }, e.prototype.Qo = function(t3) {
    return qi(this.persistence, new Mi(), t3.initialUser, this.R);
  }, e.prototype.Uo = function(t3) {
    var e2 = this.persistence.referenceDelegate.garbageCollector;
    return new vi(e2, t3.asyncQueue);
  }, e.prototype.qo = function(t3) {
    var e2 = Li(t3.databaseInfo.databaseId, t3.databaseInfo.persistenceKey), n2 = this.cacheSizeBytes !== void 0 ? ti.withCacheSize(this.cacheSizeBytes) : ti.DEFAULT;
    return new Ci(this.synchronizeTabs, e2, t3.clientId, n2, t3.asyncQueue, Do(), Ao(), this.R, this.sharedClientState, !!this.forceOwnership);
  }, e.prototype.Bo = function(t3) {
    return new Io();
  }, e;
}(cu);
var fu = function(t2) {
  function e(e2, n2) {
    var r2 = this;
    return (r2 = t2.call(this, e2, n2, false) || this).Ko = e2, r2.cacheSizeBytes = n2, r2.synchronizeTabs = true, r2;
  }
  return __extends(e, t2), e.prototype.initialize = function(e2) {
    return __awaiter(this, void 0, void 0, function() {
      var n2, r2 = this;
      return __generator(this, function(i) {
        switch (i.label) {
          case 0:
            return [4, t2.prototype.initialize.call(this, e2)];
          case 1:
            return i.sent(), n2 = this.Ko.syncEngine, this.sharedClientState instanceof bo ? (this.sharedClientState.syncEngine = {
              ui: Zs.bind(null, n2),
              ai: iu.bind(null, n2),
              hi: ou.bind(null, n2),
              fn: ru.bind(null, n2),
              ci: Js.bind(null, n2)
            }, [4, this.sharedClientState.start()]) : [3, 3];
          case 2:
            i.sent(), i.label = 3;
          case 3:
            return [4, this.persistence.He(function(t3) {
              return __awaiter(r2, void 0, void 0, function() {
                return __generator(this, function(e3) {
                  switch (e3.label) {
                    case 0:
                      return [4, tu(this.Ko.syncEngine, t3)];
                    case 1:
                      return e3.sent(), this.gcScheduler && (t3 && !this.gcScheduler.started ? this.gcScheduler.start(this.localStore) : t3 || this.gcScheduler.stop()), [2];
                  }
                });
              });
            })];
          case 4:
            return i.sent(), [2];
        }
      });
    });
  }, e.prototype.Bo = function(t3) {
    var e2 = Do();
    if (!bo.yt(e2))
      throw new N2(S2.UNIMPLEMENTED, "IndexedDB persistence is only available on platforms that support LocalStorage.");
    var n2 = Li(t3.databaseInfo.databaseId, t3.databaseInfo.persistenceKey);
    return new bo(e2, t3.asyncQueue, n2, t3.clientId, t3.initialUser);
  }, e;
}(hu);
var lu = function() {
  function t2() {
  }
  return t2.prototype.initialize = function(t3, e) {
    return __awaiter(this, void 0, void 0, function() {
      var n2 = this;
      return __generator(this, function(r2) {
        switch (r2.label) {
          case 0:
            return this.localStore ? [3, 2] : (this.localStore = t3.localStore, this.sharedClientState = t3.sharedClientState, this.datastore = this.createDatastore(e), this.remoteStore = this.createRemoteStore(e), this.eventManager = this.createEventManager(e), this.syncEngine = this.createSyncEngine(e, !t3.synchronizeTabs), this.sharedClientState.onlineStateHandler = function(t4) {
              return Fs(n2.syncEngine, t4, 1);
            }, this.remoteStore.remoteSyncer.handleCredentialChange = Ys.bind(null, this.syncEngine), [4, os(this.remoteStore, this.syncEngine.isPrimaryClient)]);
          case 1:
            r2.sent(), r2.label = 2;
          case 2:
            return [2];
        }
      });
    });
  }, t2.prototype.createEventManager = function(t3) {
    return new ps();
  }, t2.prototype.createDatastore = function(t3) {
    var e, n2 = ko(t3.databaseInfo.databaseId), r2 = (e = t3.databaseInfo, new No(e));
    return function(t4, e2, n3) {
      return new Oo(t4, e2, n3);
    }(t3.credentials, r2, n2);
  }, t2.prototype.createRemoteStore = function(t3) {
    var e, n2, r2, i, o, s = this;
    return e = this.localStore, n2 = this.datastore, r2 = t3.asyncQueue, i = function(t4) {
      return Fs(s.syncEngine, t4, 0);
    }, o = To.yt() ? new To() : new Eo(), new Fo(e, n2, r2, i, o);
  }, t2.prototype.createSyncEngine = function(t3, e) {
    return function(t4, e2, n2, r2, i, o, s) {
      var u2 = new Cs(t4, e2, n2, r2, i, o);
      return s && (u2.$o = true), u2;
    }(this.localStore, this.remoteStore, this.eventManager, this.sharedClientState, t3.initialUser, t3.maxConcurrentLimboResolutions, e);
  }, t2.prototype.terminate = function() {
    return function(t3) {
      return __awaiter(this, void 0, void 0, function() {
        var e;
        return __generator(this, function(n2) {
          switch (n2.label) {
            case 0:
              return e = P2(t3), k2("RemoteStore", "RemoteStore shutting down."), e.Or.add(5), [4, Vo(e)];
            case 1:
              return n2.sent(), e.Lr.shutdown(), e.Br.set("Unknown"), [2];
          }
        });
      });
    }(this.remoteStore);
  }, t2;
}();
var pu = function() {
  function t2(t3) {
    this.observer = t3, this.muted = false;
  }
  return t2.prototype.next = function(t3) {
    this.observer.next && this.jo(this.observer.next, t3);
  }, t2.prototype.error = function(t3) {
    this.observer.error ? this.jo(this.observer.error, t3) : console.error("Uncaught Error in snapshot listener:", t3);
  }, t2.prototype.Wo = function() {
    this.muted = true;
  }, t2.prototype.jo = function(t3, e) {
    var n2 = this;
    this.muted || setTimeout(function() {
      n2.muted || t3(e);
    }, 0);
  }, t2;
}();
var yu = function() {
  function t2(t3, e) {
    var n2 = this;
    this.Go = t3, this.R = e, this.metadata = new wr(), this.buffer = new Uint8Array(), this.zo = new TextDecoder("utf-8"), this.Ho().then(function(t4) {
      t4 && t4.io() ? n2.metadata.resolve(t4.payload.metadata) : n2.metadata.reject(new Error("The first element of the bundle is not a metadata, it is\n             " + JSON.stringify(t4 == null ? void 0 : t4.payload)));
    }, function(t4) {
      return n2.metadata.reject(t4);
    });
  }
  return t2.prototype.close = function() {
    return this.Go.cancel();
  }, t2.prototype.getMetadata = function() {
    return __awaiter(this, void 0, void 0, function() {
      return __generator(this, function(t3) {
        return [2, this.metadata.promise];
      });
    });
  }, t2.prototype.Lo = function() {
    return __awaiter(this, void 0, void 0, function() {
      return __generator(this, function(t3) {
        switch (t3.label) {
          case 0:
            return [4, this.getMetadata()];
          case 1:
            return [2, (t3.sent(), this.Ho())];
        }
      });
    });
  }, t2.prototype.Ho = function() {
    return __awaiter(this, void 0, void 0, function() {
      var t3, e, n2, r2;
      return __generator(this, function(i) {
        switch (i.label) {
          case 0:
            return [4, this.Jo()];
          case 1:
            return (t3 = i.sent()) === null ? [2, null] : (e = this.zo.decode(t3), n2 = Number(e), isNaN(n2) && this.Yo("length string (" + e + ") is not valid number"), [4, this.Xo(n2)]);
          case 2:
            return r2 = i.sent(), [2, new Is(JSON.parse(r2), t3.length + n2)];
        }
      });
    });
  }, t2.prototype.Zo = function() {
    return this.buffer.findIndex(function(t3) {
      return t3 === "{".charCodeAt(0);
    });
  }, t2.prototype.Jo = function() {
    return __awaiter(this, void 0, void 0, function() {
      var t3, e;
      return __generator(this, function(n2) {
        switch (n2.label) {
          case 0:
            return this.Zo() < 0 ? [4, this.tc()] : [3, 3];
          case 1:
            if (n2.sent())
              return [3, 3];
            n2.label = 2;
          case 2:
            return [3, 0];
          case 3:
            return this.buffer.length === 0 ? [2, null] : ((t3 = this.Zo()) < 0 && this.Yo("Reached the end of bundle when a length string is expected."), e = this.buffer.slice(0, t3), [2, (this.buffer = this.buffer.slice(t3), e)]);
        }
      });
    });
  }, t2.prototype.Xo = function(t3) {
    return __awaiter(this, void 0, void 0, function() {
      var e;
      return __generator(this, function(n2) {
        switch (n2.label) {
          case 0:
            return this.buffer.length < t3 ? [4, this.tc()] : [3, 3];
          case 1:
            n2.sent() && this.Yo("Reached the end of bundle when more is expected."), n2.label = 2;
          case 2:
            return [3, 0];
          case 3:
            return e = this.zo.decode(this.buffer.slice(0, t3)), [2, (this.buffer = this.buffer.slice(t3), e)];
        }
      });
    });
  }, t2.prototype.Yo = function(t3) {
    throw this.Go.cancel(), new Error("Invalid bundle format: " + t3);
  }, t2.prototype.tc = function() {
    return __awaiter(this, void 0, void 0, function() {
      var t3, e;
      return __generator(this, function(n2) {
        switch (n2.label) {
          case 0:
            return [4, this.Go.read()];
          case 1:
            return (t3 = n2.sent()).done || ((e = new Uint8Array(this.buffer.length + t3.value.length)).set(this.buffer), e.set(t3.value, this.buffer.length), this.buffer = e), [2, t3.done];
        }
      });
    });
  }, t2;
}();
var vu = function() {
  function t2(t3) {
    this.datastore = t3, this.readVersions = new Map(), this.mutations = [], this.committed = false, this.lastWriteError = null, this.writtenDocs = new Set();
  }
  return t2.prototype.lookup = function(t3) {
    return __awaiter(this, void 0, void 0, function() {
      var e, n2 = this;
      return __generator(this, function(r2) {
        switch (r2.label) {
          case 0:
            if (this.ensureCommitNotCalled(), this.mutations.length > 0)
              throw new N2(S2.INVALID_ARGUMENT, "Firestore transactions require all reads to be executed before all writes.");
            return [4, function(t4, e2) {
              return __awaiter(this, void 0, void 0, function() {
                var n3, r3, i, o, s, u2;
                return __generator(this, function(a) {
                  switch (a.label) {
                    case 0:
                      return n3 = P2(t4), r3 = Cn(n3.R) + "/documents", i = {
                        documents: e2.map(function(t5) {
                          return Nn(n3.R, t5);
                        })
                      }, [4, n3.$i("BatchGetDocuments", r3, i)];
                    case 1:
                      return o = a.sent(), s = new Map(), o.forEach(function(t5) {
                        var e3 = function(t6, e4) {
                          return "found" in e4 ? function(t7, e5) {
                            O2(!!e5.found), e5.found.name, e5.found.updateTime;
                            var n4 = Dn(t7, e5.found.name), r4 = Tn(e5.found.updateTime), i2 = new Tt({
                              mapValue: {
                                fields: e5.found.fields
                              }
                            });
                            return St.newFoundDocument(n4, r4, i2);
                          }(t6, e4) : "missing" in e4 ? function(t7, e5) {
                            O2(!!e5.missing), O2(!!e5.readTime);
                            var n4 = Dn(t7, e5.missing), r4 = Tn(e5.readTime);
                            return St.newNoDocument(n4, r4);
                          }(t6, e4) : L2();
                        }(n3.R, t5);
                        s.set(e3.key.toString(), e3);
                      }), u2 = [], [2, (e2.forEach(function(t5) {
                        var e3 = s.get(t5.toString());
                        O2(!!e3), u2.push(e3);
                      }), u2)];
                  }
                });
              });
            }(this.datastore, t3)];
          case 1:
            return [2, ((e = r2.sent()).forEach(function(t4) {
              return n2.recordVersion(t4);
            }), e)];
        }
      });
    });
  }, t2.prototype.set = function(t3, e) {
    this.write(e.toMutation(t3, this.precondition(t3))), this.writtenDocs.add(t3.toString());
  }, t2.prototype.update = function(t3, e) {
    try {
      this.write(e.toMutation(t3, this.preconditionForUpdate(t3)));
    } catch (t4) {
      this.lastWriteError = t4;
    }
    this.writtenDocs.add(t3.toString());
  }, t2.prototype.delete = function(t3) {
    this.write(new Be(t3, this.precondition(t3))), this.writtenDocs.add(t3.toString());
  }, t2.prototype.commit = function() {
    return __awaiter(this, void 0, void 0, function() {
      var t3, e = this;
      return __generator(this, function(n2) {
        switch (n2.label) {
          case 0:
            if (this.ensureCommitNotCalled(), this.lastWriteError)
              throw this.lastWriteError;
            return t3 = this.readVersions, this.mutations.forEach(function(e2) {
              t3.delete(e2.key.toString());
            }), t3.forEach(function(t4, n3) {
              var r2 = at.fromPath(n3);
              e.mutations.push(new je(r2, e.precondition(r2)));
            }), [4, function(t4, e2) {
              return __awaiter(this, void 0, void 0, function() {
                var n3, r2, i;
                return __generator(this, function(o) {
                  switch (o.label) {
                    case 0:
                      return n3 = P2(t4), r2 = Cn(n3.R) + "/documents", i = {
                        writes: e2.map(function(t5) {
                          return On(n3.R, t5);
                        })
                      }, [4, n3.Ni("Commit", r2, i)];
                    case 1:
                      return o.sent(), [2];
                  }
                });
              });
            }(this.datastore, this.mutations)];
          case 1:
            return n2.sent(), this.committed = true, [2];
        }
      });
    });
  }, t2.prototype.recordVersion = function(t3) {
    var e;
    if (t3.isFoundDocument())
      e = t3.version;
    else {
      if (!t3.isNoDocument())
        throw L2();
      e = j.min();
    }
    var n2 = this.readVersions.get(t3.key.toString());
    if (n2) {
      if (!e.isEqual(n2))
        throw new N2(S2.ABORTED, "Document version changed between two reads.");
    } else
      this.readVersions.set(t3.key.toString(), e);
  }, t2.prototype.precondition = function(t3) {
    var e = this.readVersions.get(t3.toString());
    return !this.writtenDocs.has(t3.toString()) && e ? Ne.updateTime(e) : Ne.none();
  }, t2.prototype.preconditionForUpdate = function(t3) {
    var e = this.readVersions.get(t3.toString());
    if (!this.writtenDocs.has(t3.toString()) && e) {
      if (e.isEqual(j.min()))
        throw new N2(S2.INVALID_ARGUMENT, "Can't update a document that doesn't exist.");
      return Ne.updateTime(e);
    }
    return Ne.exists(true);
  }, t2.prototype.write = function(t3) {
    this.ensureCommitNotCalled(), this.mutations.push(t3);
  }, t2.prototype.ensureCommitNotCalled = function() {
  }, t2;
}();
var mu = function() {
  function t2(t3, e, n2, r2) {
    this.asyncQueue = t3, this.datastore = e, this.updateFunction = n2, this.deferred = r2, this.ec = 5, this.Zi = new Co(this.asyncQueue, "transaction_retry");
  }
  return t2.prototype.run = function() {
    this.nc();
  }, t2.prototype.nc = function() {
    var t3 = this;
    this.Zi.ji(function() {
      return __awaiter(t3, void 0, void 0, function() {
        var t4, e, n2 = this;
        return __generator(this, function(r2) {
          return t4 = new vu(this.datastore), (e = this.sc(t4)) && e.then(function(e2) {
            n2.asyncQueue.enqueueAndForget(function() {
              return t4.commit().then(function() {
                n2.deferred.resolve(e2);
              }).catch(function(t5) {
                n2.ic(t5);
              });
            });
          }).catch(function(t5) {
            n2.ic(t5);
          }), [2];
        });
      });
    });
  }, t2.prototype.sc = function(t3) {
    try {
      var e = this.updateFunction(t3);
      return !ot(e) && e.catch && e.then ? e : (this.deferred.reject(Error("Transaction callback must return a Promise")), null);
    } catch (t4) {
      return this.deferred.reject(t4), null;
    }
  }, t2.prototype.ic = function(t3) {
    var e = this;
    this.ec > 0 && this.rc(t3) ? (this.ec -= 1, this.asyncQueue.enqueueAndForget(function() {
      return e.nc(), Promise.resolve();
    })) : this.deferred.reject(t3);
  }, t2.prototype.rc = function(t3) {
    if (t3.name === "FirebaseError") {
      var e = t3.code;
      return e === "aborted" || e === "failed-precondition" || !Ge(e);
    }
    return false;
  }, t2;
}();
var gu = function() {
  function t2(t3, e, n2) {
    var r2 = this;
    this.credentials = t3, this.asyncQueue = e, this.databaseInfo = n2, this.user = ho.UNAUTHENTICATED, this.clientId = M2.u(), this.credentialListener = function() {
      return Promise.resolve();
    }, this.credentials.setChangeListener(e, function(t4) {
      return __awaiter(r2, void 0, void 0, function() {
        return __generator(this, function(e2) {
          switch (e2.label) {
            case 0:
              return k2("FirestoreClient", "Received user=", t4.uid), [4, this.credentialListener(t4)];
            case 1:
              return e2.sent(), this.user = t4, [2];
          }
        });
      });
    });
  }
  return t2.prototype.getConfiguration = function() {
    return __awaiter(this, void 0, void 0, function() {
      return __generator(this, function(t3) {
        return [2, {
          asyncQueue: this.asyncQueue,
          databaseInfo: this.databaseInfo,
          clientId: this.clientId,
          credentials: this.credentials,
          initialUser: this.user,
          maxConcurrentLimboResolutions: 100
        }];
      });
    });
  }, t2.prototype.setCredentialChangeListener = function(t3) {
    this.credentialListener = t3;
  }, t2.prototype.verifyNotTerminated = function() {
    if (this.asyncQueue.isShuttingDown)
      throw new N2(S2.FAILED_PRECONDITION, "The client has already been terminated.");
  }, t2.prototype.terminate = function() {
    var t3 = this;
    this.asyncQueue.enterRestrictedMode();
    var e = new wr();
    return this.asyncQueue.enqueueAndForgetEvenWhileRestricted(function() {
      return __awaiter(t3, void 0, void 0, function() {
        var t4, n2;
        return __generator(this, function(r2) {
          switch (r2.label) {
            case 0:
              return r2.trys.push([0, 5, , 6]), this.onlineComponents ? [4, this.onlineComponents.terminate()] : [3, 2];
            case 1:
              r2.sent(), r2.label = 2;
            case 2:
              return this.offlineComponents ? [4, this.offlineComponents.terminate()] : [3, 4];
            case 3:
              r2.sent(), r2.label = 4;
            case 4:
              return this.credentials.removeChangeListener(), e.resolve(), [3, 6];
            case 5:
              return t4 = r2.sent(), n2 = cs(t4, "Failed to shutdown persistence"), e.reject(n2), [3, 6];
            case 6:
              return [2];
          }
        });
      });
    }), e.promise;
  }, t2;
}();
function wu(t2, e) {
  return __awaiter(this, void 0, void 0, function() {
    var n2, r2, i = this;
    return __generator(this, function(o) {
      switch (o.label) {
        case 0:
          return t2.asyncQueue.verifyOperationInProgress(), k2("FirestoreClient", "Initializing OfflineComponentProvider"), [4, t2.getConfiguration()];
        case 1:
          return n2 = o.sent(), [4, e.initialize(n2)];
        case 2:
          return o.sent(), r2 = n2.initialUser, t2.setCredentialChangeListener(function(t3) {
            return __awaiter(i, void 0, void 0, function() {
              return __generator(this, function(n3) {
                switch (n3.label) {
                  case 0:
                    return r2.isEqual(t3) ? [3, 2] : [4, Ui(e.localStore, t3)];
                  case 1:
                    n3.sent(), r2 = t3, n3.label = 2;
                  case 2:
                    return [2];
                }
              });
            });
          }), e.persistence.setDatabaseDeletedListener(function() {
            return t2.terminate();
          }), t2.offlineComponents = e, [2];
      }
    });
  });
}
function bu(t2, e) {
  return __awaiter(this, void 0, void 0, function() {
    var n2, r2;
    return __generator(this, function(i) {
      switch (i.label) {
        case 0:
          return t2.asyncQueue.verifyOperationInProgress(), [4, Iu(t2)];
        case 1:
          return n2 = i.sent(), k2("FirestoreClient", "Initializing OnlineComponentProvider"), [4, t2.getConfiguration()];
        case 2:
          return r2 = i.sent(), [4, e.initialize(n2, r2)];
        case 3:
          return i.sent(), t2.setCredentialChangeListener(function(t3) {
            return function(t4, e2) {
              return __awaiter(this, void 0, void 0, function() {
                var n3, r3;
                return __generator(this, function(i2) {
                  switch (i2.label) {
                    case 0:
                      return (n3 = P2(t4)).asyncQueue.verifyOperationInProgress(), k2("RemoteStore", "RemoteStore received new credentials"), r3 = Qo(n3), n3.Or.add(3), [4, Vo(n3)];
                    case 1:
                      return i2.sent(), r3 && n3.Br.set("Unknown"), [4, n3.remoteSyncer.handleCredentialChange(e2)];
                    case 2:
                      return i2.sent(), n3.Or.delete(3), [4, Mo(n3)];
                    case 3:
                      return i2.sent(), [2];
                  }
                });
              });
            }(e.remoteStore, t3);
          }), t2.onlineComponents = e, [2];
      }
    });
  });
}
function Iu(t2) {
  return __awaiter(this, void 0, void 0, function() {
    return __generator(this, function(e) {
      switch (e.label) {
        case 0:
          return t2.offlineComponents ? [3, 2] : (k2("FirestoreClient", "Using default OfflineComponentProvider"), [4, wu(t2, new cu())]);
        case 1:
          e.sent(), e.label = 2;
        case 2:
          return [2, t2.offlineComponents];
      }
    });
  });
}
function Eu(t2) {
  return __awaiter(this, void 0, void 0, function() {
    return __generator(this, function(e) {
      switch (e.label) {
        case 0:
          return t2.onlineComponents ? [3, 2] : (k2("FirestoreClient", "Using default OnlineComponentProvider"), [4, bu(t2, new lu())]);
        case 1:
          e.sent(), e.label = 2;
        case 2:
          return [2, t2.onlineComponents];
      }
    });
  });
}
function Tu(t2) {
  return Iu(t2).then(function(t3) {
    return t3.persistence;
  });
}
function _u(t2) {
  return Iu(t2).then(function(t3) {
    return t3.localStore;
  });
}
function Su(t2) {
  return Eu(t2).then(function(t3) {
    return t3.remoteStore;
  });
}
function Nu(t2) {
  return Eu(t2).then(function(t3) {
    return t3.syncEngine;
  });
}
function Du(t2) {
  return __awaiter(this, void 0, void 0, function() {
    var e, n2;
    return __generator(this, function(r2) {
      switch (r2.label) {
        case 0:
          return [4, Eu(t2)];
        case 1:
          return e = r2.sent(), [2, ((n2 = e.eventManager).onListen = xs.bind(null, e.syncEngine), n2.onUnlisten = Ls.bind(null, e.syncEngine), n2)];
      }
    });
  });
}
function Au(t2, e, n2) {
  var r2 = this;
  n2 === void 0 && (n2 = {});
  var i = new wr();
  return t2.asyncQueue.enqueueAndForget(function() {
    return __awaiter(r2, void 0, void 0, function() {
      var r3;
      return __generator(this, function(o) {
        switch (o.label) {
          case 0:
            return r3 = function(t3, e2, n3, r4, i2) {
              var o2 = new pu({
                next: function(o3) {
                  e2.enqueueAndForget(function() {
                    return vs(t3, s);
                  });
                  var u2 = o3.docs.has(n3);
                  !u2 && o3.fromCache ? i2.reject(new N2(S2.UNAVAILABLE, "Failed to get document because the client is offline.")) : u2 && o3.fromCache && r4 && r4.source === "server" ? i2.reject(new N2(S2.UNAVAILABLE, 'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')) : i2.resolve(o3);
                },
                error: function(t4) {
                  return i2.reject(t4);
                }
              }), s = new bs(Ht(n3.path), o2, {
                includeMetadataChanges: true,
                so: true
              });
              return ys(t3, s);
            }, [4, Du(t2)];
          case 1:
            return [2, r3.apply(void 0, [o.sent(), t2.asyncQueue, e, n2, i])];
        }
      });
    });
  }), i.promise;
}
function ku(t2, e, n2) {
  var r2 = this;
  n2 === void 0 && (n2 = {});
  var i = new wr();
  return t2.asyncQueue.enqueueAndForget(function() {
    return __awaiter(r2, void 0, void 0, function() {
      var r3;
      return __generator(this, function(o) {
        switch (o.label) {
          case 0:
            return r3 = function(t3, e2, n3, r4, i2) {
              var o2 = new pu({
                next: function(n4) {
                  e2.enqueueAndForget(function() {
                    return vs(t3, s);
                  }), n4.fromCache && r4.source === "server" ? i2.reject(new N2(S2.UNAVAILABLE, 'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')) : i2.resolve(n4);
                },
                error: function(t4) {
                  return i2.reject(t4);
                }
              }), s = new bs(n3, o2, {
                includeMetadataChanges: true,
                so: true
              });
              return ys(t3, s);
            }, [4, Du(t2)];
          case 1:
            return [2, r3.apply(void 0, [o.sent(), t2.asyncQueue, e, n2, i])];
        }
      });
    });
  }), i.promise;
}
var Cu = function(t2, e, n2, r2, i, o, s, u2) {
  this.databaseId = t2, this.appId = e, this.persistenceKey = n2, this.host = r2, this.ssl = i, this.forceLongPolling = o, this.autoDetectLongPolling = s, this.useFetchStreams = u2;
};
var xu = function() {
  function t2(t3, e) {
    this.projectId = t3, this.database = e || "(default)";
  }
  return Object.defineProperty(t2.prototype, "isDefaultDatabase", {
    get: function() {
      return this.database === "(default)";
    },
    enumerable: false,
    configurable: true
  }), t2.prototype.isEqual = function(e) {
    return e instanceof t2 && e.projectId === this.projectId && e.database === this.database;
  }, t2;
}();
var Ru = new Map();
var Lu = function(t2, e) {
  this.user = e, this.type = "OAuth", this.authHeaders = {}, this.authHeaders.Authorization = "Bearer " + t2;
};
var Ou = function() {
  function t2() {
    this.changeListener = null;
  }
  return t2.prototype.getToken = function() {
    return Promise.resolve(null);
  }, t2.prototype.invalidateToken = function() {
  }, t2.prototype.setChangeListener = function(t3, e) {
    this.changeListener = e, t3.enqueueRetryable(function() {
      return e(ho.UNAUTHENTICATED);
    });
  }, t2.prototype.removeChangeListener = function() {
    this.changeListener = null;
  }, t2;
}();
var Pu = function() {
  function t2(t3) {
    this.token = t3, this.changeListener = null;
  }
  return t2.prototype.getToken = function() {
    return Promise.resolve(this.token);
  }, t2.prototype.invalidateToken = function() {
  }, t2.prototype.setChangeListener = function(t3, e) {
    var n2 = this;
    this.changeListener = e, t3.enqueueRetryable(function() {
      return e(n2.token.user);
    });
  }, t2.prototype.removeChangeListener = function() {
    this.changeListener = null;
  }, t2;
}();
var Fu = function() {
  function t2(t3) {
    var e = this;
    this.currentUser = ho.UNAUTHENTICATED, this.oc = new wr(), this.cc = 0, this.forceRefresh = false, this.auth = null, this.asyncQueue = null, this.uc = function() {
      e.cc++, e.currentUser = e.ac(), e.oc.resolve(), e.changeListener && e.asyncQueue.enqueueRetryable(function() {
        return e.changeListener(e.currentUser);
      });
    };
    var n2 = function(t4) {
      k2("FirebaseCredentialsProvider", "Auth detected"), e.auth = t4, e.auth.addAuthTokenListener(e.uc);
    };
    t3.onInit(function(t4) {
      return n2(t4);
    }), setTimeout(function() {
      if (!e.auth) {
        var r2 = t3.getImmediate({
          optional: true
        });
        r2 ? n2(r2) : (k2("FirebaseCredentialsProvider", "Auth not yet detected"), e.oc.resolve());
      }
    }, 0);
  }
  return t2.prototype.getToken = function() {
    var t3 = this, e = this.cc, n2 = this.forceRefresh;
    return this.forceRefresh = false, this.auth ? this.auth.getToken(n2).then(function(n3) {
      return t3.cc !== e ? (k2("FirebaseCredentialsProvider", "getToken aborted due to token change."), t3.getToken()) : n3 ? (O2(typeof n3.accessToken == "string"), new Lu(n3.accessToken, t3.currentUser)) : null;
    }) : Promise.resolve(null);
  }, t2.prototype.invalidateToken = function() {
    this.forceRefresh = true;
  }, t2.prototype.setChangeListener = function(t3, e) {
    var n2 = this;
    this.asyncQueue = t3, this.asyncQueue.enqueueRetryable(function() {
      return __awaiter(n2, void 0, void 0, function() {
        return __generator(this, function(t4) {
          switch (t4.label) {
            case 0:
              return [4, this.oc.promise];
            case 1:
              return t4.sent(), [4, e(this.currentUser)];
            case 2:
              return t4.sent(), this.changeListener = e, [2];
          }
        });
      });
    });
  }, t2.prototype.removeChangeListener = function() {
    this.auth && this.auth.removeAuthTokenListener(this.uc), this.changeListener = function() {
      return Promise.resolve();
    };
  }, t2.prototype.ac = function() {
    var t3 = this.auth && this.auth.getUid();
    return O2(t3 === null || typeof t3 == "string"), new ho(t3);
  }, t2;
}();
var Mu = function() {
  function t2(t3, e, n2) {
    this.hc = t3, this.lc = e, this.fc = n2, this.type = "FirstParty", this.user = ho.FIRST_PARTY;
  }
  return Object.defineProperty(t2.prototype, "authHeaders", {
    get: function() {
      var t3 = {
        "X-Goog-AuthUser": this.lc
      }, e = this.hc.auth.getAuthHeaderValueForFirstParty([]);
      return e && (t3.Authorization = e), this.fc && (t3["X-Goog-Iam-Authorization-Token"] = this.fc), t3;
    },
    enumerable: false,
    configurable: true
  }), t2;
}();
var Vu = function() {
  function t2(t3, e, n2) {
    this.hc = t3, this.lc = e, this.fc = n2;
  }
  return t2.prototype.getToken = function() {
    return Promise.resolve(new Mu(this.hc, this.lc, this.fc));
  }, t2.prototype.setChangeListener = function(t3, e) {
    t3.enqueueRetryable(function() {
      return e(ho.FIRST_PARTY);
    });
  }, t2.prototype.removeChangeListener = function() {
  }, t2.prototype.invalidateToken = function() {
  }, t2;
}();
function qu(t2, e, n2) {
  if (!n2)
    throw new N2(S2.INVALID_ARGUMENT, "Function " + t2 + "() cannot be called with an empty " + e + ".");
}
function Uu(t2, e) {
  if (e === void 0)
    return {
      merge: false
    };
  if (e.mergeFields !== void 0 && e.merge !== void 0)
    throw new N2(S2.INVALID_ARGUMENT, "Invalid options passed to function " + t2 + '(): You cannot specify both "merge" and "mergeFields".');
  return e;
}
function Bu(t2, e, n2, r2) {
  if (e === true && r2 === true)
    throw new N2(S2.INVALID_ARGUMENT, t2 + " and " + n2 + " cannot be used together.");
}
function ju(t2) {
  if (!at.isDocumentKey(t2))
    throw new N2(S2.INVALID_ARGUMENT, "Invalid document reference. Document references must have an even number of segments, but " + t2 + " has " + t2.length + ".");
}
function Ku(t2) {
  if (at.isDocumentKey(t2))
    throw new N2(S2.INVALID_ARGUMENT, "Invalid collection reference. Collection references must have an odd number of segments, but " + t2 + " has " + t2.length + ".");
}
function Gu(t2) {
  if (t2 === void 0)
    return "undefined";
  if (t2 === null)
    return "null";
  if (typeof t2 == "string")
    return t2.length > 20 && (t2 = t2.substring(0, 20) + "..."), JSON.stringify(t2);
  if (typeof t2 == "number" || typeof t2 == "boolean")
    return "" + t2;
  if (typeof t2 == "object") {
    if (t2 instanceof Array)
      return "an array";
    var e = function(t3) {
      if (t3.constructor) {
        var e2 = /function\s+([^\s(]+)\s*\(/.exec(t3.constructor.toString());
        if (e2 && e2.length > 1)
          return e2[1];
      }
      return null;
    }(t2);
    return e ? "a custom " + e + " object" : "an object";
  }
  return typeof t2 == "function" ? "a function" : L2();
}
function Qu(t2, e) {
  if ("_delegate" in t2 && (t2 = t2._delegate), !(t2 instanceof e)) {
    if (e.name === t2.constructor.name)
      throw new N2(S2.INVALID_ARGUMENT, "Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");
    var n2 = Gu(t2);
    throw new N2(S2.INVALID_ARGUMENT, "Expected type '" + e.name + "', but it was: " + n2);
  }
  return t2;
}
function zu(t2, e) {
  if (e <= 0)
    throw new N2(S2.INVALID_ARGUMENT, "Function " + t2 + "() requires a positive number, but it was: " + e + ".");
}
var Wu = function() {
  function t2(t3) {
    var e;
    if (t3.host === void 0) {
      if (t3.ssl !== void 0)
        throw new N2(S2.INVALID_ARGUMENT, "Can't provide ssl option if host option is not set");
      this.host = "firestore.googleapis.com", this.ssl = true;
    } else
      this.host = t3.host, this.ssl = (e = t3.ssl) === null || e === void 0 || e;
    if (this.credentials = t3.credentials, this.ignoreUndefinedProperties = !!t3.ignoreUndefinedProperties, t3.cacheSizeBytes === void 0)
      this.cacheSizeBytes = 41943040;
    else {
      if (t3.cacheSizeBytes !== -1 && t3.cacheSizeBytes < 1048576)
        throw new N2(S2.INVALID_ARGUMENT, "cacheSizeBytes must be at least 1048576");
      this.cacheSizeBytes = t3.cacheSizeBytes;
    }
    this.experimentalForceLongPolling = !!t3.experimentalForceLongPolling, this.experimentalAutoDetectLongPolling = !!t3.experimentalAutoDetectLongPolling, this.useFetchStreams = !!t3.useFetchStreams, Bu("experimentalForceLongPolling", t3.experimentalForceLongPolling, "experimentalAutoDetectLongPolling", t3.experimentalAutoDetectLongPolling);
  }
  return t2.prototype.isEqual = function(t3) {
    return this.host === t3.host && this.ssl === t3.ssl && this.credentials === t3.credentials && this.cacheSizeBytes === t3.cacheSizeBytes && this.experimentalForceLongPolling === t3.experimentalForceLongPolling && this.experimentalAutoDetectLongPolling === t3.experimentalAutoDetectLongPolling && this.ignoreUndefinedProperties === t3.ignoreUndefinedProperties && this.useFetchStreams === t3.useFetchStreams;
  }, t2;
}();
var Hu = function() {
  function t2(t3, e) {
    this.type = "firestore-lite", this._persistenceKey = "(lite)", this._settings = new Wu({}), this._settingsFrozen = false, t3 instanceof xu ? (this._databaseId = t3, this._credentials = new Ou()) : (this._app = t3, this._databaseId = function(t4) {
      if (!Object.prototype.hasOwnProperty.apply(t4.options, ["projectId"]))
        throw new N2(S2.INVALID_ARGUMENT, '"projectId" not provided in firebase.initializeApp.');
      return new xu(t4.options.projectId);
    }(t3), this._credentials = new Fu(e));
  }
  return Object.defineProperty(t2.prototype, "app", {
    get: function() {
      if (!this._app)
        throw new N2(S2.FAILED_PRECONDITION, "Firestore was not initialized using the Firebase SDK. 'app' is not available");
      return this._app;
    },
    enumerable: false,
    configurable: true
  }), Object.defineProperty(t2.prototype, "_initialized", {
    get: function() {
      return this._settingsFrozen;
    },
    enumerable: false,
    configurable: true
  }), Object.defineProperty(t2.prototype, "_terminated", {
    get: function() {
      return this._terminateTask !== void 0;
    },
    enumerable: false,
    configurable: true
  }), t2.prototype._setSettings = function(t3) {
    if (this._settingsFrozen)
      throw new N2(S2.FAILED_PRECONDITION, "Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");
    this._settings = new Wu(t3), t3.credentials !== void 0 && (this._credentials = function(t4) {
      if (!t4)
        return new Ou();
      switch (t4.type) {
        case "gapi":
          var e = t4.client;
          return O2(!(typeof e != "object" || e === null || !e.auth || !e.auth.getAuthHeaderValueForFirstParty)), new Vu(e, t4.sessionIndex || "0", t4.iamToken || null);
        case "provider":
          return t4.client;
        default:
          throw new N2(S2.INVALID_ARGUMENT, "makeCredentialsProvider failed due to invalid credential type");
      }
    }(t3.credentials));
  }, t2.prototype._getSettings = function() {
    return this._settings;
  }, t2.prototype._freezeSettings = function() {
    return this._settingsFrozen = true, this._settings;
  }, t2.prototype._delete = function() {
    return this._terminateTask || (this._terminateTask = this._terminate()), this._terminateTask;
  }, t2.prototype.toJSON = function() {
    return {
      app: this._app,
      databaseId: this._databaseId,
      settings: this._settings
    };
  }, t2.prototype._terminate = function() {
    return t3 = this, (e = Ru.get(t3)) && (k2("ComponentProvider", "Removing Datastore"), Ru.delete(t3), e.terminate()), Promise.resolve();
    var t3, e;
  }, t2;
}();
var Yu = function() {
  function t2(t3, e, n2) {
    this.converter = e, this._key = n2, this.type = "document", this.firestore = t3;
  }
  return Object.defineProperty(t2.prototype, "_path", {
    get: function() {
      return this._key.path;
    },
    enumerable: false,
    configurable: true
  }), Object.defineProperty(t2.prototype, "id", {
    get: function() {
      return this._key.path.lastSegment();
    },
    enumerable: false,
    configurable: true
  }), Object.defineProperty(t2.prototype, "path", {
    get: function() {
      return this._key.path.canonicalString();
    },
    enumerable: false,
    configurable: true
  }), Object.defineProperty(t2.prototype, "parent", {
    get: function() {
      return new Xu(this.firestore, this.converter, this._key.path.popLast());
    },
    enumerable: false,
    configurable: true
  }), t2.prototype.withConverter = function(e) {
    return new t2(this.firestore, e, this._key);
  }, t2;
}();
var $u = function() {
  function t2(t3, e, n2) {
    this.converter = e, this._query = n2, this.type = "query", this.firestore = t3;
  }
  return t2.prototype.withConverter = function(e) {
    return new t2(this.firestore, e, this._query);
  }, t2;
}();
var Xu = function(t2) {
  function e(e2, n2, r2) {
    var i = this;
    return (i = t2.call(this, e2, n2, Ht(r2)) || this)._path = r2, i.type = "collection", i;
  }
  return __extends(e, t2), Object.defineProperty(e.prototype, "id", {
    get: function() {
      return this._query.path.lastSegment();
    },
    enumerable: false,
    configurable: true
  }), Object.defineProperty(e.prototype, "path", {
    get: function() {
      return this._query.path.canonicalString();
    },
    enumerable: false,
    configurable: true
  }), Object.defineProperty(e.prototype, "parent", {
    get: function() {
      var t3 = this._path.popLast();
      return t3.isEmpty() ? null : new Yu(this.firestore, null, new at(t3));
    },
    enumerable: false,
    configurable: true
  }), e.prototype.withConverter = function(t3) {
    return new e(this.firestore, t3, this._path);
  }, e;
}($u);
function Ju(t2, e) {
  for (var n2, r2 = [], i = 2; i < arguments.length; i++)
    r2[i - 2] = arguments[i];
  if (t2 = getModularInstance(t2), qu("collection", "path", e), t2 instanceof Hu)
    return Ku(n2 = W2.fromString.apply(W2, __spreadArray([e], r2))), new Xu(t2, null, n2);
  if (!(t2 instanceof Yu || t2 instanceof Xu))
    throw new N2(S2.INVALID_ARGUMENT, "Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");
  return Ku(n2 = W2.fromString.apply(W2, __spreadArray([t2.path], r2)).child(W2.fromString(e))), new Xu(t2.firestore, null, n2);
}
function Zu(t2, e) {
  for (var n2, r2 = [], i = 2; i < arguments.length; i++)
    r2[i - 2] = arguments[i];
  if (t2 = getModularInstance(t2), arguments.length === 1 && (e = M2.u()), qu("doc", "path", e), t2 instanceof Hu)
    return ju(n2 = W2.fromString.apply(W2, __spreadArray([e], r2))), new Yu(t2, null, new at(n2));
  if (!(t2 instanceof Yu || t2 instanceof Xu))
    throw new N2(S2.INVALID_ARGUMENT, "Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");
  return ju(n2 = t2._path.child(W2.fromString.apply(W2, __spreadArray([e], r2)))), new Yu(t2.firestore, t2 instanceof Xu ? t2.converter : null, new at(n2));
}
function ta2(t2, e) {
  return t2 = getModularInstance(t2), e = getModularInstance(e), (t2 instanceof Yu || t2 instanceof Xu) && (e instanceof Yu || e instanceof Xu) && t2.firestore === e.firestore && t2.path === e.path && t2.converter === e.converter;
}
function ea2(t2, e) {
  return t2 = getModularInstance(t2), e = getModularInstance(e), t2 instanceof $u && e instanceof $u && t2.firestore === e.firestore && re(t2._query, e._query) && t2.converter === e.converter;
}
var na2 = function() {
  function t2() {
    var t3 = this;
    this.dc = Promise.resolve(), this.wc = [], this._c = false, this.mc = [], this.yc = null, this.gc = false, this.Ec = [], this.Zi = new Co(this, "async_queue_retry"), this.Tc = function() {
      var e2 = Ao();
      e2 && k2("AsyncQueue", "Visibility state changed to " + e2.visibilityState), t3.Zi.Gi();
    };
    var e = Ao();
    e && typeof e.addEventListener == "function" && e.addEventListener("visibilitychange", this.Tc);
  }
  return Object.defineProperty(t2.prototype, "isShuttingDown", {
    get: function() {
      return this._c;
    },
    enumerable: false,
    configurable: true
  }), t2.prototype.enqueueAndForget = function(t3) {
    this.enqueue(t3);
  }, t2.prototype.enqueueAndForgetEvenWhileRestricted = function(t3) {
    this.Ic(), this.Ac(t3);
  }, t2.prototype.enterRestrictedMode = function() {
    if (!this._c) {
      this._c = true;
      var t3 = Ao();
      t3 && typeof t3.removeEventListener == "function" && t3.removeEventListener("visibilitychange", this.Tc);
    }
  }, t2.prototype.enqueue = function(t3) {
    return this.Ic(), this._c ? new Promise(function(t4) {
    }) : this.Ac(t3);
  }, t2.prototype.enqueueRetryable = function(t3) {
    var e = this;
    this.enqueueAndForget(function() {
      return e.wc.push(t3), e.Rc();
    });
  }, t2.prototype.Rc = function() {
    return __awaiter(this, void 0, void 0, function() {
      var t3, e = this;
      return __generator(this, function(n2) {
        switch (n2.label) {
          case 0:
            if (this.wc.length === 0)
              return [3, 5];
            n2.label = 1;
          case 1:
            return n2.trys.push([1, 3, , 4]), [4, this.wc[0]()];
          case 2:
            return n2.sent(), this.wc.shift(), this.Zi.reset(), [3, 4];
          case 3:
            if (!Sr(t3 = n2.sent()))
              throw t3;
            return k2("AsyncQueue", "Operation failed with retryable error: " + t3), [3, 4];
          case 4:
            this.wc.length > 0 && this.Zi.ji(function() {
              return e.Rc();
            }), n2.label = 5;
          case 5:
            return [2];
        }
      });
    });
  }, t2.prototype.Ac = function(t3) {
    var e = this, n2 = this.dc.then(function() {
      return e.gc = true, t3().catch(function(t4) {
        throw e.yc = t4, e.gc = false, C("INTERNAL UNHANDLED ERROR: ", function(t5) {
          var e2 = t5.message || "";
          return t5.stack && (e2 = t5.stack.includes(t5.message) ? t5.stack : t5.message + "\n" + t5.stack), e2;
        }(t4)), t4;
      }).then(function(t4) {
        return e.gc = false, t4;
      });
    });
    return this.dc = n2, n2;
  }, t2.prototype.enqueueAfterDelay = function(t3, e, n2) {
    var r2 = this;
    this.Ic(), this.Ec.indexOf(t3) > -1 && (e = 0);
    var i = as.createAndSchedule(this, t3, e, n2, function(t4) {
      return r2.bc(t4);
    });
    return this.mc.push(i), i;
  }, t2.prototype.Ic = function() {
    this.yc && L2();
  }, t2.prototype.verifyOperationInProgress = function() {
  }, t2.prototype.vc = function() {
    return __awaiter(this, void 0, void 0, function() {
      var t3;
      return __generator(this, function(e) {
        switch (e.label) {
          case 0:
            return [4, t3 = this.dc];
          case 1:
            e.sent(), e.label = 2;
          case 2:
            if (t3 !== this.dc)
              return [3, 0];
            e.label = 3;
          case 3:
            return [2];
        }
      });
    });
  }, t2.prototype.Pc = function(t3) {
    for (var e = 0, n2 = this.mc; e < n2.length; e++) {
      if (n2[e].timerId === t3)
        return true;
    }
    return false;
  }, t2.prototype.Vc = function(t3) {
    var e = this;
    return this.vc().then(function() {
      e.mc.sort(function(t4, e2) {
        return t4.targetTimeMs - e2.targetTimeMs;
      });
      for (var n2 = 0, r2 = e.mc; n2 < r2.length; n2++) {
        var i = r2[n2];
        if (i.skipDelay(), t3 !== "all" && i.timerId === t3)
          break;
      }
      return e.vc();
    });
  }, t2.prototype.Sc = function(t3) {
    this.Ec.push(t3);
  }, t2.prototype.bc = function(t3) {
    var e = this.mc.indexOf(t3);
    this.mc.splice(e, 1);
  }, t2;
}();
function ra2(t2) {
  return function(t3, e) {
    if (typeof t3 != "object" || t3 === null)
      return false;
    for (var n2 = t3, r2 = 0, i = ["next", "error", "complete"]; r2 < i.length; r2++) {
      var o = i[r2];
      if (o in n2 && typeof n2[o] == "function")
        return true;
    }
    return false;
  }(t2);
}
var ia2 = function() {
  function t2() {
    this._progressObserver = {}, this._taskCompletionResolver = new wr(), this._lastProgress = {
      taskState: "Running",
      totalBytes: 0,
      totalDocuments: 0,
      bytesLoaded: 0,
      documentsLoaded: 0
    };
  }
  return t2.prototype.onProgress = function(t3, e, n2) {
    this._progressObserver = {
      next: t3,
      error: e,
      complete: n2
    };
  }, t2.prototype.catch = function(t3) {
    return this._taskCompletionResolver.promise.catch(t3);
  }, t2.prototype.then = function(t3, e) {
    return this._taskCompletionResolver.promise.then(t3, e);
  }, t2.prototype._completeWith = function(t3) {
    this._updateProgress(t3), this._progressObserver.complete && this._progressObserver.complete(), this._taskCompletionResolver.resolve(t3);
  }, t2.prototype._failWith = function(t3) {
    this._lastProgress.taskState = "Error", this._progressObserver.next && this._progressObserver.next(this._lastProgress), this._progressObserver.error && this._progressObserver.error(t3), this._taskCompletionResolver.reject(t3);
  }, t2.prototype._updateProgress = function(t3) {
    this._lastProgress = t3, this._progressObserver.next && this._progressObserver.next(t3);
  }, t2;
}();
var oa2 = -1;
var sa2 = function(t2) {
  function e(e2, n2) {
    var r2 = this;
    return (r2 = t2.call(this, e2, n2) || this).type = "firestore", r2._queue = new na2(), r2._persistenceKey = "name" in e2 ? e2.name : "[DEFAULT]", r2;
  }
  return __extends(e, t2), e.prototype._terminate = function() {
    return this._firestoreClient || aa2(this), this._firestoreClient.terminate();
  }, e;
}(Hu);
function ua2(t2) {
  return t2._firestoreClient || aa2(t2), t2._firestoreClient.verifyNotTerminated(), t2._firestoreClient;
}
function aa2(t2) {
  var e, n2 = t2._freezeSettings(), r2 = function(t3, e2, n3, r3) {
    return new Cu(t3, e2, n3, r3.host, r3.ssl, r3.experimentalForceLongPolling, r3.experimentalAutoDetectLongPolling, r3.useFetchStreams);
  }(t2._databaseId, ((e = t2._app) === null || e === void 0 ? void 0 : e.options.appId) || "", t2._persistenceKey, n2);
  t2._firestoreClient = new gu(t2._credentials, t2._queue, r2);
}
function ca2(t2, e, n2) {
  var r2 = this, i = new wr();
  return t2.asyncQueue.enqueue(function() {
    return __awaiter(r2, void 0, void 0, function() {
      var r3;
      return __generator(this, function(o) {
        switch (o.label) {
          case 0:
            return o.trys.push([0, 3, , 4]), [4, wu(t2, n2)];
          case 1:
            return o.sent(), [4, bu(t2, e)];
          case 2:
            return o.sent(), i.resolve(), [3, 4];
          case 3:
            if (!function(t3) {
              return t3.name === "FirebaseError" ? t3.code === S2.FAILED_PRECONDITION || t3.code === S2.UNIMPLEMENTED : !(typeof DOMException != "undefined" && t3 instanceof DOMException) || (t3.code === 22 || t3.code === 20 || t3.code === 11);
            }(r3 = o.sent()))
              throw r3;
            return console.warn("Error enabling offline persistence. Falling back to persistence disabled: " + r3), i.reject(r3), [3, 4];
          case 4:
            return [2];
        }
      });
    });
  }).then(function() {
    return i.promise;
  });
}
function ha2(t2) {
  if (t2._initialized || t2._terminated)
    throw new N2(S2.FAILED_PRECONDITION, "Firestore has already been started and persistence can no longer be enabled. You can only enable persistence before calling any other methods on a Firestore object.");
}
var fa2 = function() {
  function t2() {
    for (var t3 = [], e = 0; e < arguments.length; e++)
      t3[e] = arguments[e];
    for (var n2 = 0; n2 < t3.length; ++n2)
      if (t3[n2].length === 0)
        throw new N2(S2.INVALID_ARGUMENT, "Invalid field name at argument $(i + 1). Field names must not be empty.");
    this._internalPath = new Y2(t3);
  }
  return t2.prototype.isEqual = function(t3) {
    return this._internalPath.isEqual(t3._internalPath);
  }, t2;
}();
var la = function() {
  function t2(t3) {
    this._byteString = t3;
  }
  return t2.fromBase64String = function(e) {
    try {
      return new t2(X2.fromBase64String(e));
    } catch (e2) {
      throw new N2(S2.INVALID_ARGUMENT, "Failed to construct data from Base64 string: " + e2);
    }
  }, t2.fromUint8Array = function(e) {
    return new t2(X2.fromUint8Array(e));
  }, t2.prototype.toBase64 = function() {
    return this._byteString.toBase64();
  }, t2.prototype.toUint8Array = function() {
    return this._byteString.toUint8Array();
  }, t2.prototype.toString = function() {
    return "Bytes(base64: " + this.toBase64() + ")";
  }, t2.prototype.isEqual = function(t3) {
    return this._byteString.isEqual(t3._byteString);
  }, t2;
}();
var da2 = function(t2) {
  this._methodName = t2;
};
var pa2 = function() {
  function t2(t3, e) {
    if (!isFinite(t3) || t3 < -90 || t3 > 90)
      throw new N2(S2.INVALID_ARGUMENT, "Latitude must be a number between -90 and 90, but was: " + t3);
    if (!isFinite(e) || e < -180 || e > 180)
      throw new N2(S2.INVALID_ARGUMENT, "Longitude must be a number between -180 and 180, but was: " + e);
    this._lat = t3, this._long = e;
  }
  return Object.defineProperty(t2.prototype, "latitude", {
    get: function() {
      return this._lat;
    },
    enumerable: false,
    configurable: true
  }), Object.defineProperty(t2.prototype, "longitude", {
    get: function() {
      return this._long;
    },
    enumerable: false,
    configurable: true
  }), t2.prototype.isEqual = function(t3) {
    return this._lat === t3._lat && this._long === t3._long;
  }, t2.prototype.toJSON = function() {
    return {
      latitude: this._lat,
      longitude: this._long
    };
  }, t2.prototype._compareTo = function(t3) {
    return V2(this._lat, t3._lat) || V2(this._long, t3._long);
  }, t2;
}();
var ya2 = /^__.*__$/;
var va = function() {
  function t2(t3, e, n2) {
    this.data = t3, this.fieldMask = e, this.fieldTransforms = n2;
  }
  return t2.prototype.toMutation = function(t3, e) {
    return this.fieldMask !== null ? new Pe(t3, this.data, this.fieldMask, e, this.fieldTransforms) : new Oe(t3, this.data, e, this.fieldTransforms);
  }, t2;
}();
var ma2 = function() {
  function t2(t3, e, n2) {
    this.data = t3, this.fieldMask = e, this.fieldTransforms = n2;
  }
  return t2.prototype.toMutation = function(t3, e) {
    return new Pe(t3, this.data, this.fieldMask, e, this.fieldTransforms);
  }, t2;
}();
function ga(t2) {
  switch (t2) {
    case 0:
    case 2:
    case 1:
      return true;
    case 3:
    case 4:
      return false;
    default:
      throw L2();
  }
}
var wa = function() {
  function t2(t3, e, n2, r2, i, o) {
    this.settings = t3, this.databaseId = e, this.R = n2, this.ignoreUndefinedProperties = r2, i === void 0 && this.Dc(), this.fieldTransforms = i || [], this.fieldMask = o || [];
  }
  return Object.defineProperty(t2.prototype, "path", {
    get: function() {
      return this.settings.path;
    },
    enumerable: false,
    configurable: true
  }), Object.defineProperty(t2.prototype, "Cc", {
    get: function() {
      return this.settings.Cc;
    },
    enumerable: false,
    configurable: true
  }), t2.prototype.Nc = function(e) {
    return new t2(Object.assign(Object.assign({}, this.settings), e), this.databaseId, this.R, this.ignoreUndefinedProperties, this.fieldTransforms, this.fieldMask);
  }, t2.prototype.xc = function(t3) {
    var e, n2 = (e = this.path) === null || e === void 0 ? void 0 : e.child(t3), r2 = this.Nc({
      path: n2,
      Fc: false
    });
    return r2.kc(t3), r2;
  }, t2.prototype.$c = function(t3) {
    var e, n2 = (e = this.path) === null || e === void 0 ? void 0 : e.child(t3), r2 = this.Nc({
      path: n2,
      Fc: false
    });
    return r2.Dc(), r2;
  }, t2.prototype.Oc = function(t3) {
    return this.Nc({
      path: void 0,
      Fc: true
    });
  }, t2.prototype.Mc = function(t3) {
    return qa2(t3, this.settings.methodName, this.settings.Lc || false, this.path, this.settings.Bc);
  }, t2.prototype.contains = function(t3) {
    return this.fieldMask.find(function(e) {
      return t3.isPrefixOf(e);
    }) !== void 0 || this.fieldTransforms.find(function(e) {
      return t3.isPrefixOf(e.field);
    }) !== void 0;
  }, t2.prototype.Dc = function() {
    if (this.path)
      for (var t3 = 0; t3 < this.path.length; t3++)
        this.kc(this.path.get(t3));
  }, t2.prototype.kc = function(t3) {
    if (t3.length === 0)
      throw this.Mc("Document fields must not be empty");
    if (ga(this.Cc) && ya2.test(t3))
      throw this.Mc('Document fields cannot begin and end with "__"');
  }, t2;
}();
var ba2 = function() {
  function t2(t3, e, n2) {
    this.databaseId = t3, this.ignoreUndefinedProperties = e, this.R = n2 || ko(t3);
  }
  return t2.prototype.qc = function(t3, e, n2, r2) {
    return r2 === void 0 && (r2 = false), new wa({
      Cc: t3,
      methodName: e,
      Bc: n2,
      path: Y2.emptyPath(),
      Fc: false,
      Lc: r2
    }, this.databaseId, this.R, this.ignoreUndefinedProperties);
  }, t2;
}();
function Ia2(t2) {
  var e = t2._freezeSettings(), n2 = ko(t2._databaseId);
  return new ba2(t2._databaseId, !!e.ignoreUndefinedProperties, n2);
}
function Ea2(t2, e, n2, r2, i, o) {
  o === void 0 && (o = {});
  var s = t2.qc(o.merge || o.mergeFields ? 2 : 0, e, n2, i);
  Pa("Data must be an object, but it was:", s, r2);
  var u2, a, c = La2(r2, s);
  if (o.merge)
    u2 = new $(s.fieldMask), a = s.fieldTransforms;
  else if (o.mergeFields) {
    for (var h = [], f = 0, l = o.mergeFields; f < l.length; f++) {
      var d = Fa2(e, l[f], n2);
      if (!s.contains(d))
        throw new N2(S2.INVALID_ARGUMENT, "Field '" + d + "' is specified in your field mask but missing from your input data.");
      Ua2(h, d) || h.push(d);
    }
    u2 = new $(h), a = s.fieldTransforms.filter(function(t3) {
      return u2.covers(t3.field);
    });
  } else
    u2 = null, a = s.fieldTransforms;
  return new va(new Tt(c), u2, a);
}
var Ta2 = function(t2) {
  function e() {
    return t2 !== null && t2.apply(this, arguments) || this;
  }
  return __extends(e, t2), e.prototype._toFieldTransform = function(t3) {
    if (t3.Cc !== 2)
      throw t3.Cc === 1 ? t3.Mc(this._methodName + "() can only appear at the top level of your update data") : t3.Mc(this._methodName + "() cannot be used with set() unless you pass {merge:true}");
    return t3.fieldMask.push(t3.path), null;
  }, e.prototype.isEqual = function(t3) {
    return t3 instanceof e;
  }, e;
}(da2);
function _a(t2, e, n2) {
  return new wa({
    Cc: 3,
    Bc: e.settings.Bc,
    methodName: t2._methodName,
    Fc: n2
  }, e.databaseId, e.R, e.ignoreUndefinedProperties);
}
var Sa = function(t2) {
  function e() {
    return t2 !== null && t2.apply(this, arguments) || this;
  }
  return __extends(e, t2), e.prototype._toFieldTransform = function(t3) {
    return new _e(t3.path, new ve());
  }, e.prototype.isEqual = function(t3) {
    return t3 instanceof e;
  }, e;
}(da2);
var Na = function(t2) {
  function e(e2, n2) {
    var r2 = this;
    return (r2 = t2.call(this, e2) || this).Uc = n2, r2;
  }
  return __extends(e, t2), e.prototype._toFieldTransform = function(t3) {
    var e2 = _a(this, t3, true), n2 = this.Uc.map(function(t4) {
      return Ra2(t4, e2);
    }), r2 = new me(n2);
    return new _e(t3.path, r2);
  }, e.prototype.isEqual = function(t3) {
    return this === t3;
  }, e;
}(da2);
var Da2 = function(t2) {
  function e(e2, n2) {
    var r2 = this;
    return (r2 = t2.call(this, e2) || this).Uc = n2, r2;
  }
  return __extends(e, t2), e.prototype._toFieldTransform = function(t3) {
    var e2 = _a(this, t3, true), n2 = this.Uc.map(function(t4) {
      return Ra2(t4, e2);
    }), r2 = new we(n2);
    return new _e(t3.path, r2);
  }, e.prototype.isEqual = function(t3) {
    return this === t3;
  }, e;
}(da2);
var Aa = function(t2) {
  function e(e2, n2) {
    var r2 = this;
    return (r2 = t2.call(this, e2) || this).Qc = n2, r2;
  }
  return __extends(e, t2), e.prototype._toFieldTransform = function(t3) {
    var e2 = new Ie(t3.R, fe(t3.R, this.Qc));
    return new _e(t3.path, e2);
  }, e.prototype.isEqual = function(t3) {
    return this === t3;
  }, e;
}(da2);
function ka2(t2, e, n2, r2) {
  var i = t2.qc(1, e, n2);
  Pa("Data must be an object, but it was:", i, r2);
  var o = [], s = Tt.empty();
  G2(r2, function(t3, r3) {
    var a2 = Va2(e, t3, n2);
    r3 = getModularInstance(r3);
    var c = i.$c(a2);
    if (r3 instanceof Ta2)
      o.push(a2);
    else {
      var h = Ra2(r3, c);
      h != null && (o.push(a2), s.set(a2, h));
    }
  });
  var a = new $(o);
  return new ma2(s, a, i.fieldTransforms);
}
function Ca2(t2, e, n2, r2, i, o) {
  var s = t2.qc(1, e, n2), a = [Fa2(e, r2, n2)], c = [i];
  if (o.length % 2 != 0)
    throw new N2(S2.INVALID_ARGUMENT, "Function " + e + "() needs to be called with an even number of arguments that alternate between field names and values.");
  for (var h = 0; h < o.length; h += 2)
    a.push(Fa2(e, o[h])), c.push(o[h + 1]);
  for (var f = [], l = Tt.empty(), d = a.length - 1; d >= 0; --d)
    if (!Ua2(f, a[d])) {
      var p2 = a[d], y2 = c[d];
      y2 = getModularInstance(y2);
      var v = s.$c(p2);
      if (y2 instanceof Ta2)
        f.push(p2);
      else {
        var m = Ra2(y2, v);
        m != null && (f.push(p2), l.set(p2, m));
      }
    }
  var g2 = new $(f);
  return new ma2(l, g2, s.fieldTransforms);
}
function xa2(t2, e, n2, r2) {
  return r2 === void 0 && (r2 = false), Ra2(n2, t2.qc(r2 ? 4 : 3, e));
}
function Ra2(t2, e) {
  if (Oa(t2 = getModularInstance(t2)))
    return Pa("Unsupported field value:", e, t2), La2(t2, e);
  if (t2 instanceof da2)
    return function(t3, e2) {
      if (!ga(e2.Cc))
        throw e2.Mc(t3._methodName + "() can only be used with update() and set()");
      if (!e2.path)
        throw e2.Mc(t3._methodName + "() is not currently supported inside arrays");
      var n2 = t3._toFieldTransform(e2);
      n2 && e2.fieldTransforms.push(n2);
    }(t2, e), null;
  if (t2 === void 0 && e.ignoreUndefinedProperties)
    return null;
  if (e.path && e.fieldMask.push(e.path), t2 instanceof Array) {
    if (e.settings.Fc && e.Cc !== 4)
      throw e.Mc("Nested arrays are not supported");
    return function(t3, e2) {
      for (var n2 = [], r2 = 0, i = 0, o = t3; i < o.length; i++) {
        var s = Ra2(o[i], e2.Oc(r2));
        s == null && (s = {
          nullValue: "NULL_VALUE"
        }), n2.push(s), r2++;
      }
      return {
        arrayValue: {
          values: n2
        }
      };
    }(t2, e);
  }
  return function(t3, e2) {
    if ((t3 = getModularInstance(t3)) === null)
      return {
        nullValue: "NULL_VALUE"
      };
    if (typeof t3 == "number")
      return fe(e2.R, t3);
    if (typeof t3 == "boolean")
      return {
        booleanValue: t3
      };
    if (typeof t3 == "string")
      return {
        stringValue: t3
      };
    if (t3 instanceof Date) {
      var n2 = B.fromDate(t3);
      return {
        timestampValue: bn(e2.R, n2)
      };
    }
    if (t3 instanceof B) {
      n2 = new B(t3.seconds, 1e3 * Math.floor(t3.nanoseconds / 1e3));
      return {
        timestampValue: bn(e2.R, n2)
      };
    }
    if (t3 instanceof pa2)
      return {
        geoPointValue: {
          latitude: t3.latitude,
          longitude: t3.longitude
        }
      };
    if (t3 instanceof la)
      return {
        bytesValue: In(e2.R, t3._byteString)
      };
    if (t3 instanceof Yu) {
      n2 = e2.databaseId;
      var r2 = t3.firestore._databaseId;
      if (!r2.isEqual(n2))
        throw e2.Mc("Document reference is for database " + r2.projectId + "/" + r2.database + " but should be for database " + n2.projectId + "/" + n2.database);
      return {
        referenceValue: _n(t3.firestore._databaseId || e2.databaseId, t3._key.path)
      };
    }
    throw e2.Mc("Unsupported field value: " + Gu(t3));
  }(t2, e);
}
function La2(t2, e) {
  var n2 = {};
  return Q2(t2) ? e.path && e.path.length > 0 && e.fieldMask.push(e.path) : G2(t2, function(t3, r2) {
    var i = Ra2(r2, e.xc(t3));
    i != null && (n2[t3] = i);
  }), {
    mapValue: {
      fields: n2
    }
  };
}
function Oa(t2) {
  return !(typeof t2 != "object" || t2 === null || t2 instanceof Array || t2 instanceof Date || t2 instanceof B || t2 instanceof pa2 || t2 instanceof la || t2 instanceof Yu || t2 instanceof da2);
}
function Pa(t2, e, n2) {
  if (!Oa(n2) || !function(t3) {
    return typeof t3 == "object" && t3 !== null && (Object.getPrototypeOf(t3) === Object.prototype || Object.getPrototypeOf(t3) === null);
  }(n2)) {
    var r2 = Gu(n2);
    throw r2 === "an object" ? e.Mc(t2 + " a custom object") : e.Mc(t2 + " " + r2);
  }
}
function Fa2(t2, e, n2) {
  if ((e = getModularInstance(e)) instanceof fa2)
    return e._internalPath;
  if (typeof e == "string")
    return Va2(t2, e);
  throw qa2("Field path arguments must be of type string or FieldPath.", t2, false, void 0, n2);
}
var Ma2 = new RegExp("[~\\*/\\[\\]]");
function Va2(t2, e, n2) {
  if (e.search(Ma2) >= 0)
    throw qa2("Invalid field path (" + e + "). Paths must not contain '~', '*', '/', '[', or ']'", t2, false, void 0, n2);
  try {
    return new (fa2.bind.apply(fa2, __spreadArray([void 0], e.split("."))))()._internalPath;
  } catch (r2) {
    throw qa2("Invalid field path (" + e + "). Paths must not be empty, begin with '.', end with '.', or contain '..'", t2, false, void 0, n2);
  }
}
function qa2(t2, e, n2, r2, i) {
  var o = r2 && !r2.isEmpty(), s = i !== void 0, u2 = "Function " + e + "() called with invalid data";
  n2 && (u2 += " (via `toFirestore()`)");
  var a = "";
  return (o || s) && (a += " (found", o && (a += " in field " + r2), s && (a += " in document " + i), a += ")"), new N2(S2.INVALID_ARGUMENT, (u2 += ". ") + t2 + a);
}
function Ua2(t2, e) {
  return t2.some(function(t3) {
    return t3.isEqual(e);
  });
}
var Ba = function() {
  function t2(t3, e, n2, r2, i) {
    this._firestore = t3, this._userDataWriter = e, this._key = n2, this._document = r2, this._converter = i;
  }
  return Object.defineProperty(t2.prototype, "id", {
    get: function() {
      return this._key.path.lastSegment();
    },
    enumerable: false,
    configurable: true
  }), Object.defineProperty(t2.prototype, "ref", {
    get: function() {
      return new Yu(this._firestore, this._converter, this._key);
    },
    enumerable: false,
    configurable: true
  }), t2.prototype.exists = function() {
    return this._document !== null;
  }, t2.prototype.data = function() {
    if (this._document) {
      if (this._converter) {
        var t3 = new ja(this._firestore, this._userDataWriter, this._key, this._document, null);
        return this._converter.fromFirestore(t3);
      }
      return this._userDataWriter.convertValue(this._document.data.value);
    }
  }, t2.prototype.get = function(t3) {
    if (this._document) {
      var e = this._document.data.field(Ka2("DocumentSnapshot.get", t3));
      if (e !== null)
        return this._userDataWriter.convertValue(e);
    }
  }, t2;
}();
var ja = function(t2) {
  function e() {
    return t2 !== null && t2.apply(this, arguments) || this;
  }
  return __extends(e, t2), e.prototype.data = function() {
    return t2.prototype.data.call(this);
  }, e;
}(Ba);
function Ka2(t2, e) {
  return typeof e == "string" ? Va2(t2, e) : e instanceof fa2 ? e._internalPath : e._delegate._internalPath;
}
var Ga2 = function() {
  function t2(t3, e) {
    this.hasPendingWrites = t3, this.fromCache = e;
  }
  return t2.prototype.isEqual = function(t3) {
    return this.hasPendingWrites === t3.hasPendingWrites && this.fromCache === t3.fromCache;
  }, t2;
}();
var Qa2 = function(t2) {
  function e(e2, n2, r2, i, o, s) {
    var u2 = this;
    return (u2 = t2.call(this, e2, n2, r2, i, s) || this)._firestore = e2, u2._firestoreImpl = e2, u2.metadata = o, u2;
  }
  return __extends(e, t2), e.prototype.exists = function() {
    return t2.prototype.exists.call(this);
  }, e.prototype.data = function(t3) {
    if (t3 === void 0 && (t3 = {}), this._document) {
      if (this._converter) {
        var e2 = new za2(this._firestore, this._userDataWriter, this._key, this._document, this.metadata, null);
        return this._converter.fromFirestore(e2, t3);
      }
      return this._userDataWriter.convertValue(this._document.data.value, t3.serverTimestamps);
    }
  }, e.prototype.get = function(t3, e2) {
    if (e2 === void 0 && (e2 = {}), this._document) {
      var n2 = this._document.data.field(Ka2("DocumentSnapshot.get", t3));
      if (n2 !== null)
        return this._userDataWriter.convertValue(n2, e2.serverTimestamps);
    }
  }, e;
}(Ba);
var za2 = function(t2) {
  function e() {
    return t2 !== null && t2.apply(this, arguments) || this;
  }
  return __extends(e, t2), e.prototype.data = function(e2) {
    return e2 === void 0 && (e2 = {}), t2.prototype.data.call(this, e2);
  }, e;
}(Qa2);
var Wa2 = function() {
  function t2(t3, e, n2, r2) {
    this._firestore = t3, this._userDataWriter = e, this._snapshot = r2, this.metadata = new Ga2(r2.hasPendingWrites, r2.fromCache), this.query = n2;
  }
  return Object.defineProperty(t2.prototype, "docs", {
    get: function() {
      var t3 = [];
      return this.forEach(function(e) {
        return t3.push(e);
      }), t3;
    },
    enumerable: false,
    configurable: true
  }), Object.defineProperty(t2.prototype, "size", {
    get: function() {
      return this._snapshot.docs.size;
    },
    enumerable: false,
    configurable: true
  }), Object.defineProperty(t2.prototype, "empty", {
    get: function() {
      return this.size === 0;
    },
    enumerable: false,
    configurable: true
  }), t2.prototype.forEach = function(t3, e) {
    var n2 = this;
    this._snapshot.docs.forEach(function(r2) {
      t3.call(e, new za2(n2._firestore, n2._userDataWriter, r2.key, r2, new Ga2(n2._snapshot.mutatedKeys.has(r2.key), n2._snapshot.fromCache), n2.query.converter));
    });
  }, t2.prototype.docChanges = function(t3) {
    t3 === void 0 && (t3 = {});
    var e = !!t3.includeMetadataChanges;
    if (e && this._snapshot.excludesMetadataChanges)
      throw new N2(S2.INVALID_ARGUMENT, "To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");
    return this._cachedChanges && this._cachedChangesIncludeMetadataChanges === e || (this._cachedChanges = function(t4, e2) {
      if (t4._snapshot.oldDocs.isEmpty()) {
        var n2 = 0;
        return t4._snapshot.docChanges.map(function(e3) {
          var r3 = new za2(t4._firestore, t4._userDataWriter, e3.doc.key, e3.doc, new Ga2(t4._snapshot.mutatedKeys.has(e3.doc.key), t4._snapshot.fromCache), t4.query.converter);
          return e3.doc, {
            type: "added",
            doc: r3,
            oldIndex: -1,
            newIndex: n2++
          };
        });
      }
      var r2 = t4._snapshot.oldDocs;
      return t4._snapshot.docChanges.filter(function(t5) {
        return e2 || t5.type !== 3;
      }).map(function(e3) {
        var n3 = new za2(t4._firestore, t4._userDataWriter, e3.doc.key, e3.doc, new Ga2(t4._snapshot.mutatedKeys.has(e3.doc.key), t4._snapshot.fromCache), t4.query.converter), i = -1, o = -1;
        return e3.type !== 0 && (i = r2.indexOf(e3.doc.key), r2 = r2.delete(e3.doc.key)), e3.type !== 1 && (o = (r2 = r2.add(e3.doc)).indexOf(e3.doc.key)), {
          type: Ha2(e3.type),
          doc: n3,
          oldIndex: i,
          newIndex: o
        };
      });
    }(this, e), this._cachedChangesIncludeMetadataChanges = e), this._cachedChanges;
  }, t2;
}();
function Ha2(t2) {
  switch (t2) {
    case 0:
      return "added";
    case 2:
    case 3:
      return "modified";
    case 1:
      return "removed";
    default:
      return L2();
  }
}
function Ya2(t2, e) {
  return t2 instanceof Qa2 && e instanceof Qa2 ? t2._firestore === e._firestore && t2._key.isEqual(e._key) && (t2._document === null ? e._document === null : t2._document.isEqual(e._document)) && t2._converter === e._converter : t2 instanceof Wa2 && e instanceof Wa2 && t2._firestore === e._firestore && ea2(t2.query, e.query) && t2.metadata.isEqual(e.metadata) && t2._snapshot.isEqual(e._snapshot);
}
function $a2(t2) {
  if ($t(t2) && t2.explicitOrderBy.length === 0)
    throw new N2(S2.UNIMPLEMENTED, "limitToLast() queries require specifying at least one orderBy() clause");
}
var Xa2 = function() {
};
function Ja2(t2) {
  for (var e = [], n2 = 1; n2 < arguments.length; n2++)
    e[n2 - 1] = arguments[n2];
  for (var r2 = 0, i = e; r2 < i.length; r2++) {
    var o = i[r2];
    t2 = o._apply(t2);
  }
  return t2;
}
var Za2 = function(t2) {
  function e(e2, n2, r2) {
    var i = this;
    return (i = t2.call(this) || this).Kc = e2, i.jc = n2, i.Wc = r2, i.type = "where", i;
  }
  return __extends(e, t2), e.prototype._apply = function(t3) {
    var e2 = Ia2(t3.firestore), n2 = function(t4, e3, n3, r2, i, o, s) {
      var u2;
      if (i.isKeyField()) {
        if (o === "array-contains" || o === "array-contains-any")
          throw new N2(S2.INVALID_ARGUMENT, "Invalid Query. You can't perform '" + o + "' queries on FieldPath.documentId().");
        if (o === "in" || o === "not-in") {
          sc2(s, o);
          for (var a = [], c = 0, h = s; c < h.length; c++) {
            var f = h[c];
            a.push(oc2(r2, t4, f));
          }
          u2 = {
            arrayValue: {
              values: a
            }
          };
        } else
          u2 = oc2(r2, t4, s);
      } else
        o !== "in" && o !== "not-in" && o !== "array-contains-any" || sc2(s, o), u2 = xa2(n3, "where", s, o === "in" || o === "not-in");
      var l = xt.create(i, o, u2);
      return function(t5, e4) {
        if (e4.g()) {
          var n4 = Jt(t5);
          if (n4 !== null && !n4.isEqual(e4.field))
            throw new N2(S2.INVALID_ARGUMENT, "Invalid query. All where filters with an inequality (<, <=, !=, not-in, >, or >=) must be on the same field. But you have inequality filters on '" + n4.toString() + "' and '" + e4.field.toString() + "'");
          var r3 = Xt(t5);
          r3 !== null && uc2(t5, e4.field, r3);
        }
        var i2 = function(t6, e5) {
          for (var n5 = 0, r4 = t6.filters; n5 < r4.length; n5++) {
            var i3 = r4[n5];
            if (e5.indexOf(i3.op) >= 0)
              return i3.op;
          }
          return null;
        }(t5, function(t6) {
          switch (t6) {
            case "!=":
              return ["!=", "not-in"];
            case "array-contains":
              return ["array-contains", "array-contains-any", "not-in"];
            case "in":
              return ["array-contains-any", "in", "not-in"];
            case "array-contains-any":
              return ["array-contains", "array-contains-any", "in", "not-in"];
            case "not-in":
              return ["array-contains", "array-contains-any", "in", "not-in", "!="];
            default:
              return [];
          }
        }(e4.op));
        if (i2 !== null)
          throw i2 === e4.op ? new N2(S2.INVALID_ARGUMENT, "Invalid query. You cannot use more than one '" + e4.op.toString() + "' filter.") : new N2(S2.INVALID_ARGUMENT, "Invalid query. You cannot use '" + e4.op.toString() + "' filters with '" + i2.toString() + "' filters.");
      }(t4, l), l;
    }(t3._query, 0, e2, t3.firestore._databaseId, this.Kc, this.jc, this.Wc);
    return new $u(t3.firestore, t3.converter, function(t4, e3) {
      var n3 = t4.filters.concat([e3]);
      return new zt(t4.path, t4.collectionGroup, t4.explicitOrderBy.slice(), n3, t4.limit, t4.limitType, t4.startAt, t4.endAt);
    }(t3._query, n2));
  }, e;
}(Xa2);
var tc2 = function(t2) {
  function e(e2, n2) {
    var r2 = this;
    return (r2 = t2.call(this) || this).Kc = e2, r2.Gc = n2, r2.type = "orderBy", r2;
  }
  return __extends(e, t2), e.prototype._apply = function(t3) {
    var e2 = function(t4, e3, n2) {
      if (t4.startAt !== null)
        throw new N2(S2.INVALID_ARGUMENT, "Invalid query. You must not call startAt() or startAfter() before calling orderBy().");
      if (t4.endAt !== null)
        throw new N2(S2.INVALID_ARGUMENT, "Invalid query. You must not call endAt() or endBefore() before calling orderBy().");
      var r2 = new jt(e3, n2);
      return function(t5, e4) {
        if (Xt(t5) === null) {
          var n3 = Jt(t5);
          n3 !== null && uc2(t5, n3, e4.field);
        }
      }(t4, r2), r2;
    }(t3._query, this.Kc, this.Gc);
    return new $u(t3.firestore, t3.converter, function(t4, e3) {
      var n2 = t4.explicitOrderBy.concat([e3]);
      return new zt(t4.path, t4.collectionGroup, n2, t4.filters.slice(), t4.limit, t4.limitType, t4.startAt, t4.endAt);
    }(t3._query, e2));
  }, e;
}(Xa2);
var ec2 = function(t2) {
  function e(e2, n2, r2) {
    var i = this;
    return (i = t2.call(this) || this).type = e2, i.zc = n2, i.Hc = r2, i;
  }
  return __extends(e, t2), e.prototype._apply = function(t3) {
    return new $u(t3.firestore, t3.converter, ne(t3._query, this.zc, this.Hc));
  }, e;
}(Xa2);
var nc2 = function(t2) {
  function e(e2, n2, r2) {
    var i = this;
    return (i = t2.call(this) || this).type = e2, i.Jc = n2, i.Yc = r2, i;
  }
  return __extends(e, t2), e.prototype._apply = function(t3) {
    var e2 = ic2(t3, this.type, this.Jc, this.Yc);
    return new $u(t3.firestore, t3.converter, function(t4, e3) {
      return new zt(t4.path, t4.collectionGroup, t4.explicitOrderBy.slice(), t4.filters.slice(), t4.limit, t4.limitType, e3, t4.endAt);
    }(t3._query, e2));
  }, e;
}(Xa2);
var rc2 = function(t2) {
  function e(e2, n2, r2) {
    var i = this;
    return (i = t2.call(this) || this).type = e2, i.Jc = n2, i.Yc = r2, i;
  }
  return __extends(e, t2), e.prototype._apply = function(t3) {
    var e2 = ic2(t3, this.type, this.Jc, this.Yc);
    return new $u(t3.firestore, t3.converter, function(t4, e3) {
      return new zt(t4.path, t4.collectionGroup, t4.explicitOrderBy.slice(), t4.filters.slice(), t4.limit, t4.limitType, t4.startAt, e3);
    }(t3._query, e2));
  }, e;
}(Xa2);
function ic2(t2, e, n2, r2) {
  if (n2[0] = getModularInstance(n2[0]), n2[0] instanceof Ba)
    return function(t3, e2, n3, r3, i2) {
      if (!r3)
        throw new N2(S2.NOT_FOUND, "Can't use a DocumentSnapshot that doesn't exist for " + n3 + "().");
      for (var o = [], s = 0, u2 = te(t3); s < u2.length; s++) {
        var a = u2[s];
        if (a.field.isKeyField())
          o.push(vt(e2, r3.key));
        else {
          var c = r3.data.field(a.field);
          if (nt(c))
            throw new N2(S2.INVALID_ARGUMENT, 'Invalid query. You are trying to start or end a query using a document for which the field "' + a.field + '" is an uncommitted server timestamp. (Since the value of this field is unknown, you cannot start/end a query with it.)');
          if (c === null) {
            var h = a.field.canonicalString();
            throw new N2(S2.INVALID_ARGUMENT, "Invalid query. You are trying to start or end a query using a document for which the field '" + h + "' (used as the orderBy) does not exist.");
          }
          o.push(c);
        }
      }
      return new Ut(o, i2);
    }(t2._query, t2.firestore._databaseId, e, n2[0]._document, r2);
  var i = Ia2(t2.firestore);
  return function(t3, e2, n3, r3, i2, o) {
    var s = t3.explicitOrderBy;
    if (i2.length > s.length)
      throw new N2(S2.INVALID_ARGUMENT, "Too many arguments provided to " + r3 + "(). The number of arguments must be less than or equal to the number of orderBy() clauses");
    for (var u2 = [], a = 0; a < i2.length; a++) {
      var c = i2[a];
      if (s[a].field.isKeyField()) {
        if (typeof c != "string")
          throw new N2(S2.INVALID_ARGUMENT, "Invalid query. Expected a string for document ID in " + r3 + "(), but got a " + typeof c);
        if (!Zt(t3) && c.indexOf("/") !== -1)
          throw new N2(S2.INVALID_ARGUMENT, "Invalid query. When querying a collection and ordering by FieldPath.documentId(), the value passed to " + r3 + "() must be a plain document ID, but '" + c + "' contains a slash.");
        var h = t3.path.child(W2.fromString(c));
        if (!at.isDocumentKey(h))
          throw new N2(S2.INVALID_ARGUMENT, "Invalid query. When querying a collection group and ordering by FieldPath.documentId(), the value passed to " + r3 + "() must result in a valid document path, but '" + h + "' is not because it contains an odd number of segments.");
        var f = new at(h);
        u2.push(vt(e2, f));
      } else {
        var l = xa2(n3, r3, c);
        u2.push(l);
      }
    }
    return new Ut(u2, o);
  }(t2._query, t2.firestore._databaseId, i, e, n2, r2);
}
function oc2(t2, e, n2) {
  if (typeof (n2 = getModularInstance(n2)) == "string") {
    if (n2 === "")
      throw new N2(S2.INVALID_ARGUMENT, "Invalid query. When querying with FieldPath.documentId(), you must provide a valid document ID, but it was an empty string.");
    if (!Zt(e) && n2.indexOf("/") !== -1)
      throw new N2(S2.INVALID_ARGUMENT, "Invalid query. When querying a collection by FieldPath.documentId(), you must provide a plain document ID, but '" + n2 + "' contains a '/' character.");
    var r2 = e.path.child(W2.fromString(n2));
    if (!at.isDocumentKey(r2))
      throw new N2(S2.INVALID_ARGUMENT, "Invalid query. When querying a collection group by FieldPath.documentId(), the value provided must result in a valid document path, but '" + r2 + "' is not because it has an odd number of segments (" + r2.length + ").");
    return vt(t2, new at(r2));
  }
  if (n2 instanceof Yu)
    return vt(t2, n2._key);
  throw new N2(S2.INVALID_ARGUMENT, "Invalid query. When querying with FieldPath.documentId(), you must provide a valid string or a DocumentReference, but it was: " + Gu(n2) + ".");
}
function sc2(t2, e) {
  if (!Array.isArray(t2) || t2.length === 0)
    throw new N2(S2.INVALID_ARGUMENT, "Invalid Query. A non-empty array is required for '" + e.toString() + "' filters.");
  if (t2.length > 10)
    throw new N2(S2.INVALID_ARGUMENT, "Invalid Query. '" + e.toString() + "' filters support a maximum of 10 elements in the value array.");
}
function uc2(t2, e, n2) {
  if (!n2.isEqual(e))
    throw new N2(S2.INVALID_ARGUMENT, "Invalid query. You have a where filter with an inequality (<, <=, !=, not-in, >, or >=) on field '" + e.toString() + "' and so you must also use '" + e.toString() + "' as your first argument to orderBy(), but your first orderBy() is on field '" + n2.toString() + "' instead.");
}
var ac2 = function() {
  function t2() {
  }
  return t2.prototype.convertValue = function(t3, e) {
    switch (e === void 0 && (e = "none"), ct(t3)) {
      case 0:
        return null;
      case 1:
        return t3.booleanValue;
      case 2:
        return tt(t3.integerValue || t3.doubleValue);
      case 3:
        return this.convertTimestamp(t3.timestampValue);
      case 4:
        return this.convertServerTimestamp(t3, e);
      case 5:
        return t3.stringValue;
      case 6:
        return this.convertBytes(et(t3.bytesValue));
      case 7:
        return this.convertReference(t3.referenceValue);
      case 8:
        return this.convertGeoPoint(t3.geoPointValue);
      case 9:
        return this.convertArray(t3.arrayValue, e);
      case 10:
        return this.convertObject(t3.mapValue, e);
      default:
        throw L2();
    }
  }, t2.prototype.convertObject = function(t3, e) {
    var n2 = this, r2 = {};
    return G2(t3.fields, function(t4, i) {
      r2[t4] = n2.convertValue(i, e);
    }), r2;
  }, t2.prototype.convertGeoPoint = function(t3) {
    return new pa2(tt(t3.latitude), tt(t3.longitude));
  }, t2.prototype.convertArray = function(t3, e) {
    var n2 = this;
    return (t3.values || []).map(function(t4) {
      return n2.convertValue(t4, e);
    });
  }, t2.prototype.convertServerTimestamp = function(t3, e) {
    switch (e) {
      case "previous":
        var n2 = rt(t3);
        return n2 == null ? null : this.convertValue(n2, e);
      case "estimate":
        return this.convertTimestamp(it(t3));
      default:
        return null;
    }
  }, t2.prototype.convertTimestamp = function(t3) {
    var e = Z2(t3);
    return new B(e.seconds, e.nanos);
  }, t2.prototype.convertDocumentKey = function(t3, e) {
    var n2 = W2.fromString(t3);
    O2(Yn(n2));
    var r2 = new xu(n2.get(1), n2.get(3)), i = new at(n2.popFirst(5));
    return r2.isEqual(e) || C("Document " + i + " contains a document reference within a different database (" + r2.projectId + "/" + r2.database + ") which is not supported. It will be treated as a reference in the current database (" + e.projectId + "/" + e.database + ") instead."), i;
  }, t2;
}();
function cc2(t2, e, n2) {
  return t2 ? n2 && (n2.merge || n2.mergeFields) ? t2.toFirestore(e, n2) : t2.toFirestore(e) : e;
}
var hc2 = function(t2) {
  function e(e2) {
    var n2 = this;
    return (n2 = t2.call(this) || this).firestore = e2, n2;
  }
  return __extends(e, t2), e.prototype.convertBytes = function(t3) {
    return new la(t3);
  }, e.prototype.convertReference = function(t3) {
    var e2 = this.convertDocumentKey(t3, this.firestore._databaseId);
    return new Yu(this.firestore, null, e2);
  }, e;
}(ac2);
var fc2 = function() {
  function t2(t3, e) {
    this._firestore = t3, this._commitHandler = e, this._mutations = [], this._committed = false, this._dataReader = Ia2(t3);
  }
  return t2.prototype.set = function(t3, e, n2) {
    this._verifyNotCommitted();
    var r2 = lc2(t3, this._firestore), i = cc2(r2.converter, e, n2), o = Ea2(this._dataReader, "WriteBatch.set", r2._key, i, r2.converter !== null, n2);
    return this._mutations.push(o.toMutation(r2._key, Ne.none())), this;
  }, t2.prototype.update = function(t3, e, n2) {
    for (var r2 = [], i = 3; i < arguments.length; i++)
      r2[i - 3] = arguments[i];
    this._verifyNotCommitted();
    var o, s = lc2(t3, this._firestore);
    return o = typeof (e = getModularInstance(e)) == "string" || e instanceof fa2 ? Ca2(this._dataReader, "WriteBatch.update", s._key, e, n2, r2) : ka2(this._dataReader, "WriteBatch.update", s._key, e), this._mutations.push(o.toMutation(s._key, Ne.exists(true))), this;
  }, t2.prototype.delete = function(t3) {
    this._verifyNotCommitted();
    var e = lc2(t3, this._firestore);
    return this._mutations = this._mutations.concat(new Be(e._key, Ne.none())), this;
  }, t2.prototype.commit = function() {
    return this._verifyNotCommitted(), this._committed = true, this._mutations.length > 0 ? this._commitHandler(this._mutations) : Promise.resolve();
  }, t2.prototype._verifyNotCommitted = function() {
    if (this._committed)
      throw new N2(S2.FAILED_PRECONDITION, "A write batch can no longer be used after commit() has been called.");
  }, t2;
}();
function lc2(t2, e) {
  if ((t2 = getModularInstance(t2)).firestore !== e)
    throw new N2(S2.INVALID_ARGUMENT, "Provided document reference is from a different Firestore instance.");
  return t2;
}
var dc2 = function(t2) {
  function e(e2) {
    var n2 = this;
    return (n2 = t2.call(this) || this).firestore = e2, n2;
  }
  return __extends(e, t2), e.prototype.convertBytes = function(t3) {
    return new la(t3);
  }, e.prototype.convertReference = function(t3) {
    var e2 = this.convertDocumentKey(t3, this.firestore._databaseId);
    return new Yu(this.firestore, null, e2);
  }, e;
}(ac2);
function pc2(t2, e, n2) {
  for (var r2 = [], i = 3; i < arguments.length; i++)
    r2[i - 3] = arguments[i];
  t2 = Qu(t2, Yu);
  var o = Qu(t2.firestore, sa2), s = Ia2(o);
  return vc2(o, [(typeof (e = getModularInstance(e)) == "string" || e instanceof fa2 ? Ca2(s, "updateDoc", t2._key, e, n2, r2) : ka2(s, "updateDoc", t2._key, e)).toMutation(t2._key, Ne.exists(true))]);
}
function yc(t2) {
  for (var e, n2, r2, i = [], o = 1; o < arguments.length; o++)
    i[o - 1] = arguments[o];
  t2 = getModularInstance(t2);
  var s = {
    includeMetadataChanges: false
  }, a = 0;
  typeof i[a] != "object" || ra2(i[a]) || (s = i[a], a++);
  var c, h, f, l = {
    includeMetadataChanges: s.includeMetadataChanges
  };
  if (ra2(i[a])) {
    var d = i[a];
    i[a] = (e = d.next) === null || e === void 0 ? void 0 : e.bind(d), i[a + 1] = (n2 = d.error) === null || n2 === void 0 ? void 0 : n2.bind(d), i[a + 2] = (r2 = d.complete) === null || r2 === void 0 ? void 0 : r2.bind(d);
  }
  if (t2 instanceof Yu)
    h = Qu(t2.firestore, sa2), f = Ht(t2._key.path), c = {
      next: function(e2) {
        i[a] && i[a](mc2(h, t2, e2));
      },
      error: i[a + 1],
      complete: i[a + 2]
    };
  else {
    var p2 = Qu(t2, $u);
    h = Qu(p2.firestore, sa2), f = p2._query;
    var y2 = new dc2(h);
    c = {
      next: function(t3) {
        i[a] && i[a](new Wa2(h, y2, p2, t3));
      },
      error: i[a + 1],
      complete: i[a + 2]
    }, $a2(t2._query);
  }
  return function(t3, e2, n3, r3) {
    var i2 = this, o2 = new pu(r3), s2 = new bs(e2, o2, n3);
    return t3.asyncQueue.enqueueAndForget(function() {
      return __awaiter(i2, void 0, void 0, function() {
        var e3;
        return __generator(this, function(n4) {
          switch (n4.label) {
            case 0:
              return e3 = ys, [4, Du(t3)];
            case 1:
              return [2, e3.apply(void 0, [n4.sent(), s2])];
          }
        });
      });
    }), function() {
      o2.Wo(), t3.asyncQueue.enqueueAndForget(function() {
        return __awaiter(i2, void 0, void 0, function() {
          var e3;
          return __generator(this, function(n4) {
            switch (n4.label) {
              case 0:
                return e3 = vs, [4, Du(t3)];
              case 1:
                return [2, e3.apply(void 0, [n4.sent(), s2])];
            }
          });
        });
      });
    };
  }(ua2(h), f, l, c);
}
function vc2(t2, e) {
  return function(t3, e2) {
    var n2 = this, r2 = new wr();
    return t3.asyncQueue.enqueueAndForget(function() {
      return __awaiter(n2, void 0, void 0, function() {
        var n3;
        return __generator(this, function(i) {
          switch (i.label) {
            case 0:
              return n3 = Os, [4, Nu(t3)];
            case 1:
              return [2, n3.apply(void 0, [i.sent(), e2, r2])];
          }
        });
      });
    }), r2.promise;
  }(ua2(t2), e);
}
function mc2(t2, e, n2) {
  var r2 = n2.docs.get(e._key), i = new dc2(t2);
  return new Qa2(t2, i, e._key, r2, new Ga2(n2.hasPendingWrites, n2.fromCache), e.converter);
}
var gc2 = function(t2) {
  function e(e2, n2) {
    var r2 = this;
    return (r2 = t2.call(this, e2, n2) || this)._firestore = e2, r2;
  }
  return __extends(e, t2), e.prototype.get = function(e2) {
    var n2 = this, r2 = lc2(e2, this._firestore), i = new dc2(this._firestore);
    return t2.prototype.get.call(this, e2).then(function(t3) {
      return new Qa2(n2._firestore, i, r2._key, t3._document, new Ga2(false, false), r2.converter);
    });
  }, e;
}(function() {
  function t2(t3, e) {
    this._firestore = t3, this._transaction = e, this._dataReader = Ia2(t3);
  }
  return t2.prototype.get = function(t3) {
    var e = this, n2 = lc2(t3, this._firestore), r2 = new hc2(this._firestore);
    return this._transaction.lookup([n2._key]).then(function(t4) {
      if (!t4 || t4.length !== 1)
        return L2();
      var i = t4[0];
      if (i.isFoundDocument())
        return new Ba(e._firestore, r2, i.key, i, n2.converter);
      if (i.isNoDocument())
        return new Ba(e._firestore, r2, n2._key, null, n2.converter);
      throw L2();
    });
  }, t2.prototype.set = function(t3, e, n2) {
    var r2 = lc2(t3, this._firestore), i = cc2(r2.converter, e, n2), o = Ea2(this._dataReader, "Transaction.set", r2._key, i, r2.converter !== null, n2);
    return this._transaction.set(r2._key, o), this;
  }, t2.prototype.update = function(t3, e, n2) {
    for (var r2 = [], i = 3; i < arguments.length; i++)
      r2[i - 3] = arguments[i];
    var o, s = lc2(t3, this._firestore);
    return o = typeof (e = getModularInstance(e)) == "string" || e instanceof fa2 ? Ca2(this._dataReader, "Transaction.update", s._key, e, n2, r2) : ka2(this._dataReader, "Transaction.update", s._key, e), this._transaction.update(s._key, o), this;
  }, t2.prototype.delete = function(t3) {
    var e = lc2(t3, this._firestore);
    return this._transaction.delete(e._key), this;
  }, t2;
}());
function wc2() {
  if (typeof Uint8Array == "undefined")
    throw new N2(S2.UNIMPLEMENTED, "Uint8Arrays are not available in this environment.");
}
function bc2() {
  if (typeof atob == "undefined")
    throw new N2(S2.UNIMPLEMENTED, "Blobs are unavailable in Firestore in this environment.");
}
var Ic2 = function() {
  function t2(t3) {
    this._delegate = t3;
  }
  return t2.fromBase64String = function(e) {
    return bc2(), new t2(la.fromBase64String(e));
  }, t2.fromUint8Array = function(e) {
    return wc2(), new t2(la.fromUint8Array(e));
  }, t2.prototype.toBase64 = function() {
    return bc2(), this._delegate.toBase64();
  }, t2.prototype.toUint8Array = function() {
    return wc2(), this._delegate.toUint8Array();
  }, t2.prototype.isEqual = function(t3) {
    return this._delegate.isEqual(t3._delegate);
  }, t2.prototype.toString = function() {
    return "Blob(base64: " + this.toBase64() + ")";
  }, t2;
}();
var Ec2 = function() {
  function t2() {
  }
  return t2.prototype.enableIndexedDbPersistence = function(t3, e) {
    return function(t4, e2) {
      ha2(t4 = Qu(t4, sa2));
      var n2 = ua2(t4), r2 = t4._freezeSettings(), i = new lu();
      return ca2(n2, i, new hu(i, r2.cacheSizeBytes, e2 == null ? void 0 : e2.forceOwnership));
    }(t3._delegate, {
      forceOwnership: e
    });
  }, t2.prototype.enableMultiTabIndexedDbPersistence = function(t3) {
    return function(t4) {
      ha2(t4 = Qu(t4, sa2));
      var e = ua2(t4), n2 = t4._freezeSettings(), r2 = new lu();
      return ca2(e, r2, new fu(r2, n2.cacheSizeBytes));
    }(t3._delegate);
  }, t2.prototype.clearIndexedDbPersistence = function(t3) {
    return function(t4) {
      var e = this;
      if (t4._initialized && !t4._terminated)
        throw new N2(S2.FAILED_PRECONDITION, "Persistence can only be cleared before a Firestore instance is initialized or after it is terminated.");
      var n2 = new wr();
      return t4._queue.enqueueAndForgetEvenWhileRestricted(function() {
        return __awaiter(e, void 0, void 0, function() {
          var e2;
          return __generator(this, function(r2) {
            switch (r2.label) {
              case 0:
                return r2.trys.push([0, 2, , 3]), [4, function(t5) {
                  return __awaiter(this, void 0, void 0, function() {
                    var e3;
                    return __generator(this, function(n3) {
                      switch (n3.label) {
                        case 0:
                          return Er.yt() ? (e3 = t5 + "main", [4, Er.delete(e3)]) : [2, Promise.resolve()];
                        case 1:
                          return n3.sent(), [2];
                      }
                    });
                  });
                }(Li(t4._databaseId, t4._persistenceKey))];
              case 1:
                return r2.sent(), n2.resolve(), [3, 3];
              case 2:
                return e2 = r2.sent(), n2.reject(e2), [3, 3];
              case 3:
                return [2];
            }
          });
        });
      }), n2.promise;
    }(t3._delegate);
  }, t2;
}();
var Tc2 = function() {
  function t2(t3, e, n2) {
    var r2 = this;
    this._delegate = e, this.Xc = n2, this.INTERNAL = {
      delete: function() {
        return r2.terminate();
      }
    }, t3 instanceof xu || (this.Zc = t3);
  }
  return Object.defineProperty(t2.prototype, "_databaseId", {
    get: function() {
      return this._delegate._databaseId;
    },
    enumerable: false,
    configurable: true
  }), t2.prototype.settings = function(t3) {
    var e = this._delegate._getSettings();
    t3.merge || e.host === t3.host || x2("You are overriding the original host. If you did not intend to override your settings, use {merge: true}."), t3.merge && delete (t3 = Object.assign(Object.assign({}, e), t3)).merge, this._delegate._setSettings(t3);
  }, t2.prototype.useEmulator = function(t3, e, n2) {
    n2 === void 0 && (n2 = {}), function(t4, e2, n3, r2) {
      r2 === void 0 && (r2 = {});
      var i = (t4 = Qu(t4, Hu))._getSettings();
      if (i.host !== "firestore.googleapis.com" && i.host !== e2 && x2("Host has been set in both settings() and useEmulator(), emulator host will be used"), t4._setSettings(Object.assign(Object.assign({}, i), {
        host: e2 + ":" + n3,
        ssl: false
      })), r2.mockUserToken) {
        var o = createMockUserToken(r2.mockUserToken), s = r2.mockUserToken.sub || r2.mockUserToken.user_id;
        if (!s)
          throw new N2(S2.INVALID_ARGUMENT, "mockUserToken must contain 'sub' or 'user_id' field!");
        t4._credentials = new Pu(new Lu(o, new ho(s)));
      }
    }(this._delegate, t3, e, n2);
  }, t2.prototype.enableNetwork = function() {
    return function(t3) {
      var e = this;
      return t3.asyncQueue.enqueue(function() {
        return __awaiter(e, void 0, void 0, function() {
          var e2, n2;
          return __generator(this, function(r2) {
            switch (r2.label) {
              case 0:
                return [4, Tu(t3)];
              case 1:
                return e2 = r2.sent(), [4, Su(t3)];
              case 2:
                return n2 = r2.sent(), [2, (e2.setNetworkEnabled(true), function(t4) {
                  var e3 = P2(t4);
                  return e3.Or.delete(0), Mo(e3);
                }(n2))];
            }
          });
        });
      });
    }(ua2(Qu(this._delegate, sa2)));
  }, t2.prototype.disableNetwork = function() {
    return function(t3) {
      var e = this;
      return t3.asyncQueue.enqueue(function() {
        return __awaiter(e, void 0, void 0, function() {
          var e2, n2;
          return __generator(this, function(r2) {
            switch (r2.label) {
              case 0:
                return [4, Tu(t3)];
              case 1:
                return e2 = r2.sent(), [4, Su(t3)];
              case 2:
                return n2 = r2.sent(), [2, (e2.setNetworkEnabled(false), function(t4) {
                  return __awaiter(this, void 0, void 0, function() {
                    var e3;
                    return __generator(this, function(n3) {
                      switch (n3.label) {
                        case 0:
                          return (e3 = P2(t4)).Or.add(0), [4, Vo(e3)];
                        case 1:
                          return n3.sent(), e3.Br.set("Offline"), [2];
                      }
                    });
                  });
                }(n2))];
            }
          });
        });
      });
    }(ua2(Qu(this._delegate, sa2)));
  }, t2.prototype.enablePersistence = function(t3) {
    var e = false, n2 = false;
    return t3 && Bu("synchronizeTabs", e = !!t3.synchronizeTabs, "experimentalForceOwningTab", n2 = !!t3.experimentalForceOwningTab), e ? this.Xc.enableMultiTabIndexedDbPersistence(this) : this.Xc.enableIndexedDbPersistence(this, n2);
  }, t2.prototype.clearPersistence = function() {
    return this.Xc.clearIndexedDbPersistence(this);
  }, t2.prototype.terminate = function() {
    return this.Zc && (this.Zc._removeServiceInstance("firestore"), this.Zc._removeServiceInstance("firestore-exp")), this._delegate._delete();
  }, t2.prototype.waitForPendingWrites = function() {
    return function(t3) {
      var e = this, n2 = new wr();
      return t3.asyncQueue.enqueueAndForget(function() {
        return __awaiter(e, void 0, void 0, function() {
          var e2;
          return __generator(this, function(r2) {
            switch (r2.label) {
              case 0:
                return e2 = Us, [4, Nu(t3)];
              case 1:
                return [2, e2.apply(void 0, [r2.sent(), n2])];
            }
          });
        });
      }), n2.promise;
    }(ua2(Qu(this._delegate, sa2)));
  }, t2.prototype.onSnapshotsInSync = function(t3) {
    return function(t4, e) {
      return function(t5, e2) {
        var n2 = this, r2 = new pu(e2);
        return t5.asyncQueue.enqueueAndForget(function() {
          return __awaiter(n2, void 0, void 0, function() {
            var e3;
            return __generator(this, function(n3) {
              switch (n3.label) {
                case 0:
                  return e3 = function(t6, e4) {
                    P2(t6).Gr.add(e4), e4.next();
                  }, [4, Du(t5)];
                case 1:
                  return [2, e3.apply(void 0, [n3.sent(), r2])];
              }
            });
          });
        }), function() {
          r2.Wo(), t5.asyncQueue.enqueueAndForget(function() {
            return __awaiter(n2, void 0, void 0, function() {
              var e3;
              return __generator(this, function(n3) {
                switch (n3.label) {
                  case 0:
                    return e3 = function(t6, e4) {
                      P2(t6).Gr.delete(e4);
                    }, [4, Du(t5)];
                  case 1:
                    return [2, e3.apply(void 0, [n3.sent(), r2])];
                }
              });
            });
          });
        };
      }(ua2(t4 = Qu(t4, sa2)), ra2(e) ? e : {
        next: e
      });
    }(this._delegate, t3);
  }, Object.defineProperty(t2.prototype, "app", {
    get: function() {
      if (!this.Zc)
        throw new N2(S2.FAILED_PRECONDITION, "Firestore was not initialized using the Firebase SDK. 'app' is not available");
      return this.Zc;
    },
    enumerable: false,
    configurable: true
  }), t2.prototype.collection = function(t3) {
    try {
      return new Vc2(this, Ju(this._delegate, t3));
    } catch (t4) {
      throw Cc(t4, "collection()", "Firestore.collection()");
    }
  }, t2.prototype.doc = function(t3) {
    try {
      return new kc2(this, Zu(this._delegate, t3));
    } catch (t4) {
      throw Cc(t4, "doc()", "Firestore.doc()");
    }
  }, t2.prototype.collectionGroup = function(t3) {
    try {
      return new Pc2(this, function(t4, e) {
        if (t4 = Qu(t4, Hu), qu("collectionGroup", "collection id", e), e.indexOf("/") >= 0)
          throw new N2(S2.INVALID_ARGUMENT, "Invalid collection ID '" + e + "' passed to function collectionGroup(). Collection IDs must not contain '/'.");
        return new $u(t4, null, function(t5) {
          return new zt(W2.emptyPath(), t5);
        }(e));
      }(this._delegate, t3));
    } catch (t4) {
      throw Cc(t4, "collectionGroup()", "Firestore.collectionGroup()");
    }
  }, t2.prototype.runTransaction = function(t3) {
    var e = this;
    return function(t4, e2) {
      return function(t5, e3) {
        var n2 = this, r2 = new wr();
        return t5.asyncQueue.enqueueAndForget(function() {
          return __awaiter(n2, void 0, void 0, function() {
            var n3;
            return __generator(this, function(i) {
              switch (i.label) {
                case 0:
                  return [4, function(t6) {
                    return Eu(t6).then(function(t7) {
                      return t7.datastore;
                    });
                  }(t5)];
                case 1:
                  return n3 = i.sent(), new mu(t5.asyncQueue, n3, e3, r2).run(), [2];
              }
            });
          });
        }), r2.promise;
      }(ua2(t4), function(n2) {
        return e2(new gc2(t4, n2));
      });
    }(this._delegate, function(n2) {
      return t3(new Nc2(e, n2));
    });
  }, t2.prototype.batch = function() {
    var t3 = this;
    return ua2(this._delegate), new Dc2(new fc2(this._delegate, function(e) {
      return vc2(t3._delegate, e);
    }));
  }, t2.prototype.loadBundle = function(t3) {
    throw new N2(S2.FAILED_PRECONDITION, '"loadBundle()" does not exist, have you imported "firebase/firestore/bundle"?');
  }, t2.prototype.namedQuery = function(t3) {
    throw new N2(S2.FAILED_PRECONDITION, '"namedQuery()" does not exist, have you imported "firebase/firestore/bundle"?');
  }, t2;
}();
var _c = function(t2) {
  function e(e2) {
    var n2 = this;
    return (n2 = t2.call(this) || this).firestore = e2, n2;
  }
  return __extends(e, t2), e.prototype.convertBytes = function(t3) {
    return new Ic2(new la(t3));
  }, e.prototype.convertReference = function(t3) {
    var e2 = this.convertDocumentKey(t3, this.firestore._databaseId);
    return kc2.tu(e2, this.firestore, null);
  }, e;
}(ac2);
function Sc2(t2) {
  var e;
  e = t2, D2.setLogLevel(e);
}
var Nc2 = function() {
  function t2(t3, e) {
    this._firestore = t3, this._delegate = e, this._userDataWriter = new _c(t3);
  }
  return t2.prototype.get = function(t3) {
    var e = this, n2 = qc2(t3);
    return this._delegate.get(n2).then(function(t4) {
      return new Lc2(e._firestore, new Qa2(e._firestore._delegate, e._userDataWriter, t4._key, t4._document, t4.metadata, n2.converter));
    });
  }, t2.prototype.set = function(t3, e, n2) {
    var r2 = qc2(t3);
    return n2 ? (Uu("Transaction.set", n2), this._delegate.set(r2, e, n2)) : this._delegate.set(r2, e), this;
  }, t2.prototype.update = function(t3, e, n2) {
    for (var r2, i = [], o = 3; o < arguments.length; o++)
      i[o - 3] = arguments[o];
    var s = qc2(t3);
    return arguments.length === 2 ? this._delegate.update(s, e) : (r2 = this._delegate).update.apply(r2, __spreadArray([s, e, n2], i)), this;
  }, t2.prototype.delete = function(t3) {
    var e = qc2(t3);
    return this._delegate.delete(e), this;
  }, t2;
}();
var Dc2 = function() {
  function t2(t3) {
    this._delegate = t3;
  }
  return t2.prototype.set = function(t3, e, n2) {
    var r2 = qc2(t3);
    return n2 ? (Uu("WriteBatch.set", n2), this._delegate.set(r2, e, n2)) : this._delegate.set(r2, e), this;
  }, t2.prototype.update = function(t3, e, n2) {
    for (var r2, i = [], o = 3; o < arguments.length; o++)
      i[o - 3] = arguments[o];
    var s = qc2(t3);
    return arguments.length === 2 ? this._delegate.update(s, e) : (r2 = this._delegate).update.apply(r2, __spreadArray([s, e, n2], i)), this;
  }, t2.prototype.delete = function(t3) {
    var e = qc2(t3);
    return this._delegate.delete(e), this;
  }, t2.prototype.commit = function() {
    return this._delegate.commit();
  }, t2;
}();
var Ac2 = function() {
  function t2(t3, e, n2) {
    this._firestore = t3, this._userDataWriter = e, this._delegate = n2;
  }
  return t2.prototype.fromFirestore = function(t3, e) {
    var n2 = new za2(this._firestore._delegate, this._userDataWriter, t3._key, t3._document, t3.metadata, null);
    return this._delegate.fromFirestore(new Oc2(this._firestore, n2), e != null ? e : {});
  }, t2.prototype.toFirestore = function(t3, e) {
    return e ? this._delegate.toFirestore(t3, e) : this._delegate.toFirestore(t3);
  }, t2.eu = function(e, n2) {
    var r2 = t2.nu, i = r2.get(e);
    i || (i = new WeakMap(), r2.set(e, i));
    var o = i.get(n2);
    return o || (o = new t2(e, new _c(e), n2), i.set(n2, o)), o;
  }, t2;
}();
Ac2.nu = new WeakMap();
var kc2 = function() {
  function t2(t3, e) {
    this.firestore = t3, this._delegate = e, this._userDataWriter = new _c(t3);
  }
  return t2.su = function(e, n2, r2) {
    if (e.length % 2 != 0)
      throw new N2(S2.INVALID_ARGUMENT, "Invalid document reference. Document references must have an even number of segments, but " + e.canonicalString() + " has " + e.length);
    return new t2(n2, new Yu(n2._delegate, r2, new at(e)));
  }, t2.tu = function(e, n2, r2) {
    return new t2(n2, new Yu(n2._delegate, r2, e));
  }, Object.defineProperty(t2.prototype, "id", {
    get: function() {
      return this._delegate.id;
    },
    enumerable: false,
    configurable: true
  }), Object.defineProperty(t2.prototype, "parent", {
    get: function() {
      return new Vc2(this.firestore, this._delegate.parent);
    },
    enumerable: false,
    configurable: true
  }), Object.defineProperty(t2.prototype, "path", {
    get: function() {
      return this._delegate.path;
    },
    enumerable: false,
    configurable: true
  }), t2.prototype.collection = function(t3) {
    try {
      return new Vc2(this.firestore, Ju(this._delegate, t3));
    } catch (t4) {
      throw Cc(t4, "collection()", "DocumentReference.collection()");
    }
  }, t2.prototype.isEqual = function(t3) {
    return (t3 = getModularInstance(t3)) instanceof Yu && ta2(this._delegate, t3);
  }, t2.prototype.set = function(t3, e) {
    e = Uu("DocumentReference.set", e);
    try {
      return function(t4, e2, n2) {
        t4 = Qu(t4, Yu);
        var r2 = Qu(t4.firestore, sa2), i = cc2(t4.converter, e2, n2);
        return vc2(r2, [Ea2(Ia2(r2), "setDoc", t4._key, i, t4.converter !== null, n2).toMutation(t4._key, Ne.none())]);
      }(this._delegate, t3, e);
    } catch (t4) {
      throw Cc(t4, "setDoc()", "DocumentReference.set()");
    }
  }, t2.prototype.update = function(t3, e) {
    for (var n2 = [], r2 = 2; r2 < arguments.length; r2++)
      n2[r2 - 2] = arguments[r2];
    try {
      return arguments.length === 1 ? pc2(this._delegate, t3) : pc2.apply(void 0, __spreadArray([this._delegate, t3, e], n2));
    } catch (t4) {
      throw Cc(t4, "updateDoc()", "DocumentReference.update()");
    }
  }, t2.prototype.delete = function() {
    return vc2(Qu((t3 = this._delegate).firestore, sa2), [new Be(t3._key, Ne.none())]);
    var t3;
  }, t2.prototype.onSnapshot = function() {
    for (var t3 = this, e = [], n2 = 0; n2 < arguments.length; n2++)
      e[n2] = arguments[n2];
    var r2 = xc2(e), i = Rc2(e, function(e2) {
      return new Lc2(t3.firestore, new Qa2(t3.firestore._delegate, t3._userDataWriter, e2._key, e2._document, e2.metadata, t3._delegate.converter));
    });
    return yc(this._delegate, r2, i);
  }, t2.prototype.get = function(t3) {
    var e = this;
    return ((t3 == null ? void 0 : t3.source) === "cache" ? function(t4) {
      t4 = Qu(t4, Yu);
      var e2 = Qu(t4.firestore, sa2), n2 = ua2(e2), r2 = new dc2(e2);
      return function(t5, e3) {
        var n3 = this, r3 = new wr();
        return t5.asyncQueue.enqueueAndForget(function() {
          return __awaiter(n3, void 0, void 0, function() {
            var n4;
            return __generator(this, function(i) {
              switch (i.label) {
                case 0:
                  return n4 = function(t6, e4, n5) {
                    return __awaiter(this, void 0, void 0, function() {
                      var r4, i2;
                      return __generator(this, function(o) {
                        switch (o.label) {
                          case 0:
                            return o.trys.push([0, 2, , 3]), [4, function(t7, e5) {
                              var n6 = P2(t7);
                              return n6.persistence.runTransaction("read document", "readonly", function(t8) {
                                return n6.Mn.mn(t8, e5);
                              });
                            }(t6, e4)];
                          case 1:
                            return (i2 = o.sent()).isFoundDocument() ? n5.resolve(i2) : i2.isNoDocument() ? n5.resolve(null) : n5.reject(new N2(S2.UNAVAILABLE, "Failed to get document from cache. (However, this document may exist on the server. Run again without setting 'source' in the GetOptions to attempt to retrieve the document from the server.)")), [3, 3];
                          case 2:
                            return r4 = o.sent(), i2 = cs(r4, "Failed to get document '" + e4 + " from cache"), n5.reject(i2), [3, 3];
                          case 3:
                            return [2];
                        }
                      });
                    });
                  }, [4, _u(t5)];
                case 1:
                  return [2, n4.apply(void 0, [i.sent(), e3, r3])];
              }
            });
          });
        }), r3.promise;
      }(n2, t4._key).then(function(n3) {
        return new Qa2(e2, r2, t4._key, n3, new Ga2(n3 !== null && n3.hasLocalMutations, true), t4.converter);
      });
    }(this._delegate) : (t3 == null ? void 0 : t3.source) === "server" ? function(t4) {
      t4 = Qu(t4, Yu);
      var e2 = Qu(t4.firestore, sa2);
      return Au(ua2(e2), t4._key, {
        source: "server"
      }).then(function(n2) {
        return mc2(e2, t4, n2);
      });
    }(this._delegate) : function(t4) {
      t4 = Qu(t4, Yu);
      var e2 = Qu(t4.firestore, sa2);
      return Au(ua2(e2), t4._key).then(function(n2) {
        return mc2(e2, t4, n2);
      });
    }(this._delegate)).then(function(t4) {
      return new Lc2(e.firestore, new Qa2(e.firestore._delegate, e._userDataWriter, t4._key, t4._document, t4.metadata, e._delegate.converter));
    });
  }, t2.prototype.withConverter = function(e) {
    return new t2(this.firestore, e ? this._delegate.withConverter(Ac2.eu(this.firestore, e)) : this._delegate.withConverter(null));
  }, t2;
}();
function Cc(t2, e, n2) {
  return t2.message = t2.message.replace(e, n2), t2;
}
function xc2(t2) {
  for (var e = 0, n2 = t2; e < n2.length; e++) {
    var r2 = n2[e];
    if (typeof r2 == "object" && !ra2(r2))
      return r2;
  }
  return {};
}
function Rc2(t2, e) {
  var n2, r2, i;
  return {
    next: function(t3) {
      i.next && i.next(e(t3));
    },
    error: (n2 = (i = ra2(t2[0]) ? t2[0] : ra2(t2[1]) ? t2[1] : typeof t2[0] == "function" ? {
      next: t2[0],
      error: t2[1],
      complete: t2[2]
    } : {
      next: t2[1],
      error: t2[2],
      complete: t2[3]
    }).error) === null || n2 === void 0 ? void 0 : n2.bind(i),
    complete: (r2 = i.complete) === null || r2 === void 0 ? void 0 : r2.bind(i)
  };
}
var Lc2 = function() {
  function t2(t3, e) {
    this._firestore = t3, this._delegate = e;
  }
  return Object.defineProperty(t2.prototype, "ref", {
    get: function() {
      return new kc2(this._firestore, this._delegate.ref);
    },
    enumerable: false,
    configurable: true
  }), Object.defineProperty(t2.prototype, "id", {
    get: function() {
      return this._delegate.id;
    },
    enumerable: false,
    configurable: true
  }), Object.defineProperty(t2.prototype, "metadata", {
    get: function() {
      return this._delegate.metadata;
    },
    enumerable: false,
    configurable: true
  }), Object.defineProperty(t2.prototype, "exists", {
    get: function() {
      return this._delegate.exists();
    },
    enumerable: false,
    configurable: true
  }), t2.prototype.data = function(t3) {
    return this._delegate.data(t3);
  }, t2.prototype.get = function(t3, e) {
    return this._delegate.get(t3, e);
  }, t2.prototype.isEqual = function(t3) {
    return Ya2(this._delegate, t3._delegate);
  }, t2;
}();
var Oc2 = function(t2) {
  function e() {
    return t2 !== null && t2.apply(this, arguments) || this;
  }
  return __extends(e, t2), e.prototype.data = function(t3) {
    return this._delegate.data(t3);
  }, e;
}(Lc2);
var Pc2 = function() {
  function t2(t3, e) {
    this.firestore = t3, this._delegate = e, this._userDataWriter = new _c(t3);
  }
  return t2.prototype.where = function(e, n2, r2) {
    try {
      return new t2(this.firestore, Ja2(this._delegate, function(t3, e2, n3) {
        var r3 = e2, i = Ka2("where", t3);
        return new Za2(i, r3, n3);
      }(e, n2, r2)));
    } catch (e2) {
      throw Cc(e2, /(orderBy|where)\(\)/, "Query.$1()");
    }
  }, t2.prototype.orderBy = function(e, n2) {
    try {
      return new t2(this.firestore, Ja2(this._delegate, function(t3, e2) {
        e2 === void 0 && (e2 = "asc");
        var n3 = e2, r2 = Ka2("orderBy", t3);
        return new tc2(r2, n3);
      }(e, n2)));
    } catch (e2) {
      throw Cc(e2, /(orderBy|where)\(\)/, "Query.$1()");
    }
  }, t2.prototype.limit = function(e) {
    try {
      return new t2(this.firestore, Ja2(this._delegate, function(t3) {
        return zu("limit", t3), new ec2("limit", t3, "F");
      }(e)));
    } catch (e2) {
      throw Cc(e2, "limit()", "Query.limit()");
    }
  }, t2.prototype.limitToLast = function(e) {
    try {
      return new t2(this.firestore, Ja2(this._delegate, function(t3) {
        return zu("limitToLast", t3), new ec2("limitToLast", t3, "L");
      }(e)));
    } catch (e2) {
      throw Cc(e2, "limitToLast()", "Query.limitToLast()");
    }
  }, t2.prototype.startAt = function() {
    for (var e = [], n2 = 0; n2 < arguments.length; n2++)
      e[n2] = arguments[n2];
    try {
      return new t2(this.firestore, Ja2(this._delegate, function() {
        for (var t3 = [], e2 = 0; e2 < arguments.length; e2++)
          t3[e2] = arguments[e2];
        return new nc2("startAt", t3, true);
      }.apply(void 0, e)));
    } catch (e2) {
      throw Cc(e2, "startAt()", "Query.startAt()");
    }
  }, t2.prototype.startAfter = function() {
    for (var e = [], n2 = 0; n2 < arguments.length; n2++)
      e[n2] = arguments[n2];
    try {
      return new t2(this.firestore, Ja2(this._delegate, function() {
        for (var t3 = [], e2 = 0; e2 < arguments.length; e2++)
          t3[e2] = arguments[e2];
        return new nc2("startAfter", t3, false);
      }.apply(void 0, e)));
    } catch (e2) {
      throw Cc(e2, "startAfter()", "Query.startAfter()");
    }
  }, t2.prototype.endBefore = function() {
    for (var e = [], n2 = 0; n2 < arguments.length; n2++)
      e[n2] = arguments[n2];
    try {
      return new t2(this.firestore, Ja2(this._delegate, function() {
        for (var t3 = [], e2 = 0; e2 < arguments.length; e2++)
          t3[e2] = arguments[e2];
        return new rc2("endBefore", t3, true);
      }.apply(void 0, e)));
    } catch (e2) {
      throw Cc(e2, "endBefore()", "Query.endBefore()");
    }
  }, t2.prototype.endAt = function() {
    for (var e = [], n2 = 0; n2 < arguments.length; n2++)
      e[n2] = arguments[n2];
    try {
      return new t2(this.firestore, Ja2(this._delegate, function() {
        for (var t3 = [], e2 = 0; e2 < arguments.length; e2++)
          t3[e2] = arguments[e2];
        return new rc2("endAt", t3, false);
      }.apply(void 0, e)));
    } catch (e2) {
      throw Cc(e2, "endAt()", "Query.endAt()");
    }
  }, t2.prototype.isEqual = function(t3) {
    return ea2(this._delegate, t3._delegate);
  }, t2.prototype.get = function(t3) {
    var e = this;
    return ((t3 == null ? void 0 : t3.source) === "cache" ? function(t4) {
      t4 = Qu(t4, $u);
      var e2 = Qu(t4.firestore, sa2), n2 = ua2(e2), r2 = new dc2(e2);
      return function(t5, e3) {
        var n3 = this, r3 = new wr();
        return t5.asyncQueue.enqueueAndForget(function() {
          return __awaiter(n3, void 0, void 0, function() {
            var n4;
            return __generator(this, function(i) {
              switch (i.label) {
                case 0:
                  return n4 = function(t6, e4, n5) {
                    return __awaiter(this, void 0, void 0, function() {
                      var r4, i2, o, s, u2;
                      return __generator(this, function(a) {
                        switch (a.label) {
                          case 0:
                            return a.trys.push([0, 2, , 3]), [4, Hi(t6, e4, true)];
                          case 1:
                            return u2 = a.sent(), r4 = new Ds(e4, u2.Bn), i2 = r4._o(u2.documents), o = r4.applyChanges(i2, false), n5.resolve(o.snapshot), [3, 3];
                          case 2:
                            return s = a.sent(), u2 = cs(s, "Failed to execute query '" + e4 + " against cache"), n5.reject(u2), [3, 3];
                          case 3:
                            return [2];
                        }
                      });
                    });
                  }, [4, _u(t5)];
                case 1:
                  return [2, n4.apply(void 0, [i.sent(), e3, r3])];
              }
            });
          });
        }), r3.promise;
      }(n2, t4._query).then(function(n3) {
        return new Wa2(e2, r2, t4, n3);
      });
    }(this._delegate) : (t3 == null ? void 0 : t3.source) === "server" ? function(t4) {
      t4 = Qu(t4, $u);
      var e2 = Qu(t4.firestore, sa2), n2 = ua2(e2), r2 = new dc2(e2);
      return ku(n2, t4._query, {
        source: "server"
      }).then(function(n3) {
        return new Wa2(e2, r2, t4, n3);
      });
    }(this._delegate) : function(t4) {
      t4 = Qu(t4, $u);
      var e2 = Qu(t4.firestore, sa2), n2 = ua2(e2), r2 = new dc2(e2);
      return $a2(t4._query), ku(n2, t4._query).then(function(n3) {
        return new Wa2(e2, r2, t4, n3);
      });
    }(this._delegate)).then(function(t4) {
      return new Mc2(e.firestore, new Wa2(e.firestore._delegate, e._userDataWriter, e._delegate, t4._snapshot));
    });
  }, t2.prototype.onSnapshot = function() {
    for (var t3 = this, e = [], n2 = 0; n2 < arguments.length; n2++)
      e[n2] = arguments[n2];
    var r2 = xc2(e), i = Rc2(e, function(e2) {
      return new Mc2(t3.firestore, new Wa2(t3.firestore._delegate, t3._userDataWriter, t3._delegate, e2._snapshot));
    });
    return yc(this._delegate, r2, i);
  }, t2.prototype.withConverter = function(e) {
    return new t2(this.firestore, e ? this._delegate.withConverter(Ac2.eu(this.firestore, e)) : this._delegate.withConverter(null));
  }, t2;
}();
var Fc2 = function() {
  function t2(t3, e) {
    this._firestore = t3, this._delegate = e;
  }
  return Object.defineProperty(t2.prototype, "type", {
    get: function() {
      return this._delegate.type;
    },
    enumerable: false,
    configurable: true
  }), Object.defineProperty(t2.prototype, "doc", {
    get: function() {
      return new Oc2(this._firestore, this._delegate.doc);
    },
    enumerable: false,
    configurable: true
  }), Object.defineProperty(t2.prototype, "oldIndex", {
    get: function() {
      return this._delegate.oldIndex;
    },
    enumerable: false,
    configurable: true
  }), Object.defineProperty(t2.prototype, "newIndex", {
    get: function() {
      return this._delegate.newIndex;
    },
    enumerable: false,
    configurable: true
  }), t2;
}();
var Mc2 = function() {
  function t2(t3, e) {
    this._firestore = t3, this._delegate = e;
  }
  return Object.defineProperty(t2.prototype, "query", {
    get: function() {
      return new Pc2(this._firestore, this._delegate.query);
    },
    enumerable: false,
    configurable: true
  }), Object.defineProperty(t2.prototype, "metadata", {
    get: function() {
      return this._delegate.metadata;
    },
    enumerable: false,
    configurable: true
  }), Object.defineProperty(t2.prototype, "size", {
    get: function() {
      return this._delegate.size;
    },
    enumerable: false,
    configurable: true
  }), Object.defineProperty(t2.prototype, "empty", {
    get: function() {
      return this._delegate.empty;
    },
    enumerable: false,
    configurable: true
  }), Object.defineProperty(t2.prototype, "docs", {
    get: function() {
      var t3 = this;
      return this._delegate.docs.map(function(e) {
        return new Oc2(t3._firestore, e);
      });
    },
    enumerable: false,
    configurable: true
  }), t2.prototype.docChanges = function(t3) {
    var e = this;
    return this._delegate.docChanges(t3).map(function(t4) {
      return new Fc2(e._firestore, t4);
    });
  }, t2.prototype.forEach = function(t3, e) {
    var n2 = this;
    this._delegate.forEach(function(r2) {
      t3.call(e, new Oc2(n2._firestore, r2));
    });
  }, t2.prototype.isEqual = function(t3) {
    return Ya2(this._delegate, t3._delegate);
  }, t2;
}();
var Vc2 = function(t2) {
  function e(e2, n2) {
    var r2 = this;
    return (r2 = t2.call(this, e2, n2) || this).firestore = e2, r2._delegate = n2, r2;
  }
  return __extends(e, t2), Object.defineProperty(e.prototype, "id", {
    get: function() {
      return this._delegate.id;
    },
    enumerable: false,
    configurable: true
  }), Object.defineProperty(e.prototype, "path", {
    get: function() {
      return this._delegate.path;
    },
    enumerable: false,
    configurable: true
  }), Object.defineProperty(e.prototype, "parent", {
    get: function() {
      var t3 = this._delegate.parent;
      return t3 ? new kc2(this.firestore, t3) : null;
    },
    enumerable: false,
    configurable: true
  }), e.prototype.doc = function(t3) {
    try {
      return new kc2(this.firestore, t3 === void 0 ? Zu(this._delegate) : Zu(this._delegate, t3));
    } catch (t4) {
      throw Cc(t4, "doc()", "CollectionReference.doc()");
    }
  }, e.prototype.add = function(t3) {
    var e2 = this;
    return function(t4, e3) {
      var n2 = Qu(t4.firestore, sa2), r2 = Zu(t4), i = cc2(t4.converter, e3);
      return vc2(n2, [Ea2(Ia2(t4.firestore), "addDoc", r2._key, i, t4.converter !== null, {}).toMutation(r2._key, Ne.exists(false))]).then(function() {
        return r2;
      });
    }(this._delegate, t3).then(function(t4) {
      return new kc2(e2.firestore, t4);
    });
  }, e.prototype.isEqual = function(t3) {
    return ta2(this._delegate, t3._delegate);
  }, e.prototype.withConverter = function(t3) {
    return new e(this.firestore, t3 ? this._delegate.withConverter(Ac2.eu(this.firestore, t3)) : this._delegate.withConverter(null));
  }, e;
}(Pc2);
function qc2(t2) {
  return Qu(t2, Yu);
}
var Uc2 = function() {
  function t2() {
    for (var t3 = [], e = 0; e < arguments.length; e++)
      t3[e] = arguments[e];
    this._delegate = new (fa2.bind.apply(fa2, __spreadArray([void 0], t3)))();
  }
  return t2.documentId = function() {
    return new t2(Y2.keyField().canonicalString());
  }, t2.prototype.isEqual = function(t3) {
    return (t3 = getModularInstance(t3)) instanceof fa2 && this._delegate._internalPath.isEqual(t3._internalPath);
  }, t2;
}();
var Bc2 = function() {
  function t2(t3) {
    this._delegate = t3;
  }
  return t2.serverTimestamp = function() {
    var e = new Sa("serverTimestamp");
    return e._methodName = "FieldValue.serverTimestamp", new t2(e);
  }, t2.delete = function() {
    var e = new Ta2("deleteField");
    return e._methodName = "FieldValue.delete", new t2(e);
  }, t2.arrayUnion = function() {
    for (var e = [], n2 = 0; n2 < arguments.length; n2++)
      e[n2] = arguments[n2];
    var r2 = function() {
      for (var t3 = [], e2 = 0; e2 < arguments.length; e2++)
        t3[e2] = arguments[e2];
      return new Na("arrayUnion", t3);
    }.apply(void 0, e);
    return r2._methodName = "FieldValue.arrayUnion", new t2(r2);
  }, t2.arrayRemove = function() {
    for (var e = [], n2 = 0; n2 < arguments.length; n2++)
      e[n2] = arguments[n2];
    var r2 = function() {
      for (var t3 = [], e2 = 0; e2 < arguments.length; e2++)
        t3[e2] = arguments[e2];
      return new Da2("arrayRemove", t3);
    }.apply(void 0, e);
    return r2._methodName = "FieldValue.arrayRemove", new t2(r2);
  }, t2.increment = function(e) {
    var n2 = function(t3) {
      return new Aa("increment", t3);
    }(e);
    return n2._methodName = "FieldValue.increment", new t2(n2);
  }, t2.prototype.isEqual = function(t3) {
    return this._delegate.isEqual(t3._delegate);
  }, t2;
}();

// node_modules/@firebase/firestore/dist/esm5/index.js
var I2 = {
  Firestore: Tc2,
  GeoPoint: pa2,
  Timestamp: B,
  Blob: Ic2,
  Transaction: Nc2,
  WriteBatch: Dc2,
  DocumentReference: kc2,
  DocumentSnapshot: Lc2,
  Query: Pc2,
  QueryDocumentSnapshot: Oc2,
  QuerySnapshot: Mc2,
  CollectionReference: Vc2,
  FieldPath: Uc2,
  FieldValue: Bc2,
  setLogLevel: Sc2,
  CACHE_SIZE_UNLIMITED: oa2
};
function P3(e) {
  !function(e2, r2) {
    e2.INTERNAL.registerComponent(new Component("firestore", function(e3) {
      var t2 = e3.getProvider("app").getImmediate();
      return r2(t2, e3.getProvider("auth-internal"));
    }, "PUBLIC").setServiceProps(Object.assign({}, I2)));
  }(e, function(e2, s) {
    return new Tc2(e2, new sa2(e2, s), new Ec2());
  }), e.registerVersion("@firebase/firestore", "2.3.6");
}
P3(index_esm_default);
/*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
//# sourceMappingURL=firebase_firestore.js.map
